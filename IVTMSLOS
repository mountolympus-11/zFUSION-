IVTMSLOS TITLE 'INTEGRATOR - ISESS LOSTERM PROCESSOR'                   00010000
**<DOC-ON>************************************************************* 00020000
*                                                                       00030000
* ROUTINE: IVTMSLOS - ISESS LOSTERM PROCESSOR                           00040000
*                                                                       00050000
* DESCRIPTION: THIS ROUTINE IS CALLED BY IVTMSESS TO PROCESS THE        00060000
*              LOSTERM WORK ELEMENT.                                    00070000
*                                                                       00080000
* ON ENTRY:                                                             00090000
*                                                                       00100000
*    R15 = ENTRY POINT ADDRESS                                          00110000
*    R14 = RETURN ADDRESS                                               00120000
*    R13 = AVAILABLE SAVE AREA                                          00130000
*    R11 = ICVT ADDRESS                                                 00140000
*    R10 = ITASK ADDRESS                                                00150000
*    R09 = IVTAMCVT ADDRESS                                             00160000
*    R08 = ISESS ADDRESS                                                00170000
*    R01 = ADDRESS OF LOSTERM WORK ELEMENT (IWEX3)                      00180000
*                                                                       00190000
* ON EXIT:                                                              00200000
*                                                                       00210000
*    R15 = 0                                                            00220000
*    R00 = 0                                                            00230000
*    R01 = 0                                                            00240000
*                                                                       00250000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00260000
*                                                                       00270000
**<DOC-OFF>************************************************************ 00280000
                                                                        00290000
         EJECT ,                                                        00300000
*********************************************************************** 00310000
*                                                                       00320000
* MAINTENANCE:                                                          00330000
*                                                                       00340000
*   08/01/93 RANDY WITEK                                                00350000
*                                                                       00360000
*********************************************************************** 00370000
                                                                        00380000
         EQUS  ,                  GENERAL EQUATES                       00390000
                                                                        00400000
RICVT    EQU   R11                                                      00410000
RITASK   EQU   R10                                                      00420000
RIVTAM   EQU   R9                                                       00430000
RISESS   EQU   R8                                                       00440000
RIACB    EQU   R7                                                       00450000
RIRPL    EQU   R6                                                       00460000
RIWE     EQU   R5                                                       00470000
RCODE    EQU   R4                                                       00480000
                                                                        00490000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00500000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00510000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00520000
         USING ISESS,RISESS       ESTABLISH ADDRESSABILITY              00530000
         USING IACB,RIACB         ESTABLISH ADDRESSABILITY              00540000
         USING IRPL,RIRPL         ESTABLISH ADDRESSABILITY              00550000
         USING IWEVTAM,RIWE       ESTABLISH ADDRESSABILITY              00560000
         USING ISTDBIND,ISEBIND   ESTABLISH ADDRESSABILITY              00570000
                                                                        00580000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00590000
WRK256   DS    XL256              GENERAL WORKAREA                      00600000
RETR15   DS    F                                                        00610000
RETR0    DS    F                                                        00620000
RETR1    DS    F                                                        00630000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      00640000
WORKLEN  #ENDWORK                 END OF WORKAREA                       00650000
                                                                        00660000
         $MSGDFT PREFIX=ICTPID,                                        +00670000
               COMPID='VTM',                                           +00680000
               TABLE=*#MSGS,                                           +00690000
               WORKA=0,                                                +00700000
               MF=(E,WRK256),                                          +00710000
               PRINT=NOGEN                                              00720000
                                                                        00730000
IVTMSLOS #ENTER BASE=R12,         ENTRY LINKAGE                        +00740000
               PREG=RIWE,                                              +00750000
               AMODE=31,                                               +00760000
               RMODE=ANY                                                00770000
                                                                        00780000
         L     RIACB,IWEX3ACB     ASSOCIATED ACB                        00790000
         L     RCODE,IWEX3RC      LOSTERM REASON CODE                   00800000
                                                                        00810000
*---------------------------------------------------------------------- 00820000
* VERIFY THE SESSION CID, IGNORE WORK ELEMENT IF NO MATCH               00830000
*---------------------------------------------------------------------- 00840000
                                                                        00850000
         CLC   ISECID,IWEX3CID    CID MATCH?                            00860000
         BNE   RETURN             BRANCH IF NOT                         00870000
                                                                        00880000
*---------------------------------------------------------------------- 00890000
* QUEUE AN END SESSION WORK ELEMENT TO THE ISESS PROCESS                00900000
*---------------------------------------------------------------------- 00910000
                                                                        00920000
         $VTAMWE L'IWEXH,         LENGTH                               +00930000
               IWECENDS           CODE                                  00940000
                                                                        00950000
         LR    R3,R1              WORK ELEMENT ADDRESS                  00960000
                                                                        00970000
         $VTAMQ (R3),             WORK ELEMENT                         +00980000
               ISEWEQ             QUEUE                                 00990000
                                                                        01000000
         B     RETURN                                                   01010000
                                                                        01020000
*---------------------------------------------------------------------- 01030000
* RETURN TO CALLER                                                      01040000
*---------------------------------------------------------------------- 01050000
                                                                        01060000
RETURN   DS    0H                                                       01070000
                                                                        01080000
         LM    R15,R1,RETREGS     LOAD RETURN VALUES                    01090000
                                                                        01100000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    01110000
                                                                        01120000
*---------------------------------------------------------------------- 01130000
* ERROR ROUTINES                                                        01140000
*---------------------------------------------------------------------- 01150000
                                                                        01160000
ERR$VTAM DS    0H                                                       01170000
                                                                        01180000
         $ABEND ABE_VTDIAG,                                            +01190000
               SCOPE=PCB,                                              +01200000
               TITLE='$VTAM FAILURE'                                    01210000
                                                                        01220000
*---------------------------------------------------------------------- 01230000
*  CONSTANTS AND LITERALS                                               01240000
*---------------------------------------------------------------------- 01250000
                                                                        01260000
         LTORG ,                                                        01270000
         PRINT NOGEN                                                    01280000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                01290000
         ISTDBIND ,               VTAM BIND IMAGE                       01300000
         TRACODES ,               INTEGRATOR TRACE CODE EQUATES         01310000
         ICVT  ,                  INTEGRATOR CVT                        01320000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   01330000
         IRPL ,                   INTEGRATOR VTAM RPL+                  01340000
         IACB ,                   INTEGRATOR VTAM ACB+                  01350000
         INIB ,                   INTEGRATOR VTAM NIB+                  01360000
         ISESS ,                  INTEGRATOR SESSION BLOCK              01370000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            01380000
         ITASK ,                  INTEGRATOR TASK BLOCK                 01390000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          01400000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       01410000
         EVCODES ,                INTEGRATOR EVENT CODES                01420000
         ABCODES ,                INTEGRATOR $ABEND CODES               01430000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     01440000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        01450000
         END   ,                                                        01460000
