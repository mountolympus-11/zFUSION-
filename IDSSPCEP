IDSSPCEP TITLE 'IDSSPCEP - DATASPACE SERVICES ROUTER'                   00010000
***************************************************************         00020000
*                                                                       00030000
*   READ / WRITE WORKING STORAGE AREA                                   00040000
*                                                                       00050000
***************************************************************         00060000
WORKAREA DSECT                                                          00070000
                                                                        00080001
         @WORK PLIST=NO                                                 00090001
                                                                        00100001
TRACREGS DS    16F                                                      00110000
                                                                        00120004
WORKLEN  EQU   *-WORKAREA                                               00130000
                                                                        00140000
         EJECT                                                          00150000
         TRACODES PRINT=NOGEN                                           00160000
                                                                        00170000
         EQUS  LINKAGE=VCON                                             00180000
                                                                        00190000
         EJECT ,                                                        00200000
**<DOC-ON>*****************************************************         00210001
*                                                                       00220000
* ROUTINE: IDSSPCEP - DATASPACE SERVICES ROUTER                         00230000
*                                                                       00240000
* DESCRIPTION:                                                          00250000
*                                                                       00260000
*    THIS ROUTINE SERVES AS THE $SPACE SERVICE FACILITY ROUTER,         00270000
*    BRIDGING PRIMARY ASCMODE CALLERS TO AR ASCMODE AND AMODE31         00280000
*    MAINTAINED BY THE $SPACE MANAGEMENT ROUTINES.  THE $SPACE          00290000
*    MACRO IDENTIFIES SPECIFIC SERVICES BY A FUNCTION CODE              00300000
*    THAT IS CONVERTED TO A MODULE ADDRESS BY THIS ROUTINE.             00310000
*    IN ADDITION, THE SUITABILITY OF THE 4K WORKAREA PASSED             00320000
*    VIA R0 IS VALIDATED.                                               00330000
*                                                                       00340000
*                                                                       00350000
* ON ENTRY:                                                             00360000
*                                                                       00370000
*    R1  POINTS TO A SERVICE-DEPENDENT OS/VS PARAMETER LIST             00380000
*        RESIDING IN THE PRIMARY ADDRESS SPACE.                         00390000
*                                                                       00400000
*    R0  CONTAINS THE ADDRESS OF A WORKAREA USED BY DATASPACE           00410000
*        SERVICE ROUTINES TO ACQUIRE SAVEAREAS (NON-ESA) AND            00420000
*        OTHER WORKAREAS.                                               00430000
*                                                                       00440000
*    R15 CONTAINS A $SPACE SERVICE FUNCTION CODE                        00450000
*                                                                       00460000
*                                                                       00470000
* ON EXIT:                                                              00480000
*                                                                       00490000
*    R15 CONTAINS A SERVICE-DEPENDENT RETURN CODE.  R0 AND R1           00500000
*        MAY ALSO CONTAIN RELATED REASON CODES AND/OR CONTROL           00510000
*        BLOCK ADDRESSES USEFUL FOR PROBLEM RESOLUTION.  THE            00520000
*        FOLLOWING RETURN CODES HAVE STANDARD MEANINGS ACROSS           00530000
*        ALL $SPACE SERVICES.                                           00540000
*                                                                       00550000
*        RC00 - NORMAL COMPLETION. THE REQUESTED FUNCTION               00560000
*               COMPLETED WITHOUT ERROR.                                00570000
*                                                                       00580000
*        RC04 - FUNCTION DEPENDENT WARNING. SUCCESSFUL PROGRAM          00590000
*               CONTINUATION IS LIKELY.                                 00600000
*                                                                       00610000
*        RC08 - FAILURE ENCOUNTERED. SUCCESSFUL PROGRAM                 00620000
*               CONTINUATION DEPENDENT UPON REQUESTOR'S RECOVERY        00630000
*               STRATEGY.                                               00640000
*                                                                       00650000
*        RC12 - FUNCTION DEPENDENT ERROR OF CRITICAL SEVERITY.          00660000
*                                                                       00670000
*        RC16 - REQUEST IN ERROR. THE REQUEST WAS INVALID AND           00680000
*               USUALLY THE RESULT OF A PROGRAMMING ERROR.              00690000
*                                                                       00700000
*        RC20 - ALU TRANSLATION ERROR.  A STORAGE EXTENT REFERRED       00710000
*               TO BY ALU NUMBER IN THE WORK SPACE IS NOT VALID OR      00720000
*               IS NOT PROPERLY DEFINED IN THE STORAGE MANAGER.         00730000
*                                                                       00740000
*        RC24 - THE WORK AREA PROVIDED VIA R0 DOES NOT SATISFY          00750000
*               REQUIREMENTS.                                           00760000
*                                                                       00770000
**<DOC-OFF>****************************************************         00780001
                                                                        00790001
         EJECT ,                                                        00800000
IDSSPCEP @ENTER WORKA=(WORKAREA,WORKLEN),                              X00810007
               EPA=,              NO ENTRY POINT ADDR PROVIDED         X00820010
               ASC=,              ASC MODE REMAINS UNCHANGED           X00830006
               SERVICE_EPA=YES    INITIAL ENTRY TO $SPACE SERVICE       00840006
                                                                        00850003
         LA    R15,CONTINUE       BEGIN AMODE 31                        00860002
         O     R15,=X'80000000'                                         00870002
         BSM   0,R15                                                    00880002
CONTINUE DS    0H                                                       00890005
                                                                        00900005
*--------------------------------------------------------------         00910000
*   TRACE REQUEST                                                       00920000
*--------------------------------------------------------------         00930000
         EREG  R14,R1             EXTRACT ENTRY REGS                    00940000
         STM   R14,R1,TRACREGS    SAVE FOR TRACE RECORD                 00950000
                                                                        00960000
         $TRACE *=A(TRC_SPACE_IN),4*4,STDENV=NO                         00970000
         BNZ   *+10               REQUEST FAILED                        00980000
         MVC   0(4*4,R1),TRACREGS INSERT REGS                           00990000
                                                                        01000000
*--------------------------------------------------------------         01010000
*   INVOKE SPACE FUNCTION                                               01020000
*--------------------------------------------------------------         01030000
         EREG  R15,R1             RESTORE PARM REGS                     01040000
         BCTR  R15,0              ZERO RELATIVE FUNCTION CODE           01050000
         SLL   R15,2              PTR ARRAY INDEX                       01060000
         L     R15,FUNCDIR(R15)   FETCH EPA                             01070000
         BASR  R14,R15            INVOKE DESIGNATED SERVICE RTN         01080000
                                                                        01090000
*--------------------------------------------------------------         01100000
*   TRACE RESULTS                                                       01110000
*--------------------------------------------------------------         01120000
         STM   R15,R1,TRACREGS+4  SAVE FOR TRACE RECORD                 01130000
                                                                        01140000
         $TRACE *=A(TRC_SPACE_OUT),4*4,STDENV=NO                        01150000
         BNZ   *+10               REQUEST FAILED                        01160000
         MVC   0(4*4,R1),TRACREGS INSERT REGS                           01170000
                                                                        01180000
         LM    R14,R1,TRACREGS    RESTORE RETURN REGS                   01190000
         B     RET                RETURN                                01200000
                                                                        01210000
*--------------------------------------------------------------         01220000
*   RETURN COMPLETION STATUS TO CALLER                                  01230000
*--------------------------------------------------------------         01240000
ERR_WKA  DS    0H                 INVALID WORKAREA                      01250000
         LA    R15,RC24           INDICATE ERROR                        01260000
         LAE   R1,0(0,0)                                                01270000
         LAE   R0,0(0,0)                                                01280000
                                                                        01290000
RET      DS    0H                                                       01300000
         @EXIT ,                                                        01310002
                                                                        01320000
         EJECT ,                                                        01330000
***************************************************************         01340000
*                                                                       01350000
*   READ ONLY CONSTANTS, ETC.                                           01360000
*                                                                       01370000
***************************************************************         01380000
FUNCDIR  DS    0A                                                       01390000
         DC    V(IDSSPCCR)        01 CREATE                             01400000
         DC    V(IDSSPCDE)        02 DESTROY                            01410000
         DC    V(IDSSPCXT)        03 EXTEND                             01420000
         DC    V(IDSSPCIM)        04 IMPORT                             01430000
         DC    V(IDSSPCEX)        05 EXPORT                             01440000
         DC    V(IDSSPCCF)        06 CONFIG                             01450000
         DC    V(IDSSPCAU)        07 ALU SIZE                           01460000
         DC    A(0)               -- RESERVED                           01470000
                                                                        01480000
         LTORG ,                                                        01490000
         END   ,                                                        01500000
