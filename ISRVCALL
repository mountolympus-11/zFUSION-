ISRVCALL TITLE '- Task Server CALLDSP'                                  00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE: ISRVCALL - Task Server CALLDSP                               00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine is entered from the task manager dispatch             00080000
*    facility for an ITASK running under a server ITASK.  When          00090000
*    a task is about to wait for event completion, the server           00100000
*    dispatcher is called to determine if any other ITASKs are          00110000
*    ready to be dispatched.  This routine will set up the              00120000
*    task restart routine address and call the server dispatcher.       00130000
*    The server dispatcher will not return code via standard            00140000
*    return logic.                                                      00150000
*                                                                       00160000
*                                                                       00170000
* ON ENTRY:                                                             00180000
*                                                                       00190000
*    R1 Contains the address of the parameter list mapped by            00200000
*    the SRVPL dsect generated by $SERVER DSECT=YES.                    00210000
*                                                                       00220000
* ON EXIT:                                                              00230000
*                                                                       00240000
*    Control is relinguished to the Task Server Dispatcher              00250000
*                                                                       00260000
* MODE:                                                                 00270000
*                                                                       00280000
*    TASK                                                               00290000
*    APF/NON-APF                                                        00300000
*    SUP/PROB                                                           00310000
*    AMODE 31, RMODE ANY                                                00320000
*                                                                       00330000
**<DOC-OFF>*****************************************************        00340000
                                                                        00350000
         EJECT ,                                                        00360000
****************************************************************        00370000
*                                                                       00380000
* MAINTENANCE:                                                          00390000
*                                                                       00400000
*   01/21/95 Ron Colmone          Par# 159456                           00410000
*            Initial Version                                            00420000
*                                                                       00430000
****************************************************************        00440000
                                                                        00450000
         EJECT ,                                                        00460000
         $SERVER DSECT=YES        TASKMGR SERVER PLIST                  00470000
                                                                        00480000
         EJECT ,                                                        00490000
         EQUS  ,                  GENERAL EQUATES                       00500000
*                                                                       00510000
         TRACODES ,               TRACE CODES                           00520000
                                                                        00530000
         EJECT ,                                                        00540000
         #WORK LENGTH=512                                               00550000
WRKPASS  DS    0D                 WORKAREA TO PASS                      00560000
         #ENDWORK                                                       00570000
                                                                        00580000
         EJECT ,                                                        00590000
ISRVCALL #ENTER BASE=(R12),       ENTRY LINKAGE                        +00600000
               PREG=R8,                                                +00610000
               WAPASS=YES                                               00620000
                                                                        00630000
         USING SRVPL,R8           ESTABLISH ADDRESSABILITY              00640000
         USING ITASK,R10          ESTABLISH ADDRESSABILITY              00650000
                                                                        00660000
*---------------------------------------------------------------        00670000
*  Set task restart address to resume                                   00680000
*---------------------------------------------------------------        00690000
         L     R0,=V(ISRVTDSP)    RESTART TASK ENTRY USING CALLDSP      00700000
         ST    R0,TSKRSRTN        ADDRESS OF TASK RESTART ROUTINE       00710000
                                                                        00720000
*---------------------------------------------------------------        00730000
*  Cut trace record for ITASK issuing CALLDSP                           00740000
*---------------------------------------------------------------        00750000
         $TRACE TRC_DISPSVCALL,8  ALLOCATE TRACE ENTRY                  00760000
         BNZ   NO_TRACE           TRACE INACTIVE                        00770000
         L     R2,4(,R13)         ISRVSERV SAVEAREA ADDRESS             00780000
         L     R2,4(,R2)          CALLER'S SAVEAREA ADDRESS             00790000
         MVC   0(4,R1),12(R2)     CALLER'S R14 ADDRESS                  00800000
NO_TRACE DS    0H                                                       00810000
                                                                        00820000
*---------------------------------------------------------------        00830000
*  Enter Server CALLDSP service to swap ITASKs. (No return)             00840000
*---------------------------------------------------------------        00850000
         @CALL ISRVDISP,WKA=WRKPASS  Call server dispatcher             00860000
                                                                        00870000
         EJECT ,                                                        00880000
****************************************************************        00890000
*                                                                       00900000
*  CONSTANTS AND LITERALS                                               00910000
*                                                                       00920000
****************************************************************        00930000
                                                                        00940000
         LTORG ,                                                        00950000
                                                                        00960000
         PRINT NOGEN                                                    00970000
         ICVT  ,                                                        00980000
         ITASK ,                                                        00990000
                                                                        01000000
         END   ,                                                        01010000
