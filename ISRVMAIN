ISRVMAIN TITLE '- Server task Main Process'                             00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE: ISRVMAIN - Server Task Main Process                          00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine is the $MAIN$ process for server tasks.               00080000
*    This routine will simply wait for the server termination           00090000
*    flag to be set prior to exiting.                                   00100000
*                                                                       00110000
* MODE:                                                                 00120000
*                                                                       00130000
*    TASK                                                               00140000
*    APF/NON-APF                                                        00150000
*    SUP/PROB                                                           00160000
*    AMODE 31, RMODE ANY                                                00170000
*                                                                       00180000
**<DOC-OFF>*****************************************************        00190000
                                                                        00200000
         EJECT ,                                                        00210000
****************************************************************        00220000
*                                                                       00230000
* MAINTENANCE:                                                          00240000
*                                                                       00250000
*   01/09/95 Ron Colmone          Par# 159456                           00260000
*            Initial Version                                            00270000
*                                                                       00280000
****************************************************************        00290000
                                                                        00300000
         EJECT ,                                                        00310000
         $TASK   DSECT=YES        TASKMGR PLIST                         00320000
                                                                        00330000
         EJECT ,                                                        00340000
         EQUS  ,                  GENERAL EQUATES                       00350000
*                                                                       00360000
         EVCODES ,                EVENT CODES                           00370000
                                                                        00380000
         EJECT ,                                                        00390000
         #WORK ,                  READ/WRITE WORKAREA                   00400000
$TSK_MFL $TASK MF=(L,*)           TASK MANAGER PLIST CONSTRUCTION AREA  00410000
         #ENDWORK                 END OF WORKAREA                       00420000
                                                                        00430000
         EJECT ,                                                        00440000
ISRVMAIN #ENTER BASE=R12,         ENTRY LINKAGE                        +00450000
               PREG=R8                                                  00460000
                                                                        00470000
         USING ITASK,R10          ESTABLISH ADDRESSABILITY              00480000
                                                                        00490000
         EJECT ,                                                        00500000
****************************************************************        00510000
*                                                                       00520000
*  Server Main Process                                                  00530000
*                                                                       00540000
****************************************************************        00550000
         L     R7,TSKSRV          ADDRESS OF SERVER EXTENSION           00560000
         USING SERVERX,R7         ADDRESSABILITY                        00570000
                                                                        00580000
         $TASK SETEPB,            INITIALIZE SERVER HALT EPB           +00590000
               EPB=SRVZEPB,                                            +00600000
               ECODE=EC$HALT,                                          +00610000
               MF=(E,$TSK_MFL)                                          00620000
                                                                        00630000
SRV_WAIT DS    0H                                                       00640000
         $TASK WAIT,              WAIT FOR EVENT COMPLETION            +00650000
               MF=(E,$TSK_MFL)                                          00660000
                                                                        00670000
         C     R15,=A(EC$HALT)    SERVER HALT EVENT REQUESTED           00680000
         BNE   SRV_WAIT           CHECK IF SERVER STOPPED               00690000
                                                                        00700000
SRV_EXIT DS    0H                                                       00710000
         #EXIT ,                  RETURN                                00720000
                                                                        00730000
         EJECT ,                                                        00740000
****************************************************************        00750000
*                                                                       00760000
*  CONSTANTS AND LITERALS                                               00770000
*                                                                       00780000
****************************************************************        00790000
                                                                        00800000
         LTORG ,                                                        00810000
                                                                        00820000
         PRINT NOGEN                                                    00830000
         ICVT  ,                                                        00840000
         ITASK ,                                                        00850000
         SERVERX ,                                                      00860000
                                                                        00870000
         END   ,                                                        00880000
