ITRCSET  TITLE '- ENABLE / DISABLE TRACE EVENT CLASS'                   00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ITRCSET  - ENABLE / DISABLE TRACE EVENT CLASS                00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THE TRACE EVENT CLASS IDENTIFIED BY THE PASSED TRACE EVENT         00080000
*    CODE IS ENABLED OR DISABLED BY SETTING OR RESETTING THE            00090000
*    ASSOC EVENT CLASS BIT IN THE XL32 (256-BIT) MASK PROVIDED.         00100000
*    LINKAGE TO THIS ROUTINE IS PROVIDED BY THE $SETRACE MACRO.         00110000
*                                                                       00120000
*                                                                       00130000
* ON ENTRY:                                                             00140000
*                                                                       00150000
*    R1 - ADDR OF AN XL32 (256-BIT) TRACE EVENT MASK                    00160000
*                                                                       00170000
*    R0 - THE LOW ORDER TWO BYTES CONTAIN THE UNSIGNED TRACE            00180000
*         EVENT CODE.  ONLY THE HIGH ORDER BYTE OF THAT HALF-           00190000
*         WORD IS INSPECTED BY THIS ROUTINE.                            00200000
*                                                                       00210000
*         BIT0 IS SET FOR ENABLE REQUESTS AND RESET FOR DISABLE         00220000
*         REQUESTS.                                                     00230000
*                                                                       00240000
*                                                                       00250000
* ON EXIT:                                                              00260000
*                                                                       00270000
*    R15  CONTAINS ONE OF THE FOLLOWING RETURN CODES                    00280000
*                                                                       00290000
*         RC00 - ENABLE / DISABLE COMPLETED                             00300000
*                                                                       00310000
*         RC04 - EVENT ALREADY ENABLED OR DISABLED.                     00320000
*                NO ACTION WAS TAKEN.                                   00330000
*                                                                       00340000
**<DOC-OFF>****************************************************         00350000
                                                                        00360000
         EJECT                                                          00370000
         EQUS  ,                                                        00380000
                                                                        00390000
         EJECT                                                          00400000
ITRCSET  #ENTER SAVE=NO,PREG=(R8,R7)                                    00410000
                                                                        00420000
         USING ICVT,R11           STANDARD ENVIRONMENT                  00430000
                                                                        00440000
         EJECT                                                          00450000
*--------------------------------------------------------------         00460000
*   IDENTIFY EVENT BYTE AND BIT                                         00470000
*--------------------------------------------------------------         00480000
         LR    R5,R7              PRESERVE ENABLE / DISABLE FLAG        00490000
         N     R5,=X'80000000'    ISOLATE FUNCTION FLAG                 00500000
                                                                        00510000
         ICM   R7,B'1100',=X'0000'   CLEAR HIGH ORDER HALFWORD          00520000
         LR    R6,R7              ISOLATE EVENT CLASS                   00530000
         SRL   R6,8               BY SHIFTING OUT EVENT IDENTIFIER      00540000
         LR    R7,R6              EVENT CLASS AS 0-255                  00550000
         SRL   R6,3               BY BITS-PER-BYTE GIVES BYTE OFFSET    00560000
         N     R7,=X'00000007'    BIT INDEX WITHIN BYTE                 00570000
                                                                        00580000
         LA    R4,X'80'           ASSUME BIT 0                          00590000
         SRL   R4,0(R7)           WALK BIT RIGHT AS NEEDED              00600000
                                                                        00610000
         AR    R8,R6              CONVERT BYTE OFFSET TO ADDRESS        00620000
                                                                        00630000
*--------------------------------------------------------------         00640000
*   ENABLE OR DISABLE                                                   00650000
*--------------------------------------------------------------         00660000
         LA    R15,RC00           ASSUME NO CONFLICTS DETECTED          00670000
         LTR   R5,R5              DETERMINE FUNCTION TYPE               00680000
         BZ    DISABLE            DISABLE THE EVENT                     00690000
                                                                        00700000
ENABLE   DS    0H                                                       00710000
         TM    0(R8),*-*          EX OBJECT                             00720000
         EX    R4,*-4             EVENT CLASS ALREADY ENABLED?          00730000
         BO    ALREADY            WARN IF SO                            00740000
         EX    R4,OI0R8           ADD TO MASK                           00750000
         B     RETURN             COMPLETE                              00760000
                                                                        00770000
DISABLE  DS    0H                                                       00780000
         TM    0(R8),*-*          EX OBJECT                             00790000
         EX    R4,*-4             EVENT CLASS ALREADY DISABLED?         00800000
         BNO   ALREADY            WARN IF SO                            00810000
         X     R4,=X'FFFFFFFF'    ONE'S COMPLEMENT OF BIT OPERATOR      00820000
         EX    R4,NI0R8           ADD TO MASK                           00830000
         B     RETURN             COMPLETE                              00840000
                                                                        00850000
*--------------------------------------------------------------         00860000
*   RETURN COMPLETION STATUS TO CALLER                                  00870000
*--------------------------------------------------------------         00880000
ALREADY  DS    0H                 EVENT CLASS ALREDY IN DESIRED STATE   00890000
         LA    R15,RC04           WARNING                               00900000
                                                                        00910000
RETURN   DS    0H                                                       00920000
         #EXIT ,                                                        00930000
                                                                        00940000
         EJECT ,                                                        00950000
***************************************************************         00960000
*                                                                       00970000
*   LOCAL READ ONLY WORKING STORAGE                                     00980000
*                                                                       00990000
***************************************************************         01000000
OI0R8    OI    0(R8),*-*          ENABLE  EVENT CLASS                   01010000
NI0R8    NI    0(R8),*-*          DISABLE EVENT CLASS                   01020000
                                                                        01030000
         LTORG ,                                                        01040000
                                                                        01050000
         PRINT NOGEN                                                    01060000
         ICVT  ,                                                        01070000
         END   ,                                                        01080000
