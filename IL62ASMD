IL62ASMD TITLE 'INTEGRATOR - LU6.2 DISPLAY MODE'                        00010000
                                                                        00020000
         PRINT NOGEN                                                    00030000
         CMINCL ,                 INTEGRATOR CPI-C DEFINITIONS          00040000
         L62INCL ,                INTEGRATOR LU6.2 DEFINITIONS          00050000
         PRINT GEN                                                      00060000
                                                                        00070000
**<DOC-ON>************************************************************* 00080000
*                                                                       00090000
* ROUTINE: IL62ASMD - LU6.2 DISPLAY MODE                                00100000
*                                                                       00110000
* DESCRIPTION:                                                          00120000
*                                                                       00130000
*    THIS ROUTINE IS CALLED TO LOCATE A MODE BLOCK FOR A SPECIFIC       00140000
*    PARTNER_LU (I.E. IVUSER).                                          00150000
*                                                                       00160000
* ON ENTRY:                                                             00170000
*                                                                       00180000
*    R15 = ENTRY POINT ADDRESS                                          00190000
*    R14 = RETURN      ADDRESS                                          00200000
*    R13 = SAVE AREA   ADDRESS                                          00210000
*    R01 = PARM LIST   ADDRESS                                          00220000
*                                                                       00230000
*          +00 = ADDRESS OF PLB (IVUSER)                                00240000
*          +04 = ADDRESS OF MODE NAME (MAX LENGTH 8 CHARACTERS)         00250000
*          +08 = ADDRESS OF MODE NAME LENGTH                            00260000
*          +0C = ADDRESS OF MDE RETURN AREA                             00270000
*          +10 = ADDRESS OF RETURN CODE AREA                            00280000
*                                                                       00290000
* ON EXIT:                                                              00300000
*                                                                       00310000
*    R15 = 0                                                            00320000
*                                                                       00330000
*    RETURN_CODE = LU62_OK --> MDE SUCCESSFULLY RETURNED                00340000
*                                                                       00350000
*                = LU62_PARAMETER_ERROR --> IVUSER/MODE NAME ERROR      00360000
*                = LU62_RESOURCE_NOT_FOUND --> MDE NOT FOUND            00370000
*                                                                       00380000
**<DOC-OFF>************************************************************ 00390000
         EJECT ,                                                        00400000
*********************************************************************** 00410000
*                                                                       00420000
* MAINTENANCE:                                                          00430000
*                                                                       00440000
*   07/01/94 RANDY WITEK                                                00450000
*                                                                       00460000
*********************************************************************** 00470000
                                                                        00480000
         EQUS  ,                  GENERAL EQUATES                       00490000
                                                                        00500000
RICVT    EQU   R11                                                      00510000
RITASK   EQU   R10                                                      00520000
RBASE    EQU   R9                                                       00530000
RIVTAM   EQU   R8                                                       00540000
RIVUSER  EQU   R7                                                       00550000
RMDE     EQU   R6                                                       00560000
RPLIST   EQU   R5                                                       00570000
                                                                        00580000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00590000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00600000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00610000
         USING IVUSER,RIVUSER     ESTABLISH ADDRESSABILITY              00620000
         USING MDE,RMDE           ESTABLISH ADDRESSABILITY              00630000
         USING L62LIST,RPLIST     ESTABLISH ADDRESSABILITY              00640000
                                                                        00650000
         COPY  CRAB               "C" RUNTIME ANCHOR BLOCK              00660000
         USING CRAB,R12           ADDRESSABILITY                        00670000
                                                                        00680000
         COPY  DSA                DYNAMIC SAVE AREA                     00690000
WORKAREA DS    0H                 READ/WRITE WORKAREA                   00700000
WRK256   DS    XL256              GENERAL WORKAREA                      00710000
SUB0SAVE DS    18F                SUBROUTINE SAVE AREA                  00720000
MODENM@  DS    A                  ADDRESS OF MODE NAME                  00730000
MODENMLN DS    F                  LENGTH OF MODE NAME                   00740000
WRKLOCAL DS    CL8                WORKING COPY OF MODE NAME             00750000
RETCODE  DS    F                  TEMPORARY RETURN CODE AREA            00760000
FLAG     DS    X                                                        00770000
FLAGLOCK EQU   X'80'                                                    00780000
FLAGLCKD EQU   X'40'                                                    00790000
WORKLEN  EQU   *-WORKAREA         LENGTH OF USER DSA AREA               00800000
DSALEN   EQU   *-DSA              LENGTH OF DSA                         00810000
                                                                        00820000
         $MSGDFT PREFIX=ICTPID,                                        +00830000
               COMPID='L62',                                           +00840000
               TABLE=*#MSGS,                                           +00850000
               WORKA=0,                                                +00860000
               MF=(E,WRK256),                                          +00870000
               PRINT=NOGEN                                              00880000
                                                                        00890000
IL6ASMD@ CSECT ,                                                        00900000
IL62ASMD CENTRY DSA=DSALEN,BASE=RBASE,INDEP=YES                         00910000
                                                                        00920000
*---------------------------------------------------------------------- 00930000
* ENTRY                                                                 00940000
*---------------------------------------------------------------------- 00950000
                                                                        00960000
         USING DSA,R13            ADDRESSABILITY                        00970000
         LR    RPLIST,R1          SAVE ADDRESS OF PLIST                 00980000
                                                                        00990000
         LA    R0,WORKAREA        ADDRESS OF USER DSA SECTION           01000000
         LA    R1,WORKLEN         LENGTH  OF USER DSA SECTION           01010000
         SR    R15,R15            PREPARE FOR CLEAR                     01020000
         MVCL  R0,R14             CLEAR USER DSA SECTION                01030000
                                                                        01040000
*---------------------------------------------------------------------- 01050000
* INITIALIZATION                                                        01060000
*---------------------------------------------------------------------- 01070000
                                                                        01080000
         @RESTENV ,               ENSURE ENVIRONMENT                    01090000
                                                                        01100000
         L     RIVTAM,ICTVTCVT    ESTABLISH IVTAMCVT POINTER            01110000
         USING IVTAMCVT,RIVTAM    ADDRESSABILITY                        01120000
         L     RIVUSER,L62PARM1   IVUSER/PLB ADDRESS                    01130000
         SR    RMDE,RMDE          NO MDE YET                            01140000
         L     R2,L62PARM2        MODE NAME ADDRESS                     01150000
         L     R3,L62PARM3        MODE NAME LENGTH ADDRESS              01160000
         L     R3,0(,R3)          MODE NAME LENGTH                      01170000
         ST    R2,MODENM@         SAVE THE ADDRESS                      01180000
         ST    R3,MODENMLN        SAVE THE LENGTH                       01190000
         MVC   WRKLOCAL,=CL8' '   BLANK WORKING COPY OF MODE NAME       01200000
         LTR   R14,R2             MODE NAME                             01210000
         BNP   INITEND            BRANCH IF NOT OK                      01220000
         LTR   R15,R3             MODE NAME LENGTH                      01230000
         BNP   INITEND            BRANCH IF NOT OK                      01240000
         ICM   R15,B'1000',=C' '  PAD WITH A BLANK IF NECESSARY         01250000
         LA    R2,WRKLOCAL        COPY-TO ADDRESS                       01260000
         LA    R3,8               COPY-TO LENGTH                        01270000
         MVCL  R2,R14             COPY MODE NAME                        01280000
                                                                        01290000
INITEND  DS    0H                                                       01300000
                                                                        01310000
*---------------------------------------------------------------------- 01320000
* ENTRY TRACE                                                           01330000
*---------------------------------------------------------------------- 01340000
                                                                        01350000
         $TRACE *=A(TRC_LU62_IL62ASMD),48 TRACE ENTRY W/ 48 USER BYTES  01360000
         BNZ   NOETRACE                   BRANCH IF NOT TRACING         01370000
         $APITRC IL62ASMD                 TRACE COMMON STUFF            01380000
         ST    RPLIST,24(,R1)             TRACE PARMLIST ADDRESS        01390000
         ST    RIVUSER,28(,R1)            TRACE IVUSER/PLB ADDRESS      01400000
         LTR   RIVUSER,RIVUSER            IS IVUSER POINTER OK?         01410000
         BZ    *+10                       BRANCH IF NOT                 01420000
         MVC   32(8,R1),IVULOCAL          TRACE PARTNER LU NAME         01430000
         MVC   40(8,R1),WRKLOCAL          TRACE MODE       NAME         01440000
NOETRACE DS    0H                                                       01450000
                                                                        01460000
*---------------------------------------------------------------------- 01470000
* LOCATE THE REQUESTED MODE NAME                                        01480000
*---------------------------------------------------------------------- 01490000
                                                                        01500000
         LTR   RIVUSER,RIVUSER    DO WE HAVE AN IVUSER POINTER?         01510000
         BNP   ERRPARM            BRANCH IF NOT                         01520000
         CLC   IVUID,=CL8'IVUSER' IS THE ID CORRECT?                    01530000
         BNE   ERRPARM            BRANCH IF NOT                         01540000
         ICM   R1,15,MODENM@      WAS A NAME POINTER PROVIDED?          01550000
         BNP   ERRPARM            BRANCH IF NOT                         01560000
         ICM   R1,15,MODENMLN     WAS A VALID LENGTH PROVIDED?          01570000
         BNP   ERRPARM            BRANCH IF NOT                         01580000
         C     R1,=F'8'           WAS A VALID LENGTH PROVIDED?          01590000
         BH    ERRPARM            BRANCH IF NOT                         01600000
                                                                        01610000
         BAS   R14,VTAMLOCK       SERIALIZE                             01620000
                                                                        01630000
         LA    RMDE,IVUMD1ST      GET SET TO RUN MODE_LIST              01640000
         S     RMDE,=A(MDENEXT-MDE)                                     01650000
                                                                        01660000
MDERUN   DS    0H                                                       01670000
                                                                        01680000
         ICM   RMDE,15,MDENEXT    LINK TO THE NEXT MDE                  01690000
         BM    ERRRESNF           BRANCH IF NOT FOUND                   01700000
         CLC   WRKLOCAL,MDENAME   COMPARE THE NAMES                     01710000
         BH    MDERUN             BRANCH IF DESIRED NAME IS HIGH        01720000
         BL    ERRRESNF           BRANCH IF NOT FOUND                   01730000
         B     RETURN             BRANCH IF FOUND                       01740000
                                                                        01750000
*---------------------------------------------------------------------- 01760000
* EXCEPTION ROUTINES                                                    01770000
*---------------------------------------------------------------------- 01780000
                                                                        01790000
ERRPARM  DS    0H                                                       01800000
                                                                        01810000
         MVC   RETCODE,=A(LU62_PARAMETER_ERROR)                         01820000
         B     ERRCOMM                                                  01830000
                                                                        01840000
ERRRESNF DS    0H                                                       01850000
                                                                        01860000
         MVC   RETCODE,=A(LU62_RESOURCE_NOT_FOUND)                      01870000
         B     ERRCOMM                                                  01880000
                                                                        01890000
ERRCOMM  DS    0H                                                       01900000
                                                                        01910000
         SR    RMDE,RMDE          ENSURE NO MDE POINTER                 01920000
         B     RETURN                                                   01930000
                                                                        01940000
*---------------------------------------------------------------------- 01950000
* EXIT TRACE AND RETURN TO CALLER                                       01960000
*---------------------------------------------------------------------- 01970000
                                                                        01980000
RETURN   DS    0H                                                       01990000
                                                                        02000000
         BAS   R14,VTAMUNLK           RELEASE THE LOCK IF NECESSARY     02010000
                                                                        02020000
         $TRACE *=A(TRC_LU62_EXIT),16 TRACE ENTRY W/ 16 USER BYTES      02030000
         BNZ   NOXTRACE               BRANCH IF TRACING NOT AVAILABLE   02040000
         MVC   0(8,R1),=CL8'IL62ASMD' MODULE NAME                       02050000
         MVC   8(4,R1),RETCODE        RETURN_CODE VALUE                 02060000
         ST    RMDE,12(,R1)           MDE ADDRESS                       02070000
NOXTRACE DS    0H                                                       02080000
                                                                        02090000
         L     R1,L62PARM4        ADDRESS OF MDE RETURN AREA            02100000
         ST    RMDE,0(,R1)        RETURN THE MDE ADDRESS                02110000
                                                                        02120000
         L     R1,L62PARM5        ADDRESS OF RETURN_CODE AREA           02130000
         MVC   0(4,R1),RETCODE    SET RETURN_CODE VARIABLE              02140000
                                                                        02150000
         SR    R15,R15            FUNCTION RETURN CODE = 0              02160000
         CEXIT RC=(R15),INDEP=YES RETURN                                02170000
                                                                        02180000
*---------------------------------------------------------------------- 02190000
*   SUBROUTINE: OBTAIN VTAM GLOBAL LOCK                                 02200000
*---------------------------------------------------------------------- 02210000
                                                                        02220000
VTAMLOCK DS    0H                                                       02230000
                                                                        02240000
         TM    FLAG,FLAGLOCK        WAS THE LOCK ALREADY OBTAINED?      02250000
         BOR   R14                  RETURN IF YES                       02260000
         STM   R14,R2,SUB0SAVE      SAVE CALLER'S REGISTERS             02270000
                                                                        02280000
         $SER  OBTAIN,                                                 +02290000
               VTAM                                                     02300000
                                                                        02310000
         C     R15,=F'4'            WAS LOCK ALREADY HELD?              02320000
         BNE   VTAMLOEX             BRANCH IF NOT                       02330000
         OI    FLAG,FLAGLCKD        REMEMBER LOCK HELD ON ENTRY         02340000
                                                                        02350000
VTAMLOEX DS    0H                                                       02360000
                                                                        02370000
         OI    FLAG,FLAGLOCK        REMEMBER LOCK IS HELD               02380000
         LM    R14,R2,SUB0SAVE      RESTORE CALLER'S REGISTERS          02390000
         BR    R14                  RETURN                              02400000
                                                                        02410000
*---------------------------------------------------------------------- 02420000
*   SUBROUTINE: RELEASE VTAM GLOBAL LOCK                                02430000
*---------------------------------------------------------------------- 02440000
                                                                        02450000
VTAMUNLK DS    0H                                                       02460000
                                                                        02470000
         TM    FLAG,FLAGLOCK        IS LOCK HELD?                       02480000
         BNOR  R14                  BRANCH IF NOT                       02490000
         TM    FLAG,FLAGLCKD        WAS LOCK HELD ON ENTRY?             02500000
         BOR   R14                  DON'T RELEASE IF IT WAS             02510000
         STM   R14,R2,SUB0SAVE      SAVE CALLER'S REGISTERS             02520000
                                                                        02530000
         $SER  RELEASE,                                                +02540000
               VTAM                                                     02550000
                                                                        02560000
         NI    FLAG,255-FLAGLOCK    SHOW LOCK NOT HELD                  02570000
         LM    R14,R2,SUB0SAVE      RESTORE CALLER'S REGISTERS          02580000
         BR    R14                  RETURN                              02590000
                                                                        02600000
*---------------------------------------------------------------------- 02610000
* LITERALS AND CONSTANTS                                                02620000
*---------------------------------------------------------------------- 02630000
                                                                        02640000
         LTORG ,                                                        02650000
                                                                        02660000
         PRINT NOGEN                                                    02670000
         ISTDBIND ,               VTAM BIND IMAGE                       02680000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                02690000
         IKJTCB ,                 MVS TASK CONTROL BLOCK                02700000
         TRACODES ,               INTEGRATOR TRACE CODE EQUATES         02710000
         ICVT  ,                  INTEGRATOR CVT                        02720000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   02730000
         ITASK ,                  INTEGRATOR TASK BLOCK                 02740000
         IPCB ,                   INTEGRATOR PROCESS BLOCK              02750000
         IACB ,                   INTEGRATOR VTAM ACB                   02760000
         ABCODES ,                INTEGRATOR $ABEND CODES               02770000
         EVCODES ,                INTEGRATOR EVENT CODES                02780000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            02790000
         END   ,                                                        02800000
