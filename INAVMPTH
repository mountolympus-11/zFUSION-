INAVMPTH TITLE '- ASSIGN STN STATE DEPTHS'                              00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: INAVMPTH - Assign STN state depths                           00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    Each NVSTN node residing in the STN is assigned a "state           00080000
*    depth" which can be used during navigation plan generation         00090000
*    to identify the most viable starting state of several              00100000
*    alternatives.                                                      00110000
*                                                                       00120000
*    The "state depth" is the mininum number of traversals              00130000
*    required to reach the NVSTN node from session                      00140000
*    establishment, as represented by the *VTAM* NVSTN node             00150000
*    that anchors all fully specified applications.                     00160000
*                                                                       00170000
*                                                                       00180000
* METHOD:                                                               00190000
*                                                                       00200000
*    The STN is traversed recursively for each successor of the         00210000
*    NVSTN node provided as input.  The state depth associated          00220000
*    with that NVSTN is incremented by one and is assigned to           00230000
*    each immediate successor, unless that successor has been           00240000
*    previously assigned a lower state depth.                           00250000
*                                                                       00260000
*                                                                       00270000
* NOTES:                                                                00280000
*                                                                       00290000
*    BAKR Linkage                                                       00300000
*    Recursive                                                          00310000
*                                                                       00320000
*                                                                       00330000
* ON ENTRY:                                                             00340000
*                                                                       00350000
*    R1  contains the address of the CURRENT NVSTN                      00360000
*                                                                       00370000
*    R0  contains the state depth associated with the                   00380000
*        CURRENT NVSTN                                                  00390000
*                                                                       00400000
*                                                                       00410000
* ON EXIT:                                                              00420000
*                                                                       00430000
*    N/A                                                                00440000
*                                                                       00450000
**<DOC-OFF>****************************************************         00460000
                                                                        00470000
         EJECT                                                          00480000
***************************************************************         00490000
*                                                                       00500000
* MAINTENANCE:                                                          00510000
*                                                                       00520000
*    05/30/95 R. Turgeon         Rel 2.0.0 - table select               00530000
*             Initial version                                           00540000
*                                                                       00550000
***************************************************************         00560000
                                                                        00570000
         EJECT                                                          00580000
         NAV   ,                  NAVIGATION NETWORK STRUCTURES         00590000
                                                                        00600000
         EJECT                                                          00610000
         EQUS  ,                                                        00620000
                                                                        00630000
         EJECT                                                          00640000
INAVMPTH #ENTER LINKAGE=BAKR,SAVE=NO,PREG=(R8,R7)                       00650000
                                                                        00660000
         EJECT                                                          00670000
***************************************************************         00680000
*                                                                       00690000
*   ASSIGN STATE DEPTH TO EACH SUCCESSOR NVSTN NODE                     00700000
*                                                                       00710000
***************************************************************         00720000
                                                                        00730000
         LA    R7,1(,R7)          STATE DEPTH THIS LEVEL                00740000
                                                                        00750000
         USING NVSTN,R8           STN NODE                              00760000
                                                                        00770000
         ICM   R6,15,NVSTSUCC     HEAD OF SUCCESSOR CHAIN               00780000
         BZ    COMPLETE           NO SUCCESSORS                         00790000
         USING NVUSUCC,R6         LIFE OF FUNCTION ADDRESSABILITY       00800000
                                                                        00810000
*--------------------------------------------------------------         00820000
*   VISIT ALL SUCCESSOR LINKAGE BLOCKS                                  00830000
*--------------------------------------------------------------         00840000
                                                                        00850000
SU_TOP   DS    0H                                                       00860000
         ICM   R4,15,NVUCOUNT     NUMBER OF SUCCESSOR LINKAGE ENTRIES   00870000
         BZ    SU_BLOCK           NONE, VERY STRANGE                    00880000
         LA    R5,NVUENTRY        LOCATE FIRST ENTRY                    00890000
         USING NVUENTRY,R5        SUCCESSOR ENTRY                       00900000
                                                                        00910000
*--------------------------------------------------------------         00920000
*   VISIT ALL SUCCESSOR NVSTN NODES                                     00930000
*--------------------------------------------------------------         00940000
                                                                        00950000
SU_NEXT  DS    0H                 PROCESS NEXT                          00960000
         L     R2,NVUSTN          LOCATE SUCCESSOR NVSTN NODE           00970000
S        USING NVSTN,R2           SHORT TERM ADDRESSABILITY             00980000
                                                                        00990000
         LH    R0,S.NVSDEPTH      FETCH STATE DEPTH                     01000000
         LTR   R0,R0              STATE DEPTH PREVIOUSLY ASSIGNED?      01010000
         BZ    SU_ASSGN           ASSIGN NOW IF NOT                     01020000
         CR    R7,R0              CURRENT DEPTH VS ASSIGNED DEPTH       01030000
         BNL   SU_ENTRY           PRIOR ASSIGNMENT HOLDS                01040000
                                                                        01050000
SU_ASSGN DS    0H                                                       01060000
         STH   R7,S.NVSDEPTH      ASSIGN STATE DEPTH                    01070000
                                                                        01080000
         LR    R0,R7              R0 <== CURRENT STATE DEPTH            01090000
         LA    R1,S.NVSTN         R1 <== CURRENT NVSTN                  01100000
         BAS   R14,INAVMPTH       DESCEND                               01110000
                                                                        01120000
SU_ENTRY DS    0H                 ADVANCE TO NEXT ENTRY                 01130000
         LA    R5,NVUENTRY+NVUENTLN                                     01140000
         BCT   R4,SU_NEXT                                               01150000
         DROP  S,R5               SUCCESSOR STN, NVUENTRY               01160000
                                                                        01170000
*--------------------------------------------------------------         01180000
*   ADVANCE TO NEXT SUCCESSOR LINKAGE BLOCK AT END OF ENTRIES           01190000
*--------------------------------------------------------------         01200000
                                                                        01210000
SU_BLOCK DS    0H                                                       01220000
         ICM   R6,15,NVUNEXT      ON TO NEXT SUCCESSOR LINKAGE BLOCK    01230000
         BNZ   SU_TOP             REPEAT                                01240000
                                                                        01250000
         EJECT                                                          01260000
***************************************************************         01270000
*                                                                       01280000
*   RETURN TO CALLER                                                    01290000
*                                                                       01300000
***************************************************************         01310000
                                                                        01320000
COMPLETE DS    0H                                                       01330000
         #EXIT ,                                                        01340000
                                                                        01350000
         EJECT                                                          01360000
***************************************************************         01370000
*                                                                       01380000
*   LOCAL READ-ONLY STORAGE, ETC.                                       01390000
*                                                                       01400000
***************************************************************         01410000
                                                                        01420000
         LTORG ,                                                        01430000
                                                                        01440000
         EJECT ,                                                        01450000
         PRINT NOGEN                                                    01460000
         ICVT  ,                                                        01470000
         ITASK ,                                                        01480000
         END   ,                                                        01490000
