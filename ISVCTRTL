ISVCTRTL TITLE 'INTEGRATOR SERVICE ROUTINE: TRT LONG'                   00010000
**<DOC-ON>************************************************************* 00020000
*                                                                       00030000
* ROUTINE: ISVCTRTL - INTEGRATOR SERVICE ROUTINE: TRT LONG              00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
* ON ENTRY:                                                             00080000
*                                                                       00090000
*    R15 = ENTRY POINT ADDRESS                                          00100000
*    R14 = RETURN ADDRESS                                               00110000
*    R13 = AVAILABLE SAVE AREA                                          00120000
*    R11 = ICVT ADDRESS                                                 00130000
*    R10 = ITASK ADDRESS                                                00140000
*    R00 = LENGTH OF TRT                                                00150000
*    R01 = ADDRESS OF TRT TABLE                                         00160000
*    R02 = ADDRESS OF TRT ARGUMENT                                      00170000
*                                                                       00180000
* ON EXIT:                                                              00190000
*                                                                       00200000
*    R15 = 0 --> ALL FUNCTION BYTES WERE ZERO                           00210000
*         !0 --> A NON-ZERO FUNCTION BYTE WAS FOUND                     00220000
*                BITS  0-23 = B'0'                                      00230000
*                BITS 24-31 = THE NON-ZERO FUNCTION BYTE                00240000
*    R00 = LENGTH OF DATA PASSED OVER                                   00250000
*    R01 = ENDING ADDRESS OF THE TRT SCAN                               00260000
*    R02 = ADDRESS OF TRT ARGUMENT                                      00270000
*                                                                       00280000
*    ALL OTHER REGISTERS ARE RESTORED                                   00290000
*                                                                       00300000
**<DOC-OFF>************************************************************ 00310000
         EJECT ,                                                        00320000
*********************************************************************** 00330000
*                                                                       00340000
* MAINTENANCE:                                                          00350000
*                                                                       00360000
*   08/01/93 RANDY WITEK                                                00370000
*                                                                       00380000
*********************************************************************** 00390000
         EQUS  ,                  GENERAL EQUATES                       00400000
RICVT    EQU   R11                                                      00410000
RITASK   EQU   R10                                                      00420000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00430000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00440000
                                                                        00450000
ISVCTRTL #ENTER BASE=R12,         ENTRY LINKAGE                        +00460000
               AMODE=31,                                               +00470000
               SAVE=NO,                                                +00480000
               RMODE=ANY                                                00490000
                                                                        00500000
*---------------------------------------------------------------------- 00510000
* PERFORM A LONG TRT                                                    00520000
*---------------------------------------------------------------------- 00530000
                                                                        00540000
         LA    R9,0(,R2)          ORIGINAL ARGUMENT ADDRESS             00550000
         LR    R5,R9                       ARGUMENT ADDRESS             00560000
         LR    R8,R0              ORIGINAL LENGTH                       00570000
         LTR   R3,R0                       LENGTH                       00580000
         BM    BADLENG            BRANCH IF LENGTH IS NEGATIVE ???      00590000
         LA    R7,256             CONSTANT                              00600000
         LR    R4,R1              TRT TABLE ADDRESS                     00610000
TESTLENG LTR   R3,R3              ANY LENGTH TO SCAN?                   00620000
         BNP   ALLZERO            BRANCH IF NOT                         00630000
         CR    R3,R7              MORE THAN A HARDWARE INSTRUCTION?     00640000
         BL    TRTLAST            BRANCH IF NOT                         00650000
         TRT   0(256,R5),0(R4)    PERFORM TRT                           00660000
         BNZ   NZEROFB            BRANCH IF NON-ZERO FUNCTION BYTE      00670000
         AR    R5,R7              BUMP ARGUMENT ADDRESS                 00680000
         SR    R3,R7              DECREMENT REMAINING LENGTH            00690000
         B     TESTLENG           GO SEE IF THIS WILL BE LAST TRT       00700000
                                                                        00710000
TRTLAST  BCTR  R3,0               LENGTH CODE FOR EXECUTE               00720000
         EX    R3,LASTTRT         EXECUTE THE LAST TRT                  00730000
         BNZ   NZEROFB            BRANCH IF NON-ZERO FUNCTION BYTE      00740000
                                                                        00750000
ALLZERO  LR    R0,R8              R0  --> LENGTH SCANNED                00760000
         LA    R1,0(R8,R9)        R1  --> ADDRESS AT END OF SCAN        00770000
         SR    R15,R15            R15 --> ZERO (NO NON-ZERO FOUND)      00780000
         B     RETURN             RETURN TO CALLER W/R15-R2             00790000
                                                                        00800000
NZEROFB  LA    R0,0(,R1)          R1  --> ADDRESS AT END OF SCAN        00810000
         SR    R0,R9              R0  --> LENGTH SCANNED                00820000
         LR    R15,R2             R15 --> NON-ZERO (FUNC BYTE IN 24-31) 00830000
         N     R15,=X'000000FF'   R15 --> 0-23 = B'0'                   00840000
         B     RETURN             RETURN TO CALLER W/R15-R2             00850000
                                                                        00860000
BADLENG  SR    R0,R0              R0  --> LENGTH SCANNED                00870000
         LR    R1,R9              R1  --> ORIGINAL ARGUMENT ADDRESS     00880000
         SR    R15,R15            R15 --> ZERO (NO NON-ZERO FOUND)      00890000
         B     RETURN             RETURN TO CALLER W/R15-R2             00900000
                                                                        00910000
RETURN   DS    0H                                                       00920000
                                                                        00930000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    00940000
                                                                        00950000
LASTTRT  TRT   0(*-*,R5),0(R4)    PERFORM TRT                           00960000
                                                                        00970000
         LTORG ,                                                        00980000
         PRINT NOGEN                                                    00990000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                01000000
         ICVT  ,                  INTEGRATOR CVT                        01010000
         ITASK ,                  INTEGRATOR TASK BLOCK                 01020000
         END   ,                                                        01030000
