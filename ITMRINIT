ITMRINIT TITLE 'INITIALIZE $TIMER FACILITY'                             00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ITMRINIT - Initialize $TIMER facility                        00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine is used to construct the $TIMEHDR array used          00080000
*    to relate $TIMER requests to the MVS/ESA STIMERM facility.         00090000
*    A table of $TIMEHDR entries is allocated, with one entry           00100000
*    for each of the concurrently managed STIMERM request               00110000
*    supported under a single TCB.                                      00120000
*                                                                       00130000
*    An EPB is also allocated and associated with the current           00140000
*    ITASK ($INTMAIN).  It will be used to communicate STIMERM          00150000
*    expiration events to the $TIMER manager.                           00160000
*                                                                       00170000
*                                                                       00180000
* ON ENTRY:                                                             00190000
*                                                                       00200000
*    N/A                                                                00210000
*                                                                       00220000
* ON EXIT:                                                              00230000
*                                                                       00240000
*    R15 contains zero                                                  00250000
*                                                                       00260000
**<DOC-OFF>****************************************************         00270000
                                                                        00280000
         EJECT ,                                                        00290000
***************************************************************         00300000
*                                                                       00310000
* MAINTENANCE:                                                          00320000
*                                                                       00330000
*   09/13/94 R. TURGEON                                                 00340000
*            Initial version                                            00350000
*                                                                       00360000
***************************************************************         00370000
                                                                        00380000
         EJECT                                                          00390000
         #WORK ,                                                        00400000
                                                                        00410000
$TASKMFL $TASK MF=L               $TASK PLIST                           00420000
                                                                        00430000
         #ENDWORK ,                                                     00440000
                                                                        00450000
         EJECT                                                          00460000
         $TIMEHDR ,               $TIMER STIMER LINKAGE TABLE           00470000
                                                                        00480000
         EJECT                                                          00490000
         @EPB ,                   EPB FORMAT                            00500000
                                                                        00510000
         EJECT                                                          00520000
         $TASK DSECT=YES          TASK MANAGER PLIST                    00530000
                                                                        00540000
         EJECT                                                          00550000
         EVCODES ,                EVENT CODES                           00560000
                                                                        00570000
         EQUS  ,                                                        00580000
                                                                        00590000
         EJECT                                                          00600000
ITMRINIT #ENTER ,                                                       00610000
                                                                        00620000
         USING ITASK,R10          $TIMER MANAGER ITASK                  00630000
                                                                        00640000
*--------------------------------------------------------------         00650000
*   ACQUIRE $TIMEHDR TABLE AND ANCHOR IN ICVT.ICTTIME                   00660000
*--------------------------------------------------------------         00670000
         LA    R2,TIMEHDRL        LENGTH OF EACH ENTRY                  00680000
         MH    R2,=AL2(TIMH#ENT)  MAX NUMBER OF ENTRIES                 00690000
                                                                        00700000
         STGGET (R2),QH=ICTSTG    ACQUIRE STORAGE                       00710000
                                                                        00720000
         ST    R1,ICTTIME         ANCHOR LINKAGE TABLE                  00730000
                                                                        00740000
*---------------------------------------------------------------        00750000
*   ALLOCATE AND INITIALIZE $TIMER EXPIRATION EPB                       00760000
*---------------------------------------------------------------        00770000
         $GETSTOR EPBLENG         STIMERM EXPIRATION EPB                00780000
                                                                        00790000
         LR    R2,R1              PRESERVE STORAGE ADDR                 00800000
         ST    R2,TSKTMEPB        ANCHOR THE UNINITIALIZED EPB          00810000
                                                                        00820000
         $TASK SETEPB,            INITIALIZE TIMER EXPIRATION EPB      X00830000
               EPB=(R2),                                               X00840000
               ECODE=EC$STIMERM,                                       X00850000
               MF=(E,$TASKMFL)                                          00860000
                                                                        00870000
*--------------------------------------------------------------         00880000
*   RETURN TO CALLER                                                    00890000
*--------------------------------------------------------------         00900000
         SR    R15,R15            RETURN CODES UNDEFINED                00910000
         #EXIT ,                                                        00920000
                                                                        00930000
         EJECT                                                          00940000
****************************************************************        00950000
*                                                                       00960000
*   LOCAL READ-ONLY DATA AREAS                                          00970000
*                                                                       00980000
****************************************************************        00990000
         LTORG ,                                                        01000000
                                                                        01010000
         PRINT NOGEN                                                    01020000
         ICVT  ,                                                        01030000
         ITASK ,                                                        01040000
         END   ,                                                        01050000
