IPSBPURG TITLE '- PREPARED STATEMENT PLAN DELETE'                       00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: IPSBPURG - Prepared statement PLAN delete                    00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine is used to purge all plans associated with            00080000
*    a PSB plan segment. IPLNDET is invoked for all plans               00090000
*    defined in PSB.PSBPLAN that are currently owned by it.             00100000
*                                                                       00110000
*                                                                       00120000
* NOTES:                                                                00130000
*                                                                       00140000
*    All plans imported into a PSB must be (1) valid, and               00150000
*    (2) acquired via IPLNGET.                                          00160000
*                                                                       00170000
*                                                                       00180000
* ENTRY:                                                                00190000
*                                                                       00200000
*    R1 contains the address of a parameter list constructed            00210000
*       as follows:                                                     00220000
*                                                                       00230000
*          +00 - PSB.PSBPLAN segment origin                             00240000
*                                                                       00250000
* EXIT:                                                                 00260000
*                                                                       00270000
*    R15 contains zero                                                  00280000
*                                                                       00290000
**<DOC-OFF>****************************************************         00300000
                                                                        00310000
         EJECT                                                          00320000
***************************************************************         00330000
*                                                                       00340000
* MAINTENANCE:                                                          00350000
*                                                                       00360000
*   04/26/94 R. Turgeon                                                 00370000
*            Initial version                                            00380000
*                                                                       00390000
*   10/09/95 R. Turgeon                                                 00400000
*            Replace PLNPURG() call with IPLNDET in support of          00410000
*            the plan management layer introduced by VDBCACHE().        00420000
*                                                                       00430000
***************************************************************         00440000
                                                                        00450000
         EJECT                                                          00460000
         #WORK ,                       READ/WRITE WORKAREA              00470000
         #ENDWORK ,                                                     00480000
                                                                        00490000
         EJECT                                                          00500000
         NAV   ,                       NAVIGATION / PLAN STRUCTURES     00510000
                                                                        00520000
         EJECT                                                          00530000
         PSB   ,                       TABLE INTERFACE BLOCK (TIB)      00540000
                                                                        00550000
         EJECT                                                          00560000
         EQUS  ,                                                        00570000
                                                                        00580000
         EJECT                                                          00590000
IPSBPURG #ENTER BASE=R12,PREG=(R8)                                      00600000
                                                                        00610000
         USING ITASK,R10               ITASK ADDRESSABILITY             00620000
                                                                        00630000
         EJECT                                                          00640000
*--------------------------------------------------------------         00650000
*   General initialization, fetch passed parameters                     00660000
*--------------------------------------------------------------         00670000
                                                                        00680000
         L     R5,0(,R8)               FETCH PASSED PARAMETERS          00690000
         USING PSBPLAN,R5              PSB PLAN SEGMENT ORIGIN          00700000
                                                                        00710000
*--------------------------------------------------------------         00720000
*   Delete repositioning plan                                           00730000
*--------------------------------------------------------------         00740000
                                                                        00750000
         CLI   PSBHPOS,TRUE            REPOSITION PLAN RETAINED?        00760000
         BNE   PDPOS                   SKIP IF NOT                      00770000
         ICM   R0,15,PSBOPOS           PSB IS PLAN OWNER?               00780000
         BNZ   PDPOS                   CURRENTLY CHECKED OUT            00790000
         MVI   PSBHPOS,FALSE           REPOSITION PLAN DISCHARGED       00800000
                                                                        00810000
         LA    R1,PSBPPOS              R1 <== REPOSITIONING PLAN        00820000
         @CALL IPLNDET,CTYPE=CVT       DELETE                           00830000
                                                                        00840000
PDPOS    DS    0H                                                       00850000
                                                                        00860000
*--------------------------------------------------------------         00870000
*   Delete run plan                                                     00880000
*--------------------------------------------------------------         00890000
                                                                        00900000
         CLI   PSBHDATA,TRUE           RUN PLAN RETAINED?               00910000
         BNE   PDRUN                   SKIP IF NOT                      00920000
         ICM   R0,15,PSBODATA          PSB IS PLAN OWNER?               00930000
         BNZ   PDRUN                   CURRENTLY CHECKED OUT            00940000
         MVI   PSBHDATA,FALSE          RUN PLAN DISCHARGED              00950000
                                                                        00960000
         LA    R1,PSBPDATA             R1 <== RUN PLAN                  00970000
         @CALL IPLNDET,CTYPE=CVT       DELETE                           00980000
                                                                        00990000
PDRUN    DS    0H                                                       01000000
                                                                        01010000
*--------------------------------------------------------------         01020000
*   Delete sessterm plan                                                01030000
*--------------------------------------------------------------         01040000
                                                                        01050000
         CLI   PSBHTERM,TRUE           SESSTERM PLAN RETAINED?          01060000
         BNE   PDTERM                  SKIP IF NOT                      01070000
         ICM   R0,15,PSBOTERM          PSB IS PLAN OWNER?               01080000
         BNZ   PDTERM                  CURRENTLY CHECKED OUT            01090000
         MVI   PSBHTERM,FALSE          SESSTERM PLAN DISCHARGED         01100000
                                                                        01110000
         LA    R1,PSBPTERM             R1 <== SESSTERM PLAN             01120000
         @CALL IPLNDET,CTYPE=CVT       DELETE                           01130000
                                                                        01140000
PDTERM   DS    0H                                                       01150000
                                                                        01160000
*--------------------------------------------------------------         01170000
*   Return to caller                                                    01180000
*--------------------------------------------------------------         01190000
                                                                        01200000
         SR    R15,R15                 RETURN CODES NOT DEFINED         01210000
                                                                        01220000
         #EXIT ,                       DONE                             01230000
         DROP  R5                      PSBPLAN                          01240000
                                                                        01250000
         EJECT                                                          01260000
***************************************************************         01270000
*                                                                       01280000
*   Local read only storage                                             01290000
*                                                                       01300000
***************************************************************         01310000
                                                                        01320000
         LTORG ,                                                        01330000
                                                                        01340000
         PRINT NOGEN                                                    01350000
         ICVT  ,                                                        01360000
         ITASK ,                                                        01370000
         IPCB  ,                                                        01380000
         END   ,                                                        01390000
