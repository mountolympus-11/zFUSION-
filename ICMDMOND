ICMDMOND TITLE '- ISSUE CLASS DISPLAY'                                  00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ICMDMOND - ISSUE CLASS DISPLAY                               00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine is used to format automated command queue             00080000
*    entries (AMNRECs).  Optionally, the caller may provide an          00090000
*    ISSUE class ID name to limit the size of the display.              00100000
*    By default, all ISSUE class entries are formatted.                 00110000
*                                                                       00120000
*                                                                       00130000
* ON ENTRY:                                                             00140000
*                                                                       00150000
*    R1  contains the address of a parameter list constructed           00160000
*        as follows:                                                    00170000
*                                                                       00180000
*        +00 - addr of a CMDREQ in local CMDPROC format                 00190000
*                                                                       00200000
*        +04 - addr of an ISSUE class identifier.  A null or            00210000
*              blank identifier requests all ISSUE classes.             00220000
*                                                                       00230000
**<DOC-OFF>****************************************************         00240000
                                                                        00250000
                                                                        00260000
***************************************************************         00270000
*                                                                       00280000
* MAINTENANCE:                                                          00290000
*                                                                       00300000
*    09/30/94 R. TURGEON                                                00310000
*             INITIAL VERSION                                           00320000
*                                                                       00330000
***************************************************************         00340000
         EJECT                                                          00350000
         #WORK ,             BEGIN WORKAREA                             00360000
                                                                        00370000
FLAGS    DS    X             FLAG BYTE                                  00380000
FIRST    EQU   X'80'            MATCHING ISSUE CLASS ENTRIES FOUND      00390000
                                                                        00400000
LASTMNID DS    CL8           ID OF LAST ISSUE CLASS ENTRY FORMATTED     00410000
CURRMNID DS    CL8           ISSUE CLASS ID SELECTED FOR CURRENT ENTRY  00420000
CONSID   DS    CL4           EYEBALL CONSOLE ID                         00430000
                                                                        00440000
TIMESTMP DS    0CL8          HH:MM:SS                                   00450000
HOURS    DS    CL2              HH - HOURS                              00460000
TIMEDLM1 DS    C':'                                                     00470000
MINUTES  DS    CL2              MM - MINUTES                            00480000
TIMEDLM2 DS    C':'                                                     00490000
SECONDS  DS    CL2              SS - SECONDS                            00500000
                                                                        00510000
$MSGMFL  $MSG  MF=L,FIELDS=(,,,,,,,)                                    00520000
                                                                        00530000
REGSAVE  DS    16F           LOCAL ROUTINE SAVEAREA                     00540000
                                                                        00550000
         #ENDWORK ,          END OF WORKAREA                            00560000
                                                                        00570000
         EJECT                                                          00580000
         CMDREQ ,            COMMAND REQUEST BLOCK                      00590000
                                                                        00600000
         EJECT                                                          00610000
         AMNREC ,            AUTOMATED COMMAND ISSUER RECORD            00620000
                                                                        00630000
         EJECT                                                          00640000
         CMDCODES ,                                                     00650000
                                                                        00660000
         ABCODES ,                                                      00670000
                                                                        00680000
         EQUS  ,                                                        00690000
                                                                        00700000
         $MSGDFT PREFIX=ICTPID,COMPID='CMD',TABLE=*#MSGS,              X00710000
               CONID=*CMRQCNID,CONNAME=CMRQCNAM,CART=CMRQCART,         X00720000
               DESTADD=*CMRQDMSK,                                      X00730000
               MSGQA=*CMRQMQA,STGQH=*CMRQSTGQ,                         X00740000
               MF=(E,$MSGMFL),                                         X00750000
               PRINT=NOGEN                                              00760000
                                                                        00770000
         EJECT                                                          00780000
                                                                        00790000
         EJECT                                                          00800000
ICMDMOND #ENTER PREG=R8                                                 00810000
                                                                        00820000
         USING ITASK,R10          STDENV                                00830000
                                                                        00840000
         EJECT                                                          00850000
***************************************************************         00860000
*                                                                       00870000
*   SCAN COMMAND SCHEDULER ISSUE CLASS Q FOR ENTRIES MATCHING           00880000
*   THE GIVEN CLASS IDENTIFIER                                          00890000
*                                                                       00900000
***************************************************************         00910000
         LR    R1,R8              PLIST ADDRESS                         00920000
         L     R8,0(,R1)          LOCATE COMMAND REQUEST BLOCK          00930000
         USING CMDREQ,R8          STANDARD CMDPROC ADDRESSABILITY       00940000
         L     R7,4(,R1)          ISSUE CLASS ID LOCATION               00950000
                                                                        00960000
         L     R6,CMRQAMNQ        ACTIVE ISSUE CLASS QUEUE              00970000
         ICM   R6,15,0(R6)        LOCATE FIRST ENTRY                    00980000
         BZ    WRNINACT           NO ACTIVE ISSUERS                     00990000
         USING AMNREC,R6                                                01000000
                                                                        01010000
FMTNEXT  DS    0H                                                       01020000
         TM    0(R7),BF           ISSUE CLASS IDENTIFIER PROVIDED?      01030000
         BZ    FMTCALL            ALL ENTRIES REQUESTED IF NOT          01040000
         CLC   AMNMONID,0(R7)     MATCHING IDS?                         01050000
         BNE   FMTADV             SKIP IF NOT                           01060000
                                                                        01070000
FMTCALL  DS    0H                                                       01080000
         LR    R1,R6              R1 <== AMNREC ENTRY                   01090000
         BAS   R14,DISPLAY        DISPLAY IT                            01100000
                                                                        01110000
FMTADV   DS    0H                                                       01120000
         ICM   R6,15,AMNNEXT      ADVANCE TO NEXT ENTRY                 01130000
         BNZ   FMTNEXT            EXAMINE ALL ENTRIES                   01140000
         DROP  R6                 AMNREC                                01150000
                                                                        01160000
***************************************************************         01170000
*                                                                       01180000
*   ISSUE TERMINATION MESSAGES IF APPLICABLE                            01190000
*                                                                       01200000
***************************************************************         01210000
         TM    FLAGS,FIRST        ANY MATCHING ENTRIES LOCATED          01220000
         BO    RETURN             DONE IF SO                            01230000
         $MNO  R1,381                                                   01240000
         BAS   R14,EASYMSG                                              01250000
         B     RETURN                                                   01260000
                                                                        01270000
WRNINACT DS    0H                 NO COMMAND ISSUERS ACTIVE             01280000
         $MNO  R1,380                                                   01290000
         BAS   R14,EASYMSG                                              01300000
                                                                        01310000
*--------------------------------------------------------------         01320000
*   RETURN TO CALLER                                                    01330000
*--------------------------------------------------------------         01340000
RETURN   DS    0H                 RETURN TO CALLER                      01350000
         LA    R15,CCODE_NORESP   NO FURTHER RESPONSES REQUIRED         01360000
                                                                        01370000
         #EXIT ,                                                        01380000
                                                                        01390000
         EJECT                                                          01400000
***************************************************************         01410000
*                                                                       01420000
* ROUTINE: DISPLAY - DISPLAY ACTIVE ISSUE CLASS IDS                     01430000
*                                                                       01440000
***************************************************************         01450000
DISPLAY  DS    0H                                                       01460000
         STM   R0,R15,REGSAVE     PRESERVE MAINLINE REGS                01470000
         LR    R6,R1              ACCEPT AMNREC ENTRY                   01480000
         USING AMNREC,R6          STANDARD ADDRESSABILITY               01490000
                                                                        01500000
*--------------------------------------------------------------         01510000
*   DISPLAY COLUMN HEADERS UPON FIRST ENTRY MATCH                       01520000
*--------------------------------------------------------------         01530000
         TM    FLAGS,FIRST        FIRST DISPLAYABLE ENTRY?              01540000
         BO    DISPDATA           SKIP IF NOT                           01550000
         OI    FLAGS,FIRST        ENTRIES MATCHED?                      01560000
                                                                        01570000
         $MNO  R1,375             HEADER LINES                          01580000
         BAS   R14,EASYMSG                                              01590000
                                                                        01600000
*--------------------------------------------------------------         01610000
*   DISPLAY ENTRY DATA                                                  01620000
*--------------------------------------------------------------         01630000
DISPDATA DS    0H                                                       01640000
         MVC   CURRMNID,AMNMONID                                        01650000
         CLC   CURRMNID,LASTMNID                                        01660000
         BNE   *+10                                                     01670000
         MVC   CURRMNID,BLANKS                                          01680000
         MVC   LASTMNID,AMNMONID                                        01690000
                                                                        01700000
*--------------------------------------------------------------         01710000
*   DISPLAY COMMAND LIST                                                01720000
*--------------------------------------------------------------         01730000
         L     R0,AMNOCNID        R0 <== CONSOLE ID                     01740000
         BAS   R14,FMTCNID                                              01750000
                                                                        01760000
         L     R0,AMNINTVL        R0 <== SUBMISSION INTERVAL            01770000
         BAS   R14,FMTINTVL                                             01780000
                                                                        01790000
         $MSG  376,FIELDS=(CURRMNID,AMNOUSER,AMNOTASK,AMNOPCB,         X01800000
               AMNOCNAM,CONSID,TIMESTMP)                                01810000
                                                                        01820000
         LH    R4,AMNCMDCT        NUMBER OF COMMAND STRINGS             01830000
         LA    R5,AMNCMD          TIGHTEN ADDRESSABILITY                01840000
         USING AMNCMD,R5                                                01850000
                                                                        01860000
DISPCMD  DS    0H                                                       01870000
         LH    R2,AMNCMDLN        LENGTH OF COMMAND STRING              01880000
                                                                        01890000
         $MSG  377,FIELDS=((AMNCMDST,(R2)))                             01900000
                                                                        01910000
         LA    R5,2(R2,R5)        TOTAL LENGTH OF COMMAND STRING ENTRY  01920000
         BCT   R4,DISPCMD         DISPLAY ALL COMMAND STRINGS           01930000
         DROP  R5                                                       01940000
                                                                        01950000
*--------------------------------------------------------------         01960000
*   RETURN TO MAINLINE                                                  01970000
*--------------------------------------------------------------         01980000
         LM    R0,R14,REGSAVE     RESTORE CALLERS REGS                  01990000
         SR    R15,R15            RETURN CODES NOT DEFINED              02000000
         BR    R14                RETURN                                02010000
         DROP  R6                 AMNREC                                02020000
                                                                        02030000
         EJECT                                                          02040000
***************************************************************         02050000
*                                                                       02060000
* ROUTINE: EASYMSG - ISSUE NON-PARAMETERIZED MESSAGE                    02070000
*                                                                       02080000
***************************************************************         02090000
EASYMSG  DS    0H                                                       02100000
         ST    R14,FWORD          PRESERVE RETURN ADDRESS               02110000
         ST    R2,DWORD           PRESERVE MAINLINE REGS                02120000
         LR    R2,R1              ACCEPT MSG ID                         02130000
                                                                        02140000
         $MSG  (R2)               ISSUE MSG                             02150000
                                                                        02160000
         L     R2,DWORD           RESTORE MAINLINE REGS                 02170000
         L     R14,FWORD          RESTORE RETURN ADDRESS                02180000
         BR    R14                RETURN                                02190000
                                                                        02200000
         EJECT                                                          02210000
***************************************************************         02220000
*                                                                       02230000
* ROUTINE: FMTCNID - FORMAT HEXIDECIMAL CONSOLE ID                      02240000
*                                                                       02250000
* ON ENTRY:                                                             02260000
*                                                                       02270000
*    R0  - MCS CONSOLE ID                                               02280000
*                                                                       02290000
***************************************************************         02300000
FMTCNID  DS    0H                                                       02310000
         MVC   CONSID,BLANKS                                            02320000
         LTR   R0,R0                                                    02330000
         BZR   R14                                                      02340000
                                                                        02350000
         ST    R0,MFE_LIST+8                                            02360000
         UNPK  MFE_LIST(5),MFE_LIST+10(3)                               02370000
         TR    MFE_LIST(4),HEXTRT-C'0'                                  02380000
         MVC   CONSID,MFE_LIST                                          02390000
         BR    R14                                                      02400000
                                                                        02410000
         EJECT                                                          02420000
***************************************************************         02430000
*                                                                       02440000
* ROUTINE: FMTINTVL - FORMAT TIME INTERVAL                              02450000
*                                                                       02460000
* ON ENTRY:                                                             02470000
*                                                                       02480000
*    R0  - TIME INTERVAL IN UNITS OF SECONDS                            02490000
*                                                                       02500000
***************************************************************         02510000
FMTINTVL DS    0H                                                       02520000
         MVC   TIMESTMP,=C'00:00:00'                                    02530000
                                                                        02540000
FMTINHH  DS    0H                 FORMAT HOURS                          02550000
         LR    R1,R0                                                    02560000
         SR    R0,R0                                                    02570000
         D     R0,=A(60*60)                                             02580000
         LTR   R1,R1                                                    02590000
         BZ    FMTINMM                                                  02600000
                                                                        02610000
         CVD   R1,DWORD                                                 02620000
         MVC   FWORD,=X'F0212020'                                       02630000
         ED    FWORD,DWORD+6                                            02640000
         MVC   HOURS,FWORD+2                                            02650000
                                                                        02660000
FMTINMM  DS    0H                 EXTRACT MINUTES                       02670000
         LR    R1,R0                                                    02680000
         SR    R0,R0                                                    02690000
         D     R0,=A(60)                                                02700000
         LTR   R1,R1                                                    02710000
         BZ    FMTINSS                                                  02720000
                                                                        02730000
         CVD   R1,DWORD                                                 02740000
         MVC   FWORD,=X'F0212020'                                       02750000
         ED    FWORD,DWORD+6                                            02760000
         MVC   MINUTES,FWORD+2                                          02770000
                                                                        02780000
FMTINSS  DS    0H                 EXTRACT SECONDS                       02790000
         LTR   R1,R0                                                    02800000
         BZ    FMTINFIN                                                 02810000
                                                                        02820000
         CVD   R1,DWORD                                                 02830000
         MVC   FWORD,=X'F0212020'                                       02840000
         ED    FWORD,DWORD+6                                            02850000
         MVC   SECONDS,FWORD+2                                          02860000
                                                                        02870000
FMTINFIN DS    0H                 RETURN                                02880000
         BR    R14                                                      02890000
                                                                        02900000
         EJECT                                                          02910000
***************************************************************         02920000
*                                                                       02930000
*   LOCAL READ ONLY DATA AREAS, ETC.                                    02940000
*                                                                       02950000
***************************************************************         02960000
ALIGN    DS    0F                                                       02970000
HEXTRT   DC    C'0123456789ABCDEF'                                      02980000
BLANKS   DC    CL16' '                                                  02990000
                                                                        03000000
         LTORG ,                                                        03010000
                                                                        03020000
         PRINT NOGEN                                                    03030000
         ICVT  ,                                                        03040000
         ITASK ,                                                        03050000
         END   ,                                                        03060000
