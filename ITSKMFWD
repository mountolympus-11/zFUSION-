ITSKMFWD TITLE '- Intra Task Message Forwarding Routine'                00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE:  ITSKMFWD - Intra Task Message Forwarding Routine            00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine process Intra task message forwarding                 00080000
*    requests.  The message received as input to resent                 00090000
*    to the target PCB specified in the MSG header using                00100000
*    the original message type.                                         00110000
*                                                                       00120000
*    If the original message was issued with REPLY=YES,                 00130000
*    the forwarded message is also sent with REPLY and                  00140000
*    a wait is issued for the notification of the reply                 00150000
*    EPB.  This reply response is then sent back to the                 00160000
*    initiator of the original message.                                 00170000
*                                                                       00180000
* ON ENTRY:                                                             00190000
*                                                                       00200000
*    R1  contains the address of a standard message header              00210000
*        addressed by TMSGSTD (TMSG HDR=NO).                            00220000
*                                                                       00230000
* ON EXIT:                                                              00240000
*                                                                       00250000
*    R15 = RC00 - Normal completion                                     00260000
*                                                                       00270000
*          RC08 - Message is not deliverable                            00280000
*                                                                       00290000
**<DOC-OFF>****************************************************         00300000
                                                                        00310000
***************************************************************         00320000
*                                                                       00330000
* MAINTENANCE:                                                          00340000
*                                                                       00350000
*    03/21/95 R. Colmone                                                00360000
*             Initial Version                                           00370000
*                                                                       00380000
***************************************************************         00390000
                                                                        00400000
         EJECT                                                          00410000
         TMSG   ,                 MESSAGE FORMAT                        00420000
                                                                        00430000
         EJECT                                                          00440000
         $TASK  DSECT=YES         ITASK FORMAT                          00450000
                                                                        00460000
         EJECT                                                          00470000
         $TSEND DSECT=YES         INTER TASK MESSAGING                  00480000
                                                                        00490000
         EJECT                                                          00500000
         EQUS  ,                  GENERAL EQUATES                       00510000
                                                                        00520000
         EJECT                                                          00530000
WORKAREA #WORK ,                  BEGIN WORKAREA                        00540000
$TSK_MFL $TASK  MF=(L,*)          TASK MANAGER PLIST                    00550000
         #ENDWORK ,               END WORKAREA                          00560000
                                                                        00570000
         EJECT                                                          00580000
ITSKMFWD #ENTER PREG=R8                                                 00590000
                                                                        00600000
         USING ITASK,R10          STANDARD ENVIRONMENT                  00610000
         USING TMSGSTD,R8         TMSG ADDRESSABILITY                   00620000
                                                                        00630000
         EJECT ,                                                        00640000
***************************************************************         00650000
*                                                                       00660000
*  Forward message to target PCB workunit.  If message is               00670000
*  undeliverable, set return code to allow default message              00680000
*  router apply default action.                                         00690000
*                                                                       00700000
***************************************************************         00710000
                                                                        00720000
         L     R5,TMSGEPB         REPLY FROM ORIGINAL REQUEST           00730000
                                                                        00740000
         $TSEND *,                                                     +00750000
               TMSGPNAM,                                               +00760000
               TYPE=*TMSGOTYP,                                         +00770000
               PARMS=(*TMSGW1,*TMSGW2,*TMSGW3,*TMSGW4),                +00780000
               INFO=(TMSGINFO,*TMSGINFL),                              +00790000
               REPLY=(R5),                                             +00800000
               MF=(E,MFE_LIST)                                          00810000
                                                                        00820000
         BNZ   FWD_NDLV           MSG NOT DELIVERED TO TGT WU           00830000
                                                                        00840000
*--------------------------------------------------------------         00850000
*  If oringal message was issued with REPLY=YES,  then wait             00860000
*  for notification of message completion to return reply               00870000
*  back to initiator of initial message.                                00880000
*--------------------------------------------------------------         00890000
         LTR   R5,R5              REPLY REQUESTED?                      00900000
         BZ    FWD_DONE           NO, FORWARDING COMPLETE               00910000
                                                                        00920000
         LR    R3,R1              ADDRESS OF REPLY ECB                  00930000
                                                                        00940000
         $TASK WAIT,              WAIT FOR REPLY FROM PROCESSOR        +00950000
               EPB=(R3),                                               +00960000
               CANCEL=FWD_NDLV,                                        +00970000
               MF=(E,$TSK_MFL)                                          00980000
                                                                        00990000
         LR    R2,R0              PRESERVE POST CODE FROM PROCESSOR     01000000
                                                                        01010000
*--------------------------------------------------------------         01020000
*  Notify original request of message processing                        01030000
*--------------------------------------------------------------         01040000
         $TASK POST,EPB=(R5),     POST ORIGINAL MESSAGE EPB            +01050000
               PCODE=(R2),                                             +01060000
               MF=(E,$TSK_MFL)                                          01070000
                                                                        01080000
*--------------------------------------------------------------         01090000
*  Intra task message forwarding complete, set return code              01100000
*  and exit.                                                            01110000
*--------------------------------------------------------------         01120000
FWD_DONE DS    0H                                                       01130000
         LA    R15,RC00           NORMAL COMPLETION                     01140000
         B     RETURN             RETURN                                01150000
                                                                        01160000
FWD_NDLV DS    0H                                                       01170000
         LA    R15,RC08           MESSAGE NOT DELIVERED/PROCESSED       01180000
         B     RETURN             RETURN                                01190000
                                                                        01200000
         EJECT ,                                                        01210000
*--------------------------------------------------------------         01220000
*   Return                                                              01230000
*--------------------------------------------------------------         01240000
RETURN   DS    0H                                                       01250000
         #EXIT ,                                                        01260000
                                                                        01270000
         EJECT ,                                                        01280000
***************************************************************         01290000
*                                                                       01300000
*   LOCAL READ-ONLY DATA AREAS                                          01310000
*                                                                       01320000
***************************************************************         01330000
         LTORG ,                                                        01340000
                                                                        01350000
         EJECT                                                          01360000
         PRINT NOGEN                                                    01370000
         ICVT  ,                                                        01380000
         ITASK ,                                                        01390000
         IPCB  ,                                                        01400000
         END                                                            01410000
