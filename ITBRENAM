ITBRENAM TITLE 'TABLE SERVICES - TABLE RENAME'                          00010001
***************************************************************         00020000
*                                                                       00030000
*   READ / WRITE WORKING STORAGE AREA                                   00040000
*                                                                       00050000
***************************************************************         00060000
WORKAREA DSECT                                                          00070000
                                                                        00110000
         @WORK PLIST=(MFE_LIST,60)                                      00111001
                                                                        00112001
LOCOTOKN DS    F             LOCAL OBJECT TOKEN - RETURNED FROM LOCATE  00120000
                                                                        00130000
OLDOBJNM DS    CL32          OLD OBJECT NAME WORK AREA                  00140000
NEWOBJNM DS    CL32          NEW OBJECT NAME WORK AREA                  00150000
                                                                        00160000
WKPAGE   DS    0F            LOWER LEVEL TBL SERVICES CAN USE THE REST  00190000
WORKLEN  EQU   *-WORKAREA                                               00200000
                                                                        00201001
         EJECT                                                          00210001
         @TBRENAM            ITBRENAM INPUT PARM LIST                   00220000
                                                                        00221001
         EJECT                                                          00230001
         TBSERVIS OPEN,DESC,CREATE,GET,CLOSE                            00240000
                                                                        00241001
         EJECT                                                          00250001
         EQUS  LINKAGE=VCON                                             00260000
                                                                        00270000
         EJECT                                                          00280001
**<DOC-ON>*****************************************************         00290001
*                                                                       00300000
* ROUTINE: ITBRENAM - RENAME TABLE                                      00310001
*                                                                       00320000
* DESCRIPTION:                                                          00330001
*                                                                       00340000
*    THE ROUTINE USES THE LOCATE AND RENAME OBJECT SERVICES TO          00350001
*    RENAME ALL OF THE OBJECTS ASSOCIATED WITH A TABLE. FIRST           00360001
*    THE TABLE IS LOCATED TO INSURE IT EXISTS AND THEN THE BASE         00370001
*    TABLE NAME IS RENAMED, FOLLOWED BY RENAMES OF THE TABLE            00380001
*    LOCATOR AND ALL OF THE TABLES INDEX OBJECTS.                       00390001
*                                                                       00400000
*                                                                       00410000
*  ON ENTRY:                                                            00420000
*                                                                       00421001
*      R1 POINTS TO A PARAMETER LIST MAPPED BY THE TBRENAME DSECT       00430000
*         MACRO @TBRENAM EXPANDS THIS DSECT                             00440001
*                                                                       00450000
*  ON EXIT:                                                             00460000
*                                                                       00461001
*      R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                   00470001
*                                                                       00471001
*          RC00 - SUCCESSFUL TABLE RENAME                               00480001
*          RC08 - TABLE RENAME FAILED                                   00490001
*                                                                       00491001
*             R0 - REASON CODES                                         00500000
*               4  - THE BASE TABLE OBJECT FAILED RENAME                00510000
*               8  - THE BASE TABLE COULD NOT BE LOCATED                00520000
*               12 - THE LOACTOR OBJECT FIALED RENAME                   00530000
*                                                                       00540000
**<DOC-OFF>****************************************************         00550001
                                                                        00551001
         EJECT                                                          00560001
ITBRENAM @ENTER WORKA=(WORKAREA,WORKLEN),ASC=PRIMARY                    00570000
                                                                        00580000
         LR    R8,R1              RETAIN INPUT PARM ADDRESS             00590000
         USING TBRENAME,R8        DECLARE INTENTIONS                    00600000
                                                                        00610000
*--------------------------------------------------------------         00620000
*   LOCATE THE OLD TABLE OBJECT (CHECK EXISTENCE)                       00630000
*--------------------------------------------------------------         00640000
RENLOCO  DS    0H                                                       00650000
                                                                        00660000
         $OBJECT LOCATE,          LOCATE THE TABLE OBJECT              X00670000
               STOKEN=*TBZSTOKN,  USE STOKEN PASSED TO US              X00680000
               OTOKEN=LOCOTOKN,   USE LOCAL WORK TOKEN AS RETRUN       X00690000
               NAMELN=*TBZONMLN,  OLD NAME AS ONE WE WANT TO LOCATE    X00700000
               NAME=*TBZONAME,    OLD NAME                             X00710000
               SHRPAGE=WKPAGE,    SHARE USERS WORK AREA                X00720000
               MF=(E,MFE_LIST)                                          00730000
                                                                        00740000
         LTR   R15,R15            LCACTED TABLE OBJECT?                 00750000
         BNZ   ERR_NFND           NO -THEN FAIL RENAME                  00760000
                                                                        00770000
*--------------------------------------------------------------         00780000
*   RENAME TABLE OBJECT                                                 00790000
*--------------------------------------------------------------         00800000
RENBASE  DS    0H                                                       00810000
                                                                        00820000
         $OBJECT RENAME,          LOCATE THE TABLE OBJECT              X00830000
               STOKEN=*TBZSTOKN,  USE STOKEN PASSED TO US              X00840000
               ONAMLN=*TBZONMLN,  OLD NAME LENGTH                      X00850000
               OLDNAME=*TBZONAME, OLD NAME                             X00860000
               NAMELN=*TBZNNMLN,  NEW NAME LENGTH                      X00870000
               NAME=*TBZNNAME,    NEW NAME                             X00880000
               SHRPAGE=WKPAGE,    SHARE USERS WORK AREA                X00890000
               MF=(E,MFE_LIST)                                          00900000
                                                                        00910000
         LTR   R15,R15            LCACTED TABLE OBJECT?                 00920000
         BNZ   ERR_BASE           NO - BASE RENAME FAILED               00930000
                                                                        00940000
*--------------------------------------------------------------         00950000
*   RENAME LOCATOR OBJECT                                               00960000
*--------------------------------------------------------------         00970000
RENLOCTR DS    0H                                                       00980000
         L     R2,TBZONAME        GET ADDRESS OF OLD NAME STRING        00990000
         L     R3,TBZONMLN        GET OLD NAME LENGTH                   01000000
         BCTR  R3,0               DECREMENT FOR EXECUTE                 01010000
         MVC   OLDOBJNM(0),0(R2)  BASE LOCATOR NAME                     01020000
         EX    R3,*-6             MOVE THE BASE NAME                    01030000
         LA    R2,OLDOBJNM+1(R3)  POINT TO END OF BASE NAME             01040000
         MVC   0(L'LOCSUFX,R2),LOCSUFX   MOVE IN LOCATOR SUFFIX         01050000
         LA    R5,L'LOCSUFX+1(R3) TOTAL LOACTOR NAME LENGTH             01060000
                                                                        01070000
         L     R2,TBZNNAME        GET ADDRESS OF NEW NAME STRING        01080000
         L     R3,TBZNNMLN        GET NEW NAME LENGTH                   01090000
         BCTR  R3,0               DECREMENT FOR EXECUTE                 01100000
         MVC   NEWOBJNM(0),0(R2)  BASE LOCATOR NAME                     01110000
         EX    R3,*-6             MOVE THE BASE NAME                    01120000
         LA    R2,NEWOBJNM+1(R3)  POINT TO END OF BASE NAME             01130000
         MVC   0(L'LOCSUFX,R2),LOCSUFX   MOVE IN LOCATOR SUFFIX         01140000
         LA    R6,L'LOCSUFX+1(R3) TOTAL LOACTOR NAME LENGTH             01150000
                                                                        01160000
         $OBJECT RENAME,          RENAME THE TABLE LOCATOR OBJECT      X01170000
               STOKEN=*TBZSTOKN,  USE STOKEN PASSED TO US              X01180000
               ONAMLN=(R5),       OLD LOCATOR NAME LENGTH              X01190000
               OLDNAME=OLDOBJNM,  OLD LOCATOR NAME                     X01200000
               NAMELN=(R6),       NEW LOCATOR NAME LENGTH              X01210000
               NAME=NEWOBJNM,     NEW LOCATOR NAME                     X01220000
               SHRPAGE=WKPAGE,    SHARE USERS WORK AREA                X01230000
               MF=(E,MFE_LIST)                                          01240000
                                                                        01250000
         LTR   R15,R15            LCACTED TABLE OBJECT?                 01260000
         BNZ   ERR_LOC            NO - LOCATOR RENAME FAILED            01270000
                                                                        01280000
*--------------------------------------------------------------         01290000
*   RENAME INDEX OBJECTS                                                01300000
*--------------------------------------------------------------         01310000
RENNDXS  DS    0H                                                       01320000
         L     R3,TBZONMLN        GET OLD BASE NAME LENGTH              01330000
         LA    R2,OLDOBJNM(R3)    POINT TO END OF BASE NAME             01340000
         MVC   0(L'NDXSUFX,R2),NDXSUFX   MOVE IN INDEX SUFFIX           01350000
         LA    R5,L'NDXSUFX+2(R3) GET TOTAL INDEX OBJECT NAME LENGTH    01360000
                                                                        01370000
         L     R3,TBZNNMLN        GET NEW BASE NAME LENGTH              01380000
         LA    R2,NEWOBJNM(R3)    POINT TO END OF BASE NAME             01390000
         MVC   0(L'NDXSUFX,R2),NDXSUFX   MOVE IN INDEX SUFFIX           01400000
         LA    R6,L'NDXSUFX+2(R3) GET TOTAL INDEX OBJECT NAME LENGTH    01410000
                                                                        01420000
         LA    R4,1               PRIME THE INDEX SUFFIX NUMBER         01430000
                                                                        01440000
RENNDXLP DS    0H                                                       01450000
         LR    R1,R4              INDEX SUFFIX VALUE                    01460000
         BAS   R14,SMALLDEC       CONVERT IT TO EYECATCHER FORM         01470000
                                                                        01480000
         L     R3,TBZONMLN        GET LENGTH OF OLD NAME                01490000
         LA    R2,OLDOBJNM+L'NDXSUFX(R3)  GET END OF INDEX NAME         01500000
         MVC   0(2,R2),2(R1)      MOVE IN INDEX SUFFIX NUMBER           01510000
                                                                        01520000
         L     R3,TBZNNMLN        GET LENGTH OF NEW NAME                01530000
         LA    R2,NEWOBJNM+L'NDXSUFX(R3)  GET END OF INDEX NAME         01540000
         MVC   0(2,R2),2(R1)      MOVE IN INDEX SUFFIX NUMBER           01550000
                                                                        01560000
         $OBJECT RENAME,          RENAME THE TABLE LOCATOR OBJECT      X01570000
               STOKEN=*TBZSTOKN,  USE STOKEN PASSED TO US              X01580000
               ONAMLN=(R5),       OLD LOCATOR NAME LENGTH              X01590000
               OLDNAME=OLDOBJNM,  OLD LOCATOR NAME                     X01600000
               NAMELN=(R6),       NEW LOCATOR NAME LENGTH              X01610000
               NAME=NEWOBJNM,     NEW LOCATOR NAME                     X01620000
               SHRPAGE=WKPAGE,    SHARE USERS WORK AREA                X01630000
               MF=(E,MFE_LIST)                                          01640000
                                                                        01650000
         LA    R4,1(,R4)          INCREMENT INDEX SUFFIX NUMBER         01660000
         LTR   R15,R15            RENAMED INDEX OBJECT?                 01670000
         BZ    RENNDXLP           YES - TRY ANOTHER                     01680000
                                                                        01690000
*--------------------------------------------------------------         01700000
* RENEND - TABLE RENAME IS COMPLETED                                    01710000
*--------------------------------------------------------------         01720000
         LA    R15,RC00           CLEAR RETURN REGISTER                 01730000
                                                                        01740000
EXIT     DS    0H                                                       01750000
         @EXIT ,                  RETURN                                01760000
                                                                        01770000
         EJECT                                                          01780001
*--------------------------------------------------------------         01790000
*   ERROR PROCESSING ROUTINES                                           01800000
*--------------------------------------------------------------         01810000
ERR_BASE DS    0H                                                       01820000
         LA    R0,RSN04           BASE TABLE NAMED FAILED RENAME        01830000
         B     ERR_ERR                                                  01840000
                                                                        01850000
ERR_NFND DS    0H                                                       01860000
         LA    R0,RSN08           BASE TABLE COULD NOT BE LOCATED       01870000
         B     ERR_ERR                                                  01880000
                                                                        01890000
ERR_LOC  DS    0H                                                       01900000
         LA    R0,RSN12           TABLE LOCATOR RENAME FAILED           01910000
                                                                        01920000
ERR_ERR  DS    0H                                                       01930000
         LA    R15,RC08                                                 01940000
         B     EXIT                                                     01950000
                                                                        01960000
         EJECT                                                          01970001
***************************************************************         01980000
*                                                                       01990000
* ROUTINE: SMALLDEC - CONVERT R1 TO SMALL DECIMAL VALUE                 02000000
*                                                                       02010000
* ON ENTRY:                                                             02020000
*                                                                       02030000
*    R1  - SMALL POSITIVE INTEGER VALUE                                 02040000
*                                                                       02050000
* ON EXIT:                                                              02060000
*                                                                       02070000
*    R1  - ADDR OF A CL4 AREA CONTAINING RIGHT-JUSTIFIED,               02080000
*          BLANK FILLED RESULT                                          02090000
*                                                                       02100000
***************************************************************         02110000
SMALLDEC DS    0H                                                       02120000
         CVD   R1,DWORD           CONVERT TO DECIMAL                    02130000
         MVC   FWORD,=X'40212020' AT LEAST A TWO-DIGIT RESULT           02140000
         ED    FWORD,DWORD+6      EYEBALL FORMAT                        02150000
         LA    R1,FWORD           RETURN RESULT                         02160000
         BR    R14                DONE                                  02170000
                                                                        02180000
         EJECT  ,                                                       02190000
*--------------------------------------------------------------         02200000
LOCSUFX  DC    C'.LOCATOR'                                              02210000
NDXSUFX  DC    C'.INDEX'                                                02220000
                                                                        02230000
         LTORG ,                                                        02240000
         END   ,                                                        02250000
