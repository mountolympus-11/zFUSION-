IGENRSAV TITLE '- #ENTER SAVEAREA FRAME RECOVERY ROUTINE'               00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE:  IGENRSAV - #ENTER SAVEAREA FRAME RECOVERY ROUTINE           00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This recovery routine (RCVRTN) is invoked on $FRAME                00080000
*    RECOVER operations to determine whether the frame                  00090000
*    represented by the given FRCA is still in use and to free          00100000
*    it if not.  Refer to IRCVFRAM for a general description of         00110000
*    $FRAME RECOVER processing.                                         00120000
*                                                                       00130000
*    Because $FRAME RECOVER processing considers frames in              00140000
*    last-in first-out sequence, the frame presented is retained        00150000
*    if and only if the RETRYSA lies within its boundaries.             00160000
*    The savearea eyecatcher used to detect storage overlays            00170000
*    is reinstalled at the end of RETRYSA.                              00180000
*                                                                       00190000
*                                                                       00200000
* NOTES:                                                                00210000
*                                                                       00220000
*    The OS/VS savearea provided to savearea frame recovery             00230000
*    routines is not used in this routine.                              00240000
*                                                                       00250000
*    STDENV callers only                                                00260000
*    BAKR linkage                                                       00270000
*                                                                       00280000
*                                                                       00290000
* ON ENTRY:                                                             00300000
*                                                                       00310000
*    R0  contains the address of a 256 byte clear workarea              00320000
*                                                                       00330000
*    R1  contains the address of a parameter list constructed           00340000
*        as follows:                                                    00350000
*                                                                       00360000
*           +00 - address of the Frame Control Area (FRCA)              00370000
*                                                                       00380000
*           +04 - address of the retry routine savearea (RETRYSA)       00390000
*                 or zero                                               00400000
*                                                                       00410000
* ON EXIT:                                                              00420000
*                                                                       00430000
*    R15 contains one of the following return codes                     00440000
*                                                                       00450000
*        RC00 - recovery complete                                       00460000
*        RC04 - recovery continues                                      00470000
*                                                                       00480000
**<DOC-OFF>****************************************************         00490000
                                                                        00500000
         EJECT                                                          00510000
         #WORK LENGTH=256         RCVRTN STANDARD                       00520000
         #ENDWORK ,                                                     00530000
                                                                        00540000
         EJECT                                                          00550000
         GSAVFRCA ,               IGENGSAV FRCA FORMAT                  00560000
                                                                        00570000
         EJECT                                                          00580000
         EQUS  LINKAGE=COND                                             00590000
                                                                        00600000
         EJECT                                                          00610000
IGENRSAV #ENTER SAVE=NO,PREG=(R8),LINKAGE=BAKR                          00620000
                                                                        00630000
         EJECT                                                          00640000
***************************************************************         00650000
*                                                                       00660000
*   EVALUATE RETRYSA WITH RESPECT TO FRCA PRESENTED                     00670000
*                                                                       00680000
***************************************************************         00690000
         LM    R6,R7,0(R8)        FETCH RETRYSA ADDRESS AND             00700000
         USING GSAVFRCA,R6        GENGSAV FRAME CONTROL AREA            00710000
                                                                        00720000
         C     R7,GSAVFORG        DETERMINE LOCATION OF RETRYSA         00730000
         BL    CONTINUE                                                 00740000
         C     R7,GSAVFEND                                              00750000
         BNL   CONTINUE                                                 00760000
                                                                        00770000
***************************************************************         00780000
*                                                                       00790000
*   RETRYSA IS CONTAINED IN CURRENT FRAME - REPAIR IT SAFELY            00800000
*                                                                       00810000
***************************************************************         00820000
         SR    R2,R2              PREPARE FOR INSERT                    00830000
         ICM   R2,3,0(R7)         SAVE AREA STACK PRESENT?              00840000
         AR    R2,R7              LOCATE AVAILABLE SLOT                 00850000
         MVC   0(4,R2),=C'SAVE'   RESTORE TAG                           00860000
         B     COMPLETE                                                 00870000
                                                                        00880000
***************************************************************         00890000
*                                                                       00900000
*   FRAME IS NO LONGER IN USE - REMOVE USING STANDARD FACILITY          00910000
*                                                                       00920000
***************************************************************         00930000
CONTINUE DS    0H                 RELEASE THE UNUSED FRAME              00940000
         L     R1,GSAVFORG        R1 <== FRAME ORIGIN ADDR              00950000
                                                                        00960000
         @@WXCALL IGENFSAV                                              00970000
                                                                        00980000
***************************************************************         00990000
*                                                                       01000000
*   RETURN TO $FRAME RECOVER DRIVER                                     01010000
*                                                                       01020000
***************************************************************         01030000
         LA    R15,RC04           CONTINUE FRAME RECOVERY               01040000
         B     EXIT                                                     01050000
                                                                        01060000
COMPLETE DS    0H                 FRAME RECOVERY COMPLETE               01070000
         LA    R15,RC00                                                 01080000
                                                                        01090000
EXIT     DS    0H                                                       01100000
         #EXIT ,                                                        01110000
                                                                        01120000
         EJECT                                                          01130000
***************************************************************         01140000
*                                                                       01150000
*   LOCAL READ ONLY WORKING STORAGE                                     01160000
*                                                                       01170000
***************************************************************         01180000
         LTORG ,                                                        01190000
                                                                        01200000
         PRINT NOGEN                                                    01210000
         ICVT  ,                                                        01220000
         END   ,                                                        01230000
