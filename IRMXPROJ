IRMXPROJ TITLE '- RESOURCE MANAGER EXIT RTN - PROJECT CLEANUP'          00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: IRMXPROJ - Resource manager exit - IPROJ cleanup             00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine receives control from the IUSER resource              00080000
*    manager routine.  The IUSER and IPROJ blocks are shared            00090000
*    between multiple workunits.  A use count is mantained in           00100000
*    the IUSER block.  When the use count goes to zero the              00110000
*    IUSER resource manager will call this routine to close             00120000
*    the current project held open by the user.                         00130000
*                                                                       00140000
* ON ENTRY:                                                             00150000
*                                                                       00160000
*    R1 - N/A                                                           00170000
*                                                                       00180000
*    R0 - terminating workunit (IPCB) address                           00190000
*                                                                       00200000
* ON EXIT:                                                              00210000
*                                                                       00220000
*    R15 contains one of the following return codes                     00230000
*                                                                       00240000
*        RC00 - request complete                                        00250000
*                                                                       00260000
**<DOC-OFF>****************************************************         00270000
                                                                        00280000
         EJECT                                                          00290000
***************************************************************         00300000
*                                                                       00310000
* MAINTENANCE:                                                          00320000
*                                                                       00330000
*   08/12/93  Ron Colmone                                               00340000
*             Initial version                                           00350000
*                                                                       00360000
***************************************************************         00370000
                                                                        00380000
         EJECT                                                          00390000
         #WORK ,                  READ/WRITE WORKAREA                   00400000
                                                                        00410000
         EJECT                                                          00420000
         XPRJREQ DSECT=NO         PROJECT SERVICES TRANSACTION PLIST    00430000
                                                                        00440000
         EJECT                                                          00450000
         PRJINFO DSECT=NO         PROJECT INFORMATION RETURN AREA       00460000
                                                                        00470000
         #ENDWORK ,               END OF WORKAREA                       00480000
                                                                        00490000
         EJECT                                                          00500000
         EQUS  ,                  GENERAL EQUATES                       00510000
                                                                        00520000
         EJECT                                                          00530000
IRMXPROJ #ENTER PREG=(R8,R9)                                            00540000
                                                                        00550000
         USING ITASK,R10          ITASK ADDRESSABILITY                  00560000
         USING IPCB,R9            IPCB  ADDRESSABILITY                  00570000
                                                                        00580000
         ICM   R7,15,PCBUSER      PROJECT CURRENT ACTIVE                00590000
         BZ    RETURN             NO, RETURN                            00600000
         USING IUSER,R7           TEMP ADDRESSABILITY                   00610000
         ICM   R7,15,USRPROJ      PROJECT CURRENT ACTIVE                00620000
         BZ    RETURN             NO, RETURN                            00630000
         USING IPROJ,R7           IPROJ ADDRESSABILITY                  00640000
                                                                        00650000
         EJECT                                                          00660000
***************************************************************         00670000
*                                                                       00680000
*   construct XPRJREQ and invoke project services interface             00690000
*                                                                       00700000
***************************************************************         00710000
                                                                        00720000
CLOSEPRJ DS    0H                                                       00730000
         MVC   XPJNAME,PRJNAME    PROJECT NAME                          00740000
         MVC   XPJTYPE,PRJACCES   RUN-TIME REQUEST                      00750000
         OI    XPJOPTS,XPJOCNFM   CONFIMATION, IF NEEDED, IS GIVEN      00760000
         LA    R0,XPJSCLOS        CLOSE REQUEST                         00770000
         ST    R0,XPJSFNC         SET SUBFUNCTION REQUEST CODE          00780000
         LA    R0,PRJINFO         PROJECT INFO RETURN AREA              00790000
         ST    R0,XPJRETA         PROVIDED FOR PROJECT INTERFACE        00800000
                                                                        00810000
         LA    R1,XPRJREQ         PROJECT TRANSACTION PLIST             00820000
         @CALL IPRJX,CTYPE=CVT    COMMON PROJECT FUNCTIONS              00830000
                                                                        00840000
*--------------------------------------------------------------         00850000
*   return                                                              00860000
*--------------------------------------------------------------         00870000
                                                                        00880000
RETURN   DS    0H                                                       00890000
         LA    R15,RC00           NORMAL COMPLETION                     00900000
         #EXIT ,                                                        00910000
                                                                        00920000
         EJECT                                                          00930000
***************************************************************         00940000
*                                                                       00950000
*   local read only data areas, etc.                                    00960000
*                                                                       00970000
***************************************************************         00980000
                                                                        00990000
         LTORG ,                                                        01000000
                                                                        01010000
         EJECT                                                          01020000
         PRINT NOGEN                                                    01030000
         ICVT  ,                                                        01040000
         ITASK ,                                                        01050000
         IPCB  ,                                                        01060000
         IUSER ,                                                        01070000
         IPROJ ,                                                        01080000
         END   ,                                                        01090000
