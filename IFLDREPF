IFLDREPF TITLE '- IDENTIFY LEADING REPEAT GROUP'                        00010000
         EQUS  ,                                                        00020000
                                                                        00030000
WORKAREA DSECT ,                                                        00040000
TRTAB    DS    XL256                                                    00050000
                                                                        00060000
         EJECT                                                          00070000
***************************************************************         00080000
*                                                                       00090000
* ROUTINE:  IFLDREPF - IDENTIFY LEADING REPEAT GROUP                    00100000
*                                                                       00110000
* DESCRIPTION:                                                          00120000
*                                                                       00130000
*    THIS ROUTINE RETURNS THE LENGTH OF A SINGLE BYTE REPEATING         00140000
*    GROUP FOUND AT THE ORIGIN OF A GIVEN STRING.  IF THE FIRST         00150000
*    CHARACTER DOES NOT REPEAT THE RETURNED VALUE IS ONE, UNLESS        00160000
*    THE STRING IS NULL, IN WHICH CASE ZERO IS RETURNED.                00170000
*                                                                       00180000
*                                                                       00190000
* ON ENTRY:                                                             00200000
*                                                                       00210000
*    R1  CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED           00220000
*        AS FOLLOWS                                                     00230000
*                                                                       00240000
*           +00 - STRING ORIGIN ADDRESS                                 00250000
*           +04 - STRING LENGTH                                         00260000
*                                                                       00270000
*    R0  CONTAINS THE ADDRESS OF A 256 BYTE WORKAREA                    00280000
*                                                                       00290000
*                                                                       00300000
* ON EXIT:                                                              00310000
*                                                                       00320000
*    R15 CONTAINS THE LENGTH OF SINGLE BYTE REPEATING GROUP.            00330000
*        ZERO IS RETURNED ONLY IF THE PASSED STRING LENGTH              00340000
*        IS ZERO.                                                       00350000
*                                                                       00360000
*    R1  CONTAINS THE ADDRESS OF THE LEAD CHARACTER, OR ZERO            00370000
*        IF THE SOURCE STRING IS NULL.                                  00380000
*                                                                       00390000
***************************************************************         00400000
         EJECT                                                          00410000
IFLDREPF #ENTER PREG=R8,SAVE=NO                                         00420000
                                                                        00430000
         USING ICVT,R11           STANDARD ENVIRONMENT                  00440000
         USING ITASK,R10                                                00450000
                                                                        00460000
         EJECT                                                          00470000
***************************************************************         00480000
*                                                                       00490000
*   DETERMINE LENGTH OF REPEATING GROUP                                 00500000
*                                                                       00510000
***************************************************************         00520000
         LM    R2,R3,0(R8)        FETCH STRING ORIGIN AND LENGTH        00530000
         LR    R4,R2              CURRENT POSITION IN STRING            00540000
         SR    R15,R15            INIT NUMBER OF LEADING ZEROS          00550000
         LTR   R3,R3              NULL STRING?                          00560000
         BZ    FWDFIN             DONE IF SO                            00570000
                                                                        00580000
*--------------------------------------------------------------         00590000
*   BUILD STRING SCAN TRANSLATE TABLE                                   00600000
*--------------------------------------------------------------         00610000
         LR    R7,R0              256 BYTE WORKAREA                     00620000
         USING WORKAREA,R7        FORMAT                                00630000
                                                                        00640000
         MVI   TRTAB,4            INITIALIZE TRANS TAB                  00650000
         MVC   TRTAB+1(L'TRTAB-1),TRTAB                                 00660000
         SR    R5,R5              PREPARE FOR INSERT                    00670000
         IC    R5,0(,R4)          FETCH LEAD BYTE                       00680000
         LA    R5,TRTAB(R5)       OFFSET TO LEAD BYTE ENTRY             00690000
         MVI   0(R5),0            GLIDE ON BY                           00700000
                                                                        00710000
         LA    R0,256             CAPACITY                              00720000
         LR    R6,R4              PRESERVE PTR TO STRING ORIGIN         00730000
                                                                        00740000
*--------------------------------------------------------------         00750000
*   ACCUMULATE REPETITIONS OF LEAD CHAR                                 00760000
*--------------------------------------------------------------         00770000
FWDNEXT  DS    0H                                                       00780000
         CR    R3,R0              LAST PASS?                            00790000
         BL    FWDLAST            ELSEWHERE IF SO                       00800000
         TRT   0(256,R4),TRTAB    SCAN FOR NON-ZERO                     00810000
         BC    HITS,FWDCALC       BINGO                                 00820000
         AR    R15,R0             ENTIRE SEGMENT SPANNED                00830000
         AR    R4,R0              NEXT SOURCE STRING EXTENT             00840000
         SR    R3,R0              ADJUST LENGTH ACCORDINGLY             00850000
         B     FWDNEXT            AGAIN                                 00860000
                                                                        00870000
FWDLAST  DS    0H                                                       00880000
         LTR   R3,R3              ANYTHING LEFT TO EXAMINE?             00890000
         BNP   FWDFIN             DONE IF NOT                           00900000
         LA    R1,0(R3,R4)        ASSUME TRT WILL MISS                  00910000
         BCTR  R3,0               PREPARE FOR EX                        00920000
         EX    R3,FWDTRT          SCAN FOR NON-ZERO                     00930000
                                                                        00940000
FWDCALC  DS    0H                                                       00950000
         SR    R1,R4              MATCHES BEFORE STOPPER                00960000
         ALR   R15,R1             ROLL INTO TOTAL                       00970000
                                                                        00980000
*--------------------------------------------------------------         00990000
*   RETURN COUNT TO REQUESTOR                                           01000000
*--------------------------------------------------------------         01010000
FWDFIN   DS    0H                                                       01020000
         LTR   R1,R15             NULL STRING?                          01030000
         BZ    *+6                SKIP IF SO                            01040000
         LR    R1,R6              ELSE RETURN PTR TO LEAD CHAR          01050000
                                                                        01060000
         #EXIT ,                  RETURN TO REQUESTOR                   01070000
                                                                        01080000
FWDTRT   TRT   0(*-*,R4),TRTAB                                          01090000
                                                                        01100000
         EJECT                                                          01110000
***************************************************************         01120000
*                                                                       01130000
*   LOCAL READ ONLY WORKING STORAGE AREAS                               01140000
*                                                                       01150000
***************************************************************         01160000
         LTORG ,                                                        01170000
                                                                        01180000
         PRINT NOGEN                                                    01190000
         ICVT  ,                                                        01200000
         ITASK ,                                                        01210000
         END   ,                                                        01220000
