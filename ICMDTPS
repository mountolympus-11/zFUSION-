ICMDTPS  TITLE '- TPSTART COMMAND'                                      00010000
         #WORK ,             BEGIN WORKAREA                             00020000
                                                                        00030000
ACBNAME  DS    CL8           ACB NAME                                   00040000
                                                                        00050000
REGSAVE  DS    16F           LOCAL ROUTINE SAVEAREA                     00060000
WK256    DS    XL256         LARGE PLIST CONSTRUCTION, ETC.             00070000
                                                                        00080000
         #ENDWORK ,          END OF WORKAREA                            00090000
                                                                        00100000
         EJECT                                                          00110000
         CMDREQ  ,           COMMAND REQUEST BLOCK                      00120000
         EJECT                                                          00130000
         CCSUMRY ,           COMMAND OPERAND PREPARSE SUMMARY           00140000
         EJECT                                                          00150000
         KEYCODES COMMANDSET=TPSTART                                    00160000
*                                                                       00170000
         CMDCODES ,                                                     00180000
*                                                                       00190000
         EQUS  ,                                                        00200000
                                                                        00210000
         $MSGDFT PREFIX=ICTPID,COMPID='CMD',TABLE=*#MSGS,              X00220000
               CONID=*CMRQCNID,CONNAME=CMRQCNAM,CART=CMRQCART,         X00230000
               DESTADD=*CMRQDMSK,                                      X00240000
               MSGQA=*CMRQMQA,STGQH=*CMRQSTGQ,                         X00250000
               MF=(E,WK256),                                           X00260000
               PRINT=NOGEN                                              00270000
         EJECT                                                          00280000
                                                                        00290000
**<DOC-ON>*****************************************************         00300000
*                                                                       00310000
* ROUTINE: ICMDTPS - TPSTART COMMAND                                    00320000
*                                                                       00330000
* DESCRIPTION:                                                          00340000
*                                                                       00350000
* SYNTAX:                                                               00360000
*                                                                       00370000
*    TPSTART ACBNAME(...)                                               00380000
*                                                                       00390000
*                                                                       00400000
* ON ENTRY:                                                             00410000
*                                                                       00420000
*    R1  contains the address of the command request block              00430000
*        (CMDREQ) in local CMDPROC format                               00440000
*                                                                       00450000
**<DOC-OFF>****************************************************         00460000
                                                                        00470000
                                                                        00480000
***************************************************************         00490000
*                                                                       00500000
* MAINTENANCE:                                                          00510000
*                                                                       00520000
*    08/11/93 R. TURGEON                                                00530000
*             INITIAL VERSION                                           00540000
*                                                                       00550000
***************************************************************         00560000
                                                                        00570000
         EJECT ,                                                        00580000
ICMDTPS  #ENTER PREG=R8                                                 00590000
                                                                        00600000
         USING ICVT,R11                                                 00610000
         USING ITASK,R10                                                00620000
                                                                        00630000
         EJECT ,                                                        00640000
***************************************************************         00650000
*                                                                       00660000
*    COMMAND PARSE                                                      00670000
*                                                                       00680000
***************************************************************         00690000
         USING CMDREQ,R8          COMMAND REQUEST BLOCK                 00700000
         ICM   R7,15,CMRQSMRY     ASSOC COMMAND SUMMARY                 00710000
         BZ    VALIDATE           ASSUME DEFAULTS                       00720000
         USING CCSUMRY,R7         COMMAND OPERAND SUMMARY FORMAT        00730000
         ICM   R5,15,CMRQSMR#     TOTAL NUMBER OF OPERAND ENTRIES       00740000
         BZ    VALIDATE           ASSUME DEFAULTS                       00750000
         L     R6,CMRQOPST        OPERAND STRING ORIGIN                 00760000
                                                                        00770000
*--------------------------------------------------------------         00780000
*   IDENTIFY THE OPERANDS PROVIDED AND VALIDATE                         00790000
*--------------------------------------------------------------         00800000
PARSENXT DS    0H                                                       00810000
         CLC   CCSID,=AL2(TPSTART_ACB)                                  00820000
         BE    PACB               EXTRACT ACB NAME                      00830000
         B     ERREJECT           REJECT OTHERWISE                      00840000
                                                                        00850000
*--------------------------------------------------------------         00860000
*   ACB REFERENCE                                                       00870000
*--------------------------------------------------------------         00880000
PACB     DS    0H                 ACB(<ACBNAME>)                        00890000
         CLC   CCSVALCT,=H'1'     SINGLE VALUE?                         00900000
         BNE   ERRSYNTX           SYNTAX PROBLEM OTHERWISE              00910000
         LH    R2,CCSVLEN         FETCH VALUE LENGTH                    00920000
         LTR   R2,R2              LENGTH OF STRING                      00930000
         BNP   ERRSYNTX           SYNTAX ERROR                          00940000
         CH    R2,=AL2(L'ACBNAME)    CORRECT LENGTH?                    00950000
         BH    ERRSYNTX           ERROR IF NOT                          00960000
                                                                        00970000
         MVC   ACBNAME,BLANKS     BLANK PAD                             00980000
         L     R3,CCSVDISP        OFFSET TO TASKNAME IN CMD LINE        00990000
         AR    R3,R6              CONVERT OFFSET TO ADDRESS             01000000
         BCTR  R2,0               PREPARE FOR EX                        01010000
         EX    R2,*+4             LOCAL COPY OF VALUE                   01020000
         MVC   ACBNAME(*-*),0(R3) EX OBJECT                             01030000
                                                                        01040000
*--------------------------------------------------------------         01050000
*   PROCESS ALL KEYWORDS, VALIDATE REQUEST COMPLETENESS                 01060000
*--------------------------------------------------------------         01070000
ADVANCE  DS    0H                                                       01080000
         LA    R15,CCSVSLN        LENGTH OF EACH VALUE ENTRY            01090000
         MH    R15,CCSVALCT       TOTAL SIZE CONSUMED BY VALUES         01100000
         LA    R7,CCSUMRY+CCSPFXL(R15)                                  01110000
         BCT   R5,PARSENXT        EXAMINE ALL OPERANDS                  01120000
         DROP  R7                 CCSUMRY                               01130000
                                                                        01140000
VALIDATE DS    0H                                                       01150000
         TM    ACBNAME,BF         ACBNAME PROVIDED?                     01160000
         BZ    ERRAMBIG                                                 01170000
                                                                        01180000
         EJECT                                                          01190000
***************************************************************         01200000
*                                                                       01210000
*   CLOSE THE DESIGNATED ACB                                            01220000
*                                                                       01230000
***************************************************************         01240000
         $VTAM TPSTART,                                                +01250000
               AREA=ACBNAME,      IACB TO BE STOPPED                   +01260000
               ERRET=ERR$VTAM,    SPECIAL ROUTINE IF TERM. NOT STARTED +01270000
               MF=(E,MFE_LIST)    START THE ACB TERMINATION & CLOSE     01280000
                                                                        01290000
         $MSG  303,FIELDS=(ACBNAME)                                     01300000
         B     NORMRET                                                  01310000
                                                                        01320000
ERR$VTAM DS    0H                                                       01330000
         ST    R15,FWORD                                                01340000
                                                                        01350000
         $MSG  304,FIELDS=(ACBNAME,FWORD)                               01360000
         B     NORMRET                                                  01370000
                                                                        01380000
         EJECT ,                                                        01390000
***************************************************************         01400000
*                                                                       01410000
*   RETURN COMPLETION STATUS TO REQUESTOR                               01420000
*                                                                       01430000
***************************************************************         01440000
NORMRET  DS    0H                                                       01450000
         LA    R15,CCODE_NORESP   NO ADDITIONAL RESPONSE REQUIRED       01460000
         B     CMDRET                                                   01470000
                                                                        01480000
ERRSYNTX DS    0H                                                       01490000
         LA    R15,CCODE_SYNTAX   SYNTAX ERROR                          01500000
         B     CMDRET             DONE                                  01510000
                                                                        01520000
ERRAMBIG DS    0H                                                       01530000
         LA    R15,CCODE_AMBIG    AMBIGUOUS REQUEST                     01540000
         B     CMDRET             DONE                                  01550000
                                                                        01560000
ERRCNFLC DS    0H                                                       01570000
         LA    R15,CCODE_CONFLICT CONFLICTING OPERANDS                  01580000
         B     CMDRET             DONE                                  01590000
                                                                        01600000
ERREJECT DS    0H                                                       01610000
         LA    R15,CCODE_REJECT   COMMAND REJECTED                      01620000
         B     CMDRET             DONE                                  01630000
                                                                        01640000
CMDRET   DS    0H                                                       01650000
         ST    R15,CMRQCOMP       POST COMPLETION CODE PER CONVENTION   01660000
         #EXIT ,                                                        01670000
                                                                        01680000
         EJECT ,                                                        01690000
***************************************************************         01700000
*                                                                       01710000
*   LOCAL READ/ONLY DATA AREAS, ETC.                                    01720000
*                                                                       01730000
***************************************************************         01740000
BLANKS   DC    CL16' '                                                  01750000
                                                                        01760000
         LTORG ,                                                        01770000
                                                                        01780000
         PRINT NOGEN                                                    01790000
         ICVT  ,                                                        01800000
         ITASK ,                                                        01810000
         IPCB  ,                                                        01820000
                                                                        01830000
         IVTAMCVT ,                                                     01840000
         $VTAM DSECT=YES                                                01850000
         END   ,                                                        01860000
