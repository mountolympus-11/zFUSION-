IRGNWRFR TITLE '- WRAP IMAGE VECTOR DELETE'                             00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: IRGNWRFR - WRAP IMAGE VECTOR (WRIVEC) DELETE                 00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THIS ROUTINE IS USE TO DELETE A WRAP REGION VECTOR AND             00080000
*    ALL ASSOCIATED DATA AREAS INCLUDING THE IMAGE BUFFER,              00090000
*    THE NVIMAGE IMAGE BUFFER HANDLE, AND THE ACTIVE TILING,            00100000
*    IF ANY.                                                            00110000
*                                                                       00120000
*                                                                       00130000
* ON ENTRY:                                                             00140000
*                                                                       00150000
*    R1  CONTAINS THE ADDRESS OF A PARAMETER LIST DESCRIBED BY          00160000
*        THE WRFRRQ MAPPING EXPANDED BELOW                              00170000
*                                                                       00180000
*                                                                       00190000
* ON EXIT:                                                              00200000
*                                                                       00210000
*    R15 CONTAINS ZERO                                                  00220000
*                                                                       00230000
**<DOC-OFF>****************************************************         00240000
                                                                        00250000
         EJECT ,                                                        00260000
***************************************************************         00270000
*                                                                       00280000
* MAPPING: IRGNWRFR PARAMETER LIST                                      00290000
*                                                                       00300000
***************************************************************         00310000
WRFRRQ   DSECT ,                  WRAP IMAGE VECTOR DELETE PLIST        00320000
WRFRWRIP DS    A                  WRIVEC ANCHOR WORD ADDRESS (**WRIVEC) 00330000
WRFRRQLN EQU   *-WRFRRQ           LENGTH OF PLIST                       00340000
                                                                        00350000
         EJECT                                                          00360000
         #WORK ,                                                        00370000
         #ENDWORK ,                                                     00380000
                                                                        00390000
         EJECT                                                          00400000
         WRIVEC ,                 WRAP REGION IMAGING VECTOR            00410000
                                                                        00420000
         EJECT                                                          00430000
         NAV    ,                 NAVIGATION STRUCTURES, ESP. NVIMAGE   00440000
                                                                        00450000
         EJECT                                                          00460000
         EQUS  ,                                                        00470000
                                                                        00480000
         EJECT                                                          00490000
IRGNWRFR #ENTER PREG=(R8)                                               00500000
                                                                        00510000
         USING ITASK,R10          STDENV                                00520000
         L     R9,TSKPCBC         PROCESS MODE                          00530000
         USING IPCB,R9            PROCESS ACCESS                        00540000
                                                                        00550000
         EJECT                                                          00560000
***************************************************************         00570000
*                                                                       00580000
*   DELETE WRIVEC AND ALL ASSOCIATED DATA AREAS                         00590000
*                                                                       00600000
***************************************************************         00610000
         USING WRFRRQ,R8          LIFE-OF-FUNCTION PLIST ADDRESSABILITY 00620000
         USING WRIVEC,R7          DECLARE INTENTIONS                    00630000
                                                                        00640000
         L     R2,WRFRWRIP        ANCHOR WORD ADDRESS                   00650000
         ICM   R7,15,0(R2)        FETCH WRIVEC                          00660000
         BZ    RETURN             ALREADY FREED                         00670000
         XC    0(4,R2),0(R2)      RESET ANCHOR                          00680000
                                                                        00690000
*--------------------------------------------------------------         00700000
*   DELETE IMAGE BUFFER                                                 00710000
*--------------------------------------------------------------         00720000
         ICM   R2,15,WRIORG       IMAGE BUFFER                          00730000
         BZ    NOIMGBUF           PREV FREED                            00740000
                                                                        00750000
         $RETSTOR (R2)            FREE IMAGE BUFFER                     00760000
                                                                        00770000
NOIMGBUF DS    0H                                                       00780000
                                                                        00790000
*--------------------------------------------------------------         00800000
*   DELETE NVIMAGE                                                      00810000
*--------------------------------------------------------------         00820000
         ICM   R2,15,WRINVIMG     IMAGE BUFFER HANDLE                   00830000
         BZ    NONVIMG            PREV FREED                            00840000
                                                                        00850000
         $RETSTOR (R2)            FREE IMAGE BUFFER HANDLE              00860000
                                                                        00870000
NONVIMG  DS    0H                                                       00880000
                                                                        00890000
*--------------------------------------------------------------         00900000
*   DELETE TILING                                                       00910000
*--------------------------------------------------------------         00920000
         ICM   R0,15,WRITILE      ACTIVE TILING?                        00930000
         BZ    NOTILE             SKIP IF NOT                           00940000
                                                                        00950000
         $CLINK FUNC=RECFREE,     DELETE TILING                        X00960000
               (STRUCT*,PCBSTG),                                       X00970000
               (STRUCT**,WRITILE)                                       00980000
                                                                        00990000
NOTILE   DS    0H                                                       01000000
                                                                        01010000
*--------------------------------------------------------------         01020000
*   DELETE WRAP IMAGE VECTOR                                            01030000
*--------------------------------------------------------------         01040000
         $RETSTOR WRIVEC          FREE WRAP IMAGE VECTOR                01050000
                                                                        01060000
*--------------------------------------------------------------         01070000
*   RETURN TO REQUESTOR                                                 01080000
*--------------------------------------------------------------         01090000
RETURN   DS    0H                                                       01100000
         SR    R15,R15            RETURN CODES NOT DEFINED              01110000
         #EXIT ,                                                        01120000
                                                                        01130000
         EJECT                                                          01140000
***************************************************************         01150000
*                                                                       01160000
*   LOCAL READ-ONLY WORKING STORAGE                                     01170000
*                                                                       01180000
***************************************************************         01190000
         LTORG ,                                                        01200000
                                                                        01210000
         PRINT NOGEN                                                    01220000
         ICVT  ,                                                        01230000
         ITASK ,                                                        01240000
         IPCB  ,                                                        01250000
         END                                                            01260000
