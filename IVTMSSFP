IVTMSSFP TITLE 'INTEGRATOR - ISESS SEND FINAL PROTOCOL CHECKS'          00010000
**<DOC-ON>************************************************************* 00020000
*                                                                       00030000
* ROUTINE: IVTMSSFP - ISESS SEND FINAL PROTOCOL CHECKS                  00040000
*                                                                       00050000
* DESCRIPTION: THIS ROUTINE IS CALLED BY IVTMSRSP AND IVTMSREQ TO       00060000
*              UPDATE STATE INFORMATION THAT MUST BE UPDATED FOLLOWING  00070000
*              A SEND COMPLETION.                                       00080000
*                                                                       00090000
* ON ENTRY:                                                             00100000
*                                                                       00110000
*    R15 = ENTRY POINT ADDRESS                                          00120000
*    R14 = RETURN      ADDRESS                                          00130000
*    R13 = SAVE AREA   ADDRESS                                          00140000
*    R11 = ICVT        ADDRESS                                          00150000
*    R10 = ITASK       ADDRESS                                          00160000
*    R09 = IVTAMCVT    ADDRESS                                          00170000
*    R01 = SPLIST      ADDRESS                                          00180000
*    R00 = ISESS       ADDRESS                                          00190000
*                                                                       00200000
* ON EXIT:                                                              00210000
*                                                                       00220000
*    R15 = 0                                                            00230000
*    R00 = 0                                                            00240000
*    R01 = 0                                                            00250000
*                                                                       00260000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00270000
*                                                                       00280000
**<DOC-OFF>************************************************************ 00290000
                                                                        00300000
         EJECT ,                                                        00310000
*********************************************************************** 00320000
*                                                                       00330000
* MAINTENANCE:                                                          00340000
*                                                                       00350000
*   09/14/94 RANDY WITEK                                                00360000
*                                                                       00370000
*********************************************************************** 00380000
                                                                        00390000
         EQUS  ,                  GENERAL EQUATES                       00400000
                                                                        00410000
RICVT    EQU   R11                                                      00420000
RITASK   EQU   R10                                                      00430000
RIVTAM   EQU   R9                                                       00440000
RISESS   EQU   R8                                                       00450000
RSPLIST  EQU   R7                                                       00460000
                                                                        00470000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00480000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00490000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00500000
         USING ISESS,RISESS       ESTABLISH ADDRESSABILITY              00510000
         USING SPLIST,RSPLIST     ESTABLISH ADDRESSABILITY              00520000
                                                                        00530000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00540000
WRK256   DS    XL256              GENERAL WORKAREA                      00550000
RETR15   DS    F                                                        00560000
RETR0    DS    F                                                        00570000
RETR1    DS    F                                                        00580000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      00590000
WORKLEN  #ENDWORK                 END OF WORKAREA                       00600000
                                                                        00610000
         $MSGDFT PREFIX=ICTPID,                                        +00620000
               COMPID='VTM',                                           +00630000
               TABLE=*#MSGS,                                           +00640000
               WORKA=0,                                                +00650000
               MF=(E,WRK256),                                          +00660000
               PRINT=NOGEN                                              00670000
                                                                        00680000
IVTMSSFP #ENTER BASE=R12,         ENTRY LINKAGE                        +00690000
               PREG=(RSPLIST,RISESS), R1 -> RSPLIST  R0 -> RISESS      +00700000
               AMODE=31,                                               +00710000
               RMODE=ANY                                                00720000
                                                                        00730000
*---------------------------------------------------------------------- 00740000
* UPDATE STATE INFORMATION                                              00750000
*---------------------------------------------------------------------- 00760000
                                                                        00770000
*                                                                       00780000
* SPECIAL HANDLING FOR AN SNA BID RU                                    00790000
*---------------------------------------------------------------------- 00800000
                                                                        00810000
         TM    SPLCNTDC,RPLBID    IS THIS A BID RESPONSE?               00820000
         BNO   PENDNBID           BRANCH IF NOT                         00830000
         TM    SPLRRH1,RHERI      IS THIS AN EXCEPTION RESPONSE?        00840000
         BO    PENDNBID           BRANCH IF YES                         00850000
         OI    ISES1,ISES1BAC     SHOW BID ACCEPTED                     00860000
         B     RETURN             STATES DONE                           00870000
                                                                        00880000
*                                                                       00890000
* NORMAL HANDLING FOR EXCEPTION RESPONSES                               00900000
*---------------------------------------------------------------------- 00910000
                                                                        00920000
PENDNBID DS    0H                                                       00930000
                                                                        00940000
         TM    SPLF4,SPLF4BID       WAS THIS A CONLOSER BID?            00950000
         BO    PENDLBID             BRANCH IF YES                       00960000
                                                                        00970000
         TM    SPLRRH1,RHERI        IS THIS AN EXCEPTION RESPONSE?      00980000
         BNO   RETURN               BRANCH IF NOT                       00990000
         CLC   SPLSENSE(2),=X'0813' BRACKET STUFF?                      01000000
         BE    PENDBRK              BRANCH IF YES                       01010000
         CLC   SPLSENSE(2),=X'0814' BRACKET STUFF?                      01020000
         BE    PENDBRK              BRANCH IF YES                       01030000
         CLC   SPLSENSE(2),=X'081B' BRACKET STUFF?                      01040000
         BE    RETURN               BRANCH IF YES                       01050000
         TM    ISEF2,ISEF2SYM       SYMMETRIC RECOVERY?                 01060000
         BO    PENDGDIR             BRANCH IF YES TO GIVE THE DIRECT.   01070000
         TM    ISEF2,ISEF2RCV       NON-SYMMETRIC RESPONSIBILITY?       01080000
         BNO   RETURN               BRANCH IF NOT                       01090000
                                                                        01100000
PENDGDIR DS    0H                                                       01110000
                                                                        01120000
         NI    ISES1,255-ISES1DIR   CLEAR THE DIRECTION                 01130000
         B     RETURN               STATES DONE                         01140000
                                                                        01150000
PENDBRK  DS    0H                                                       01160000
                                                                        01170000
         NI    ISES1,255-ISES1INB   CLEAR THE INB INDICATION            01180000
         NI    ISES1,255-ISES1DIR   CLEAR THE DIRECTION                 01190000
         B     RETURN               STATES DONE                         01200000
                                                                        01210000
*                                                                       01220000
* SPECIAL HANDLING OF CONTENTION LOSER BB RU'S                          01230000
*---------------------------------------------------------------------- 01240000
                                                                        01250000
PENDLBID DS    0H                                                       01260000
                                                                        01270000
         TM    SPLRRH1,RHERI        DID BB FAIL?                        01280000
         BNO   PENDACCP             BRANCH IF NOT                       01290000
         CLC   SPLSENSE(2),=X'0813' WAS THE BRACKET REJECTED?           01300000
         BE    RETURN               BRANCH IF YES                       01310000
         CLC   SPLSENSE(2),=X'0814' WAS THE BRACKET REJECTED?           01320000
         BE    RETURN               BRANCH IF YES                       01330000
                                                                        01340000
PENDACCP DS    0H                                                       01350000
                                                                        01360000
         OI    ISES1,ISES1INB       SHOW WE ARE IN-BRACKET              01370000
         OI    ISES1,ISES1DIR       TAKE THE DIRECTION                  01380000
         TM    SPLRH2,RHCDI         DID WE GIVE UP DIRECTION ALSO?      01390000
         BNO   RETURN               BRANCH IF NOT                       01400000
         NI    ISES1,255-ISES1DIR   CLEAR THE DIRECTION                 01410000
         B     RETURN               STATES DONE                         01420000
                                                                        01430000
*---------------------------------------------------------------------- 01440000
* RETURN TO CALLER                                                      01450000
*---------------------------------------------------------------------- 01460000
                                                                        01470000
RETURN   DS    0H                                                       01480000
                                                                        01490000
         LM    R15,R1,RETREGS     LOAD RETURN VALUES                    01500000
                                                                        01510000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    01520000
                                                                        01530000
*---------------------------------------------------------------------- 01540000
*  CONSTANTS AND LITERALS                                               01550000
*---------------------------------------------------------------------- 01560000
                                                                        01570000
         LTORG ,                                                        01580000
         PRINT NOGEN                                                    01590000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                01600000
         ISTDBIND ,               VTAM BIND IMAGE                       01610000
         ISTRH ,                  VTAM SNA REQUEST HEADER               01620000
         TRACODES ,               INTEGRATOR TRACE CODE EQUATES         01630000
         ICVT  ,                  INTEGRATOR CVT                        01640000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   01650000
         IRPL ,                   INTEGRATOR VTAM RPL+                  01660000
         IACB ,                   INTEGRATOR VTAM ACB+                  01670000
         INIB ,                   INTEGRATOR VTAM NIB+                  01680000
         ISESS ,                  INTEGRATOR SESSION BLOCK              01690000
         IRQE ,                   INTEGRATOR RECEIVE QUEUE ELEMENT      01700000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            01710000
         ITASK ,                  INTEGRATOR TASK BLOCK                 01720000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          01730000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       01740000
         EVCODES ,                INTEGRATOR EVENT CODES                01750000
         ABCODES ,                INTEGRATOR $ABEND CODES               01760000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     01770000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        01780000
         $TASK DSECT=YES          INTEGRATOR $TASK SERVICES             01790000
         $PROC DSECT=YES          INTEGRATOR $PROC SERVICES             01800000
         $VTAM DSECT=YES          INTEGRATOR $VTAM SERVICES             01810000
         $SESS DSECT=YES          INTEGRATOR $SESS SERVICES             01820000
         IFGEXLST ,               VTAM EXIT LIST                        01830000
         END   ,                                                        01840000
