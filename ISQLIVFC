ISQLIVFC TITLE '- ACQUIRE INPUT COLUMN VALUE FROM CLAUSE'               00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ISQLIVFC - Acquire input column value from clause            00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine is used to acquire a value for an input               00080000
*    variable associated with a VDB column name.  The value             00090000
*    is acquired by searching a "predicate list" provided               00100000
*    on input.  Selection of the list(s) appropriate for the            00110000
*    SQL statement type is the responsiblity of the caller.             00120000
*                                                                       00130000
*    Column values are queued in basic predicate format                 00140000
*    (colname <opr> value) to any of several lists depending on         00150000
*    the type of SQL statement and the clauses present in that          00160000
*    statement.  For example, variable assignments will appear          00170000
*    in the VALUES clause of an INSERT statement, and                   00180000
*    potentially in both the SET and WHERE clauses of an                00190000
*    UPDATE statement.                                                  00200000
*                                                                       00210000
*    In response to the VDB column name provided as input, one          00220000
*    of three outcomes is possible.  If the column name                 00230000
*    provided on input does not match any of the basic                  00240000
*    predicate entries, a NOT FOUND condition is returned.              00250000
*                                                                       00260000
*    Otherwise, the predicate may contain a literal value               00270000
*    reference, or may refer to a "default value" indicated             00280000
*    by SQL grammar extensions or non-standard interpretation           00290000
*    (of the NULL keyword in most cases).                               00300000
*                                                                       00310000
*                                                                       00320000
* REQUIREMENTS:                                                         00330000
*                                                                       00340000
*    It is assumed that the caller has ensured that basic               00350000
*    predicates relating an input column to a literal value do          00360000
*    so only using the equality (=) operator, conveying a               00370000
*    value assignment.                                                  00380000
*                                                                       00390000
*    Similarly, the caller is responsible for ensuring that             00400000
*    the column is referred to at most once in the predicate            00410000
*    list.  Multiple column value assignments in the same               00420000
*    clause are ambiguous.                                              00430000
*                                                                       00440000
*                                                                       00450000
* ON ENTRY:                                                             00460000
*                                                                       00470000
*    R0 - addr of predicate queue anchor word                           00480000
*    R1 - addr of VDB column name                                       00490000
*                                                                       00500000
*                                                                       00510000
* ON EXIT:                                                              00520000
*                                                                       00530000
*    R15 contains one of the following return codes                     00540000
*                                                                       00550000
*        RC00 - column value assignment acquired                        00560000
*                                                                       00570000
*               R1 - value string origin                                00580000
*               R0 - value string length                                00590000
*                                                                       00600000
*        RC04 - Explicit NULL value                                     00610000
*                                                                       00620000
*        RC08 - no reference to named column found                      00630000
*                                                                       00640000
**<DOC-OFF>****************************************************         00650000
                                                                        00660000
         EJECT                                                          00670000
***************************************************************         00680000
*                                                                       00690000
* MAINTENANCE:                                                          00700000
*                                                                       00710000
*    06/28/95 R. Turgeon                                                00720000
*             Initial version from breakup of ISQLVDB and the           00730000
*             introduction of table select support                      00740000
*                                                                       00750000
***************************************************************         00760000
                                                                        00770000
         EJECT                                                          00780000
         SQLSEMAL ,          SQL SEMANTIC SUMMARY                       00790000
                                                                        00800000
         EJECT                                                          00810000
         EQUS  ,                                                        00820000
                                                                        00830000
ISQLIVFC #ENTER PREG=(R8,R7),SAVE=NO                                    00840000
                                                                        00850000
****************************************************************        00860000
*                                                                       00870000
*   Predicate list scan                                                 00880000
*                                                                       00890000
****************************************************************        00900000
                                                                        00910000
         ICM   R2,15,0(R7)        FIRST PREDICATE IN LIST               00920000
         BZ    SCANFAIL           COLUMN NOT MATCHED                    00930000
                                                                        00940000
PFX      USING PREDENT,R2         PREDICATE LIST NODE - COMMON PFX      00950000
BPT      USING SBPTERM,R2         BASIC PREDICATE FORMAT                00960000
                                                                        00970000
*---------------------------------------------------------------        00980000
*   SCAN ALL COLUMN VALUE SOURCES UNTIL MATCH                           00990000
*---------------------------------------------------------------        01000000
                                                                        01010000
SCANTOP  DS    0H                                                       01020000
         CLI   PFX.PREDTYPE,PRED$BPE   BASIC PREDICATE ENTRY?           01030000
         BE    SCANCOMP                MATCH COLUMN IF SO               01040000
         CLI   PFX.PREDTYPE,PRED$SET   SET CLAUSE VARIATION?            01050000
         BNE   SCANADV                 SKIP IF NOT                      01060000
                                                                        01070000
SCANCOMP DS    0H                                                       01080000
         L     R3,BPT.SBPACOL     COLUMN REFERENCE                      01090000
         USING SQCOLREF,R3        COLUMN ENTRY FORMAT                   01100000
         CLC   SQCOLNM,0(R8)      MATCHES ARGUMENT COLUMN NAME?         01110000
         BE    SCANHIT            MATCH IF SO                           01120000
                                                                        01130000
SCANADV  DS    0H                                                       01140000
         ICM   R2,15,PFX.PREDLINK CONTINUE SEARCH                       01150000
         BNZ   SCANTOP            MORE ENTRIES TO TEST                  01160000
                                                                        01170000
*---------------------------------------------------------------        01180000
*   MATCHING PREDCIATE / SET-VALUE NOT FOUND                            01190000
*---------------------------------------------------------------        01200000
                                                                        01210000
SCANFAIL DS    0H                                                       01220000
         LA    R15,RC08                                                 01230000
         B     SCANRET                                                  01240000
                                                                        01250000
*---------------------------------------------------------------        01260000
*   COLUMN MATCHED - IDENTIFY ASSOCIATED VALUE                          01270000
*---------------------------------------------------------------        01280000
                                                                        01290000
SCANHIT  DS    0H                 PREDICATE MATCHES COLUMN              01300000
         LA    R15,RC04           PRESUME EXPLICIT NULL VALUE           01310000
         TM    BPT.SBPVTYPE,SBPV$DFT                                    01320000
         BO    SCANRET                                                  01330000
                                                                        01340000
         LH    R0,BPT.SBPLVAL     VALUE LENGTH                          01350000
         L     R1,BPT.SBPAVAL     VALUE STRING ORIGIN                   01360000
         LA    R15,RC00                                                 01370000
                                                                        01380000
*---------------------------------------------------------------        01390000
*   RETURN COMPLETION STATUS / VALUE TO CALLER                          01400000
*---------------------------------------------------------------        01410000
                                                                        01420000
SCANRET  DS    0H                                                       01430000
         #EXIT ,                                                        01440000
                                                                        01450000
         EJECT                                                          01460000
***************************************************************         01470000
*                                                                       01480000
*   Local read-only working storage                                     01490000
*                                                                       01500000
***************************************************************         01510000
                                                                        01520000
         LTORG ,                                                        01530000
                                                                        01540000
         PRINT NOGEN                                                    01550000
         ICVT ,                                                         01560000
         ITASK ,                                                        01570000
         END   ,                                                        01580000
