IDSSPCUQ TITLE 'DATASPACE SVCS - SPACE SERIALIZATION (EXCLUSIVE)'       00010000
***************************************************************         00020000
*                                                                       00030000
*   LOCAL READ/WRITE WORKING STORAGE                                    00040000
*                                                                       00050000
***************************************************************         00060000
WORKAREA DSECT ,                                                        00070000
                                                                        00080000
         @WORK ,                                                        00090000
                                                                        00100000
WORKLEN  EQU   *-WORKAREA                                               00110000
                                                                        00120000
         EJECT ,                                                        00130000
         SPCEQUS  ,                                                     00140000
                                                                        00150000
         EJECT ,                                                        00160000
         EQUS  ,                                                        00170000
                                                                        00180000
         EJECT ,                                                        00190000
**<DOC-ON>*****************************************************         00200000
*                                                                       00210000
* ROUTINE:  IDSSPCUQ - SPACE SERIALIZATION - EXCLUSIVE IF AVAIL         00220000
*                                                                       00230000
* DESCRIPTION:                                                          00240000
*                                                                       00250000
*    THIS ROUTINE IS USED TO ACQUIRE EXCLUSIVE CONTROL OF THE           00260000
*    NAMED SPACE IF THE RESOURCE IS IMMEDIATELY AVAILABLE.              00270000
*                                                                       00280000
*    WHEN NO EXTERNAL SERIALIZATION CONTROL AREA IS GIVEN,              00290000
*    SERIALIZATION IS IMPLEMENTED BY ENQ AND DEQ.  OTHERWISE A          00300000
*    @SERSERV OBTAIN IS ISSUED TO ALLOW THE EXTERNAL                    00310000
*    SERIALIZATION MECHANISM TO ACQUIRE CONTROL. THE @SERSERV           00320000
*    MACRO AND ITS SERIALIZATION TECHNIQUES ARE NOT DESCRIBED           00330000
*    IN THIS API.                                                       00340000
*                                                                       00350000
*                                                                       00360000
* ON ENTRY:                                                             00370000
*                                                                       00380000
*    R0 - SPACE SERIALIZATION CONTROL                                   00390000
*    R1 - ADDR OF SPACE IDENTIFIER XL8                                  00400000
*                                                                       00410000
* ON EXIT:                                                              00420000
*                                                                       00430000
*    R15  CONTAINS ONE OF THE FOLLOWING RETURN CODES                    00440000
*                                                                       00450000
*         RC00 - RESOURCE ACQUIRED, OWNERSHIP ASSIGNED                  00460000
*         RC04 - RESOURCE IS NOT IMMEDIATELY AVAILABLE                  00470000
*         RC08 - RESOURCE ALREADY OWNED BY REQUESTOR                    00480000
*                                                                       00490000
*                                                                       00500000
* AMODE:   ANY                                                          00510000
* RMODE:   ANY                                                          00520000
* ASCMODE: PRIMARY                                                      00530000
*                                                                       00540000
**<DOC-OFF>****************************************************         00550000
                                                                        00560000
         EJECT ,                                                        00570000
IDSSPCUQ @ENTER WORKA=(WORKAREA,WORKLEN),ASC=PRIMARY                    00580000
                                                                        00590000
         LTR   R2,R0              EXTERNAL LOCKING?                     00600000
         BZ    ENQDEQ             STANDARD SERIALIZATION OTHERWISE      00610000
                                                                        00620000
*--------------------------------------------------------------         00630000
*   SPACE SERIALIZATION VIA EXTERNAL MECHANISMS                         00640000
*--------------------------------------------------------------         00650000
         @SERSERV OBTAIN,COND=YES,LOCKPTR=(R2)                          00660000
         B     EXIT                                                     00670000
                                                                        00680000
*--------------------------------------------------------------         00690000
*   SPACE SERIALIZATION VIA ENQ / DEQ                                   00700000
*--------------------------------------------------------------         00710000
ENQDEQ   DS    0H                                                       00720000
         LR    R4,R1              SPACE NAME                            00730000
         MVC   MFE_LIST(ENQLEN),ENQ                                     00740000
                                                                        00750000
         ENQ   (INTSPACE,(R4),E,8,STEP),                               X00760000
               RET=USE,                                                X00770000
               MF=(E,MFE_LIST)                                          00780000
                                                                        00790000
         LTR   R15,R15            ACQUIRED?                             00800000
         BZ    EXIT               DONE IF SO                            00810000
         ICM   R15,8,3(R15)       ELSE FETCH ACTUAL VALUE               00820000
         SRL   R15,24             ISOLATE                               00830000
                                                                        00840000
*--------------------------------------------------------------         00850000
*   RETURN TO CALLER                                                    00860000
*--------------------------------------------------------------         00870000
EXIT     DS    0H                                                       00880000
         @EXIT ,                                                        00890000
                                                                        00900000
         EJECT                                                          00910000
***************************************************************         00920000
*                                                                       00930000
*   LOCAL READ ONLY DATA AREAS, ETC.                                    00940000
*                                                                       00950000
***************************************************************         00960000
INTSPACE DC    CL8'INTSPACE'                                            00970000
                                                                        00980000
ENQ      ENQ   (*-*,*-*,E,0,STEP),RET=USE,MF=L                          00990000
ENQLEN   EQU   *-ENQ                                                    01000000
                                                                        01010000
         LTORG ,                                                        01020000
                                                                        01030000
         PRINT NOGEN                                                    01040000
         ICVT  ,                                                        01050000
         IHAPSA ,                                                       01060000
         IKJTCB ,                                                       01070000
         END                                                            01080000
