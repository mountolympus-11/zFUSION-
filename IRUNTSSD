IRUNTSSD TITLE '- DELETE TABLE-SELECT SEARCH ARGUMENT'                  00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE:  IRUNTSSD - DELETE TABLE-SELECT SEARCH ARGUMENT              00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine releases the storage occupied by a table-             00080000
*    select search argument previously constructed by IRUNTSSA.         00090000
*                                                                       00100000
*                                                                       00110000
* NOTES:                                                                00120000
*                                                                       00130000
*    Consider creating a dedicated STGMGR storage pool to allow         00140000
*    the entire search argument to be deleted with a single             00150000
*    STGTERM call.                                                      00160000
*                                                                       00170000
*                                                                       00180000
* LINKAGE:                                                              00190000
*                                                                       00200000
*    Standard linkage upon entry                                        00210000
*    Internally recursive using BAKR linkage                            00220000
*                                                                       00230000
*                                                                       00240000
* ON ENTRY:                                                             00250000
*                                                                       00260000
*    R1  contains the address of a SARG constructed by IRUNTSSA         00270000
*                                                                       00280000
*                                                                       00290000
* ON EXIT:                                                              00300000
*                                                                       00310000
*    R15 contains one of the following return codes                     00320000
*                                                                       00330000
*        RC00 - storage release complete                                00340000
*                                                                       00350000
*        RC04 - SARG address provided is zero                           00360000
*                                                                       00370000
*        RC24 - storage availability / management failure               00380000
*                                                                       00390000
*               R0 - storage service completion code                    00400000
*                                                                       00410000
**<DOC-OFF>****************************************************         00420000
                                                                        00430000
         EJECT                                                          00440000
***************************************************************         00450000
*                                                                       00460000
*  Maintenance:                                                         00470000
*                                                                       00480000
*    06/14/95  R. Turgeon                                               00490000
*              Initial version                                          00500000
*                                                                       00510000
*    09/06/95  R. Turgeon       PAR 213494                              00520000
*              Corrected bad branch in TSFREE routine that              00530000
*              causes either an ABEND or storage leak.                  00540000
*                                                                       00550000
***************************************************************         00560000
                                                                        00570000
         EJECT                                                          00580000
         #WORK ,                                                        00590000
         #ENDWORK ,                                                     00600000
                                                                        00610000
         EJECT                                                          00620000
         TBBNODES ,               TABLE SERVICES SARG FORMATS           00630000
                                                                        00640000
         EJECT                                                          00650000
         EQUS  ,                                                        00660000
                                                                        00670000
         EJECT                                                          00680000
IRUNTSSD #ENTER PREG=(R8)                                               00690000
                                                                        00700000
         USING ITASK,R10          STDENV                                00710000
         L     R9,TSKPCBC         PROCESS MODE                          00720000
         USING IPCB,R9            LIFE OF FUNCTION ADDRESSABILITY       00730000
                                                                        00740000
         EJECT                                                          00750000
***************************************************************         00760000
*                                                                       00770000
*   Accept passed SARG, exit with warning if not provided.              00780000
*   Else initiate a recursive descent through the SARG nodes            00790000
*   freeing them from the bottom up.                                    00800000
*                                                                       00810000
***************************************************************         00820000
                                                                        00830000
         LTR   R8,R8              SARG PROVIDED?                        00840000
         BZ    WRN_SARG           DONE IF NOT                           00850000
         USING TBSARG1,R8         SOURCE SARG                           00860000
                                                                        00870000
         ICM   R1,15,TBS1NODE     R1 <== SARG ORIGIN                    00880000
         BZ    FREEFINL           NO SARG NODES ???                     00890000
         BAS   R14,TSFREE         COPY AND PRUNE THE SARG               00900000
         LTR   R15,R15            COMPLETED WITHOUT ERROR?              00910000
         BNZ   ERR_STG            ATTRIBUTE TO STORAGE ERROR            00920000
                                                                        00930000
***************************************************************         00940000
*                                                                       00950000
*   Release the SARG header                                             00960000
*                                                                       00970000
***************************************************************         00980000
                                                                        00990000
FREEFINL DS    0H                                                       01000000
         STGRETN ADDR=(R8),LEN=TBS1LEN,QH=TSKSTG                        01010000
                                                                        01020000
         BNZ   ERR_STG            STORAGE FAILURE                       01030000
         DROP  R8                 TBSARG1                               01040000
                                                                        01050000
***************************************************************         01060000
*                                                                       01070000
*   Return completion status to caller                                  01080000
*                                                                       01090000
***************************************************************         01100000
                                                                        01110000
         LA    R15,RC00           INDICATE SUCCESS                      01120000
         B     RETURN             COMPLETE                              01130000
                                                                        01140000
WRN_SARG DS    0H                 NO SARG PROVIDED                      01150000
         LA    R15,RC04           WARNING                               01160000
         B     RETURN                                                   01170000
                                                                        01180000
ERR_STG  DS    0H                 STORAGE FAILURE                       01190000
         LR    R0,R15             PRESERVE SERVICE ROUTINE RETCODE      01200000
         LA    R15,RC24           SET LOCAL INDICATOR                   01210000
                                                                        01220000
*--------------------------------------------------------------         01230000
*   Return to caller                                                    01240000
*--------------------------------------------------------------         01250000
                                                                        01260000
RETURN   DS    0H                                                       01270000
         SR    R0,R0              REASON CODES NOT DEFINED              01280000
                                                                        01290000
         #EXIT ,                                                        01300000
                                                                        01310000
         EJECT                                                          01320000
**<DOC-ON>*****************************************************         01330000
*                                                                       01340000
* ROUTINE:  TSFREE - Release SARG predicate subtree storage             01350000
*                                                                       01360000
* ON ENTRY:                                                             01370000
*                                                                       01380000
*    R1  contains the address of a source predicate subtree             01390000
*                                                                       01400000
* ON EXIT:                                                              01410000
*                                                                       01420000
*    R15 contains zero or a storage manager failure code                01430000
*                                                                       01440000
**<DOC-OFF>****************************************************         01450000
                                                                        01460000
TSFREE   DS    0H                                                       01470000
         BAKR  R14,0                                                    01480000
                                                                        01490000
         LR    R4,R1              SARG NODE, MULTIPLE FORMATS           01500000
P        USING TBBPRED,R4            PREDICATE FORMATS                  01510000
C        USING TBCONN,R4             BOOLEAN CONNECTOR                  01520000
                                                                        01530000
*--------------------------------------------------------------         01540000
*   FREE SUBTREES OF CONNECTOR NODES                                    01550000
*--------------------------------------------------------------         01560000
                                                                        01570000
         CLI   C.TBCOTYPE,TBCO$CON                                      01580000
         BNE   TS_TERM            TERM NODE IF NOT CONNECTOR    213494  01590000
                                                                        01600000
         ICM   R1,15,C.TBCOLEFT   LEFT SOURCE SUBTREE                   01610000
         BZ    TS_RTREE           ODD, BUT ONWARD                       01620000
         BAS   R14,TSFREE         COPY SUBTREE, RETURN ROOT             01630000
         LTR   R15,R15            SUCCESS?                              01640000
         BNZ   TS_EXIT            ERROR OTHERWISE                       01650000
                                                                        01660000
TS_RTREE DS    0H                                                       01670000
         ICM   R1,15,C.TBCORGHT   RIGHT SOURCE SUBTREE                  01680000
         BZ    TS_TERM            ODD, BUT ONWARD                       01690000
         BAS   R14,TSFREE         COPY SUBTREE, RETURN ROOT             01700000
         LTR   R15,R15            SUCCESS?                              01710000
         BNZ   TS_EXIT            ERROR OTHERWISE                       01720000
                                                                        01730000
TS_TERM  DS    0H                                                       01740000
                                                                        01750000
*-------------------------------------------------------------          01760000
*   FREE CURRENT NODE                                                   01770000
*-------------------------------------------------------------          01780000
                                                                        01790000
         LA    R2,TBPRLEN         ASSUME PREDICATE FORMAT               01800000
         CLI   C.TBCOTYPE,TBCO$CON                                      01810000
         BNE   *+8                ASSUMPTION CORRECT                    01820000
         LA    R2,TBCOLEN         ELSE ITS A CONNECTOR                  01830000
                                                                        01840000
         STGRETN ADDR=(R4),LEN=(R2),QH=TSKSTG                           01850000
                                                                        01860000
*--------------------------------------------------------------         01870000
*   RETURN COMPLETION STATUS AND SARG NODE COPY TO CALLER               01880000
*--------------------------------------------------------------         01890000
                                                                        01900000
TS_EXIT  DS    0H                                                       01910000
         PR    ,                                                        01920000
         DROP  C,P                SARG NODES, SOURCE AND COPY           01930000
                                                                        01940000
         EJECT                                                          01950000
***************************************************************         01960000
*                                                                       01970000
*   Local read-only data areas, etc.                                    01980000
*                                                                       01990000
***************************************************************         02000000
                                                                        02010000
         LTORG ,                                                        02020000
                                                                        02030000
         EJECT                                                          02040000
         PRINT NOGEN                                                    02050000
         ICVT  ,                                                        02060000
         ITASK ,                                                        02070000
         IPCB  ,                                                        02080000
         END   ,                                                        02090000
