IRMXUSTP TITLE 'RESOUCE MANAGER EXIT - STOP PCBS FOR IUSER'             00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE: IRMXUSTP - Resource manager exit - Stop PCBs for IUSER       00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*   This resource manager routine will post the processes               00080000
*   associated with the IUSER control block provided.  PCBs             00090000
*   created on behalf of the terminating user, such as SLU              00100000
*   processes, are not subordinate to the USER process and              00110000
*   therefore must be explictly stopped.  This routine will run         00120000
*   through the ITASK PCB queue and notify those processes that         00130000
*   are associated with the terminating user.                           00140000
*                                                                       00150000
*                                                                       00160000
* ON ENTRY:                                                             00170000
*                                                                       00180000
*   R0 contains the address of the PCB being deleted                    00190000
*   R1 contains the address of the IUSER control block                  00200000
*                                                                       00210000
* ON EXIT:                                                              00220000
*                                                                       00230000
*   R15 contains one of the following return codes:                     00240000
*                                                                       00250000
*     RC00 - Normal completion                                          00260000
*                                                                       00270000
**<DOC-ON>******************************************************        00280000
                                                                        00290000
         EJECT ,                                                        00300000
****************************************************************        00310000
*                                                                       00320000
* MAINTENANCE:                                                          00330000
*                                                                       00340000
*   09/22/94  RON COLMONE                                               00350000
*             Initial version                                           00360000
*                                                                       00370000
****************************************************************        00380000
                                                                        00390000
         EJECT ,                                                        00400000
         EQUS  ,                  GENERATE EQUATES                      00410000
                                                                        00420000
         EJECT ,                                                        00430000
         $PROC DSECT=YES          PROCESS MANAGER PLIST                 00440000
                                                                        00450000
         EJECT                                                          00460000
         $RESMGR DSECT=YES        RESOURCE MANAGER SERVICE PLIST        00470000
                                                                        00480000
         EJECT ,                                                        00490000
         #WORK ,                  READ/WRITE WORKAREA                   00500000
                                                                        00510000
$PROCMFL $PROC MF=L                                                     00520000
         #ENDWORK ,                                                     00530000
                                                                        00540000
         EJECT ,                                                        00550000
IRMXUSTP #ENTER BASE=R12,PREG=(R7,R9)                                   00560000
                                                                        00570000
         USING ITASK,R10          ITASK ADDRESSABILITY                  00580000
         USING IPCB,R9            IPCB  ADDRESSABILITY                  00590000
         USING IUSER,R7           IUSER ADDRESSABILITY                  00600000
                                                                        00610000
*--------------------------------------------------------------         00620000
*                                                                       00630000
*  STOP ALL PROCESSES ASSOCIATED WITH THIS USER/APPL                    00640000
*                                                                       00650000
*--------------------------------------------------------------         00660000
         LA    R4,TSKPCB          PCB DISPATCH QUEUE ORIGIN             00670000
         SH    R4,=AL2(PCBNEXT-IPCB)                                    00680000
Q        USING IPCB,R4            ADDRESSABILITY                        00690000
                                                                        00700000
STP_NEXT DS    0H                                                       00710000
         ICM   R4,15,Q.PCBNEXT    ADDR OF NEXT PCB                      00720000
         BZ    RETURN             STOP COMPLETE                         00730000
         C     R7,Q.PCBUSER       PROCESS ASSOCIATED WITH USER?         00740000
         BNE   STP_NEXT           CHECK NEXT PCB                        00750000
         TM    Q.PCBFLGS,PCB$PSTP+PCB$PCNL+PCB$STOP+PCB$CNCL            00760000
         BNZ   STP_NEXT           ALREADY NOTIFIED OR PENDING           00770000
                                                                        00780000
         $PROC STOP,PCB=Q.IPCB,MF=(E,$PROCMFL)                          00790000
                                                                        00800000
         B     STP_NEXT           CHECK NEXT PCB                        00810000
         DROP  Q                  IPCB                                  00820000
                                                                        00830000
RETURN   DS    0H                                                       00840000
         LA    R15,RC00           NORMAL COMPLETION                     00850000
         #EXIT ,                  RETURN                                00860000
                                                                        00870000
         EJECT ,                                                        00880000
****************************************************************        00890000
*                                                                       00900000
*  LITERAL, CONSTANTS  AND MAPPINGS                                     00910000
*                                                                       00920000
****************************************************************        00930000
         LTORG ,                  LITERALS                              00940000
                                                                        00950000
         PRINT NOGEN                                                    00960000
         ICVT  ,                                                        00970000
         ITASK ,                                                        00980000
         IPCB  ,                                                        00990000
         IUSER ,                                                        01000000
         PRINT GEN                                                      01010000
                                                                        01020000
         END   ,                                                        01030000
