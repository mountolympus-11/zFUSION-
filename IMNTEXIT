IMNTEXIT TITLE ' - CALL MODIFIED CATALOG TABLE EXIT ROUTINES'           00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: IMNTEXIT - Call Modified Catalog Table Exit Routines         00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine will determine if a catalog table has been            00080000
*    updated and will call all associated catalog maintenance           00090000
*    table exit routines.  If an exit routine is called the             00100000
*    table maintenance flag is reset.                                   00110000
*                                                                       00120000
* ON ENTRY:                                                             00130000
*                                                                       00140000
*    N/A                                                                00150000
*                                                                       00160000
* ON EXIT:                                                              00170000
*                                                                       00180000
*    R15 contains one of the following return codes:                    00190000
*                                                                       00200000
*        RC00 - Catalog Table Maintenance exits processed               00210000
*        RCnn - Highest return code from exit routine                   00220000
*                                                                       00230000
**<DOC-OFF>****************************************************         00240000
                                                                        00250000
         EJECT ,                                                        00260000
***************************************************************         00270000
*                                                                       00280000
* MAINTENANCE:                                                          00290000
*                                                                       00300000
*   09/08/93  RON COLMONE                                               00310000
*             INITIAL VERSION                                           00320000
*                                                                       00330000
***************************************************************         00340000
                                                                        00350000
         EJECT ,                                                        00360000
         EQUS  ,                  GENERAL EQUATES                       00370000
                                                                        00380000
         EJECT ,                                                        00390000
         $MNTCAT TYPE=DSECT       CATALOG MAINT TABLE MAPPINGS          00400000
                                                                        00410000
         EJECT ,                                                        00420000
         #WORK ,                  READ/WRITE WORKAREA                   00430000
HIGHRC   DS    F                  HIGHEST EXIT RETURN CODE              00440000
HIGHRSN  DS    F                  HIGHEST EXIT REASON CODE              00450000
         #ENDWORK ,               END OF WORKAREA                       00460000
                                                                        00470000
         EJECT ,                                                        00480000
IMNTEXIT #ENTER BASE=R12,PREG=R8                                        00490000
                                                                        00500000
         USING ITASK,R10          ITASK ADDRESSABILITY                  00510000
         L     R9,TSKPCBC         ADDRESS OF CURRENT PCB                00520000
         USING IPCB,R9            IPCB  ADDRESSABILITY                  00530000
                                                                        00540000
         L     R7,PCBUSER         ADDRESS OF IUSER BLOCK                00550000
         USING IUSER,R7           TEMP ADDRESSABILITY                   00560000
         L     R7,USRPROJ         PROJECT CONTROL AREA                  00570000
         USING IPROJ,R7           LIFE OF FUNCTION                      00580000
         STM   R14,R12,12(R13)    SAVE REGS FOR RS-EXP                  00590000
                                                                        00600000
         EJECT ,                                                        00610000
*--------------------------------------------------------------         00620000
*  OBTAIN MAINT TABLE ORIGIN AND ENTRY COUNT                            00630000
*--------------------------------------------------------------         00640000
         L     R4,=V(IMNTTAB)     ADDR OF TABLE LIST                    00650000
         USING MNTHDR,R4          ESTABLISH ADDRESSABILITY              00660000
         L     R3,MHDRCNT         GET COUNT OF ENTRIES                  00670000
         L     R4,MHDRFRST        ADDRESS OF FIRST ENTRY                00680000
         USING MNTTBL,R4          ESTABLISH ADDRESSABILITY              00690000
                                                                        00700000
*--------------------------------------------------------------         00710000
*  OBTAIN MAINT BYTE ADDR AND CHECK IF TABLE HAS BEEN MODIFIED          00720000
*--------------------------------------------------------------         00730000
TMNTCHK  DS    0H                                                       00740000
         RSEXP MNTFLGRS,SAVE=(R13)    ADDR OF CHANGE BYTE               00750000
         LR    R5,R15             RETAIN MAINT BYTE ADDRESS             00760000
         IC    R1,MNTMASK         MAINT FLAG ATTRIBUTE                  00770000
         EX    R1,TESTMASK        HAS TABLE BEEN MODIFIED               00780000
         BZ    TMNTNEXT           NO,  PROCESS NEXT ENTRY               00790000
                                                                        00800000
*--------------------------------------------------------------         00810000
* CATALOG TABLE HAS BEEN MODIFIED,  CALL ASSOCIATED EXIT RTNS           00820000
*--------------------------------------------------------------         00830000
         LA    R2,4               MAXIMUM EXIT RTN COUNT                00840000
         LA    R6,MNTRTN1         ADDR OF FIRST EXIT RTN                00850000
                                                                        00860000
TMNTRTN  DS    0H                                                       00870000
         ICM   R15,15,0(R6)       OFFSET TO RTN ADDRESS?                00880000
         BZ    TMNTRTNX           ZERO,  CHECK NEXT ENTRY               00890000
         LA    R15,ICTMODTB(R15)  ADDRESS OF RTN ADDRESS                00900000
         ICM   R15,15,0(R15)      EXIT ROUTINE AVAILABLE                00910000
         BZ    TMNTRTNX           NO, CHECK NEXT ENTRY                  00920000
         BASR  R14,R15            CALL CATALOG MAINT EXIT RTN           00930000
                                                                        00940000
         C     R15,HIGHRC         HIGHEST RETURN CODE                   00950000
         BNH   TMNTRSET           NO,  CONTINUE                         00960000
         ST    R15,HIGHRC         SAVE HIGHEST RETURN CODE              00970000
         ST    R0,HIGHRSN         SAVE HIGHEST REASON CODE              00980000
                                                                        00990000
TMNTRSET DS    0H                                                       01000000
         SR    R1,R1              PREPARE FOR INSERT                    01010000
         IC    R1,MNTMASK         MAINT FLAG ATTRIBUTE                  01020000
         X     R1,=X'000000FF'    PREPARE FOR NI                        01030000
         EX    R1,RSETMASK        RESET MAINT MASK                      01040000
                                                                        01050000
TMNTRTNX DS    0H                                                       01060000
         LA    R6,L'MNTRTN1(,R6)  ADDRESS OF NEXT RTN OFFSET            01070000
         BCT   R2,TMNTRTN         CHECK NEXT EXIT ADDRESS               01080000
                                                                        01090000
*--------------------------------------------------------------         01100000
* CATALOG TABLE HAS BEEN MODIFIED,  CALL ASSOCIATED EXIT RTNS           01110000
*--------------------------------------------------------------         01120000
TMNTNEXT DS    0H                                                       01130000
         LA    R4,MNTTBLN(,R4)    ADDRESS OF NEXT TABLE ENTRY           01140000
         BCT   R3,TMNTCHK         PROCESS NEXT ENTRY                    01150000
                                                                        01160000
         EJECT ,                                                        01170000
***************************************************************         01180000
*                                                                       01190000
*  RETURN                                                               01200000
*                                                                       01210000
***************************************************************         01220000
TMNTEXIT DS    0H                                                       01230000
         L     R15,HIGHRC         SET RETURN CODE                       01240000
         L     R0,HIGHRSN         SET REASON CODE                       01250000
         #EXIT ,                  RETURN                                01260000
                                                                        01270000
         EJECT ,                                                        01280000
****************************************************************        01290000
*                                                                       01300000
*  LITERALS, CONSTANTS AND MAPPINGS                                     01310000
*                                                                       01320000
****************************************************************        01330000
TESTMASK TM    0(R5),*-*          *** EX OBJECT ***                     01340000
RSETMASK NI    0(R5),*-*          *** EX OBJECT ***                     01350000
                                                                        01360000
         LTORG ,                                                        01370000
                                                                        01380000
         PRINT NOGEN                                                    01390000
         ICVT  ,                                                        01400000
         ITASK ,                                                        01410000
         IPCB  ,                                                        01420000
         IUSER ,                                                        01430000
         IPROJ ,                                                        01440000
         PRINT GEN                                                      01450000
         END                                                            01460000
