         TITLE 'IMSGCLST - MESSAGE CLASS TABLE LOOKUP'                  00010000
                                                                        00020000
         $MCLASS DSECT=YES   GENERATE DEFINITION AND ENTRY MAPPINGS     00030000
                                                                        00040000
         EJECT                                                          00050000
         EQUS  LINKAGE=COND                                             00060000
                                                                        00070000
         EJECT                                                          00080000
**<DOC-ON>*****************************************************         00090000
*                                                                       00100000
* ROUTINE: IMSGCLST - MESSAGE CLASS TABLE LOOKUP                        00110000
*                                                                       00120000
* DESCRIPTION:                                                          00130000
*                                                                       00140000
*    THIS ROUTINE ACQUIRES THE CLASS TABLE ENTRY CORRESPONDING          00150000
*    TO A CLASS CODE PROVIDED ON ENTRY. IF THE INPUT CLASS CODE         00160000
*    IS AN UPPER CASE ALPHABETIC, IT IS CONVERTED TO A MESSAGE          00170000
*    CLASS TABLE ENTRY ADDRESS.  IF THAT ENTRY DOES NOT DEFINE          00180000
*    A MESSAGE CLASS, OR IF THE INPUT CLASS IS NOT SUITABLE,            00190000
*    THE DEFAULT CLASS ENTRY IS RETURNED.                               00200000
*                                                                       00210000
*    THE $MSGATTR MACRO MAY BE USED TO GENERATE CALLING LINKAGE         00220000
*                                                                       00230000
* ON ENTRY:                                                             00240000
*                                                                       00250000
*    R1 - ADDR OF A ONE BYTE MESSAGE CLASS CODE                         00260000
*                                                                       00270000
* ON EXIT:                                                              00280000
*                                                                       00290000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                     00300000
*                                                                       00310000
*        RC00 - MESSAGE CLASS IS ACTIVE                                 00320000
*        RC04 - MESSAGE CLASS IS INACTIVE                               00330000
*                                                                       00340000
*    R1  ADDRESS OF THE MESSAGE CLASS TABLE ENTRY (MSGCSENT)            00350000
*    R0  DESTINATION MASK (LOW ORDER) ASSOCIATED WITH MSG CLASS         00360000
*                                                                       00370000
**<DOC-OFF>****************************************************         00380000
                                                                        00390000
***************************************************************         00400000
*                                                                       00410000
* MAINTENANCE:                                                          00420000
*                                                                       00430000
*    05/18/93 R. TURGEON                                                00440000
*             INITIAL VERSION                                           00450000
*                                                                       00460000
***************************************************************         00470000
                                                                        00480000
         EJECT ,                                                        00490000
IMSGCLST #ENTER SAVE=NO                                                 00500000
                                                                        00510000
         EJECT ,                                                        00520000
         USING ITASK,R10                                                00530000
         USING ICVT,R11                                                 00540000
                                                                        00550000
*--------------------------------------------------------------         00560000
*   LOCATE APPROPRIATE ENTRY IN TASK OR SYSTEM CLASS TABLE              00570000
*--------------------------------------------------------------         00580000
         SR    R3,R3                   PREPARE FOR INSERT               00590000
         IC    R3,0(,R1)               FETCH CLASS CODE                 00600000
                                                                        00610000
         USING MSGCSENT,R2             DECLARE INTENTIONS               00620000
                                                                        00630000
         L     R2,ICTMSGCL             SYSTEM WIDE MSG ROUTING          00640000
         LTR   R10,R10                 TASK MODE?                       00650000
         BZ    TAB_SEL                 SKIP IF NOT                      00660000
         ICM   R0,15,TSKMSGCL          MSG CLASS TABLE PRESENT?         00670000
         BZ    *+6                     SKIP IF NOT                      00680000
         LR    R2,R0                   SWITCH TO WU-SPECIFIC TABLE      00690000
                                                                        00700000
TAB_SEL  DS    0H                      SYSTEM WIDE MSG ROUTING APPLIES  00710000
         LR    R5,R2                   ASSUME DEFAULT ENTRY             00720000
         CH    R3,=AL2(C'A')           ALPHA CODE?                      00730000
         BL    EXTRACT                 USE DEFAULT ENTRY IF NOT         00740000
         CH    R3,=AL2(C'Z')           ALPHA CODE?                      00750000
         BH    EXTRACT                 USE DEFAULT ENTRY IF NOT         00760000
         SH    R3,=AL2(C'A')           CONVERT CHAR TO INDEX            00770000
         MH    R3,=AL2(MSGCSLN)        OFFSET TO ENTRY                  00780000
         LA    R5,MSGCSENT+MSGCSLN(R3) FIRST ENTRY FOLLOWS DEFAULT      00790000
                                                                        00800000
         USING MSGCSENT,R5             ENTRY RETURNED                   00810000
                                                                        00820000
EXTRACT  DS    0H                                                       00830000
         CLI   MSGCSCOD,0              MSG CLASS IS DEFINED?            00840000
         BNE   SELECT                  ONWARD IF SO                     00850000
         LR    R5,R2                   REVERT TO DEFAULT ENTRY          00860000
                                                                        00870000
*--------------------------------------------------------------         00880000
*   EXTRACT MESSAGE CLASS STATUS AND DEFAULT DESTINATIONS               00890000
*--------------------------------------------------------------         00900000
SELECT   DS    0H                                                       00910000
         SR    R0,R0                   RETURN DEFAULT DESTINATIONS      00920000
         IC    R0,MSGCSDST             DESTINATION MASK                 00930000
                                                                        00940000
         LA    R15,RC04                ASSUME CLASS IS INACTIVE         00950000
         CLI   MSGCSCOD,0              DEFAULTS DEFINED?                00960000
         BE    RETURN                  CONSIDER INACTIVE IF NOT         00970000
         CLI   MSGCSACT,0              CLASS INACTIVE?                  00980000
         BE    RETURN                  DONE IF SO                       00990000
         LA    R15,RC00                MESSAGE IS ACTIVE                01000000
                                                                        01010000
RETURN   DS    0H                      R0 CONTAINS DESTINATION MASK     01020000
         LA    R1,MSGCSENT             RETURN CLASS TABLE ENTRY         01030000
         #EXIT ,                                                        01040000
                                                                        01050000
         EJECT ,                                                        01060000
***************************************************************         01070000
*                                                                       01080000
*   LOCAL READ/ONLY DATA AREAS, ETC.                                    01090000
*                                                                       01100000
***************************************************************         01110000
         LTORG ,                                                        01120000
                                                                        01130000
         PRINT NOGEN                                                    01140000
         ITASK ,                                                        01150000
         ICVT  ,                                                        01160000
         END   ,                                                        01170000
