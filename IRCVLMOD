         TITLE 'IRCVLMOD - IDENTIFY LMOD AT STORAGE LOCATION'           00010000
         #WORK ,             BEGIN WORKAREA                             00020000
LMODSTG  DS    A             CANDIDATE LMOD INSTRUCTION/DATA ADDRESS    00030000
ADDR     DS    A             LMOD ORIGIN ADDRESS                        00040000
LENGTH   DS    F             LMOD LENGTH                                00050000
NAME     DS    CL8           LMOD NAME                                  00060000
                                                                        00070000
         CSVQUERY PLISTVER=2,MF=(L,CSVLIST)                             00080000
         #ENDWORK ,          END WORKAREA                               00090000
                                                                        00100000
         EJECT                                                          00110000
         EQUS  ,                                                        00120000
         EJECT                                                          00130000
                                                                        00140000
**<DOC-ON>*****************************************************         00150000
*                                                                       00160000
* ROUTINE: IRCVLMOD - IDENTIFY LMOD AT STORAGE LOCATION                 00170000
*                                                                       00180000
* DESCRIPTION:                                                          00190000
*                                                                       00200000
*    THIS ROUTINE ATTEMPTS TO IDENTIFY A LOAD MODULE GIVEN THE          00210000
*    ADDRESS OF AN INSTRUCTION OR DATA ITEM CONTAINED WITHIN IT.        00220000
*    THE MVS/ESA CSVQUERY SERVICE IS USED TO SEARCH FOR THE             00230000
*    LMOD OWNING (OCCUPYING) THE STORAGE EXTENT.                        00240000
*                                                                       00250000
*                                                                       00260000
* DEPENDENCIES:  MVS/ESA 3.1+                                           00270000
*                                                                       00280000
*                                                                       00290000
* ON ENTRY:                                                             00300000
*                                                                       00310000
*    R1 CONTAINS THE ADDR OF A PLIST CONSTRUCTED AS FOLLOWS:            00320000
*                                                                       00330000
*       +00 - ADDR OF CANDIDATE INSTRUCTION OR DATA                     00340000
*       +04 - LMOD NAME RETURN AREA PTR (CL8)                           00350000
*       +08 - LMOD ORIGIN ADDRESS RETURN AREA PTR (AL4)                 00360000
*       +12 - LMOD LENGTH RETURN AREA PTR                               00370000
*                                                                       00380000
*                                                                       00390000
* ON EXIT:                                                              00400000
*                                                                       00410000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES:                    00420000
*                                                                       00430000
*          RC00 - LOAD MODULE ATTRIBUTES RETURNED.                      00440000
*                                                                       00450000
*          RC04 - LOAD MODULE NOT MATCHED TO STORAGE ADDRESS.           00460000
*                 USER PROVIDED RETURN AREAS ARE NOT MODIFIED.          00470000
*                                                                       00480000
*          RC08 - FUNCTION DID NOT COMPLETE.                            00490000
*                                                                       00500000
*                 R1 - CSVQUERY RETURN CODE (ORIGINAL R15)              00510000
*                                                                       00520000
**<DOC-OFF>****************************************************         00530000
                                                                        00540000
***************************************************************         00550000
*                                                                       00560000
* MAINTENANCE:                                                          00570000
*                                                                       00580000
*    04/15/93 R. TURGEON                                                00590000
*             INITIAL VERSION                                           00600000
*                                                                       00610000
***************************************************************         00620000
                                                                        00630000
         EJECT ,                                                        00640000
IRCVLMOD #ENTER PREG=R8                                                 00650000
                                                                        00660000
         LM    R4,R7,0(R8)        FETCH PASSED PARAMETERS               00670000
         ST    R4,LMODSTG         CANDIDATE STORAGE ADDRESS             00680000
                                                                        00690000
*--------------------------------------------------------------         00700000
*   INVOKE SYSTEM LMOD LOCATOR SERVICE                                  00710000
*--------------------------------------------------------------         00720000
         CSVQUERY INADDR=LMODSTG,    CANDIDATE STORAGE ADDRESS         X00730000
               SEARCH=JPALPA,        SEARCH JOBPACK AND LPA QUEUES     X00740000
               OUTMJNM=NAME,         RETURN MAJOR (MEMBER) NAME        X00750000
               OUTLOADPT=ADDR,       RETURN ORIGIN ADDRESS             X00760000
               OUTLENGTH=LENGTH,     RETURN LMOD LENGTH                X00770000
               MF=(E,CSVLIST)                                           00780000
                                                                        00790000
         CH    R15,=AL2(RC08)     SEARCH FAILED?                        00800000
         BE    ERR_LMOD           FAIL IF SO                            00810000
         LTR   R15,R15            LMOD IDENTIFIED?                      00820000
         BNE   ERR_SERV           FUNCTION FAILED IF NOT                00830000
                                                                        00840000
         MVC   0(8,R5),NAME       RETURN LMOD NAME                      00850000
         MVC   0(4,R6),ADDR       RETURN LMOD ORIGIN ADDR               00860000
         MVC   0(4,R7),LENGTH     RETURN LMOD LENGTH                    00870000
         LA    R15,RC00           INDICATE SUCCESS                      00880000
         B     EXIT               DONE                                  00890000
                                                                        00900000
*--------------------------------------------------------------         00910000
*   ERROR HANDLING AND RETURN                                           00920000
*--------------------------------------------------------------         00930000
ERR_LMOD DS    0H                 LMOD NOT FOUND                        00940000
         LA    R15,RC04                                                 00950000
         B     EXIT                                                     00960000
                                                                        00970000
ERR_SERV DS    0H                 CSVQUERY FAILED IN UNEXPECTED FASHION 00980000
         LR    R1,R15             CSVQUERY COMPLETION CODE              00990000
         LA    R15,RC08                                                 01000000
                                                                        01010000
*--------------------------------------------------------------         01020000
EXIT     DS    0H                                                       01030000
         #EXIT ,                  RETURN                                01040000
                                                                        01050000
         EJECT ,                                                        01060000
***************************************************************         01070000
*                                                                       01080000
*   LOCAL READ/ONLY DATA AREAS, ETC.                                    01090000
*                                                                       01100000
***************************************************************         01110000
         LTORG ,                                                        01120000
                                                                        01130000
         PRINT NOGEN                                                    01140000
         ICVT  ,                                                        01150000
         END   ,                                                        01160000
