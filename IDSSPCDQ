IDSSPCDQ TITLE 'DATASPACE SVCS - SPACE DEQUEUE'                         00010000
***************************************************************         00020000
*                                                                       00030000
*   LOCAL READ/WRITE WORKING STORAGE                                    00040000
*                                                                       00050000
***************************************************************         00060000
WORKAREA DSECT ,                                                        00070000
                                                                        00080000
         @WORK ,                                                        00090000
                                                                        00100000
WORKLEN  EQU   *-WORKAREA                                               00110000
                                                                        00120000
         EJECT ,                                                        00130000
         SPCEQUS  ,                                                     00140000
                                                                        00150000
         EJECT ,                                                        00160000
         EQUS  ,                                                        00170000
         EJECT ,                                                        00180000
**<DOC-ON>*****************************************************         00190000
*                                                                       00200000
* ROUTINE:  IDSSPCDQ - SPACE DEQUEUE                                    00210000
*                                                                       00220000
* DESCRIPTION:                                                          00230000
*                                                                       00240000
*    THIS ROUTINE IS USED TO RELEASE THE SERIALIZATION                  00250000
*    PREVIOUSLY IMPOSED ON THE NAMED SPACE.  WHEN NO EXTERNAL           00260000
*    SERIALIZATION CONTROL AREA IS GIVEN, SERIALIZATION IS              00270000
*    CONTROLLED BY ENQ AND DEQ.  OTHERWISE A @SERSERV RELEASE           00280000
*    IS ISSUED TO ALLOW THE EXTERNAL SERIALIZATION MECHANISM TO         00290000
*    ACQUIRE CONTROL.  THE @SERSERV MACRO AND ITS SERIALIZATION         00300000
*    TECHNIQUES ARE NOT DESCRIBED IN THIS API.                          00310000
*                                                                       00320000
*                                                                       00330000
* ON ENTRY:                                                             00340000
*                                                                       00350000
*    R0 - SPACE SERIALIZATION CONTROL OR ZERO                           00360000
*    R1 - ADDR OF SPACE IDENTIFIER (XL8)                                00370000
*                                                                       00380000
* ON EXIT:                                                              00390000
*                                                                       00400000
*    R15  CONTAINS THE SERVICE ROUTINE RETURN CODE                      00410000
*                                                                       00420000
*                                                                       00430000
* AMODE:   ANY                                                          00440000
* RMODE:   ANY                                                          00450000
* ASCMODE: PRIMARY                                                      00460000
*                                                                       00470000
**<DOC-OFF>****************************************************         00480000
                                                                        00490000
         EJECT ,                                                        00500000
IDSSPCDQ @ENTER WORKA=(WORKAREA,WORKLEN),ASC=PRIMARY                    00510000
                                                                        00520000
         LTR   R2,R0              EXTERNAL LOCKING?                     00530000
         BZ    ENQDEQ             STANDARD SERIALIZATION OTHERWISE      00540000
                                                                        00550000
*--------------------------------------------------------------         00560000
*   SPACE SERIALIZATION VIA EXTERNAL MECHANISMS                         00570000
*--------------------------------------------------------------         00580000
         @SERSERV RELEASE,LOCKPTR=(R2)                                  00590000
         B     EXIT                                                     00600000
                                                                        00610000
*--------------------------------------------------------------         00620000
*   SPACE SERIALIZATION VIA ENQ / DEQ                                   00630000
*--------------------------------------------------------------         00640000
ENQDEQ   DS    0H                                                       00650000
         LR    R4,R1              SPACE NAME                            00660000
         MVC   MFE_LIST(DEQLEN),DEQ                                     00670000
                                                                        00680000
         DEQ   (INTSPACE,(R4),8,STEP),                                 X00690000
               RET=HAVE,                                               X00700000
               MF=(E,MFE_LIST)                                          00710000
                                                                        00720000
         LTR   R15,R15            ACQUIRED?                             00730000
         BZ    EXIT               DONE IF SO                            00740000
         ICM   R15,8,3(R15)       ELSE FETCH ACTUAL VALUE               00750000
         SRL   R15,24             ISOLATE                               00760000
                                                                        00770000
*--------------------------------------------------------------         00780000
EXIT     DS    0H                                                       00790000
         @EXIT ,                                                        00800000
                                                                        00810000
*--------------------------------------------------------------         00820000
*   LOCAL READ ONLY DATA AREAS, ETC.                                    00830000
*--------------------------------------------------------------         00840000
INTSPACE DC    CL8'INTSPACE'                                            00850000
                                                                        00860000
DEQ      DEQ   (*-*,*-*,*-*,STEP),RET=HAVE,MF=L                         00870000
DEQLEN   EQU   *-DEQ                                                    00880000
                                                                        00890000
         LTORG ,                                                        00900000
                                                                        00910000
         PRINT NOGEN                                                    00920000
         ICVT  ,                                                        00930000
         IHAPSA ,                                                       00940000
         IKJTCB ,                                                       00950000
         END                                                            00960000
