ICMDSTG  TITLE '- XTG STORAGE UTILIZATION STATISTICS'                   00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE:  ICMDSTG - XTG storage utilization statistics                00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine implements the STORAGE command that allows            00080000
*    an operator to display XTG facility storage utilization            00090000
*    statistics and to reset several of those statistics to             00100000
*    establish a new reporting interval.                                00110000
*                                                                       00120000
*    When STORAGE is issued without any other operands, DISPLAY         00130000
*    SUMMARY is assumed by default.  For DISPLAY requests,              00140000
*    the SUMMARY information (INTCMD221-INTCMD223) containing           00150000
*    total storage allocation is always presented.  SUBPOOLS            00160000
*    documents detailed storage utilization in powers-of-two            00170000
*    increments.  PARTITIONS includes the information provided          00180000
*    by SUBPOOLS, but shows the storage committed to regular            00190000
*    divisions of each subpool, as defined by the STORPROF              00200000
*    storage profile.                                                   00210000
*                                                                       00220000
*    RESET zeros the total and total-below-16M request counters         00230000
*    only.  When DISPLAY and RESET are specified together, the          00240000
*    display is performed before the request counters are               00250000
*    zeroed.                                                            00260000
*                                                                       00270000
*                                                                       00280000
* SYNTAX:                                                               00290000
*                                                                       00300000
*    STORAGE  DISPLAY /, RESET    SUMMARY  SUBPOOLS  PARTITIONS         00310000
*      STG       D         E       SMRY                PARTS            00320000
*                                                                       00330000
*                                                                       00340000
* ON ENTRY:                                                             00350000
*                                                                       00360000
*    R1  ADDR OF COMMAND REQUEST BLOCK (CMDREQ) IN LOCAL                00370000
*        CMDPROC FORMAT                                                 00380000
*                                                                       00390000
**<DOC-OFF>****************************************************         00400000
                                                                        00410000
         EJECT                                                          00420000
***************************************************************         00430000
*                                                                       00440000
* MAINTENANCE:                                                          00450000
*                                                                       00460000
*    08/13/93 R. TURGEON                                                00470000
*             INITIAL VERSION                                           00480000
*                                                                       00490000
*    11/10/94 R. TURGEON                                                00500000
*             REWRITE FOR XTG STORAGE MANAGER                           00510000
                                                                        00520000
***************************************************************         00530000
                                                                        00540000
         EJECT                                                          00550000
         #WORK ,                                                        00560000
                                                                        00570000
REQFLAG  DS    X             REQUEST TYPE AND QUALIFIERS                00580000
REQDISP  EQU   X'80'            DISPLAY                                 00590000
REQRESET EQU   X'40'            RESET                                   00600000
REQDSMRY EQU   X'08'            EXTENT SUMMARY                          00610000
REQDSUBP EQU   X'04'            SUBPOOLS                                00620000
REQDPART EQU   X'02'            SUBPOOL PARTITIONS                      00630000
                                                                        00640000
RESERVED DS    XL3           RESERVED                                   00650000
                                                                        00660000
PARTSIZE DS    F             PARTITION SIZE CEILING                     00670000
                                                                        00680000
KMVSSZ   DS    F             TOTAL NON-CELLED STORAGE SIZE IN KBYTES    00690000
KTOTSZ   DS    F             TOTAL ALLOCATED STORAGE IN KBYTES          00700000
KHWMSZ   DS    F             TOTAL ALLOCATED STORAGE - HWM IN KBYTES    00710000
                                                                        00720000
PSTATS   DS    0F,0F,0F      PARTITION / SUBPOOL / SYSTEM TOTAL         00730000
PREQS    DS    3F            NUMBER OF REQUESTS                         00740000
PBLKS    DS    3F            NUMBER OF BLOCKS ALLOCATED                 00750000
PCELLS   DS    3F            NUMBER OF CELLS IN CELLPOOL                00760000
PB16M    DS    3F            NUMBER OF LOC=BELOW REQUESTS               00770000
PMVSSZ   DS    3F            TOTAL NON-CELLED STORAGE SIZE              00780000
PTOTSZ   DS    3F            TOTAL ALLOCATED STORAGE                    00790000
PHWMSZ   DS    3F            TOTAL ALLOCATED STORAGE - HWM              00800000
                                                                        00810000
$MSGMFL  $MSG  FIELDS=(,,,,,,,,,,,,),MF=L                               00820000
                                                                        00830000
         #ENDWORK ,          END WORKAREA                               00840000
                                                                        00850000
         EJECT                                                          00860000
         CMDREQ  ,           COMMAND REQUEST BLOCK                      00870000
                                                                        00880000
         EJECT                                                          00890000
         CCSUMRY ,           COMMAND OPERAND PREPARSE SUMMARY           00900000
                                                                        00910000
         EJECT                                                          00920000
         STORLVLS ,          STORAGE MANAGEMENT CONTROL AREAS           00930000
                                                                        00940000
         EJECT                                                          00950000
         KEYCODES COMMANDSET=STG                                        00960000
                                                                        00970000
         CMDCODES ,                                                     00980000
                                                                        00990000
         EQUS  ,                                                        01000000
                                                                        01010000
         $MSGDFT PREFIX=ICTPID,COMPID='CMD',TABLE=*#MSGS,              X01020000
               CONID=*CMRQCNID,CONNAME=CMRQCNAM,CART=CMRQCART,         X01030000
               DESTADD=*CMRQDMSK,                                      X01040000
               MSGQA=*CMRQMQA,STGQH=*CMRQSTGQ,                         X01050000
               MF=(U,$MSGMFL),                                         X01060000
               PRINT=GEN                                                01070000
                                                                        01080000
         EJECT ,                                                        01090000
ICMDSTG  #ENTER PREG=R8                                                 01100000
                                                                        01110000
         USING ICVT,R11                                                 01120000
                                                                        01130000
         EJECT                                                          01140000
***************************************************************         01150000
*                                                                       01160000
*    LOCATE COMMAND REQUEST BLOCK, COMMAND SUMMARY, AND OPS             01170000
*                                                                       01180000
***************************************************************         01190000
         USING CMDREQ,R8          COMMAND REQUEST BLOCK                 01200000
         $MSG  MF=(I,$MSGMFL)     MESSAGING CAPABILITY                  01210000
                                                                        01220000
         ICM   R7,15,CMRQSMRY     ASSOC COMMAND SUMMARY                 01230000
         BZ    SCANEND            OPERANDS PROVIDED                     01240000
                                                                        01250000
         USING CCSUMRY,R7         COMMAND OPERAND SUMMARY FORMAT        01260000
         ICM   R5,15,CMRQSMR#     TOTAL NUMBER OF OPERAND ENTRIES       01270000
         BZ    SCANEND            TAKE DEFAULTS IF NONE PROVIDED        01280000
         L     R6,CMRQOPST        OPERAND STRING ORIGIN                 01290000
                                                                        01300000
*--------------------------------------------------------------         01310000
*   IDENTIFY THE OPERANDS PROVIDED AND VALIDATE                         01320000
*--------------------------------------------------------------         01330000
PARSENXT DS    0H                                                       01340000
         CLC   CCSID,=AL2(STG_DISPLAY)                                  01350000
         BNE   *+8                                                      01360000
         OI    REQFLAG,REQDISP                                          01370000
                                                                        01380000
         CLC   CCSID,=AL2(STG_D_SUMMARY)                                01390000
         BNE   *+8                                                      01400000
         OI    REQFLAG,REQDSMRY                                         01410000
                                                                        01420000
         CLC   CCSID,=AL2(STG_D_SUBPOOLS)                               01430000
         BNE   *+8                                                      01440000
         OI    REQFLAG,REQDSUBP                                         01450000
                                                                        01460000
         CLC   CCSID,=AL2(STG_D_PARTNS)                                 01470000
         BNE   *+8                                                      01480000
         OI    REQFLAG,REQDPART                                         01490000
                                                                        01500000
         CLC   CCSID,=AL2(STG_RESET)                                    01510000
         BNE   *+8                                                      01520000
         OI    REQFLAG,REQRESET                                         01530000
                                                                        01540000
         LA    R15,CCSVSLN        LENGTH OF EACH VALUE ENTRY            01550000
         MH    R15,CCSVALCT       TOTAL SIZE CONSUMED BY VALUES         01560000
         LA    R7,CCSUMRY+CCSPFXL(R15)                                  01570000
         BCT   R5,PARSENXT        EXAMINE ALL OPERANDS                  01580000
         DROP  R7                 CCSUMRY                               01590000
                                                                        01600000
*--------------------------------------------------------------         01610000
*   PARSE COMPLETE, ASSIGN DEFAULTS IF NECESSARY                        01620000
*--------------------------------------------------------------         01630000
SCANEND  DS    0H                                                       01640000
         TM    REQFLAG,REQDISP+REQRESET   MAJOR OPERANDS PROVIDED?      01650000
         BNZ   *+8                SKIP IF SO                            01660000
         OI    REQFLAG,REQDISP    DISPLAY                               01670000
                                                                        01680000
         TM    REQFLAG,REQDISP    DISPLAY REQUEST?                      01690000
         BNO   SCANPOST           SKIP IF NOT                           01700000
         TM    REQFLAG,REQDSMRY+REQDSUBP+REQDPART                       01710000
         BNZ   SCANPOST                                                 01720000
         OI    REQFLAG,REQDSMRY                                         01730000
                                                                        01740000
SCANPOST DS    0H                                                       01750000
                                                                        01760000
         EJECT ,                                                        01770000
***************************************************************         01780000
*                                                                       01790000
*   LOCATE STORAGE MANAGER DATA AREAS                                   01800000
*                                                                       01810000
***************************************************************         01820000
         USING STANCHOR,R9        LIFE-OF-FUNCTION ADDRESSABILITY       01830000
         ICM   R9,15,ICTXTANC     STGMGMT ANCHOR AREA                   01840000
         BNZ   DISPLAY                                                  01850000
                                                                        01860000
         $MSG  219                                                      01870000
                                                                        01880000
         B     RETURN                                                   01890000
                                                                        01900000
         EJECT                                                          01910000
***************************************************************         01920000
*                                                                       01930000
*   DISPLAY STORAGE STATISTICS                                          01940000
*                                                                       01950000
***************************************************************         01960000
DISPLAY  DS    0H                                                       01970000
         TM    REQFLAG,REQDISP    DISPLAY REQUEST?                      01980000
         BNO   RESET              SKIP IF NOT                           01990000
                                                                        02000000
         $MSG  220                IDENTIFY STORAGE COMPONENT            02010000
                                                                        02020000
         $MSG  225                DISPLAY BLOCK HEADING                 02030000
                                                                        02040000
*--------------------------------------------------------------         02050000
*   PROCESS EACH SUBPOOL                                                02060000
*--------------------------------------------------------------         02070000
         L     R7,STALVL1         LOCATE SUBPOOL TABLE                  02080000
         USING SL1ENTRY,R7        PREPARE FOR SUBPOOL SCAN              02090000
                                                                        02100000
DNXTSUBP DS    0H                                                       02110000
         TM    SL1ATTRS,SL1A_INACTIVE   ACTIVE SUBOOL?                  02120000
         BNO   SUBPINIT           BEGIN PARTITION SCAN IF SO            02130000
         L     R7,SL1LVL2         REPLACE WITH PROXY                    02140000
                                                                        02150000
SUBPINIT DS    0H                 INIT SUBPOOL ACCUMULATORS             02160000
         XC    PREQS+4,PREQS+4    NUMBER OF REQUESTS                    02170000
         XC    PBLKS+4,PBLKS+4    NUMBER OF BLOCKS ALLOCATED            02180000
         XC    PCELLS+4,PCELLS+4  NUMBER OF CELLS IN CELLPOOL           02190000
         XC    PTOTSZ+4,PTOTSZ+4  TOTAL ALLOCATED STORAGE               02200000
         XC    PHWMSZ+4,PHWMSZ+4  TOTAL ALLOCATED STORAGE - HWM         02210000
         XC    PB16M+4,PB16M+4    NUMBER OF LOC=BELOW REQUESTS          02220000
         XC    PMVSSZ+4,PMVSSZ+4  TOTAL NON-CELLED STORAGE SIZE         02230000
                                                                        02240000
*--------------------------------------------------------------         02250000
*   ACQUIRE STATS FOR EACH PARTITION ATTACHED TO SUBPOOL                02260000
*--------------------------------------------------------------         02270000
DPARTSCN DS    0H                 BLOCK CONCURRENT FETCH AND STORE      02280000
         L     R6,SL1LVL2         LOCATE PARTITION TABLE                02290000
         USING SL2ENTRY,R6        PREPARE FOR PARTITION TABLE SCAN      02300000
         LH    R5,SL1PARTS        NUMBER OF PARTITIONS                  02310000
                                                                        02320000
DPARTNXT DS    0H                 BLOCK CONCURRENT FETCH AND STORE      02330000
         L     R0,SL2UREQS        NUMBER OF REQUESTS                    02340000
         ST    R0,PREQS           PARTITION                             02350000
         AL    R0,PREQS+4                                               02360000
         ST    R0,PREQS+4         SUBPOOL                               02370000
                                                                        02380000
         L     R0,SL2UBLKS        NUMBER OF OUTSTANDING BLOCKS          02390000
         ST    R0,PBLKS           PARTITION                             02400000
         AL    R0,PBLKS+4                                               02410000
         ST    R0,PBLKS+4         SUBPOOL                               02420000
                                                                        02430000
         L     R0,SL2PTOTL        NUMBER OF CELLS IN CELLPOOL           02440000
         ST    R0,PCELLS          PARTITION                             02450000
         AL    R0,PCELLS+4                                              02460000
         ST    R0,PCELLS+4        SUBPOOL                               02470000
                                                                        02480000
         L     R0,SL2UTOTL        TOTAL ALLOCATED STORAGE               02490000
         ST    R0,PTOTSZ          PARTITION                             02500000
         AL    R0,PTOTSZ+4                                              02510000
         ST    R0,PTOTSZ+4        SUBPOOL                               02520000
                                                                        02530000
         L     R0,SL2UHWM         TOTAL ALLOCATED STORAGE - HWM         02540000
         ST    R0,PHWMSZ          PARTITION                             02550000
         AL    R0,PHWMSZ+4                                              02560000
         ST    R0,PHWMSZ+4        SUBPOOL                               02570000
                                                                        02580000
         L     R0,SL2UB16M        NUMBER OF LOC=BELOW REQUESTS          02590000
         ST    R0,PB16M           PARTITION                             02600000
         AL    R0,PB16M+4                                               02610000
         ST    R0,PB16M+4         SUBPOOL                               02620000
                                                                        02630000
         L     R0,SL2UMVSA        TOTAL NON-CELLED STORAGE SIZE         02640000
         ST    R0,PMVSSZ          PARTITION                             02650000
         AL    R0,PMVSSZ+4                                              02660000
         ST    R0,PMVSSZ+4        SUBPOOL                               02670000
                                                                        02680000
*--------------------------------------------------------------         02690000
*   FORMAT THE PARTITION ENTRY IF SELECTED                              02700000
*--------------------------------------------------------------         02710000
         TM    REQFLAG,REQDPART   PARTITION FORMATTING SELECTED         02720000
         BNO   NOPART             SKIP IF NOT                           02730000
         CLC   SL1PARTS,=H'1'     PARTITIONING IS TRIVIAL?              02740000
         BNH   NOPART             SKIP IF SO                            02750000
                                                                        02760000
         LH    R2,SL2MAX          PARTITION CEILING                     02770000
         ST    R2,PARTSIZE        SAVE FOR REPORT                       02780000
                                                                        02790000
         L     R0,PMVSSZ          NON-CELLED STORAGE SIZE               02800000
         SRL   R0,10                                                    02810000
         ST    R0,KMVSSZ                                                02820000
                                                                        02830000
         L     R0,PTOTSZ          TOTAL STORAGE ALLOCATED               02840000
         SRL   R0,10                                                    02850000
         ST    R0,KTOTSZ                                                02860000
                                                                        02870000
         L     R0,PHWMSZ          TOTAL STORAGE ALLOCATED - HWM         02880000
         SRL   R0,10                                                    02890000
         ST    R0,KHWMSZ                                                02900000
                                                                        02910000
         $MSG  226,FIELDS=(PARTSIZE,                                   X02920000
               PREQS,PBLKS,PCELLS,PB16M,                               X02930000
               KMVSSZ,KTOTSZ,KHWMSZ)                                    02940000
                                                                        02950000
NOPART   DS    0H                                                       02960000
         LA    R6,SL2ENTLN(,R6)   ADVANCE TO NEXT PARTITION             02970000
         BCT   R5,DPARTNXT        PROCESS ENTIRE PARTITION              02980000
                                                                        02990000
*--------------------------------------------------------------         03000000
*   FORMAT THE SUBPOOL ENTRY IF SELECTED / OPERAND DEPENDENT            03010000
*--------------------------------------------------------------         03020000
         TM    REQFLAG,REQDSUBP+REQDPART                                03030000
         BZ    NOSUBP             SKIP IF NOT                           03040000
                                                                        03050000
         SR    R2,R2              PREPARE FOR INSERT                    03060000
         ICM   R2,3,SL1MAX        UNSIGNED SUBPOOL CEILING              03070000
         ST    R2,PARTSIZE        SAVE FOR REPORT                       03080000
         LTR   R2,R2              UNBOUNDED SUBPOOL (SIZE)?             03090000
         BNZ   SUBPCONT           ONWARD IF NOT                         03100000
         L     R6,SL1LVL2         LOCATE THE SINGLE PARTITION ENTRY     03110000
         MVC   PARTSIZE,SL2UMVSB  USE LARGEST BLOCK AS SUBPOOL BOUND    03120000
                                                                        03130000
SUBPCONT DS    0H                                                       03140000
         L     R0,PMVSSZ+4        NON-CELLED STORAGE SIZE               03150000
         SRL   R0,10                                                    03160000
         ST    R0,KMVSSZ                                                03170000
                                                                        03180000
         L     R0,PTOTSZ+4        TOTAL STORAGE ALLOCATED               03190000
         SRL   R0,10                                                    03200000
         ST    R0,KTOTSZ                                                03210000
                                                                        03220000
         L     R0,PHWMSZ+4        TOTAL STORAGE ALLOCATED - HWM         03230000
         SRL   R0,10                                                    03240000
         ST    R0,KHWMSZ                                                03250000
                                                                        03260000
         TM    REQFLAG,REQDPART   FORMATTING PARTITIONS?                03270000
         BNO   SUBPDETL           USE SUBPOOL DETAIL MSG FORM           03280000
         CLC   SL1PARTS,=H'1'     SINGLE PARTITION?                     03290000
         BH    SUBPSMRY           USE SUBPOOL SUMMARY MSG FORM IF NOT   03300000
                                                                        03310000
SUBPDETL DS    0H                                                       03320000
         $MSG  227,FIELDS=(PARTSIZE,                                   X03330000
               PREQS+4,PBLKS+4,PCELLS+4,PB16M+4,                       X03340000
               KMVSSZ,KTOTSZ,KHWMSZ)                                    03350000
         B     NOSUBP                                                   03360000
                                                                        03370000
SUBPSMRY DS    0H                                                       03380000
         $MSG  228,                                                    X03390000
               FIELDS=(PREQS+4,PBLKS+4,PCELLS+4,PB16M+4,               X03400000
               KMVSSZ,KTOTSZ,KHWMSZ)                                    03410000
                                                                        03420000
NOSUBP   DS    0H                                                       03430000
                                                                        03440000
*--------------------------------------------------------------         03450000
*   ROLL SUBPOOL TOTALS INTO SYSTEM TOTALS                              03460000
*--------------------------------------------------------------         03470000
         L     R0,PREQS+4         NUMBER OF REQUESTS                    03480000
         AL    R0,PREQS+8                                               03490000
         ST    R0,PREQS+8                                               03500000
                                                                        03510000
         L     R0,PBLKS+4         NUMBER OF BLOCKS ALLOCATED            03520000
         AL    R0,PBLKS+8                                               03530000
         ST    R0,PBLKS+8                                               03540000
                                                                        03550000
         L     R0,PCELLS+4        NUMBER OF CELLS IN CELLPOOL           03560000
         AL    R0,PCELLS+8                                              03570000
         ST    R0,PCELLS+8                                              03580000
                                                                        03590000
         L     R0,PTOTSZ+4        TOTAL ALLOCATED STORAGE               03600000
         AL    R0,PTOTSZ+8                                              03610000
         ST    R0,PTOTSZ+8                                              03620000
                                                                        03630000
         L     R0,PHWMSZ+4        TOTAL ALLOCATED STORAGE - HWM         03640000
         AL    R0,PHWMSZ+8                                              03650000
         ST    R0,PHWMSZ+8                                              03660000
                                                                        03670000
         L     R0,PB16M+4         NUMBER OF LOC=BELOW REQUESTS          03680000
         AL    R0,PB16M+8                                               03690000
         ST    R0,PB16M+8                                               03700000
                                                                        03710000
         L     R0,PMVSSZ+4        TOTAL NON-CELLED STORAGE SIZE         03720000
         AL    R0,PMVSSZ+8                                              03730000
         ST    R0,PMVSSZ+8                                              03740000
                                                                        03750000
         TM    SL1ATTRS,SL1A_LAST LAST ENTRY?                           03760000
         BO    TOTALS             DONE HERE IF SO                       03770000
         LA    R7,SL1ENTLN(,R7)   ELSE ADVANCE TO NEXT SUBPOOL          03780000
         B     DNXTSUBP           AGAIN                                 03790000
                                                                        03800000
*--------------------------------------------------------------         03810000
*   TOTALS LINE                                                         03820000
*--------------------------------------------------------------         03830000
TOTALS   DS    0H                                                       03840000
         LH    R2,SL1MAX          SUBPOOL CEILING                       03850000
         ST    R2,PARTSIZE        SAVE FOR REPORT                       03860000
                                                                        03870000
         L     R0,PMVSSZ+8        NON-CELLED STORAGE SIZE               03880000
         SRL   R0,10                                                    03890000
         ST    R0,KMVSSZ                                                03900000
                                                                        03910000
         L     R0,PTOTSZ+8        TOTAL STORAGE ALLOCATED               03920000
         SRL   R0,10                                                    03930000
         ST    R0,KTOTSZ                                                03940000
                                                                        03950000
         L     R0,PHWMSZ+8        TOTAL STORAGE ALLOCATED - HWM         03960000
         SRL   R0,10                                                    03970000
         ST    R0,KHWMSZ                                                03980000
                                                                        03990000
         $MSG  229,                                                    X04000000
               FIELDS=(PREQS+8,PBLKS+8,PCELLS+8,PB16M+8,               X04010000
               KMVSSZ,KTOTSZ,KHWMSZ)                                    04020000
                                                                        04030000
         DROP  R6,R7              SL2ENTRY, SL1ENTRY                    04040000
                                                                        04050000
*--------------------------------------------------------------         04060000
*   REPORT STORAGE USED FOR CELL POOLS                                  04070000
*--------------------------------------------------------------         04080000
         SR    R2,R2              AGGREGATE CELLPOOL EXTENT SIZE        04090000
         ICM   R3,15,STAXTLST     SCAN ALL EXTENTS                      04100000
         BZ    XTENTEND           DONE IF NONE                          04110000
         USING STXTENT,R3         EXTENT FORMAT                         04120000
                                                                        04130000
XTENTNXT DS    0H                                                       04140000
         AL    R2,STXLEN          ACCUMULATE EXTENT SIZES               04150000
         ICM   R3,15,STXNEXT      ANY LEFT?                             04160000
         BNZ   XTENTNXT           AGAIN IF SO                           04170000
         DROP  R3                 STXTENT                               04180000
                                                                        04190000
XTENTEND DS    0H                                                       04200000
         L     R4,PMVSSZ+8        NON-CELLED STORAGE SIZE               04210000
         AR    R4,R2              TOTAL STORAGE ACQUIRED BY INTFCE      04220000
         SRL   R4,10              CONVERT BYTES TO KB                   04230000
         SRL   R2,10              CONVERT BYTES TO KB                   04240000
                                                                        04250000
         $MSG  221,FIELDS=(((R4)),((R2)))                               04260000
                                                                        04270000
*--------------------------------------------------------------         04280000
*   WARNING IF CELL STORAGE REQUESTED BUT NOT AVAILABLE                 04290000
*--------------------------------------------------------------         04300000
         TM    STAFLAGS,STAFNSTG  CELL POOL STORAGE EXHAUSTED?          04310000
         BNO   NCPX               SKIP IF NOT                           04320000
                                                                        04330000
         $MSG  222                                                      04340000
                                                                        04350000
NCPX     DS    0H                                                       04360000
                                                                        04370000
         EJECT ,                                                        04380000
***************************************************************         04390000
*                                                                       04400000
*   RESET STORAGE STATISTICS                                            04410000
*                                                                       04420000
***************************************************************         04430000
RESET    DS    0H                 STG DISPLAY COMPLETE                  04440000
         TM    REQFLAG,REQRESET   DISPLAY REQUEST?                      04450000
         BNO   RESETFIN           SKIP IF NOT                           04460000
         L     R7,STALVL1         LOCATE SUBPOOL TABLE                  04470000
         USING SL1ENTRY,R7        PREPARE FOR SUBPOOL SCAN              04480000
                                                                        04490000
         SR    R0,R0              USEFUL ZERO                           04500000
                                                                        04510000
RNXTSUBP DS    0H                                                       04520000
         TM    SL1ATTRS,SL1A_INACTIVE   ACTIVE SUBOOL?                  04530000
         BNO   *+8                BEGIN PARTITION SCAN IF SO            04540000
         L     R7,SL1LVL2         REPLACE WITH PROXY                    04550000
                                                                        04560000
*--------------------------------------------------------------         04570000
*   CLEAR STATS FOR EACH PARTITION ATTACHED TO SUBPOOL                  04580000
*--------------------------------------------------------------         04590000
         L     R6,SL1LVL2         LOCATE PARTITION TABLE                04600000
         USING SL2ENTRY,R6        PREPARE FOR PARTITION TABLE SCAN      04610000
         LH    R5,SL1PARTS        NUMBER OF PARTITIONS                  04620000
                                                                        04630000
RPARTSCN DS    0H                 BLOCK CONCURRENT FETCH AND STORE      04640000
         ST    R0,SL2UREQS        TOTAL REQUESTS                        04650000
         ST    R0,SL2UB16M        TOTAL REQUESTS BELOW THE LINE         04660000
                                                                        04670000
         L     R15,SL2UTOTL       TOTAL SIZE OF STORAGE OUTSTANDING     04680000
         ST    R15,SL2UHWM        RESET HIGH-WATER MARK ACCORDINGLY     04690000
                                                                        04700000
         LA    R6,SL2ENTLN(,R6)   ADVANCE TO NEXT PARTITION             04710000
         BCT   R5,RPARTSCN        PROCESS ALL PARTITIONS                04720000
                                                                        04730000
*--------------------------------------------------------------         04740000
*   PROCESS ALL SUBPOOLS                                                04750000
*--------------------------------------------------------------         04760000
         TM    SL1ATTRS,SL1A_LAST LAST ENTRY?                           04770000
         BO    RESETMSG           DONE HERE IF SO                       04780000
         LA    R7,SL1ENTLN(,R7)   ELSE ADVANCE TO NEXT SUBPOOL          04790000
         B     RNXTSUBP           AGAIN                                 04800000
                                                                        04810000
RESETMSG DS    0H                 RESET COMPLETE                        04820000
         $MSG  224                                                      04830000
                                                                        04840000
RESETFIN DS    0H                                                       04850000
         DROP  R6,R7              SL2ENTRY, SL1ENTRY                    04860000
                                                                        04870000
         EJECT ,                                                        04880000
***************************************************************         04890000
*                                                                       04900000
*   RETURN COMPLETION STATUS TO REQUESTOR                               04910000
*                                                                       04920000
***************************************************************         04930000
RETURN   DS    0H                                                       04940000
         LA    R15,CCODE_NORESP   NO ADDITIONAL RESPONSE REQUIRED       04950000
         ST    R15,CMRQCOMP       POST COMPLETION CODE PER CONVENTION   04960000
                                                                        04970000
         #EXIT ,                                                        04980000
                                                                        04990000
         EJECT ,                                                        05000000
***************************************************************         05010000
*                                                                       05020000
*   LOCAL READ/ONLY DATA AREAS, ETC.                                    05030000
*                                                                       05040000
***************************************************************         05050000
         LTORG ,                                                        05060000
                                                                        05070000
         PRINT NOGEN                                                    05080000
         ICVT  ,                                                        05090000
         END   ,                                                        05100000
