INAVOPT2 TITLE '- PLAN REORGANIZATION / OPTIMIZATION #2'                00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: INAVOPT2 - PLAN REORGANIZATION / OPTIMIZATION #2             00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THIS FUNCTION IS INVOKED PRIOR TO THE REUSE OF A SAVED             00080000
*    (PREPARED) PLAN TO REORGANIZE THE SUPER-ARC PEER CHAINS,           00090000
*    MOVING THE MOST RECENTLY ENCOUNTERED CONDITIONAL ALTERNATE         00100000
*    TO THE FRONT OF THE PEER LIST.  THIS HEURISTIC IS INTENDED         00110000
*    TO, ON AVERAGE, DECREASE THE NUMBER OF IMAGE COMPARE               00120000
*    REQUESTS MADE OVER THE LIFE OF THE PLAN.                           00130000
*                                                                       00140000
*    A RELATED OPTIMIZATION IS PERFORMED BY PLANOPT1 DURING             00150000
*    THE INITIAL CONSTRUCTION OF THE PLAN.  CONSULT INAVPLAN            00160000
*    FOR DETAILS.                                                       00170000
*                                                                       00180000
* NOTES:                                                                00190000
*                                                                       00200000
*    SUPRARC.SUPOCCUR IS SET IN AT MOST ONE SUPER ARC OF EACH           00210000
*    NESTING LEVEL (STEP) OF THE PLAN.  THESE "VISIT" ARE RESET         00220000
*    AS THE PLAN IS REORGED.                                            00230000
*                                                                       00240000
*    SUPRARCS ARE UPDATED IN PLACE; NO STORAGE MANAGMENT ISSUES.        00250000
*                                                                       00260000
* ENTRY:                                                                00270000
*                                                                       00280000
*    R1 CONTAINS THE ADDR OF THE FIRST ENTRY IN THE SUPERARC            00290000
*       PEER CHAIN FOR ANY PARTICULAR NESTING LEVEL OF THE PLAN         00300000
*                                                                       00310000
* EXIT:                                                                 00320000
*                                                                       00330000
*    R15 CONTAINS ZERO                                                  00340000
*                                                                       00350000
**<DOC-OFF>****************************************************         00360000
                                                                        00370000
         EJECT                                                          00380000
***************************************************************         00390000
*                                                                       00400000
* MAINTENANCE:                                                          00410000
*                                                                       00420000
*   05/02/94  R. TURGEON                                                00430000
*             INITIAL VERSION                                           00440000
*                                                                       00450000
***************************************************************         00460000
                                                                        00470000
         EJECT                                                          00480000
         NAV   ,                       NAVIGATION / PLAN STRUCTURES     00490000
                                                                        00500000
         EJECT                                                          00510000
         EQUS  ,                                                        00520000
                                                                        00530000
         EJECT                                                          00540000
INAVOPT2 #ENTER BASE=R12,SAVE=NO,PREG=(R8)                              00550000
                                                                        00560000
         USING ITASK,R10               ITASK ADDRESSABILITY             00570000
                                                                        00580000
         EJECT                                                          00590000
*--------------------------------------------------------------         00600000
*   IDENTIFY HEAD OF CHAIN, SCAN FOR 'VISITED' SUPERARC                 00610000
*--------------------------------------------------------------         00620000
DESCEND  DS    0H                                                       00630000
         LTR   R7,R8                   HEAD OF CHAIN                    00640000
         BZ    RETURN                  DEFENSIVE STAND                  00650000
                                                                        00660000
F        USING SUPRARC,R7              FIRST IN CHAIN                   00670000
C        USING SUPRARC,R8              CURR  IN CHAIN                   00680000
                                                                        00690000
FVISIT   DS    0H                                                       00700000
         CLI   C.SUPOCCUR,FALSE        THIS XITION MATCHED LAST PASS?   00710000
         BNE   SWAP                    BRANCH IF SO                     00720000
         ICM   R8,15,C.SUPPEER         ELSE TRY NEXT ENTRY              00730000
         BNZ   FVISIT                  CONTINUE SCAN                    00740000
         B     RETURN                  SCAN COMPLETE                    00750000
                                                                        00760000
*--------------------------------------------------------------         00770000
*   NON-TRIVIAL EXCHANGE OF FIRST AND SELECTED ARCS                     00780000
*--------------------------------------------------------------         00790000
SWAP     DS    0H                                                       00800000
         MVI   C.SUPOCCUR,FALSE        ERASE LAST MATCHED INDICATOR     00810000
         CR    R7,R8                   TRIVIAL CASE?                    00820000
         BE    ADVANCE                 SKIP EXCHANGE IF SO              00830000
                                                                        00840000
         L     R14,F.SUPPEER           FIRST NODE, PEER PTR             00850000
         L     R15,C.SUPPEER           CURR  NODE, PEER PTR             00860000
                                                                        00870000
         XC    C.SUPRARC(SUPARCLN),F.SUPRARC                            00880000
         XC    F.SUPRARC(SUPARCLN),C.SUPRARC                            00890000
         XC    C.SUPRARC(SUPARCLN),F.SUPRARC                            00900000
                                                                        00910000
         ST    R14,F.SUPPEER           RESTORE PEER PTRS                00920000
         ST    R15,C.SUPPEER                                            00930000
                                                                        00940000
*--------------------------------------------------------------         00950000
*   ADVANCE TO NEXT STEP OF THE PLAN AND RESTART SCAN                   00960000
*--------------------------------------------------------------         00970000
ADVANCE  DS    0H                                                       00980000
         L     R8,F.SUPNEXT            CONTINUE THRU PLAN STEPS         00990000
         B     DESCEND                 CONTINUE                         01000000
                                                                        01010000
*--------------------------------------------------------------         01020000
*  RETURN TO REQUESTOR                                                  01030000
*--------------------------------------------------------------         01040000
RETURN   DS    0H                                                       01050000
         #EXIT ,                       RETURN                           01060000
                                                                        01070000
         EJECT                                                          01080000
***************************************************************         01090000
*                                                                       01100000
*   LOCAL READ ONLY STORAGE                                             01110000
*                                                                       01120000
***************************************************************         01130000
         LTORG ,                                                        01140000
                                                                        01150000
         PRINT NOGEN                                                    01160000
         ICVT  ,                                                        01170000
         ITASK ,                                                        01180000
         IPCB  ,                                                        01190000
         END   ,                                                        01200000
