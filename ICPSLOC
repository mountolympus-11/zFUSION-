ICPSLOC TITLE 'INTEGRATOR CPIC SERVICE: LOCATE TKB/RCB'                 00010000
                                                                        00020000
         PRINT NOGEN                                                    00030000
         CMINCL ,                 INTEGRATOR CPI-C DEFINITIONS          00040000
         L62INCL ,                INTEGRATOR LU6.2 DEFINITIONS          00050000
         PRINT GEN                                                      00060000
                                                                        00070000
**<DOC-ON>************************************************************* 00080000
*                                                                       00090000
* ROUTINE: ICPSLOC - INTEGRATOR CPIC SERVICE: LOCATE TKB/RCB            00100000
*                                                                       00110000
* DESCRIPTION:                                                          00120000
*                                                                       00130000
* ON ENTRY:                                                             00140000
*                                                                       00150000
*    R15 = ENTRY POINT ADDRESS                                          00160000
*    R14 = RETURN ADDRESS                                               00170000
*    R13 = AVAILABLE SAVE AREA                                          00180000
*    R11 = ICVT ADDRESS                                                 00190000
*    R10 = ITASK ADDRESS                                                00200000
*    R01 = ADDRESS OF CONVERSATION ID                                   00210000
*                                                                       00220000
* ON EXIT:                                                              00230000
*                                                                       00240000
*    R15 = 0                                                            00250000
*    R01 = ADDRESS OF TKB -OR- 0                                        00260000
*    R00 = ADDRESS OF RCB -OR- 0                                        00270000
*                                                                       00280000
*    ALL OTHER REGISTERS ARE RESTORED                                   00290000
*                                                                       00300000
**<DOC-OFF>************************************************************ 00310000
         EJECT ,                                                        00320000
*********************************************************************** 00330000
*                                                                       00340000
* MAINTENANCE:                                                          00350000
*                                                                       00360000
*   08/01/94 RANDY WITEK                                                00370000
*                                                                       00380000
*********************************************************************** 00390000
         EQUS  ,                  GENERAL EQUATES                       00400000
RICVT    EQU   R11                                                      00410000
RITASK   EQU   R10                                                      00420000
RPARM    EQU   R9                                                       00430000
RTKB     EQU   R8                                                       00440000
RRCB     EQU   R7                                                       00450000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00460000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00470000
         USING TKB,RTKB           ESTABLISH ADDRESSABILITY              00480000
         USING RCB,RRCB           ESTABLISH ADDRESSABILITY              00490000
                                                                        00500000
ICPSLOC #ENTER BASE=R12,          R12 IS BASE REGISTER                 +00510000
               AMODE=31,                                               +00520000
               RMODE=ANY,                                              +00530000
               PREG=(RPARM),      R1 --> RPARM                         +00540000
               RESTENV=NO,        ICVT AND ITASK POINTERS ARE OK       +00550000
               SAVE=NO,           DON'T ALLOCATE A SAVE AREA           +00560000
               WAPASS=NO,         NO WORK AREA PASSED IN R0            +00570000
               LINKAGE=STD        CALLED BY BAS/BASR                    00580000
                                                                        00590000
*---------------------------------------------------------------------- 00600000
* LOCATE SPECIFIED CONVERSATION                                         00610000
*---------------------------------------------------------------------- 00620000
                                                                        00630000
         ICM   R1,15,TSKPCBC             OUR IPCB                       00640000
         BZ    NOLOCATE                  BRANCH IF NO IPCB              00650000
         ICM   RTKB,15,PCBIVTAM-IPCB(R1) OUR TKB                        00660000
         BNP   NOLOCATE                  BRANCH IF NO TKB               00670000
         CLC   TKBID,=CL8'TKB'           EYECATCHER PRESENT?            00680000
         BNE   NOLOCATE                  BRANCH IF NOT                  00690000
         CLC   0(4,RPARM),4(RPARM)       DOES IT SMELL LIKE A CONVID?   00700000
         BNE   NOLOCATE                  BRANCH IF NOT                  00710000
         ICM   RRCB,15,0(RPARM)          SHOULD BE AN RCB POINTER       00720000
         BNP   NOLOCATE                  BRANCH IF NOT                  00730000
                                                                        00740000
         LA    R1,TKBRC1ST               VERIFY RCB IS ON THE CHAIN     00750000
         S     R1,=A(RCBNEXT-RCB)        NORMALIZE FOR RUN              00760000
                                                                        00770000
RUNRCBS  DS    0H                                                       00780000
                                                                        00790000
         ICM   R1,15,RCBNEXT-RCB(R1)     NEXT RCB                       00800000
         BM    NOLOCATE                  BRANCH IF NOT ON CHAIN         00810000
         CR    R1,RRCB                   IS THIS THE ONE?               00820000
         BNE   RUNRCBS                   BRANCH IF NOT                  00830000
                                                                        00840000
         CLC   RCBID,=CL8'RCB'           EYECATCHER PRESENT?            00850000
         BNE   NOLOCATE                  BRANCH IF NOT                  00860000
         C     RTKB,RCBTKBID             DOES IT BELONG TO THIS TKB?    00870000
         BNE   NOLOCATE                  BRANCH IF NOT                  00880000
         LR    R0,RRCB                   RCB POINTER                    00890000
         LR    R1,RTKB                   TKB POINTER                    00900000
         B     RETURN                                                   00910000
                                                                        00920000
NOLOCATE DS    0H                                                       00930000
                                                                        00940000
         SR    R0,R0                     NO RCB POINTER                 00950000
         SR    R1,R1                     NO TKB POINTER                 00960000
         B     RETURN                                                   00970000
                                                                        00980000
*---------------------------------------------------------------------- 00990000
* RETURN TO CALLER                                                      01000000
*---------------------------------------------------------------------- 01010000
                                                                        01020000
RETURN   DS    0H                                                       01030000
                                                                        01040000
         SR    R15,R15            CLEAR R15                             01050000
                                                                        01060000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    01070000
                                                                        01080000
         LTORG ,                                                        01090000
         PRINT NOGEN                                                    01100000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                01110000
         ICVT  ,                  INTEGRATOR CVT                        01120000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   01130000
         ITASK ,                  INTEGRATOR TASK BLOCK                 01140000
         IPCB ,                   INTEGRATOR PROCESS BLOCK              01150000
         END   ,                                                        01160000
