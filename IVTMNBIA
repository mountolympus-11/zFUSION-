IVTMNBIA TITLE 'INTEGRATOR - BIND IMAGE ANALYZER'                       00010000
**<DOC-ON>************************************************************* 00020000
*                                                                       00030000
* ROUTINE: IVTMNBIA - BIND IMAGE ANALYZER                               00040000
*                                                                       00050000
* DESCRIPTION: THIS ROUTINE IS CALLED DURING LOGON OR BIND PROCESSING   00060000
*              AFTER THE ISESS HAS BEEN PARTIALLY BUILT.                00070000
*              THE BIND IMAGE INFORMATION IN THE ISESS IS PROCESSED     00080000
*              TO DETERMINE SUCH USEFUL THINGS AS THE RU SIZES          00090000
*              SUPPORTED, CONTROL REQUESTS THAT ARE SUPPORTED, ETC.     00100000
*              THIS INFORMATION IS STORED IN A MORE USEFUL FORMAT IN    00110000
*              VARIOUS FIELDS OF THE ISESS.                             00120000
*                                                                       00130000
* ON ENTRY:                                                             00140000
*                                                                       00150000
*    R15 = ENTRY POINT ADDRESS                                          00160000
*    R14 = RETURN ADDRESS                                               00170000
*    R13 = AVAILABLE SAVE AREA                                          00180000
*    R11 = ICVT ADDRESS                                                 00190000
*    R10 = ITASK ADDRESS                                                00200000
*    R09 = IVTAMCVT ADDRESS                                             00210000
*    R01 = ISESS ADDRESS                                                00220000
*                                                                       00230000
* ON EXIT:                                                              00240000
*                                                                       00250000
*    R15 = 0 --> SUCCESSFUL                                             00260000
*        = 4 --> SESSION INFORMATION NOT SUCCESSFULLY PROCESSED         00270000
*    R00 = 0                                                            00280000
*    R01 = 0                                                            00290000
*                                                                       00300000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00310000
*                                                                       00320000
**<DOC-OFF>************************************************************ 00330000
                                                                        00340000
         EJECT ,                                                        00350000
*********************************************************************** 00360000
*                                                                       00370000
* MAINTENANCE:                                                          00380000
*                                                                       00390000
*   08/01/93 RANDY WITEK                                                00400000
*   07/01/94 RANDY WITEK - LU6.2 SUPPORT                                00410000
*                                                                       00420000
*********************************************************************** 00430000
                                                                        00440000
         EQUS  ,                  GENERAL EQUATES                       00450000
                                                                        00460000
RICVT    EQU   R11                                                      00470000
RITASK   EQU   R10                                                      00480000
RIVTAM   EQU   R9                                                       00490000
RISESS   EQU   R8                                                       00500000
RIVUSER  EQU   R7                                                       00510000
                                                                        00520000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00530000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00540000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00550000
         USING ISESS,RISESS       ESTABLISH ADDRESSABILITY              00560000
         USING IVUSER,RIVUSER     ESTABLISH ADDRESSABILITY              00570000
         USING ISTDBIND,ISEBIND   ESTABLISH ADDRESSABILITY              00580000
                                                                        00590000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00600000
WRK256   DS    XL256              GENERAL WORKAREA                      00610000
LV0SAVE  DS    18F                SUBROUTINE SAVE AREA                  00620000
RETR15   DS    F                                                        00630000
RETR0    DS    F                                                        00640000
RETR1    DS    F                                                        00650000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      00660000
WORKLEN  #ENDWORK                 END OF WORKAREA                       00670000
                                                                        00680000
         $MSGDFT PREFIX=ICTPID,                                        +00690000
               COMPID='VTM',                                           +00700000
               TABLE=*#MSGS,                                           +00710000
               WORKA=0,                                                +00720000
               MF=(E,WRK256),                                          +00730000
               PRINT=NOGEN                                              00740000
                                                                        00750000
IVTMNBIA #ENTER BASE=R12,         ENTRY LINKAGE                        +00760000
               PREG=RISESS,                                            +00770000
               AMODE=31,                                               +00780000
               RMODE=ANY                                                00790000
                                                                        00800000
         L     RIVUSER,ISEIVUSR   ASSOCIATED IVUSER BLOCK               00810000
                                                                        00820000
*---------------------------------------------------------------------- 00830000
* RESET FIELDS IN CASE NEGOTIABLE BIND RESPONSE IS BEING PROCESSED      00840000
*---------------------------------------------------------------------- 00850000
                                                                        00860000
         NI    ISEF1,X'FF'        RESET FLAGS AS APPROPRIATE            00870000
         NI    ISEF2,X'80'        RESET FLAGS AS APPROPRIATE            00880000
         NI    ISEF3,X'00'        RESET FLAGS AS APPROPRIATE            00890000
         NI    ISEF4,X'FF'        RESET FLAGS AS APPROPRIATE            00900000
         XC    ISESTATE,ISESTATE  RESET FLAGS AS APPROPRIATE            00910000
         XC    ISERESET,ISERESET  RESET FLAGS AS APPROPRIATE            00920000
                                                                        00930000
*---------------------------------------------------------------------- 00940000
* IF INTEGRATOR IS SLU PARTNER, ALTER PLU/SLU DEPENDENT FIELDS          00950000
*---------------------------------------------------------------------- 00960000
                                                                        00970000
         TM    ISEF2,ISEF2SLU     IS INTEGRATOR THE SLU PARTNER?        00980000
         BNO   NOTSLU             BRANCH IF NOT                         00990000
                                                                        01000000
         IC    R1,BINSECP         PICK UP SECONDARY LU PROTOCOL FLAGS   01010000
         MVC   BINSECP,BINPRIP    MOVE PLU PARTNER'S FLAGS TO SECP      01020000
         STC   R1,BINPRIP         INTEGRATOR PROTOCOL FLAGS ARE IN PRIP 01030000
                                                                        01040000
         IC    R1,BINSRUSZ        PICK UP SECONDARY SEND RU SIZE        01050000
         MVC   BINSRUSZ,BINPRUSZ  MOVE PLU PARTNER'S RU SIZE TO SRUSZ   01060000
         STC   R1,BINPRUSZ        INTEGRATOR SEND RU SIZE IS IN PRUSZ   01070000
                                                                        01080000
         XI    BINCMNP2,BINBKFS   BKFS '1' -->INTEG. IS 1ST SPKR        01090000
         XI    BINCMNP2,BINCONR   CONR '1' -->INTEG. IS HDX FF 1ST SNDR 01100000
                                                                        01110000
NOTSLU   DS    0H                                                       01120000
                                                                        01130000
*---------------------------------------------------------------------- 01140000
* REJECT SESSION IF REQUESTED LU6.2 FACILITIES EXCEED OUR CAPABILITIES  01150000
*---------------------------------------------------------------------- 01160000
                                                                        01170000
         CLC   BINLUP(2),=X'0602' LU TYPE 6.2?                          01180000
         BNE   NOT62              BRANCH IF NOT                         01190000
                                                                        01200000
         TM    BINFLG2,BINCSBK    CONF/SYNCPT/BACKOUT SPECIFIED?        01210000
         BNO   ENDCSBK            BRANCH IF NOT                         01220000
         TM    IVUF2,IVUF2SPB     CAN WE DO IT?                         01230000
         BNO   RETURN4            REJECT IF NOT                         01240000
ENDCSBK  DS    0H                                                       01250000
         TM    BINFLG2,BINCONF    CONFIRM SPECIFIED?                    01260000
         BNO   ENDSYNC            BRANCH IF NOT                         01270000
         TM    IVUF2,IVUF2CFM     CAN WE DO IT?                         01280000
         BNO   RETURN4            REJECT IF NOT                         01290000
ENDSYNC  DS    0H                                                       01300000
                                                                        01310000
         TM    BINFLG2,BINRS      RECONNECT SUPPORT SPECIFIED?          01320000
         BNO   ENDRS              BRANCH IF NOT                         01330000
         TM    IVUF2,IVUF2REC     CAN WE DO IT?                         01340000
         BNO   RETURN4            REJECT IF NOT                         01350000
ENDRS    DS    0H                                                       01360000
                                                                        01370000
         TM    BINFLG2,BINPSS     PARALLEL SESSION SUPPORT?             01380000
         BNO   ENDPSS             BRANCH IF NOT                         01390000
         TM    IVUF1,IVUF1PSC     CAN WE DO IT?                         01400000
         BNO   RETURN4            REJECT IF NOT                         01410000
         B     ENDPSS             CONTINUE                              01420000
CHKPSS   DS    0H                                                       01430000
         TM    IVUF1,IVUF1PSC     ARE WE USING PARALLEL SESSIONS?       01440000
         BO    RETURN4            REJECT IF WE ARE AND THEY ARE NOT     01450000
ENDPSS   DS    0H                                                       01460000
                                                                        01470000
         CLC   ISELOGMD,=CL8'SNASVCMG'                                  01480000
         BNE   ENDSVCMG                                                 01490000
         TM    IVUF1,IVUF1PSC          PARALLEL SESSION CAPABLE?        01500000
         BNO   RETURN4                 REJECT IF NOT                    01510000
         TM    BINFLG2,BINPSS+BINGDSVF CNOS SUPPORT?                    01520000
         BNO   RETURN4                 REJECT IF NOT                    01530000
ENDSVCMG DS    0H                                                       01540000
                                                                        01550000
NOT62    DS    0H                                                       01560000
                                                                        01570000
*---------------------------------------------------------------------- 01580000
* BINPRUSZ IS X'AB', CALCULATE MAX SEND RU SIZE = A*(2**B)              01590000
*---------------------------------------------------------------------- 01600000
                                                                        01610000
         L     R1,=F'32767'       THIS IS MAX IF BIND DOESN'T SPECIFY   01620000
         TM    BINPRUSZ,X'80'     NO MAX SPECIFIED?                     01630000
         BZ    SETSRUSZ           BRANCH IF NO MAXIMUM                  01640000
         SLR   R15,R15            CLEAR FOR INSERT                      01650000
         IC    R15,BINPRUSZ       R15 = 000000AB                        01660000
         LR    R3,R15             R3  = 000000AB                        01670000
         N     R15,=X'0000000F'   R15 = 0000000B                        01680000
         LA    R1,1               R1  = 2                               01690000
         SLA   R1,0(R15)          R1  = 2**B                            01700000
         SRA   R3,4               R3  = 0000000A                        01710000
         MR    R0,R3              R1  = A*(2**B)                        01720000
         C     R1,=F'32767'       IS MAX RU SIZE UNACCEPTABLE?          01730000
         BNH   SETSRUSZ           BRANCH IF NOT                         01740000
         L     R1,=F'32767'       SET ACCEPTABLE MAXIMUM                01750000
                                                                        01760000
SETSRUSZ DS    0H                                                       01770000
                                                                        01780000
         STH   R1,ISESRUSZ        SET MAXIMUM RU SIZE                   01790000
                                                                        01800000
*---------------------------------------------------------------------- 01810000
* BINSRUSZ IS X'AB', CALCULATE MAX RECEIVE RU SIZE = A*(2**B)           01820000
*---------------------------------------------------------------------- 01830000
                                                                        01840000
         L     R1,=F'32767'       THIS IS MAX IF BIND DOESN'T SPECIFY   01850000
         TM    BINSRUSZ,X'80'     NO MAX SPECIFIED?                     01860000
         BZ    SETRRUSZ           BRANCH IF NO MAXIMUM                  01870000
         SLR   R15,R15            CLEAR FOR INSERT                      01880000
         IC    R15,BINSRUSZ       R15 = 000000AB                        01890000
         LR    R3,R15             R3  = 000000AB                        01900000
         N     R15,=X'0000000F'   R15 = 0000000B                        01910000
         LA    R1,1               R1  = 2                               01920000
         SLA   R1,0(R15)          R1  = 2**B                            01930000
         SRA   R3,4               R3  = 0000000A                        01940000
         MR    R0,R3              R1  = A*(2**B)                        01950000
         C     R1,=F'32767'       IS MAX RU SIZE UNACCEPTABLE?          01960000
         BNH   SETRRUSZ           BRANCH IF NOT                         01970000
         L     R1,=F'32767'       SET ACCEPTABLE MAXIMUM                01980000
                                                                        01990000
SETRRUSZ DS    0H                                                       02000000
                                                                        02010000
         STH   R1,ISERRUSZ        SET MAXIMUM RU SIZE                   02020000
                                                                        02030000
*---------------------------------------------------------------------- 02040000
* DETERMINE RU SUPPORT SPECIFIED BY TS PROFILE                          02050000
*---------------------------------------------------------------------- 02060000
                                                                        02070000
         LA    R1,TSPROFTB        ADDRESS OF THE PROFILE TABLE          02080000
                                                                        02090000
TSPRNEXT DS    0H                                                       02100000
                                                                        02110000
         CLC   0(1,R1),=X'00'     END OF TABLE REACHED?                 02120000
         BE    RETURN4            BRANCH IF YES, DON'T SUPPORT IT       02130000
         CLC   0(1,R1),BINTS      IS THIS THE ENTRY WE NEED?            02140000
         BE    TSPRSET            BRANCH IF YES                         02150000
         LA    R1,L'TSPRFENT(,R1) NEXT TABLE ENTRY                      02160000
         B     TSPRNEXT           CHECK THE NEXT ENTRY                  02170000
                                                                        02180000
TSPRSET  DS    0H                                                       02190000
                                                                        02200000
         MVC   ISER1(1),1(R1)     SET THE SEND    TS PROFILE SUPPORT    02210000
         MVC   ISERR1(1),1(R1)    SET THE RECEIVE TS PROFILE SUPPORT    02220000
                                                                        02230000
*---------------------------------------------------------------------- 02240000
* DETERMINE RU SUPPORT SPECIFIED BY FM PROFILE                          02250000
*---------------------------------------------------------------------- 02260000
                                                                        02270000
         LA    R1,FMPROFTB        ADDRESS OF THE PROFILE TABLE          02280000
                                                                        02290000
FMPRNEXT DS    0H                                                       02300000
                                                                        02310000
         CLC   0(1,R1),=X'00'     END OF TABLE REACHED?                 02320000
         BE    RETURN4            BRANCH IF YES, DON'T SUPPORT IT       02330000
         CLC   0(1,R1),BINFM      IS THIS THE ENTRY WE NEED?            02340000
         BE    FMPRSET            BRANCH IF YES                         02350000
         LA    R1,L'FMPRFENT(,R1) NEXT TABLE ENTRY                      02360000
         B     FMPRNEXT           CHECK THE NEXT ENTRY                  02370000
                                                                        02380000
FMPRSET  DS    0H                                                       02390000
                                                                        02400000
         MVC   ISER2(1),1(R1)     SET THE SEND    FM PROFILE SUPPORT    02410000
         MVC   ISERR2(1),1(R1)    SET THE RECEIVE FM PROFILE SUPPORT    02420000
         MVC   ISER3(1),2(R1)     SET THE SEND    FM PROFILE SUPPORT    02430000
         MVC   ISERR3(1),2(R1)    SET THE RECEIVE FM PROFILE SUPPORT    02440000
                                                                        02450000
*---------------------------------------------------------------------- 02460000
* DETERMINE FM USAGE FROM PRIMARY AND COMMON LU PROTOCOL BYTES          02470000
*---------------------------------------------------------------------- 02480000
                                                                        02490000
* SET BRACKET USAGE RULES FOR THE SESSION                               02500000
*---------------------------------------------------------------------- 02510000
                                                                        02520000
         TM    BINCMNP,BINBRAK    IS RESET STATE BETWEEN BRACKETS?      02530000
         BO    BRBET              BRANCH IF YES                         02540000
         TM    BINPRIP,BINPSEB    CAN WE SEND EB?                       02550000
         BNO   BRSSEB             BRANCH IF NOT                         02560000
         OI    ISEF3,ISEF3EB      WE CAN SEND EB                        02570000
         B     BRINBOK            COMPLETE BRACKET USAGE                02580000
                                                                        02590000
BRSSEB   DS    0H                                                       02600000
                                                                        02610000
         TM    BINSECP,BINSSEB    CAN PARTNER SEND EB?                  02620000
         BO    BRINBOK            BRANCH YES, BRACKETS USED             02630000
         CLI   BINFM,BINFM19      FM PROFILE 19?                        02640000
         BNE   BRDONE             BRANCH IF NOT, BRACKETS AREN'T USED   02650000
         OI    ISEF2,ISEF2CEB     WE SEND CEB                           02660000
                                                                        02670000
BRINBOK  DS    0H                                                       02680000
                                                                        02690000
         OI    ISES1,ISES1INB     WE ARE NOW IN BRACKETS                02700000
         OI    ISESR1,ISES1INB    AND ALSO WHEN SESSION IS RESET        02710000
                                                                        02720000
BRBET    DS    0H                                                       02730000
                                                                        02740000
         OI    ISEF3,ISEF3BB      WE CAN SEND BB                        02750000
         TM    BINPRIP,BINPSEB    CAN WE SEND EB?                       02760000
         BNO   BRDONE             BRANCH IF NOT                         02770000
         OI    ISEF3,ISEF3EB      WE CAN SEND EB                        02780000
                                                                        02790000
BRDONE   DS    0H                                                       02800000
                                                                        02810000
* SET CHAINING USAGE RULE FOR THE SESSION                               02820000
*---------------------------------------------------------------------- 02830000
                                                                        02840000
         TM    BINPRIP,BINPCHN    CAN WE SEND MULTIPLE REQUEST CHAINS?  02850000
         BNO   CHNDONE            BRANCH IF NOT                         02860000
         OI    ISEF3,ISEF3CHN     WE CAN SEND CHAINS                    02870000
         CLI   BINFM,BINFM19      PROCESS DISCRETE RU'S?                02880000
         BNE   CHNDONE            BRANCH IF NOT                         02890000
         OI    ISEF2,ISEF2DRU     WE PROCESS DISCRETE RU'S              02900000
                                                                        02910000
CHNDONE  DS    0H                                                       02920000
                                                                        02930000
* SET RESPONSE TYPES THAT CAN BE REQUESTED                              02940000
*---------------------------------------------------------------------- 02950000
                                                                        02960000
         TM    BINPRIP,BINDFRSP   CAN WE ASK FOR DEFINITE RESPONSE?     02970000
         BNO   DEFDONE            BRANCH IF NOT                         02980000
         OI    ISEF3,ISEF3DEF     WE CAN ASK                            02990000
                                                                        03000000
DEFDONE  DS    0H                                                       03010000
                                                                        03020000
         TM    BINPRIP,BINEXRSP   CAN WE ASK FOR EXCEPTION RESPONSE?    03030000
         BNO   RSPDONE            BRANCH IF NOT                         03040000
         OI    ISEF3,ISEF3EXR     WE CAN ASK                            03050000
                                                                        03060000
RSPDONE  DS    0H                                                       03070000
                                                                        03080000
* SET FMH USAGE RULE                                                    03090000
*---------------------------------------------------------------------- 03100000
                                                                        03110000
         TM    BINCMNP,BINFMHD    CAN FMH'S BE USED?                    03120000
         BNO   FMHDONE            BRANCH IF NOT                         03130000
         OI    ISEF2,ISEF2FMH     WE CAN USE                            03140000
                                                                        03150000
FMHDONE  DS    0H                                                       03160000
                                                                        03170000
* SET CHANGE DIRECTION USAGE                                            03180000
*---------------------------------------------------------------------- 03190000
                                                                        03200000
         TM    BINCMNP2,BINHDXFF+BINHDXC HDX FLIP-FLOP OR CONTENTION?   03210000
         BZ    FDX                BRANCH IF FULL-DUPLEX                 03220000
         OI    ISEF3,ISEF3HDX     SESSION IS HALF-DUPLEX                03230000
         TM    BINCMNP2,BINHDXC   HALF-DUPLEX CONTENTION?               03240000
         BO    CDDONE             BRANCH IF YES                         03250000
         OI    ISEF3,ISEF3CD      WE CAN USE CD IN HDX FLIP-FLOP        03260000
         TM    ISEF3,ISEF3BRK     ARE BRACKETS IN USE?                  03270000
         BZ    CDRST              BRANCH IF NOT                         03280000
         TM    ISES1,ISES1INB     IS RESET STATE IN-BRACKETS?           03290000
         BNO   CDDONE             BRANCH IF NOT                         03300000
                                                                        03310000
CDRST    DS    0H                                                       03320000
                                                                        03330000
         TM    BINCMNP2,BINCONR   ARE WE HDX-FF FIRST SENDER?           03340000
         BNO   CDDONE             BRANCH IF NOT                         03350000
         B     FDXDIR             SET DIRECTION OWNERSHIP               03360000
                                                                        03370000
FDX      DS    0H                                                       03380000
                                                                        03390000
         CLC   BINLUP(2),=X'0602' LU TYPE 6.2 FDX?                      03400000
         BNE   FDXDIR             BRANCH IF NOT                         03410000
         OI    ISEF3,ISEF3CD      WE CAN USE CD IN HDX FLIP-FLOP        03420000
                                                                        03430000
FDXDIR   DS    0H                                                       03440000
                                                                        03450000
         OI    ISES1,ISES1DIR     WE NOW HAVE DIRECTION                 03460000
         OI    ISESR1,ISES1DIR    AND WE HAVE DIRECTION AFTER A RESET   03470000
                                                                        03480000
CDDONE   DS    0H                                                       03490000
                                                                        03500000
* SET CONTENTION WINNER / BRACKETS FIRST SPEAKER                        03510000
*---------------------------------------------------------------------- 03520000
                                                                        03530000
         TM    ISEF3,ISEF3HDX     FULL-DUPLEX SESSION?                  03540000
         BZ    WINDONE            BRANCH IF FULL-DUPLEX                 03550000
                                                                        03560000
         TM    ISEF3,ISEF3CD      HALF-DUPLEX FLIP-FLOP?                03570000
         BNO   WINSET             BRANCH IF HALF-DUPLEX CONTENTION      03580000
         TM    ISEF3,ISEF3BRK     ARE BRACKETS USED?                    03590000
         BNZ   WINSET             BRANCH IF YES                         03600000
         CLI   BINFM,BINFM19      FM PROFILE 19?                        03610000
         BE    WINSET             BRANCH IF YES                         03620000
         TM    BINCMNP2,BINRCVR   SYMMETRIC RESPONSIBILITY?             03630000
         BO    WINDONE            BRANCH IF YES                         03640000
                                                                        03650000
WINSET   DS    0H                                                       03660000
                                                                        03670000
         TM    BINCMNP2,BINBKFS   ARE WE WINNER/1ST SPEAKER?            03680000
         BNO   WINDONE            BRANCH IF NOT                         03690000
         OI    ISEF2,ISEF2WIN     WE ARE CONT. WINNER/1ST SPEAKER       03700000
                                                                        03710000
WINDONE  DS    0H                                                       03720000
                                                                        03730000
* SET RECOVERY RESPONSIBILITY                                           03740000
*---------------------------------------------------------------------- 03750000
                                                                        03760000
         TM    BINCMNP2,BINRCVR   SYMMETRIC RESPONSIBILITY?             03770000
         BO    RECSYM             BRANCH IF YES                         03780000
         TM    ISEF2,ISEF2WIN     ARE WE CONTENTION WINNER?             03790000
         BO    RECDONE            BRANCH IF YES                         03800000
         OI    ISEF2,ISEF2RCV     WE ARE RESPONSIBLE FOR RECOVERY       03810000
         B     RECDONE                                                  03820000
                                                                        03830000
RECSYM   DS    0H                                                       03840000
                                                                        03850000
         OI    ISEF2,ISEF2SYM     SET SYMMETRIC RECOVERY                03860000
                                                                        03870000
RECDONE  DS    0H                                                       03880000
                                                                        03890000
* SET CONDITIONAL BRACKET TERMINATION                                   03900000
*---------------------------------------------------------------------- 03910000
                                                                        03920000
         TM    ISEF3,ISEF3BRK     ARE BRACKETS USED?                    03930000
         BZ    CBTDONE            BRANCH IF NOT                         03940000
                                                                        03950000
         TM    BINCMNP,BINBKTR    CONDITIONAL BRACKET TERMINATION?      03960000
         BNO   CBTDONE            BRANCH IF NOT                         03970000
         OI    ISEF3,ISEF3CBT     WE USE CONDITIONAL BRACKET TERM.      03980000
                                                                        03990000
CBTDONE  DS    0H                                                       04000000
                                                                        04010000
*---------------------------------------------------------------------- 04020000
* FINALIZE THE RU SUPPORT FLAGS AND STATE FLAGS                         04030000
*---------------------------------------------------------------------- 04040000
                                                                        04050000
* SET DATA TRAFFIC RESET STATE IN RESET STATE FLAGS IF SDT IS SUPPORTED 04060000
*---------------------------------------------------------------------- 04070000
                                                                        04080000
         TM    ISER1,ISER1SDT     DOES SESSION USE SDT?                 04090000
         BNO   SDTDONE            BRANCH IF NOT                         04100000
         OI    ISESR1,ISES1DTR    SDT IS REQUIRED AFTER SESSION RESET   04110000
         TM    ISEF2,ISEF2SLU     IS INTEGRATOR THE SLU PARTNER?        04120000
         BNO   SDTDONE            BRANCH IF NOT                         04130000
         OI    ISES1,ISES1DTR     SDT IS REQUIRED NOW                   04140000
                                                                        04150000
SDTDONE  DS    0H                                                       04160000
                                                                        04170000
* CORRECT BID/RTR SUPPORT FOR FMPROF 3,4,18 & BIS/SBI FOR FMPROF 18     04180000
*---------------------------------------------------------------------- 04190000
                                                                        04200000
         CLI   BINFM,3               FM PROFILE 3?                      04210000
         BE    BIDRTRCK              BRANCH IF YES                      04220000
         CLI   BINFM,4               FM PROFILE 4?                      04230000
         BE    BIDRTRCK              BRANCH IF YES                      04240000
         CLI   BINFM,18              FM PROFILE 18?                     04250000
         BNE   BIDRTRDN              BRANCH IF NOT                      04260000
                                                                        04270000
BIDRTRCK DS    0H                                                       04280000
                                                                        04290000
         TM    ISEF3,ISEF3BRK        ARE BRACKETS USED?                 04300000
         BNZ   BIDRTRDN              BRANCH IF YES                      04310000
         NI    ISER2,255-ISER2BID    NO BID ALLOWED (SEND)              04320000
         NI    ISER3,255-ISER3RTR    NO RTR ALLOWED (SEND)              04330000
         NI    ISERR2,255-ISER2BID   NO BID ALLOWED (RECEIVE)           04340000
         NI    ISERR3,255-ISER3RTR   NO RTR ALLOWED (RECEIVE)           04350000
         CLI   BINFM,18              FM PROFILE 18?                     04360000
         BNE   BIDRTRDN              BRANCH IF NOT                      04370000
         NI    ISER3,255-ISER3BIS    NO BIS ALLOWED (SEND)              04380000
         NI    ISER3,255-ISER3SBI    NO SBI ALLOWED (SEND)              04390000
         NI    ISERR3,255-ISER3BIS   NO BIS ALLOWED (RECEIVE)           04400000
         NI    ISERR3,255-ISER3SBI   NO SBI ALLOWED (RECEIVE)           04410000
                                                                        04420000
BIDRTRDN DS    0H                                                       04430000
                                                                        04440000
* CORRECT LUSTAT SUPPORT FOR FMPROF 3                                   04450000
*---------------------------------------------------------------------- 04460000
                                                                        04470000
         CLI   BINFM,3               FM PROFILE 3?                      04480000
         BNE   LUSTATDN              BRANCH IF NOT                      04490000
         TM    ISEF2,ISEF2SLU        ARE WE THE SLU?                    04500000
         BO    LUSSLU                BRANCH IF YES                      04510000
         NI    ISER2,255-ISER2LUS    NO LUSTAT ALLOWED (SEND)           04520000
         B     LUSTATDN              DONE                               04530000
                                                                        04540000
LUSSLU   DS    0H                                                       04550000
                                                                        04560000
         NI    ISERR2,255-ISER2LUS   NO LUSTAT ALLOWED (RECEIVE)        04570000
         B     LUSTATDN              DONE                               04580000
                                                                        04590000
LUSTATDN DS    0H                                                       04600000
                                                                        04610000
* CORRECT RU SUPPORT FOR SLU'S                                          04620000
*---------------------------------------------------------------------- 04630000
                                                                        04640000
         TM    ISEF2,ISEF2SLU        ARE WE THE SLU?                    04650000
         BNO   SLURUEND              BRANCH IF NOT                      04660000
                                                                        04670000
         NI    ISER1,255-ISER1CLR    NO CLEAR  ALLOWED (SEND)           04680000
         NI    ISER1,255-ISER1SDT    NO SDT    ALLOWED (SEND)           04690000
         NI    ISER1,255-ISER1CRV    NO CRV    ALLOWED (SEND)           04700000
         NI    ISER1,255-ISER1SAT    NO STSN   ALLOWED (SEND)           04710000
         NI    ISER2,255-ISER2SHU    NO SHUTD  ALLOWED (SEND)           04720000
                                                                        04730000
         NI    ISERR1,255-ISER1RQR   NO RQR    ALLOWED (RECEIVE)        04740000
         NI    ISERR2,255-ISER2SHC   NO SHUTC  ALLOWED (RECEIVE)        04750000
         NI    ISERR2,255-ISER2RQS   NO RSHUTD ALLOWED (RECEIVE)        04760000
                                                                        04770000
SLURUEND DS    0H                                                       04780000
                                                                        04790000
* CORRECT RU SUPPORT FOR PLU'S                                          04800000
*---------------------------------------------------------------------- 04810000
                                                                        04820000
         TM    ISEF2,ISEF2SLU        ARE WE THE PLU?                    04830000
         BO    PLURUEND              BRANCH IF NOT                      04840000
                                                                        04850000
         NI    ISER1,255-ISER1RQR    NO RQR    ALLOWED (SEND)           04860000
         NI    ISER2,255-ISER2SHC    NO SHUTC  ALLOWED (SEND)           04870000
         NI    ISER2,255-ISER2RQS    NO RSHUTD ALLOWED (SEND)           04880000
                                                                        04890000
         NI    ISERR1,255-ISER1CLR   NO CLEAR  ALLOWED (RECEIVE)        04900000
         NI    ISERR1,255-ISER1SDT   NO SDT    ALLOWED (RECEIVE)        04910000
         NI    ISERR1,255-ISER1CRV   NO CRV    ALLOWED (RECEIVE)        04920000
         NI    ISERR1,255-ISER1SAT   NO STSN   ALLOWED (RECEIVE)        04930000
         NI    ISERR2,255-ISER2SHU   NO SHUTD  ALLOWED (RECEIVE)        04940000
                                                                        04950000
PLURUEND DS    0H                                                       04960000
                                                                        04970000
* CORRECT BID/RTR SUPPORT FOR BIDDER AND FIRST SPEAKER                  04980000
*---------------------------------------------------------------------- 04990000
                                                                        05000000
         TM    ISEF3,ISEF3BRK        ARE BRACKETS USED?                 05010000
         BZ    BIDSPKDN              BRANCH IF NOT                      05020000
         TM    BINCMNP2,BINBKFS      ARE WE WINNER/1ST SPEAKER?         05030000
         BNO   BIDFIXUP              BRANCH IF NOT (WE ARE BIDDER)      05040000
                                                                        05050000
         NI    ISER2,255-ISER2BID    NO BID    ALLOWED (SEND)           05060000
         NI    ISERR3,255-ISER3RTR   NO RTR    ALLOWED (RECEIVE)        05070000
         B     BIDSPKDN              DONE                               05080000
                                                                        05090000
BIDFIXUP DS    0H                                                       05100000
                                                                        05110000
         NI    ISERR2,255-ISER2BID   NO BID    ALLOWED (RECEIVE)        05120000
         NI    ISER3,255-ISER3RTR    NO RTR    ALLOWED (SEND)           05130000
         B     BIDSPKDN              DONE                               05140000
                                                                        05150000
BIDSPKDN DS    0H                                                       05160000
                                                                        05170000
         B     RETURN                                                   05180000
                                                                        05190000
*---------------------------------------------------------------------- 05200000
* SET RETURN CODE 4                                                     05210000
*---------------------------------------------------------------------- 05220000
                                                                        05230000
RETURN4  DS    0H                                                       05240000
                                                                        05250000
         MVI   RETR15+(L'RETR15-1),4                                    05260000
         B     RETURN                                                   05270000
                                                                        05280000
*---------------------------------------------------------------------- 05290000
* RETURN TO CALLER                                                      05300000
*---------------------------------------------------------------------- 05310000
                                                                        05320000
RETURN   DS    0H                                                       05330000
                                                                        05340000
         LM    R15,R1,RETREGS     LOAD RETURN VALUES                    05350000
                                                                        05360000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    05370000
                                                                        05380000
*---------------------------------------------------------------------- 05390000
*  CONSTANTS AND LITERALS                                               05400000
*---------------------------------------------------------------------- 05410000
                                                                        05420000
TSPROFTB DS    0X                                                       05430000
         DC    AL1(2),AL1(ISER1T2)            TS PROFILE 02             05440000
TSPRFENT EQU   TSPROFTB,*-TSPROFTB                                      05450000
         DC    AL1(3),AL1(ISER1T3)            TS PROFILE 03             05460000
         DC    AL1(4),AL1(ISER1T4)            TS PROFILE 04             05470000
         DC    AL1(7),AL1(ISER1T7)            TS PROFILE 07             05480000
         DC    AL1(0),AL1(0)                  END OF TABLE ENTRY        05490000
                                                                        05500000
FMPROFTB DS    0X                                                       05510000
         DC    AL1(02),AL1(ISER2F2,ISER3F2)   FM PROFILE 02             05520000
FMPRFENT EQU   FMPROFTB,*-FMPROFTB                                      05530000
         DC    AL1(03),AL1(ISER2F3,ISER3F3)   FM PROFILE 03             05540000
         DC    AL1(04),AL1(ISER2F4,ISER3F4)   FM PROFILE 04             05550000
         DC    AL1(07),AL1(ISER2F7,ISER3F7)   FM PROFILE 07             05560000
         DC    AL1(18),AL1(ISER2F18,ISER3F18) FM PROFILE 18             05570000
         DC    AL1(19),AL1(ISER2F19,ISER3F19) FM PROFILE 19             05580000
         DC    AL1(00),AL1(0)                 END OF TABLE ENTRY        05590000
                                                                        05600000
         LTORG ,                                                        05610000
         PRINT NOGEN                                                    05620000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                05630000
         ISTDBIND ,               VTAM BIND IMAGE                       05640000
         ICVT  ,                  INTEGRATOR CVT                        05650000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   05660000
         IRPL ,                   INTEGRATOR VTAM RPL+                  05670000
         IACB ,                   INTEGRATOR VTAM ACB+                  05680000
         INIB ,                   INTEGRATOR VTAM NIB+                  05690000
         ISESS ,                  INTEGRATOR SESSION BLOCK              05700000
         IPOOL ,                  INTEGRATOR POOL BLOCK                 05710000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            05720000
         ITASK ,                  INTEGRATOR TASK BLOCK                 05730000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          05740000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       05750000
         EVCODES ,                INTEGRATOR EVENT CODES                05760000
         ABCODES ,                INTEGRATOR $ABEND CODES               05770000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     05780000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        05790000
         $TASK DSECT=YES          INTEGRATOR $TASK SERVICES             05800000
         $PROC DSECT=YES          INTEGRATOR $PROC SERVICES             05810000
         $VTAM DSECT=YES          INTEGRATOR $VTAM SERVICES             05820000
         IFGEXLST ,               VTAM EXIT LIST                        05830000
         END   ,                                                        05840000
