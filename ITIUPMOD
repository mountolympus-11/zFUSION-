ITIUPMOD TITLE 'TIUPDT - MODIFY ROW REQUEST'                            00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ITIUPMOD - TIUPDT - MODIFY ROW REQUEST                       00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THIS ROUTINE RECEIVES CONTROL TO REPLACE THE ROW                   00080000
*    AT THE CURRENT POSITION IDENTIFIED BY THE PASSED                   00090000
*    TABLE TOKEN FOR THE TABLE CURRENTLY BEING PROCESSED BY             00100000
*    TIUPDT SERVICE ROUTINE.                                            00110000
*                                                                       00120000
*    NOTE: TBMOD IS NOT USED FOR THIS REQUEST SINCE IT                  00130000
*          CURRENTLY ONLY OPERATES WITH INDEXED REQUESTS.               00140000
*                                                                       00150000
* ON ENTRY:                                                             00160000
*                                                                       00170000
*    R1  POINTS TO A STANDARD OS PARAMETER LIST                         00180000
*                                                                       00190000
*         0 - ADDR OF ROW BUFFER                                        00200000
*         4 - ADDR OF TABLE REQUEST (TIUPREQ)                           00210000
*         8 - ADDR OF TABLE DESC    (TBFMT)                             00220000
*        12 - ADDR OF TABLE TOKEN                                       00230000
*        16 - ADDR OF MSG WORK AREA                                     00240000
*                                                                       00250000
* ON EXIT:                                                              00260000
*                                                                       00270000
*        R15 =  0 - REQUEST COMPLETED SUCCESSFULLY                      00280000
*              >0 - REQUEST FAILED                                      00290000
*                                                                       00300000
*               R15-R1 PRESERVED FROM TABLE SERVICE REQUEST             00310000
*                                                                       00320000
*                                                                       00330000
**<DOC-OFF>****************************************************         00340000
                                                                        00350000
         EJECT ,                                                        00360000
***************************************************************         00370000
*                                                                       00380000
* MAINTENANCE:                                                          00390000
*                                                                       00400000
*   01/XX/93  RON COLMONE                                               00410000
*             INITIAL VERSION                                           00420000
*                                                                       00430000
*   08/05/93  RON COLMONE                                               00440000
*             CONVERTED TO NEW ENVIRONMENT                              00450000
*                                                                       00460000
***************************************************************         00470000
                                                                        00480000
         EJECT ,                                                        00490000
         @TIUPDT ,                REQUEST BLOCK FORMAT                  00500000
         EJECT ,                                                        00510000
         TBSERVIS ADD,DELETE                                            00520000
         EJECT ,                                                        00530000
         EQUS  ,                  GENERAL EQUATES                       00540000
                                                                        00550000
         EJECT ,                                                        00560000
         #WORK LENGTH=256         READ/WRITE WORKAREA                   00570000
ROWBUFR  DS    A                  ADDR OF ROW BUFFER                    00580000
TFORMAT  DS    A                  ADDR OF TABLE FORMAT                  00590000
TTOKEN@  DS    A                  ADDR OF TABLE TOKEN                   00600000
MSGBUF@  DS    A                  ADDR OF MESSAGE BUFFER                00610000
                                                                        00620000
ERRINFO  DS    0F                 TABLE SERVICE ERROR INFO              00630000
ERR_R15  DS    F                                                        00640000
ERR_R0   DS    F                                                        00650000
ERR_R1   DS    F                                                        00660000
         #ENDWORK ,               END OF WORKAREA                       00670000
                                                                        00680000
         EJECT ,                                                        00690000
ITIUPMOD #ENTER BASE=R12,WAPASS=YES,PREG=R8                             00700000
                                                                        00710000
         USING ITASK,R10          ITASK ADDRESSABILITY                  00720000
         L     R9,TSKPCBC         ADDR OF CURRENT TASK                  00730000
         USING IPCB,R9            IPCB  ADDRESSABILITY                  00740000
                                                                        00750000
*--------------------------------------------------------------         00760000
                                                                        00770000
         L     R7,PCBUSER         PROJECT CONTROL AREA                  00780000
         USING IUSER,R7           TEMP ADDRESSABILITY                   00790000
         L     R7,USRPROJ         ADDRESS OF PROJ BLOCK                 00800000
         USING IPROJ,R7           LIFE OF FUNCTION                      00810000
                                                                        00820000
         LM    R2,R6,0(R8)        GET PASSED PARMS                      00830000
         ST    R2,ROWBUFR         ADDR OF ROW BUFFER                    00840000
         ST    R4,TFORMAT         ADDR OF TABLE FORMAT                  00850000
         ST    R5,TTOKEN@         ADDR OF TABLE TOKEN                   00860000
         ST    R6,MSGBUF@         ADDR OF MESSAGE BUFFER                00870000
                                                                        00880000
         LR    R8,R3              ADDR OF REQUEST BLOCK                 00890000
         USING TIUPREQ,R8         ESTABLISH ADDRESSABILITY              00900000
                                                                        00910000
         EJECT ,                                                        00920000
**************************************************************          00930000
*                                                                       00940000
*   DELETE CURRENT TABLE ROW                                            00950000
*                                                                       00960000
**************************************************************          00970000
                                                                        00980000
         LA    R4,DELMSG          ADDR   OF MESSAGE                     00990000
         LA    R3,L'DELMSG        LENGTH OF MESSAGE                     01000000
                                                                        01010000
         TBDELETE TTOKEN=*TTOKEN@,                                     +01020000
               POS=CURRENT,                                            +01030000
               MF=(E,MFE_LIST)                                          01040000
                                                                        01050000
         LTR   R15,R15            DELETE SUCCESSFUL?                    01060000
         BNZ   ETBSRV                                                   01070000
                                                                        01080000
**************************************************************          01090000
*                                                                       01100000
*   ADD TABLE ROW BACK                                                  01110000
*                                                                       01120000
**************************************************************          01130000
                                                                        01140000
         LA    R4,ADDMSG          ADDR   OF MESSAGE                     01150000
         LA    R3,L'ADDMSG        LENGTH OF MESSAGE                     01160000
                                                                        01170000
         TBADD *ROWBUFR,          ADD TABLE ROW                        +01180000
               POS=CURRENT,                                            +01190000
               TTOKEN=*TTOKEN@,                                        +01200000
               MF=(E,MFE_LIST)                                          01210000
                                                                        01220000
         LTR   R15,R15            UPDATE SUCCESSFUL?                    01230000
         BNZ   ETBSRV             NO, SET RETURN CODES                  01240000
                                                                        01250000
         EJECT ,                                                        01260000
**************************************************************          01270000
*                                                                       01280000
*   POST UPDATE STATUS TO IPROJ                                         01290000
*                                                                       01300000
**************************************************************          01310000
                                                                        01320000
         @CALL IMNTCTLG,(TIUPRNAM),  UPDATE MAINTENANCE FLAG           +01330000
               CTYPE=CVT,MF=(E,MFE_LIST)                                01340000
                                                                        01350000
         LA    R15,RC00           SET  RETURN CODE                      01360000
         ST    R15,ERRINFO        SAVE RETURN CODE                      01370000
         B     EXIT               RETURN                                01380000
                                                                        01390000
         EJECT ,                                                        01400000
**************************************************************          01410000
*                                                                       01420000
*   TABLE SERVICES ERROR                                                01430000
*                                                                       01440000
**************************************************************          01450000
                                                                        01460000
ETBSRV   DS    0H                                                       01470000
         STM   R15,R1,ERRINFO     SAVE TBSERV ERROR INFO                01480000
         L     R2,MSGBUF@         ADDR OF MESSAGE BUFFER                01490000
         LA    R2,2(,R2)          PAST MESSAGE LENGTH                   01500000
         BCTR  R3,0               PREPARE FOR EX                        01510000
         EX    R3,*+4             MOVE FAILED MESSAGE TO BFR            01520000
         MVC   0(*-*,R2),0(R4)    *** EX OBJECT ***                     01530000
         LA    R2,1(R3,R2)        MSG ADDR OF TABLE NAME                01540000
         MVC   0(L'TIUPRNAM,R2),TIUPRNAM                                01550000
                                                                        01560000
         L     R2,MSGBUF@         ADDR OF MESSAGE BUFFER                01570000
         LA    R3,L'TIUPRNAM+1(,R3)   TOTAL MESSAGE LENGTH              01580000
         STH   R3,0(R2)           SET LENGTH OF MESSAGE                 01590000
                                                                        01600000
         EJECT ,                                                        01610000
***************************************************************         01620000
*                                                                       01630000
*  RETURN TO CALLER                                                     01640000
*                                                                       01650000
***************************************************************         01660000
                                                                        01670000
EXIT     DS    0H                                                       01680000
         #EXIT ,                  RETURN                                01690000
         DROP  R8                 TIUPREQ                               01700000
                                                                        01710000
         EJECT ,                                                        01720000
***************************************************************         01730000
*                                                                       01740000
*  MESSAGES, CONSTANTS AND LITERALS                                     01750000
*                                                                       01760000
***************************************************************         01770000
                                                                        01780000
DELMSG   DC    C'TBDELETE REQUEST FAILED FOR TABLE: '                   01790000
ADDMSG   DC    C'TBADD REQUEST FAILED FOR TABLE: '                      01800000
                                                                        01810000
         LTORG ,                                                        01820000
                                                                        01830000
         PRINT NOGEN                                                    01840000
         ICVT  ,                                                        01850000
         ITASK ,                                                        01860000
         IPCB  ,                                                        01870000
         IUSER ,                                                        01880000
         IPROJ ,                                                        01890000
         PRINT GEN                                                      01900000
                                                                        01910000
         END   ,                                                        01920000
