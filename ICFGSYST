ICFGSYST TITLE '- GENERATE REMOTE SYSTEMS DEFINITIONS'                  00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE: ICFGSYST - GENERATE REMOTE SYSTEMS DEFINITIONS               00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*   This routine retrieves the SYSTEMS table and generates an           00080000
*   ISYS control block for each row of the table and attempts to        00090000
*   establish the associated session.                                   00100000
*   This routine is called during VTAM task initialization to           00110000
*   start the remote systems connections.                               00120000
*   This routine is also called when                                    00130000
*   updates occur to the SYSTEMS global table.                          00140000
*                                                                       00150000
*                                                                       00160000
* ON ENTRY:                                                             00170000
*                                                                       00180000
*    R15 = ENTRY POINT ADDRESS                                          00190000
*    R14 = RETURN      ADDRESS                                          00200000
*    R13 = SAVE AREA   ADDRESS                                          00210000
*    R11 = ICVT        ADDRESS                                          00220000
*    R10 = ITASK       ADDRESS                                          00230000
*                                                                       00240000
* ON EXIT:                                                              00250000
*                                                                       00260000
*    R15 = GENERAL RETURN CODE                                          00270000
*                                                                       00280000
*        = 0 --> REMOTE SYSTEMS SUCCESSFULLY INITIALIZED                00290000
*                                                                       00300000
*                R00 = 0                                                00310000
*                R01 = 0                                                00320000
*                                                                       00330000
*        = 8 --> TABLE OPEN FAILURE                                     00340000
*                                                                       00350000
*                R00 = TBOPEN RETURN CODE                               00360000
*                R01 = TBOPEN REASON CODE                               00370000
*                                                                       00380000
*        =12 --> SERVICE FAILURE                                        00390000
*                                                                       00400000
*                R00 = 4 --> TBSET ERROR                                00410000
*                    = 8 --> $SYSTEMS DEFINE ERROR                      00420000
*                    =12 --> $SYSTEMS START ERROR                       00430000
*                R01 = 0                                                00440000
*                                                                       00450000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00460000
*                                                                       00470000
**<DOC-OFF>*****************************************************        00480000
                                                                        00490000
****************************************************************        00500000
*                                                                       00510000
* MAINTENANCE:                                                          00520000
*                                                                       00530000
*    12/31/93 RANDY WITEK                                               00540000
*                                                                       00550000
*    12/06/94 R. Turgeon                                                00560000
*             Removed PAGE= / SHRPAGE= for $SPACE, $OBJECT,             00570000
*             and TB* service requests                                  00580000
*                                                                       00590000
****************************************************************        00600000
                                                                        00610000
         EQUS  ,                                                        00620000
                                                                        00630000
RICVT    EQU   R11                                                      00640000
RITASK   EQU   R10                                                      00650000
RISYS    EQU   R9                                                       00660000
                                                                        00670000
         PRINT NOGEN                                                    00680000
         TBSERVIS OPEN,SET,GET                                          00690000
         PRINT GEN                                                      00700000
                                                                        00710000
         #WORK ,                                                        00720000
WRK256   DS    XL256              GENERAL WORKAREA                      00730000
                                                                        00740000
SYSTREC  DS    XL(SYSTEMSL)       SYSTEMS RECORD                        00750000
                                                                        00760000
RETR15   DS    F                                                        00770000
RETR0    DS    F                                                        00780000
RETR1    DS    F                                                        00790000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      00800000
         #ENDWORK ,                                                     00810000
                                                                        00820000
         $MSGDFT PREFIX=ICTPID,                                        +00830000
               COMPID='VTM',                                           +00840000
               TABLE=*#MSGS,                                           +00850000
               WORKA=0,                                                +00860000
               MF=(E,WRK256),                                          +00870000
               PRINT=NOGEN                                              00880000
                                                                        00890000
ICFGSYST #ENTER BASE=R12,                                              +00900000
               AMODE=31,                                               +00910000
               RMODE=ANY                                                00920000
                                                                        00930000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00940000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00950000
         USING ISY,RISYS          ESTABLISH ADDRESSABILITY              00960000
X        USING SYSTEMS,SYSTREC    ESTABLISH ADDRESSABILITY              00970000
                                                                        00980000
*---------------------------------------------------------------        00990000
*  OPEN TABLE ON INITIAL REMOTE SYSTEMS CONFIGURATION REQUEST           01000000
*---------------------------------------------------------------        01010000
                                                                        01020000
         ICM   R0,15,ICTSYSTM     SYSTEMS TABLE AREADY OPEN?            01030000
         BNZ   SET_TOP            YES,  POSITION TO TOP OF TABLE        01040000
                                                                        01050000
         TBOPEN 'SYSTEMS',        OPEN SYSTEMS CATALOG TABLE           +01060000
               STOKEN=*ICTSYSP@,                                       +01070000
               TTOKEN=ICTSYSTM,                                        +01080000
               MF=(E,MFE_LIST)                                          01090000
                                                                        01100000
         LTR   R15,R15            SUCCESSFUL COMPLETION?                01110000
         BNZ   ERR_OPEN           TABLE OPEN FAILED                     01120000
                                                                        01130000
*---------------------------------------------------------------        01140000
*  POSITIION SYSTEMS TABLE TO TOP                                       01150000
*---------------------------------------------------------------        01160000
                                                                        01170000
SET_TOP  DS    0H                                                       01180000
                                                                        01190000
         TBSET TTOKEN=ICTSYSTM,   POSITION AT TOP OF TABLE             +01200000
               POS=TOP,                                                +01210000
               MF=(E,MFE_LIST)                                          01220000
                                                                        01230000
         LTR   R15,R15            SUCCESSFUL COMPLETION?                01240000
         BNZ   ERR_SET            TBSET FAILED                          01250000
                                                                        01260000
*---------------------------------------------------------------        01270000
*  RETRIEVE NEXT SYSTEMS TABLE ROW                                      01280000
*---------------------------------------------------------------        01290000
                                                                        01300000
GET_SYST DS    0H                                                       01310000
                                                                        01320000
         TBGET SYSTREC,           RETRIEVE NEXT SYSTEMS TABLE ROW      +01330000
               LENGTH=L'SYSTREC,                                       +01340000
               TTOKEN=ICTSYSTM,                                        +01350000
               POS=NEXT,                                               +01360000
               MF=(E,MFE_LIST)                                          01370000
                                                                        01380000
         LTR   R15,R15            SUCCESSFUL COMPLETION?                01390000
         BNZ   RETURN             END OF SYSTEMS TABLE                  01400000
                                                                        01410000
*---------------------------------------------------------------        01420000
*  DEFINE THE REMOTE SYSTEM                                             01430000
*---------------------------------------------------------------        01440000
                                                                        01450000
         $SYSTEMS DEFINE,                                              +01460000
               APPLID=X.SSYSAPP,                                       +01470000
               SMFID=X.SSYSSMF,                                        +01480000
               DESC=X.SSYSDESC,                                        +01490000
               MF=(E,MFE_LIST)                                          01500000
                                                                        01510000
         LTR   R15,R15            DID DEFINITION COMPLETE OK?           01520000
         BZ    STARTSYS           BRANCH IF YES                         01530000
         C     R0,=A($SYSTEMS_RSN_ALREADY_DEFINED)                      01540000
         BE    STARTSYS           BRANCH IF RE-DEFINITION DUPLICATE     01550000
         B     ERR_DEF            RETURN WITH SERVICE FAILURE           01560000
                                                                        01570000
*---------------------------------------------------------------        01580000
*  START CONNECTION WITH THE REMOTE SYSTEM                              01590000
*---------------------------------------------------------------        01600000
                                                                        01610000
STARTSYS DS    0H                                                       01620000
                                                                        01630000
         $SYSTEMS START,                                               +01640000
               APPLID=X.SSYSAPP,                                       +01650000
               MF=(E,MFE_LIST)                                          01660000
                                                                        01670000
                                                                        01680000
         LTR   R15,R15            DID START COMPLETE OK?                01690000
         BZ    GET_SYST           BRANCH IF YES                         01700000
         C     R0,=A($SYSTEMS_RSN_ALREADY_STARTED)                      01710000
         BE    GET_SYST           BRANCH IF START WAS ALREADY COMPLETE  01720000
         B     ERR_STA            RETURN WITH SERVICE FAILURE           01730000
                                                                        01740000
*---------------------------------------------------------------        01750000
*  EXCEPTION ROUTINES                                                   01760000
*---------------------------------------------------------------        01770000
                                                                        01780000
ERR_OPEN DS    0H                                                       01790000
                                                                        01800000
         MVI   RETR15+(L'RETR15-1),8   SYSTEMS FAILED TO OPEN           01810000
         ST    R15,RETR0               TBOPEN RETURN CODE               01820000
         ST    R0,RETR1                TBOPEN REASON CODE               01830000
         B     RETURN                  RETURN                           01840000
                                                                        01850000
ERR_SET  DS    0H                                                       01860000
                                                                        01870000
         MVI   RETR15+(L'RETR15-1),12  SERVICE FAILURE                  01880000
         MVI   RETR0+(L'RETR0-1),4     TBSET FAILURE                    01890000
         B     RETURN                  RETURN                           01900000
                                                                        01910000
ERR_DEF  DS    0H                                                       01920000
                                                                        01930000
         MVI   RETR15+(L'RETR15-1),12  SERVICE FAILURE                  01940000
         MVI   RETR0+(L'RETR0-1),8     $SYSTEMS DEFINE FAILURE          01950000
         B     RETURN                                                   01960000
                                                                        01970000
ERR_STA  DS    0H                                                       01980000
                                                                        01990000
         MVI   RETR15+(L'RETR15-1),12  SERVICE FAILURE                  02000000
         MVI   RETR0+(L'RETR0-1),12    $SYSTEMS START FAILURE           02010000
         B     RETURN                                                   02020000
                                                                        02030000
*---------------------------------------------------------------        02040000
*  RETURN                                                               02050000
*---------------------------------------------------------------        02060000
                                                                        02070000
RETURN   DS    0H                                                       02080000
         LM    R15,R1,RETREGS     LOAD RETURN VALUES                    02090000
                                                                        02100000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    02110000
                                                                        02120000
****************************************************************        02130000
*                                                                       02140000
*  LITERALS, CONSTANTS, AND MAPPINGS                                    02150000
*                                                                       02160000
****************************************************************        02170000
                                                                        02180000
         LTORG ,                                                        02190000
         PRINT NOGEN                                                    02200000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                02210000
         ISTRH ,                  VTAM REQUEST HEADER                   02220000
         ISTDBIND ,               VTAM BIND IMAGE                       02230000
         TRACODES ,               INTEGRATOR TRACE CODE EQUATES         02240000
         ICVT  ,                  INTEGRATOR CVT                        02250000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   02260000
         ISESS ,                  INTEGRATOR ISESS BLOCK                02270000
         ITASK ,                  INTEGRATOR TASK BLOCK                 02280000
         IRPL ,                   INTEGRATOR IRPL  BLOCK                02290000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       02300000
         EVCODES ,                INTEGRATOR EVENT CODES                02310000
         ABCODES ,                INTEGRATOR $ABEND CODES               02320000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     02330000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        02340000
         $SYSTEMS DSECT=YES       INTEGRATOR $SYSTEMS SERVICES          02350000
         ICATALOG SYSTEMS                                               02360000
         END   ,                                                        02370000
