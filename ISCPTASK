ISCPTASK TITLE '- Command operand scoping - ITASK constraint'           00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ISCPTASK - Command operand scoping - ITASK constraint        00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This command line scoping routine may be designated in             00080000
*    a KEYTAB entry via the SCOPEREQ= operand to ensure that            00090000
*    the value of the associated operand is either unspecified,         00100000
*    or specifies the ITASK identified in the input CITREQ.             00110000
*                                                                       00120000
*    When the operand is not specified, it is imposed by                00130000
*    inserting the CITREQ resident ITASK name in the operand            00140000
*    extension area and formatting the OPLIST entry                     00150000
*    accordingly.                                                       00160000
*                                                                       00170000
*                                                                       00180000
* ON ENTRY:                                                             00190000
*                                                                       00200000
*    R1  contains the address of the standard scoping routine           00210000
*        parameter list mapped by CSCOPEP.                              00220000
*                                                                       00230000
*                                                                       00240000
* ON EXIT:                                                              00250000
*                                                                       00260000
*    R15 contains a standard return code value as described in          00270000
*        the CSCOPEP entry parameter list.                              00280000
*                                                                       00290000
**<DOC-OFF>****************************************************         00300000
                                                                        00310000
         EJECT                                                          00320000
***************************************************************         00330000
*                                                                       00340000
* MAINTENANCE:                                                          00350000
*                                                                       00360000
*    04/06/95 R. Turgeon                                                00370000
*             Initial version                                           00380000
*                                                                       00390000
***************************************************************         00400000
                                                                        00410000
         EJECT                                                          00420000
         CSCOPEP ,           SCOPING ROUTINE PARAMETER LIST             00430000
                                                                        00440000
         EJECT                                                          00450000
         KEYTAB DSECT=YES    COMMAND KEYWORD TABLE FORMATS              00460000
                                                                        00470000
         EJECT                                                          00480000
         OPLIST ,            COMMAND KEYWORD & VALUES INSTANCES         00490000
                                                                        00500000
         EJECT                                                          00510000
         CITREQ DSECT=YES    INTERTASK COMMAND EXECUTION REQUEST BLOCK  00520000
                                                                        00530000
         EJECT                                                          00540000
         EQUS  ,                                                        00550000
                                                                        00560000
         EJECT ,                                                        00570000
ISCPTASK #ENTER PREG=R8,SAVE=NO                                         00580000
                                                                        00590000
         EJECT                                                          00600000
***************************************************************         00610000
*                                                                       00620000
*   GENERAL INITIALIZATION, FETCH PASSSED PARAMETERS                    00630000
*                                                                       00640000
***************************************************************         00650000
                                                                        00660000
         LM    R2,R3,12(R8)       FETCH EXTENSION AREA INFO             00670000
*                                 R2 <== EXTENSION FREE AREA PTR ADDR   00680000
*                                 R3 <== EXTENSION FREE AREA LEN ADDR   00690000
                                                                        00700000
         LM    R5,R7,0(R8)        FETCH MAJOR CONTROL BLOCKS            00710000
         USING KEYTAB,R5          KEYTAB ENTRY                          00720000
         USING OPLIST,R6          OPERAND SUMMARY TABLE                 00730000
         USING CITREQ,R7          INTERTASK COMMAND REQ BLOCK OR ZERO   00740000
                                                                        00750000
         LTR   R7,R7              CITREQ AVAILABLE?                     00760000
         BZ    ERR_VIO            NO BASIS FOR CONTINUATION IF NOT      00770000
                                                                        00780000
*--------------------------------------------------------------         00790000
*   ACQUIRE TRIMMED LENGTH OF ITASK NAME                                00800000
*--------------------------------------------------------------         00810000
                                                                        00820000
         @TRIM CITITASK,L'CITITASK,CHAR=NULL                            00830000
                                                                        00840000
         LR    R9,R1              TRIMMED ITASK NAME LENGTH             00850000
                                                                        00860000
         CLI   OPLSPEC,0          OPERAND PRESENT IN COMMAND LINE?      00870000
         BE    ADDVAL             DONE HERE IF NOT                      00880000
                                                                        00890000
*--------------------------------------------------------------         00900000
*   OPERAND SPECIFIED, VALUE CONSTRAINED TO ITASK NAME                  00910000
*--------------------------------------------------------------         00920000
                                                                        00930000
         CH    R9,OPLVLEN         ITASK NAMES LENGTH MATCH?             00940000
         BNE   ERR_VIO            CANT MATCH OTHERWISE                  00950000
         L     R15,OPLVPTR        LOCATE VALUE                          00960000
         BCTR  R9,0               PREPARE FOR COMPARE                   00970000
         EX    R9,COMPTEXT        MATCHING ITASK NAMES                  00980000
         BNE   ERR_VIO            ERROR OTHERWISE                       00990000
         B     NORMRET            SUCCESS                               01000000
                                                                        01010000
COMPTEXT CLC   CITITASK(*-*),0(R15)                                     01020000
                                                                        01030000
*--------------------------------------------------------------         01040000
*   OPERAND NOT SPECIFIED, CONSTRUCT AND POST ITASK NAME                01050000
*--------------------------------------------------------------         01060000
                                                                        01070000
ADDVAL   DS    0H                                                       01080000
         L     R15,0(,R3)         EXTENSION AREA LENGTH REMAINING       01090000
         SR    R15,R9             SUFFICIENT FOR NEW TEXT?              01100000
         BM    ERR_OVFL           OVERFLOW OTHERWISE                    01110000
         ST    R15,0(,R3)         UPDATE EXTENSION AREA FREE LENGTH     01120000
                                                                        01130000
         L     R14,0(,R2)         FREE AREA ORIGIN                      01140000
         ST    R14,OPLVPTR        VALUE POINTER                         01150000
         STH   R9,OPLVLEN         VALUE LENGTH                          01160000
                                                                        01170000
         BCTR  R9,0               PREPARE FOR COPY                      01180000
         EX    R9,COPYTASK        INSERT EXTENSION OPERAND              01190000
         LA    R14,1(R9,R14)      UPDATE FREE AREA PTR                  01200000
         ST    R14,0(,R2)         UPDATE EXTENSION AREA FREE PTR        01210000
                                                                        01220000
         MVI   OPLSPEC,TRUE       OPERAND SPECIFIED                     01230000
         LA    R0,1               SINGLE VALUE                          01240000
         STH   R0,OPLCOUNT                                              01250000
         B     NORMRET                                                  01260000
                                                                        01270000
COPYTASK MVC   0(*-*,R14),CITITASK                                      01280000
                                                                        01290000
         EJECT                                                          01300000
***************************************************************         01310000
*                                                                       01320000
*   RETURN COMPLETION STATUS TO CALLER                                  01330000
*                                                                       01340000
***************************************************************         01350000
                                                                        01360000
NORMRET  DS    0H                                                       01370000
         LA    R15,RC00           NO SCOPE CONSTRAINT VIOLATION         01380000
         B     EXIT               RETURN                                01390000
                                                                        01400000
ERR_VIO  DS    0H                 SCOPING VIOLATION ENCOUNTERED         01410000
         LA    R15,RC04           RETURN CODE                           01420000
         B     EXIT                                                     01430000
                                                                        01440000
ERR_OVFL DS    0H                 OPERAND EXTENSION AREA OVERFLOW       01450000
         LA    R15,RC08           RETURN CODE, IDENTIFY FAILING OPERAND 01460000
                                                                        01470000
*--------------------------------------------------------------         01480000
*   RETURN TO CALLER                                                    01490000
*--------------------------------------------------------------         01500000
                                                                        01510000
EXIT     DS    0H                                                       01520000
         #EXIT ,                  TERMINATE                             01530000
                                                                        01540000
         EJECT                                                          01550000
***************************************************************         01560000
*                                                                       01570000
*   LOCAL READ/ONLY DATA AREAS, ETC.                                    01580000
*                                                                       01590000
***************************************************************         01600000
                                                                        01610000
         LTORG ,                                                        01620000
                                                                        01630000
         PRINT NOGEN                                                    01640000
         ICVT  ,                                                        01650000
         END   ,                                                        01660000
