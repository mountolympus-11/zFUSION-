IL62DRCV TITLE 'INTEGRATOR - LU6.2 RECEIVE SPLIST PROCESSOR'            00010000
                                                                        00020000
         PRINT NOGEN                                                    00030000
         CMINCL ,                 INTEGRATOR CPI-C DEFINITIONS          00040000
         L62INCL ,                INTEGRATOR LU6.2 DEFINITIONS          00050000
         PRINT GEN                                                      00060000
                                                                        00070000
**<DOC-ON>************************************************************* 00080000
*                                                                       00090000
* ROUTINE: IL62DRCV - INTEGRATOR LU6.2 RECEIVE SPLIST PROCESSOR         00100000
*                                                                       00110000
* DESCRIPTION: THIS ROUTINE IS CALLED TO PROCESS A COMPLETED            00120000
*              RECEIVE SPLIST.                                          00130000
*                                                                       00140000
* ON ENTRY:                                                             00150000
*                                                                       00160000
*    R15 = ENTRY POINT ADDRESS                                          00170000
*    R14 = RETURN      ADDRESS                                          00180000
*    R13 = SAVE AREA   ADDRESS                                          00190000
*    R11 = ICVT        ADDRESS                                          00200000
*    R10 = ITASK       ADDRESS                                          00210000
*    R09 = IVTAMCVT    ADDRESS                                          00220000
*    R08 = ISESS       ADDRESS                                          00230000
*    R01 = SPLIST      ADDRESS                                          00240000
*    R00 = EVENT CODE                                                   00250000
*          EC$SESS_RECEIVE = NORMAL RECEIVE COMPLETION                  00260000
*          EC$LU62_SHIP    = SHIP           COMPLETION                  00270000
*          EC$LU62_BID     = BID            COMPLETION                  00280000
*                                                                       00290000
* ON EXIT:                                                              00300000
*                                                                       00310000
*    R15 = GENERAL RETURN CODE                                          00320000
*                                                                       00330000
*        = 0 --> INPUT SUCCESSFULLY PROCESSED                           00340000
*                R00 = 0                                                00350000
*                R01 = 0                                                00360000
*                                                                       00370000
*        = 4 --> INPUT ERROR, NEGATIVE RESPONSE WAS SENT IF POSSIBLE    00380000
*                R00 = SENSE DATA                                       00390000
*                R01 = 0                                                00400000
*                                                                       00410000
*        = 8 --> $SESS ERROR OCCURRED SENDING DATA/RESPONSE/ETC.        00420000
*                R00 = $SESS SPLRETCD                                   00430000
*                R01 = $SESS SPLRSNCD                                   00440000
*                                                                       00450000
*        =12 --> THE INPUT $SESS_RECEIVE SPLIST HAD AN ERROR RETURN     00460000
*                R00 = $SESS SPLRETCD                                   00470000
*                R01 = $SESS SPLRSNCD                                   00480000
*                                                                       00490000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00500000
*                                                                       00510000
**<DOC-OFF>************************************************************ 00520000
                                                                        00530000
*********************************************************************** 00540000
*                                                                       00550000
* MAINTENANCE:                                                          00560000
*                                                                       00570000
*   07/01/94 RANDY WITEK - LU6.2 SUPPORT                                00580000
*                                                                       00590000
*********************************************************************** 00600000
                                                                        00610000
         EQUS  ,                  GENERAL EQUATES                       00620000
                                                                        00630000
RICVT    EQU   R11                                                      00640000
RITASK   EQU   R10                                                      00650000
RIVTAM   EQU   R9                                                       00660000
RISESS   EQU   R8                                                       00670000
RSPLIST  EQU   R7                                                       00680000
RRCB     EQU   R6                                                       00690000
                                                                        00700000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00710000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00720000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00730000
         USING ISESS,RISESS       ESTABLISH ADDRESSABILITY              00740000
         USING SPLIST,RSPLIST     ESTABLISH ADDRESSABILITY              00750000
         USING RCB,RRCB           ESTABLISH ADDRESSABILITY              00760000
                                                                        00770000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00780000
                                                                        00790000
WRK256   DS    XL256              GENERAL WORKAREA                      00800000
SUB0SAVE DS    18F                SUBROUTINE SAVE AREA                  00810000
SUB1SAVE DS    18F                SUBROUTINE SAVE AREA                  00820000
SESSTOKN DS    XL(L'ISETK)        SESSION TOKEN AREA                    00830000
$SESSEX  $SESS MF=L,FIELDS=((,,,))                                      00840000
L62MFL   L62POST MF=L             PLIST CONSTRUCTION                    00850000
$TASKMFL $TASK MF=L               PLIST CONSTRUCTION                    00860000
$WUMFL   $WULOC MF=L              PLIST CONSTRUCTION                    00870000
WUDATA   DS    XL16               WULOC RETURN AREA                     00880000
EXTSRU   DS    XL(L'ISERU)        EXTRACT AREA                          00890000
EXTRRU   DS    XL(L'ISERRU)       EXTRACT AREA                          00900000
L62RETCD DS    F                  L62 RETURN CODE RETURN AREA           00910000
CPICPOST DS    F                  POST CODE FOR SPECIAL CPIC REQUESTS   00920000
EVENTCDE DS    F                  $TASK EVENT CODE FROM MAINLINE DRIVER 00930000
DESC@    DS    F                  USED FOR TRACE FUNCTION               00940000
DESCLEN  DS    F                  USED FOR TRACE FUNCTION               00950000
TRACE@   DS    F                  USED FOR TRACE FUNCTION               00960000
TRACELEN DS    F                  USED FOR TRACE FUNCTION               00970000
RETR15   DS    F                                                        00980000
RETR0    DS    F                                                        00990000
RETR1    DS    F                                                        01000000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      01010000
GIVECDRH DS    XL3                RH TO GIVE UP DIRECTION               01020000
BISRH    DS    XL3                RH FOR BIS REQUEST/RESPONSE           01030000
FLAG     DS    X                  FLAGS                                 01040000
FLAGDLCK EQU   X'80'                                                    01050000
FLAGDLKD EQU   X'40'                                                    01060000
FLAGCOPY EQU   X'20'              SPLIST IS A WORKING COPY              01070000
WORKLEN  #ENDWORK                 END OF WORKAREA                       01080000
                                                                        01090000
         $MSGDFT PREFIX=ICTPID,                                        +01100000
               COMPID='L62',                                           +01110000
               TABLE=*#MSGS,                                           +01120000
               WORKA=0,                                                +01130000
               MF=(E,WRK256),                                          +01140000
               PRINT=NOGEN                                              01150000
                                                                        01160000
IL62DRCV #ENTER BASE=R12,                                              +01170000
               PREG=(RSPLIST,R2),       R1->RSPLIST R0-->R2            +01180000
               AMODE=31,                                               +01190000
               RMODE=ANY                                                01200000
                                                                        01210000
*---------------------------------------------------------------------- 01220000
* INITIALIZATION                                                        01230000
*---------------------------------------------------------------------- 01240000
                                                                        01250000
         ST    R2,EVENTCDE         SAVE EVENT CODE                      01260000
         MVC   SESSTOKN,SPLTOKEN   SAVE SESSION TOKEN                   01270000
                                                                        01280000
*---------------------------------------------------------------------- 01290000
* EXAMINE EVENT CODE                                                    01300000
*---------------------------------------------------------------------- 01310000
                                                                        01320000
         C     R2,=A(EC$SESS_RECEIVE)                                   01330000
         BE    EC_RECV                                                  01340000
         C     R2,=A(EC$LU62_SHIP)                                      01350000
         BE    EC_SHIP                                                  01360000
         C     R2,=A(EC$LU62_BID)                                       01370000
         BE    EC_BID                                                   01380000
         EX    0,*                                                      01390000
                                                                        01400000
*---------------------------------------------------------------------- 01410000
* CHECK FOR CPIC REQUEST                                                01420000
*---------------------------------------------------------------------- 01430000
                                                                        01440000
EC_RECV  DS    0H                                                       01450000
                                                                        01460000
         CLI   SPLRETCD+(L'SPLRETCD-1),$SESS_RC_CPIC_REQUEST            01470000
         BNE   NOTCPIC                          BRANCH IF NOT CPIC      01480000
                                                                        01490000
*---------------------------------------------------------------------- 01500000
* CHECK FOR CPIC SHIP REQUEST                                           01510000
*---------------------------------------------------------------------- 01520000
                                                                        01530000
         CLI   SPLRSNCD+(L'SPLRSNCD-1),$SESS_RSN_CPIC_SHIP              01540000
         BNE   NOTSHIP                          BRANCH IF NOT           01550000
                                                                        01560000
         OC    ISE62SRQ,ISE62SRQ    IS A REQUEST ACTIVE?                01570000
         BNZ   CPICBUSY             BRANCH IF YES, CAN'T ACCEPT         01580000
         OC    ISE62RRQ,ISE62RRQ    IS A REQUEST ACTIVE?                01590000
         BNZ   CPICBUSY             BRANCH IF YES, CAN'T ACCEPT         01600000
                                                                        01610000
         TM    ISE62FL1,ISE62RER    NEG RESP RECEIVED?                  01620000
         BNO   SHIPNORM             BRANCH IF NOT                       01630000
                                                                        01640000
         TM    ISE62RH1,RHERI       IS THIS AN ER RU?                   01650000
         BNO   SHIPEX               BRANCH IF NOT, IT IS CONFIRM        01660000
                                                                        01670000
X        USING SBFLIST,R3                                               01680000
                                                                        01690000
         L     R3,ISE62SBF            CURRENT CPIC SEND BUFFER          01700000
         MVC   SPLAREA,X.SBFBUFA      SET BUFFER ADDRESS                01710000
         MVC   SPLAREAL,X.SBFBUFO     SET BUFFER LENGTH                 01720000
         MVC   SPLRH,ISE62RH          SET THE RH                        01730000
                                                                        01740000
         LA    R1,=CL13'DATA NOT SENT'                                  01750000
         ST    R1,DESC@                                                 01760000
         MVI   DESCLEN+(L'DESCLEN-1),13                                 01770000
         L     R1,SPLAREA                                               01780000
         ST    R1,TRACE@                                                01790000
         MVC   TRACELEN,SPLAREAL                                        01800000
         LR    R1,RSPLIST                                               01810000
         BAS   R14,TRACESPL                                             01820000
                                                                        01830000
         XC    X.SBFBUFO,X.SBFBUFO    NO DATA IN THE SEND BUFFER        01840000
         XC    ISE62RH,ISE62RH        CLEAR THE RH                      01850000
         B     CPICDONE                                                 01860000
                                                                        01870000
SHIPEX   DS    0H                                                       01880000
                                                                        01890000
         BAS   R14,COPYSPL          COPY THE SHIP SPLIST                01900000
         ST    R1,ISE62SRQ          SAVE THE COPY                       01910000
         L     R15,IL6@DREX         EXCEPTION RECEIVE ROUTINE           01920000
         BASR  R14,R15              CALL IT                             01930000
         STM   R15,R1,RETREGS       SAVE THE RETURN VALUES              01940000
         B     RETURN               AND RETURN                          01950000
                                                                        01960000
SHIPNORM DS    0H                                                       01970000
                                                                        01980000
         BAS   R14,COPYSPL          CREATE A COPY OF THE SPLIST         01990000
         ST    R1,ISE62SRQ          ANCHOR THE CURRENT SHIP REQUEST     02000000
         LR    RSPLIST,R1           USE THE SPLIST COPY                 02010000
                                                                        02020000
SHIPREST DS    0H                                                       02030000
                                                                        02040000
         OC    ISE62BRQ,ISE62BRQ    IS THERE A PENDING BID?             02050000
         BZ    SHIPEPB              BRANCH IF NOT                       02060000
         OI    ISE62FL2,ISE62SWB    SHOW SHIP IS WAITING BID COMPLETION 02070000
         B     RETURN               EXIT TO AWAIT BID COMPLETION        02080000
                                                                        02090000
SHIPEPB  DS    0H                                                       02100000
                                                                        02110000
         $TASK SETEPB,                                                 +02120000
               ECODE=EC$LU62_SHIP,                                     +02130000
               ERRET=ERR$TASK,                                         +02140000
               MF=(E,$TASKMFL)      INITIALIZE BID EPB                  02150000
                                                                        02160000
         LR    R4,R1                EPB TOKEN / ADDR                    02170000
         L     R3,ISE62SBF          CURRENT CPIC SEND BUFFER            02180000
                                                                        02190000
         $SESS $SESS_SEND_DATA,     SEND THE CURRENT CPIC BUFFER       +02200000
               SESSION=SESSTOKN,                                       +02210000
               AREA=*X.SBFBUFA,                                        +02220000
               AREALEN=*X.SBFBUFO,                                     +02230000
               POOL=*,              LU6.2 INFO HAS BEEN PLACED HERE    +02240000
               MASK=*,              LU6.2 INFO HAS BEEN PLACED HERE    +02250000
               LUNAME=*,            LU6.2 INFO HAS BEEN PLACED HERE    +02260000
               LOGMODE=*,           LU6.2 INFO HAS BEEN PLACED HERE    +02270000
               RH=ISE62RH,                                             +02280000
               EPB=(R4),                                               +02290000
               MF=(E,(RSPLIST))                                         02300000
                                                                        02310000
         LA    R1,=CL10'SHIP START'                                     02320000
         ST    R1,DESC@                                                 02330000
         MVI   DESCLEN+(L'DESCLEN-1),10                                 02340000
         L     R1,SPLAREA                                               02350000
         ST    R1,TRACE@                                                02360000
         MVC   TRACELEN,SPLAREAL                                        02370000
         LR    R1,RSPLIST                                               02380000
         BAS   R14,TRACESPL                                             02390000
         B     RETURN               WAIT FOR SHIP TO COMPLETE           02400000
                                                                        02410000
*                                                                       02420000
* PROCESS SHIP COMPLETION                                               02430000
*---------------------------------------------------------------------- 02440000
                                                                        02450000
EC_SHIP  DS    0H                                                       02460000
                                                                        02470000
         LTR   RSPLIST,RSPLIST        WAS THE SPLIST PURGED?            02480000
         BZ    RETURN                 JUST EXIT IF YES                  02490000
                                                                        02500000
         XC    ISE62SRQ,ISE62SRQ      NO SHIP REQUEST CURRENTLY ACTIVE  02510000
         OI    FLAG,FLAGCOPY          WORKING WITH SPLIST COPY          02520000
         L     R3,ISE62SBF            CURRENT CPIC SEND BUFFER          02530000
                                                                        02540000
         MVI   ISE62FRC,ISE62FRC_BETC IN CASE THIS WAS A SEND REPLY     02550000
                                                                        02560000
         TM    ISE62RH2,RHBBI         BEGIN BRACKET?                    02570000
         BNO   SHIPNOBB               BRANCH IF NOT                     02580000
         MVI   ISE62FBR,ISE62FBR_INB                                    02590000
         TM    ISEF2,ISEF2WIN         ARE WE THE CON WINNER?            02600000
         BNO   SHIPNOBB               BRANCH NO, DIR SET BY BID         02610000
         MVI   ISE62FCD,ISE62FCD_CD   SHOW WE HAVE DIRECTION            02620000
SHIPNOBB DS    0H                                                       02630000
         TM    ISE62RH0,RHBCI         BEGIN CHAIN?                      02640000
         BNO   SHIPNOBC               BRANCH IF NOT                     02650000
         MVI   ISE62FSC,ISE62FSC_INC                                    02660000
SHIPNOBC DS    0H                                                       02670000
         TM    ISE62RH0,RHECI         END CHAIN?                        02680000
         BNO   SHIPNOEC               BRANCH IF NOT                     02690000
         MVI   ISE62FSC,ISE62FSC_BETC                                   02700000
         TM    ISE62RH2,RHCDI         CHANGE DIRECTION?                 02710000
         BNO   SHIPNOCD               BRANCH IF NOT                     02720000
         MVI   ISE62FCD,ISE62FCD_NOCD                                   02730000
SHIPNOCD DS    0H                                                       02740000
         TM    ISE62RH2,RHCEBI        CEB?                              02750000
         BNO   SHIPNOEC               BRANCH IF NOT                     02760000
         MVI   ISE62FCD,ISE62FCD_NOCD                                   02770000
         MVI   ISE62FBR,ISE62FBR_BETB                                   02780000
         B     SHIPNOEC               FSM UPDATE COMPLETE               02790000
SHIPNOEC DS    0H                                                       02800000
                                                                        02810000
         ICM   R15,15,SPLRETCD        TEST THE RETURN CODE              02820000
         BNZ   BADSHIP                BRANCH IF SEND OK                 02830000
                                                                        02840000
SHIPDONE DS    0H                                                       02850000
                                                                        02860000
         XC    X.SBFBUFO,X.SBFBUFO    NO DATA IN THE SEND BUFFER        02870000
         XC    ISE62RH,ISE62RH        CLEAR THE RH                      02880000
         B     CPICDONE                                                 02890000
                                                                        02900000
BADSHIP  DS    0H                                                       02910000
                                                                        02920000
         CLI   SPLRETCD+(L'SPLRETCD-1),$SESS_RC_VTAMRC                  02930000
         BNE   CPICSERR                     BRANCH IF NOT               02940000
         CLC   SPLRSNCD+2(2),=XL2'0404'     NEGATIVE RESPONSE RECEIVED? 02950000
         BNE   CPICSERR                     BRANCH IF NOT               02960000
         CLC   SPLSENSE(2),=XL2'0846'       ERROR FMH COMING?           02970000
         BNE   CPICSERR                     BRANCH IF NOT               02980000
         TM    ISE62RH2,RHCEBI              WAS THIS A CEB?             02990000
         BNO   BADINB                       BRANCH IF NOT               03000000
         TM    ISE62RH1,RHERI               WAS THIS AN EX RESP?        03010000
         BO    SHIPDONE                     BRANCH YES, BRACKET ENDED   03020000
         TM    ISE62RH1,RHDR2               WAS THIS A DR2/DR3?         03030000
         BNO   SHIPDONE                     BRANCH NO, BRACKET ENDED    03040000
                                                                        03050000
BADINB   DS    0H                                                       03060000
                                                                        03070000
         MVI   ISE62FBR,ISE62FBR_INB        REFRESH STATE IF NECESSARY  03080000
         XC    X.SBFBUFO,X.SBFBUFO          NO DATA IN THE SEND BUFFER  03090000
         XC    ISE62RH,ISE62RH              CLEAR THE RH                03100000
         ST    RSPLIST,ISE62SRQ             SAVE PENDING REQUEST        03110000
                                                                        03120000
RERROR   DS    0H                                                       03130000
                                                                        03140000
         OI    ISE62FL1,ISE62RER            INDICATE "RECEIVED-ERROR"   03150000
         CLI   ISE62FCD,ISE62FCD_CD         DO WE STILL HAVE DIRECTION? 03160000
         BNE   RETURN                       RETURN IF NOT, WAIT FOR FMH 03170000
                                                                        03180000
         MVC   GIVECDRH(3),=XL3'019020'                                 03190000
         CLI   ISE62FSC,ISE62FSC_INC        ARE WE IN-CHAIN?            03200000
         BNE   ERRESET                      BRANCH IF NOT               03210000
                                                                        03220000
         $SESS $SESS_SEND_DATA,             SEND NULL RU WITH CD       +03230000
               SESSION=SESSTOKN,                                       +03240000
               AREA=0,                                                 +03250000
               AREALEN=0,                                              +03260000
               POOL=*,              LU6.2 INFO HAS BEEN PLACED HERE    +03270000
               MASK=*,              LU6.2 INFO HAS BEEN PLACED HERE    +03280000
               LUNAME=*,            LU6.2 INFO HAS BEEN PLACED HERE    +03290000
               LOGMODE=*,           LU6.2 INFO HAS BEEN PLACED HERE    +03300000
               RH=GIVECDRH,                                            +03310000
               MF=(E,(RSPLIST))                                         03320000
                                                                        03330000
         LA    R1,=CL14'CD SURRENDERED'                                 03340000
         ST    R1,DESC@                                                 03350000
         MVI   DESCLEN+(L'DESCLEN-1),14                                 03360000
         SR    R1,R1                                                    03370000
         ST    R1,TRACE@                                                03380000
         ST    R1,TRACELEN                                              03390000
         LR    R1,RSPLIST                                               03400000
         BAS   R14,TRACESPL                                             03410000
                                                                        03420000
ERRESET  DS    0H                                                       03430000
                                                                        03440000
         MVI   ISE62FSC,ISE62FSC_BETC                                   03450000
         MVI   ISE62FCD,ISE62FCD_NOCD                                   03460000
         NI    ISES1,255-ISES1DIR           CLEAR THE DIRECTION         03470000
         B     RETURN                       RETURN AND WAIT FOR FMH     03480000
                                                                        03490000
         DROP  X                                                        03500000
                                                                        03510000
NOTSHIP  DS    0H                                                       03520000
                                                                        03530000
*                                                                       03540000
* CHECK FOR CPIC SEND CONFIRMED REQUEST                                 03550000
*---------------------------------------------------------------------- 03560000
                                                                        03570000
         CLI   SPLRSNCD+(L'SPLRSNCD-1),$SESS_RSN_CPIC_SEND_CFMD         03580000
         BNE   NOTCFMD                               BRANCH IF NOT      03590000
                                                                        03600000
X        USING SPLIST,R3                                                03610000
                                                                        03620000
         ICM   R3,15,ISE62RB1       FIRST RECEIVE BUFFER                03630000
         BNP   CPICSERR             BRANCH IF NO BUFFER ?????????       03640000
         LM    R14,R15,X.SPL62RBN   NEXT/PREV RECEIVE BUFFER PTRS       03650000
         ST    R15,SPL62RBP-SPLIST(,R14) SET PREV PTR IN NEXT           03660000
         ST    R14,SPL62RBN-SPLIST(,R15) SET NEXT PTR IN PREV           03670000
                                                                        03680000
         $SESS $SESS_SEND_POSRESP,  SEND A POSITIVE RESPONSE           +03690000
               SESSION=SESSTOKN,                                       +03700000
               RH=X.SPLRH,                                             +03710000
               SEQNO=ISE62CBS,                                         +03720000
               CNTRL=X.SPLCNTRL,                                       +03730000
               AREA=*,              PRESERVE BUFFER ADDRESS            +03740000
               AREALEN=*,           PRESERVE BUFFER LENGTH             +03750000
               POOL=*,              LU6.2 INFO HAS BEEN PLACED HERE    +03760000
               MASK=*,              LU6.2 INFO HAS BEEN PLACED HERE    +03770000
               LUNAME=*,            LU6.2 INFO HAS BEEN PLACED HERE    +03780000
               LOGMODE=*,           LU6.2 INFO HAS BEEN PLACED HERE    +03790000
               MF=(E,(RSPLIST))                                         03800000
                                                                        03810000
         LA    R1,=CL9'+RSP SENT'                                       03820000
         ST    R1,DESC@                                                 03830000
         MVI   DESCLEN+(L'DESCLEN-1),9                                  03840000
         SR    R1,R1                                                    03850000
         ST    R1,TRACE@                                                03860000
         ST    R1,TRACELEN                                              03870000
         LR    R1,RSPLIST                                               03880000
         BAS   R14,TRACESPL                                             03890000
                                                                        03900000
         ICM   R15,15,SPLRETCD      TEST RETURN CODE                    03910000
         BNZ   CPICSERR             BRANCH IF ERROR                     03920000
                                                                        03930000
         MVI   ISE62FRC,ISE62FRC_BETC                                   03940000
         TM    X.SPLRH2,RHCEBI        CEB?                              03950000
         BNO   CFMDNOEB               BRANCH IF NOT                     03960000
         MVI   ISE62FCD,ISE62FCD_NOCD                                   03970000
         MVI   ISE62FBR,ISE62FBR_BETB                                   03980000
                                                                        03990000
CFMDNOEB DS    0H                                                       04000000
                                                                        04010000
         DROP  X                                                        04020000
                                                                        04030000
         LR    R1,R3                ADDR OF "CONFIRMED" SPLIST          04040000
         BAS   R14,FREESPL          RELEASE BUFFER AND SPLIST           04050000
         B     CPICDONE                                                 04060000
                                                                        04070000
NOTCFMD  DS    0H                                                       04080000
                                                                        04090000
*                                                                       04100000
* CHECK FOR CPIC SEND RTS REQUEST                                       04110000
*---------------------------------------------------------------------- 04120000
                                                                        04130000
         CLI   SPLRSNCD+(L'SPLRSNCD-1),$SESS_RSN_CPIC_SEND_RTS          04140000
         BNE   NOTRTS                                BRANCH IF NOT      04150000
                                                                        04160000
         $SESS $SESS_SEND_SIGNAL,                                      +04170000
               SESSION=SESSTOKN,                                       +04180000
               SEQNO=ISE62CBS,                                         +04190000
               AREA=SIGDATA,                                           +04200000
               AREALEN=4,                                              +04210000
               POOL=*,              LU6.2 INFO HAS BEEN PLACED HERE    +04220000
               MASK=*,              LU6.2 INFO HAS BEEN PLACED HERE    +04230000
               LUNAME=*,            LU6.2 INFO HAS BEEN PLACED HERE    +04240000
               LOGMODE=*,           LU6.2 INFO HAS BEEN PLACED HERE    +04250000
               MF=(E,(RSPLIST))                                         04260000
                                                                        04270000
         LA    R1,=CL11'SIGNAL SENT'                                    04280000
         ST    R1,DESC@                                                 04290000
         MVI   DESCLEN+(L'DESCLEN-1),11                                 04300000
         SR    R1,R1                                                    04310000
         ST    R1,TRACE@                                                04320000
         ST    R1,TRACELEN                                              04330000
         LR    R1,RSPLIST                                               04340000
         BAS   R14,TRACESPL                                             04350000
                                                                        04360000
         ICM   R15,15,SPLRETCD      TEST RETURN CODE                    04370000
         BNZ   CPICSERR             BRANCH IF ERROR                     04380000
         B     CPICDONE                                                 04390000
                                                                        04400000
SIGDATA  DC    X'00010001'                                              04410000
                                                                        04420000
NOTRTS   DS    0H                                                       04430000
                                                                        04440000
*                                                                       04450000
* CHECK FOR CPIC SEND ERROR REQUEST                                     04460000
*---------------------------------------------------------------------- 04470000
                                                                        04480000
         CLI   SPLRSNCD+(L'SPLRSNCD-1),$SESS_RSN_CPIC_SEND_ERROR        04490000
         BNE   NOTSERR                                 BRANCH IF NOT    04500000
                                                                        04510000
         OC    ISE62SRQ,ISE62SRQ       IS A REQUEST ACTIVE?             04520000
         BNZ   CPICBUSY                BRANCH IF YES, CAN'T ACCEPT      04530000
         OC    ISE62RRQ,ISE62RRQ       IS A REQUEST ACTIVE?             04540000
         BNZ   CPICBUSY                BRANCH IF YES, CAN'T ACCEPT      04550000
                                                                        04560000
         BAS   R14,COPYSPL             COPY THE SEND ERROR SPLIST       04570000
         ST    R1,ISE62SRQ             AND SAVE THE COPY                04580000
                                                                        04590000
         CLI   ISE62FRC,ISE62FRC_INC   ARE WE IN-CHAIN?                 04600000
         BE    SERRNEG1                BRANCH IF YES                    04610000
         CLI   ISE62FRC,ISE62FRC_PR    ARE WE PENDING-RESPONSE?         04620000
         BE    SERRNEGR                BRANCH IF YES                    04630000
         CLI   ISE62FRC,ISE62FRC_PSR   ARE WE PENDING-SEND-REPLY?       04640000
         BE    SERRNEGR                BRANCH IF YES                    04650000
         CLI   ISE62FCD,ISE62FCD_CD    DO WE HAVE DIRECTION NOW?        04660000
         BE    SERRRELS                IF YES, ALLOW ICPISERR TO RUN    04670000
         OI    ISE62FL1,ISE62NRO       WE NEED TO SEND A NEG RESP       04680000
         B     RETURN                  WAIT FOR SOMETHING TO RESPOND TO 04690000
                                                                        04700000
SERRNEG1 DS    0H                                                       04710000
                                                                        04720000
         MVI   ISE62FRC,ISE62FRC_NRS   SHOW NEG-RESP-SENT               04730000
         B     SERRNEGR                AND SEND THE RESPONSE            04740000
                                                                        04750000
SERRNEGR DS    0H                                                       04760000
                                                                        04770000
         OI    ISE62FL1,ISE62SER       INDICATE SEND ERROR EXCEPTION    04780000
                                                                        04790000
         $SESS $SESS_SEND_NEGRESP,                                     +04800000
               SESSION=SESSTOKN,                                       +04810000
               RH=RH0846,                                              +04820000
               SEQNO=ISE62CBS,                                         +04830000
               SENSE=SNS0846,                                          +04840000
               CNTRL=CNT0846,                                          +04850000
               POOL=*,              LU6.2 INFO HAS BEEN PLACED HERE    +04860000
               MASK=*,              LU6.2 INFO HAS BEEN PLACED HERE    +04870000
               LUNAME=*,            LU6.2 INFO HAS BEEN PLACED HERE    +04880000
               LOGMODE=*,           LU6.2 INFO HAS BEEN PLACED HERE    +04890000
               MF=(E,(RSPLIST))                                         04900000
                                                                        04910000
         LA    R1,=CL9'-RSP SENT'                                       04920000
         ST    R1,DESC@                                                 04930000
         MVI   DESCLEN+(L'DESCLEN-1),9                                  04940000
         SR    R1,R1                                                    04950000
         ST    R1,TRACE@                                                04960000
         ST    R1,TRACELEN                                              04970000
         LR    R1,RSPLIST                                               04980000
         BAS   R14,TRACESPL                                             04990000
                                                                        05000000
         ICM   R15,15,SPLRETCD        TEST RETURN CODE                  05010000
         BNZ   CPICSERR               BRANCH IF ERROR                   05020000
         CLI   ISE62FRC,ISE62FRC_PSR  WAS THE EC RU DEQUEUED?           05030000
         BE    SERRRELS               IF YES...CONTINUE W/ICPISERR      05040000
         L     R15,IL6@DREX           CALL THE EX-RCV ROUTINE           05050000
         BASR  R14,R15                LINK TO ROUTINE                   05060000
         STM   R15,R1,RETREGS         SAVE THE RETURN VALUES            05070000
         B     RETURN                 WAIT FOR DIRECTION                05080000
                                                                        05090000
SERRRELS DS    0H                                                       05100000
                                                                        05110000
         MVI   ISE62FRC,ISE62FRC_BETC CORRECT THE INBOUND CHAIN STATE   05120000
         NI    ISE62FL1,255-ISE62SER  CLEAR THE EXCEPTION STATE         05130000
         L     R1,ISE62SRQ            QUEUED SPLIST COPY                05140000
         BAS   R14,FREESPL            RELEASE THE SPLIST COPY           05150000
         XC    ISE62SRQ,ISE62SRQ      SHOW NO SPLIST QUEUED             05160000
         B     CPICDONE                                                 05170000
                                                                        05180000
RH0846   DC    XL3'039000'                                              05190000
SNS0846  DC    XL4'08460000'                                            05200000
CNT0846  DC    XL3'800000'                                              05210000
                                                                        05220000
NOTSERR  DS    0H                                                       05230000
                                                                        05240000
*                                                                       05250000
* CHECK FOR CPIC RECEIVE REQUEST                                        05260000
*---------------------------------------------------------------------- 05270000
                                                                        05280000
         CLI   SPLRSNCD+(L'SPLRSNCD-1),$SESS_RSN_CPIC_RECEIVE           05290000
         BNE   NOTRCV                                BRANCH IF NOT      05300000
                                                                        05310000
         OC    SPL62PLA,SPL62PLA    IS THIS A "DUMMY" TO TRIGGER RRM?   05320000
         BZ    RCVCALL              BRANCH IF YES                       05330000
                                                                        05340000
         OC    ISE62RRQ,ISE62RRQ    IS THERE A REQUEST ACTIVE?          05350000
         BNZ   CPICBUSY             BRANCH IF YES                       05360000
         BAS   R14,COPYSPL          CREATE A COPY OF THE SPLIST         05370000
         ST    R1,ISE62RRQ          ANCHOR THE CURRENT RECEIVE REQUEST  05380000
                                                                        05390000
RCVCALL  DS    0H                                                       05400000
                                                                        05410000
         L     R15,IL6@DREC         CALL THE RECEIVE COMPLETION RTN     05420000
         BASR  R14,R15              LINK TO ROUTINE                     05430000
         STM   R15,R1,RETREGS       PASS RETURN VALUES                  05440000
         B     RETURN               AND WE ARE DONE                     05450000
                                                                        05460000
NOTRCV   DS    0H                                                       05470000
                                                                        05480000
*                                                                       05490000
* CHECK FOR CPIC BID REQUEST                                            05500000
*---------------------------------------------------------------------- 05510000
                                                                        05520000
         CLI   SPLRSNCD+(L'SPLRSNCD-1),$SESS_RSN_CPIC_BID               05530000
         BNE   NOTBID                                BRANCH IF NOT      05540000
                                                                        05550000
         BAS   R14,COPYSPL          CREATE A COPY OF THE SPLIST         05560000
         ST    R1,ISE62BRQ          ANCHOR THE CURRENT BID REQUEST      05570000
         LR    RSPLIST,R1           USE THE SPLIST COPY                 05580000
                                                                        05590000
         $TASK SETEPB,                                                 +05600000
               ECODE=EC$LU62_BID,                                      +05610000
               ERRET=ERR$TASK,                                         +05620000
               MF=(E,$TASKMFL)      INITIALIZE BID EPB                  05630000
                                                                        05640000
         LR    R3,R1                EPB TOKEN / ADDR                    05650000
                                                                        05660000
         $SESS $SESS_SEND_LUSTAT,                                      +05670000
               SESSION=SESSTOKN,                                       +05680000
               SENSE=BIDSENSE,                                         +05690000
               RH=BIDRH,                                               +05700000
               POOL=*,              LU6.2 INFO HAS BEEN PLACED HERE    +05710000
               MASK=*,              LU6.2 INFO HAS BEEN PLACED HERE    +05720000
               LUNAME=*,            LU6.2 INFO HAS BEEN PLACED HERE    +05730000
               LOGMODE=*,           LU6.2 INFO HAS BEEN PLACED HERE    +05740000
               EPB=(R3),                                               +05750000
               MF=(E,(RSPLIST))                                         05760000
                                                                        05770000
         LA    R1,=CL8'BID SENT'                                        05780000
         ST    R1,DESC@                                                 05790000
         MVI   DESCLEN+(L'DESCLEN-1),8                                  05800000
         SR    R1,R1                                                    05810000
         ST    R1,TRACE@                                                05820000
         ST    R1,TRACELEN                                              05830000
         LR    R1,RSPLIST                                               05840000
         BAS   R14,TRACESPL                                             05850000
         B     RETURN                                                   05860000
                                                                        05870000
*                                                                       05880000
* PROCESS BID REQUEST COMPLETION                                        05890000
*---------------------------------------------------------------------- 05900000
                                                                        05910000
EC_BID   DS    0H                                                       05920000
                                                                        05930000
         LTR   RSPLIST,RSPLIST        WAS THE SPLIST PURGED?            05940000
         BZ    RETURN                 JUST EXIT IF YES                  05950000
                                                                        05960000
         XC    ISE62BRQ,ISE62BRQ    NO PENDING BID REQUEST              05970000
         ICM   R15,15,SPLRETCD      WAS BID A SUCCESS?                  05980000
         BZ    BIDPROC              BRANCH IF YES                       05990000
         CLC   SPLSENSE(2),=X'0814' IS AN RTR COMING?                   06000000
         BNE   BIDERR               BRANCH IF NOT                       06010000
         MVC   ISE62AQE,SPL62AQE    QUEUE TO AQE TO THE SESSION FOR RTR 06020000
         B     BIDFREE              AND EXIT TO WAIT FOR RTR            06030000
                                                                        06040000
BIDERR   DS    0H                                                       06050000
                                                                        06060000
         CLC   SPLSENSE(2),=X'0813' NORMAL BID REJECT (NO RTR?)         06070000
         BE    BIDPROC              BRANCH IF YES                       06080000
         MVI   RETR15+(L'RETR15-1),8 KILL THE SESSION                   06090000
         MVC   RETR0,SPLRETCD                                           06100000
         MVC   RETR1,SPLRSNCD                                           06110000
                                                                        06120000
BIDPROC  DS    0H                                                       06130000
                                                                        06140000
         $VTAMWE L'IWEY5,           LENGTH                             +06150000
               IWECBID              CODE                                06160000
                                                                        06170000
X        USING IWEVTAM,R1                                               06180000
         MVC   X.IWEY5AQE,SPL62AQE  PASS THE AQE ADDRESS                06190000
         ICM   R15,15,SPLRETCD      WAS BID A SUCCESS?                  06200000
         BNZ   BIDRESP              BRANCH IF NOT                       06210000
         OI    X.IY5F1,IY5F1BOK     SHOW BID WAS OK                     06220000
         DROP  X                                                        06230000
                                                                        06240000
BIDRESP  DS    0H                                                       06250000
                                                                        06260000
         L     R14,ISEIVUSR           IVUSER BLOCK ADDRESS              06270000
         LA    R0,IVUWEQ-IVUSER(,R14) QUEUE ADDRESS                     06280000
         BAS   R14,QWE                QUEUE THE WORK ELEMENT            06290000
         LTR   R15,R15                SUCCESSFUL QUEUEING?              06300000
         BZ    BIDFREE                BRANCH IF YES                     06310000
         EX    0,*                                                      06320000
                                                                        06330000
BIDFREE  DS    0H                                                       06340000
                                                                        06350000
         LR    R1,RSPLIST             SPLIST USED FOR BID               06360000
         BAS   R14,FREESPL            RELEASE IT                        06370000
         TM    ISE62FL2,ISE62SWB      SHIP WAITING FOR BID COMPLETION?  06380000
         BNO   RETURN                 JUST RETURN IF NOT                06390000
         L     RSPLIST,ISE62SRQ       TAKE THE SHIP REQUEST             06400000
         NI    ISE62FL2,255-ISE62SWB  NO LONGER WAITING                 06410000
         B     SHIPREST               RESTART THE SHIP                  06420000
                                                                        06430000
BIDSENSE DC    XL4'00060000'                                            06440000
BIDRH    DC    XL3'4B8280'                                              06450000
                                                                        06460000
NOTBID   DS    0H                                                       06470000
                                                                        06480000
*                                                                       06490000
* CHECK FOR CPIC YIELD REQUEST                                          06500000
*---------------------------------------------------------------------- 06510000
                                                                        06520000
         CLI   SPLRSNCD+(L'SPLRSNCD-1),$SESS_RSN_CPIC_YIELD             06530000
         BNE   NOTYLD                                BRANCH IF NOT      06540000
                                                                        06550000
         $SESS $SESS_SEND_LUSTAT,                                      +06560000
               SESSION=SESSTOKN,                                       +06570000
               SENSE=YLDSENSE,                                         +06580000
               RH=YLDRH,                                               +06590000
               POOL=*,              LU6.2 INFO HAS BEEN PLACED HERE    +06600000
               MASK=*,              LU6.2 INFO HAS BEEN PLACED HERE    +06610000
               LUNAME=*,            LU6.2 INFO HAS BEEN PLACED HERE    +06620000
               LOGMODE=*,           LU6.2 INFO HAS BEEN PLACED HERE    +06630000
               MF=(E,(RSPLIST))                                         06640000
                                                                        06650000
         LA    R1,=CL10'YIELD SENT'                                     06660000
         ST    R1,DESC@                                                 06670000
         MVI   DESCLEN+(L'DESCLEN-1),10                                 06680000
         SR    R1,R1                                                    06690000
         ST    R1,TRACE@                                                06700000
         ST    R1,TRACELEN                                              06710000
         LR    R1,RSPLIST                                               06720000
         BAS   R14,TRACESPL                                             06730000
                                                                        06740000
         MVI   ISE62FBR,ISE62FBR_BETB                                   06750000
         MVI   ISE62FCD,ISE62FCD_NOCD                                   06760000
                                                                        06770000
         $VTAMWE L'IWEY4,         LENGTH                               +06780000
               IWECFRES           CODE                                  06790000
                                                                        06800000
X        USING IWEVTAM,R1                                               06810000
Y        USING MDE,R2                                                   06820000
         L     R2,ISE62MDE                                              06830000
         ST    R2,X.IWEY4MDE        PASS THE MDE ADDRESS                06840000
         MVC   X.IWEY4NME,Y.MDENAME PASS THE MODE NAME                  06850000
         MVC   X.IWEY4TKN,ISETK     PASS THE SESSION TOKEN              06860000
         DROP  X                                                        06870000
         DROP  Y                                                        06880000
                                                                        06890000
         L     R14,ISEIVUSR           IVUSER BLOCK ADDRESS              06900000
         LA    R0,IVUWEQ-IVUSER(,R14) QUEUE ADDRESS                     06910000
         BAS   R14,QWE                QUEUE THE WORK ELEMENT            06920000
         B     RETURN                                                   06930000
                                                                        06940000
YLDSENSE DC    XL4'00060000'                                            06950000
YLDRH    DC    XL3'4B9001'                                              06960000
                                                                        06970000
NOTYLD   DS    0H                                                       06980000
                                                                        06990000
*                                                                       07000000
* CHECK FOR CPIC BIS REQUEST/RESPONSE                                   07010000
*---------------------------------------------------------------------- 07020000
                                                                        07030000
         CLI   SPLRSNCD+(L'SPLRSNCD-1),$SESS_RSN_CPIC_BIS_RESPONSE      07040000
         BE    BISRSP                                                   07050000
         CLI   SPLRSNCD+(L'SPLRSNCD-1),$SESS_RSN_CPIC_BIS_REQUEST       07060000
         BNE   NOTBISR                                                  07070000
         MVC   BISRH(3),=XL3'4B9000'                                    07080000
         B     SENDBIS                                                  07090000
                                                                        07100000
BISRSP   DS    0H                                                       07110000
                                                                        07120000
         MVC   BISRH(3),=XL3'4BB000'                                    07130000
         B     SENDBIS                                                  07140000
                                                                        07150000
SENDBIS  DS    0H                                                       07160000
                                                                        07170000
         $SESS $SESS_SEND_BIS,                                         +07180000
               SESSION=SESSTOKN,                                       +07190000
               RH=BISRH,                                               +07200000
               POOL=*,              LU6.2 INFO HAS BEEN PLACED HERE    +07210000
               MASK=*,              LU6.2 INFO HAS BEEN PLACED HERE    +07220000
               LUNAME=*,            LU6.2 INFO HAS BEEN PLACED HERE    +07230000
               LOGMODE=*,           LU6.2 INFO HAS BEEN PLACED HERE    +07240000
               MF=(E,(RSPLIST))                                         07250000
                                                                        07260000
         LA    R1,=CL8'BIS SENT'                                        07270000
         ST    R1,DESC@                                                 07280000
         MVI   DESCLEN+(L'DESCLEN-1),8                                  07290000
         SR    R1,R1                                                    07300000
         ST    R1,TRACE@                                                07310000
         ST    R1,TRACELEN                                              07320000
         LR    R1,RSPLIST                                               07330000
         BAS   R14,TRACESPL                                             07340000
                                                                        07350000
         $VTAMWE L'IWEY3,         LENGTH                               +07360000
               IWECBISR           CODE                                  07370000
                                                                        07380000
X        USING IWEVTAM,R1                                               07390000
Y        USING MDE,R2                                                   07400000
         OI    X.IY3F1,IY3F1SNT     BIS REQ/RSP WAS SENT                07410000
         L     R2,ISE62MDE                                              07420000
         ST    R2,X.IWEY3MDE        PASS THE MDE ADDRESS                07430000
         MVC   X.IWEY3NME,Y.MDENAME PASS THE MODE NAME                  07440000
         MVC   X.IWEY3TKN,ISETK     PASS THE SESSION TOKEN              07450000
         TM    SPLRH1,RHDR2         WAS THIS A BIS RSP?                 07460000
         BNO   *+8                  BRANCH IF NOT                       07470000
         OI    X.IY3F1,IY3F1RSP     BIS RSP WAS SENT                    07480000
         DROP  X                                                        07490000
         DROP  Y                                                        07500000
                                                                        07510000
         L     R14,ISEIVUSR           IVUSER BLOCK ADDRESS              07520000
         LA    R0,IVUWEQ-IVUSER(,R14) QUEUE ADDRESS                     07530000
         BAS   R14,QWE                QUEUE THE WORK ELEMENT            07540000
         B     RETURN                                                   07550000
                                                                        07560000
NOTBISR  DS    0H                                                       07570000
                                                                        07580000
*                                                                       07590000
* CHECK FOR CPIC BID SYNC                                               07600000
*---------------------------------------------------------------------- 07610000
                                                                        07620000
         CLI   SPLRSNCD+(L'SPLRSNCD-1),$SESS_RSN_CPIC_BID_SYNC          07630000
         BNE   NOTBS                                 BRANCH IF NOT      07640000
         B     QSPLIST                               Q IT TO RCV        07650000
                                                                        07660000
NOTBS    DS    0H                                                       07670000
                                                                        07680000
*                                                                       07690000
* CHECK FOR CPIC TP CLEANUP SYNCHRONIZATION REQUEST                     07700000
*---------------------------------------------------------------------- 07710000
                                                                        07720000
         CLI   SPLRSNCD+(L'SPLRSNCD-1),$SESS_RSN_CPIC_CLEANUP           07730000
         BNE   NOTCLUP                          BRANCH IF NOT           07740000
                                                                        07750000
         ICM   R0,15,ISE62SRQ       IS A REQUEST ACTIVE?                07760000
         BNZ   QCLUP                BRANCH IF YES, NEED TO SYNC         07770000
         ICM   R0,15,ISE62RRQ       IS A REQUEST ACTIVE?                07780000
         BNZ   CLUPKILL             BRANCH IF YES, JUST KILL IT         07790000
         B     CPICDONE             POST CLEANUP IF NOTHING ACTIVE      07800000
                                                                        07810000
QCLUP    DS    0H                                                       07820000
                                                                        07830000
         BAS   R14,COPYSPL          CREATE A COPY OF THE SPLIST         07840000
         ST    R1,ISE62CRQ          ANCHOR THE CLEANUP REQUEST          07850000
         B     RETURN               AND EXIT                            07860000
                                                                        07870000
CLUPKILL DS    0H                                                       07880000
                                                                        07890000
         XC    ISE62RRQ,ISE62RRQ    REQUEST NO LONGER EXISTS            07900000
         B     CPICDONE             AND POST CLEANUP TO RUN             07910000
                                                                        07920000
NOTCLUP  DS    0H                                                       07930000
                                                                        07940000
         B     NOTCPIC                                                  07950000
                                                                        07960000
*                                                                       07970000
* COMMON COMPLETION FOR MORE THAN ONE OUTSTANDING REQUEST               07980000
*---------------------------------------------------------------------- 07990000
                                                                        08000000
CPICBUSY DS    0H                                                       08010000
                                                                        08020000
         MVI   CPICPOST+(L'CPICPOST-1),CM_OPERATION_NOT_ACCEPTED        08030000
         B     CPICDONE                                                 08040000
                                                                        08050000
*                                                                       08060000
* COMMON COMPLETION FOR CPIC $SESS FAILURES                             08070000
*---------------------------------------------------------------------- 08080000
                                                                        08090000
CPICSERR DS    0H                                                       08100000
                                                                        08110000
         MVI   CPICPOST+(L'CPICPOST-1),CM_RESOURCE_FAILURE_NO_RETRY     08120000
         MVI   RETR15+(L'RETR15-1),8                                    08130000
         MVC   RETR0,SPLRETCD                                           08140000
         MVC   RETR1,SPLRSNCD                                           08150000
         B     CPICDONE                                                 08160000
                                                                        08170000
*                                                                       08180000
* COMMON COMPLETION FOR SPECIAL CPIC REQUESTS                           08190000
*---------------------------------------------------------------------- 08200000
                                                                        08210000
CPICDONE DS    0H                                                       08220000
                                                                        08230000
         L62POST *SPL62EPB,         ADDRESS OF EPB TO POST             +08240000
               CPICPOST,            ADDRESS OF POST CODE               +08250000
               SPL62ENT,            ADDRESS OF ENTITY TOKEN            +08260000
               L62RETCD,            ADDRESS OF RETURN CODE AREA        +08270000
               MF=(E,L62MFL)                                            08280000
                                                                        08290000
*                                                                       08300000
* RELEASE SPLIST IF WE ARE WORKING WITH A COPY                          08310000
*---------------------------------------------------------------------- 08320000
                                                                        08330000
         TM    FLAG,FLAGCOPY        SPLIST COPY?                        08340000
         BNO   CPICCLUP             RETURN IF NOT                       08350000
         XC    SPLAREA,SPLAREA      DON'T SHOW AN AREA TO FREE (SBUF)   08360000
         XC    SPLAREAL,SPLAREAL    DON'T SHOW AN AREA TO FREE (SBUF)   08370000
         LR    R1,RSPLIST           PASS SPLIST ADDRESS IN R1           08380000
         BAS   R14,FREESPL          RELEASE THE SPLIST                  08390000
         B     CPICCLUP                                                 08400000
                                                                        08410000
*                                                                       08420000
* POST AND RELEASE CLEANUP REQUEST IF APPROPRIATE                       08430000
*---------------------------------------------------------------------- 08440000
                                                                        08450000
CPICCLUP DS    0H                                                       08460000
                                                                        08470000
         ICM   RSPLIST,15,ISE62CRQ  IS A CLEANUP PENDING?               08480000
         BZ    RETURN               EXIT IF NOT                         08490000
         ICM   R0,15,ISE62SRQ       IS SHIP/SERR STILL ACTIVE?          08500000
         BNZ   RETURN               EXIT IF YES                         08510000
         XC    ISE62CRQ,ISE62CRQ    CLEAR THE CLEANUP REQUEST           08520000
         XC    CPICPOST,CPICPOST    SET POSTCODE OF ZERO                08530000
                                                                        08540000
         L62POST *SPL62EPB,         ADDRESS OF EPB TO POST             +08550000
               CPICPOST,            ADDRESS OF POST CODE               +08560000
               SPL62ENT,            ADDRESS OF ENTITY TOKEN            +08570000
               L62RETCD,            ADDRESS OF RETURN CODE AREA        +08580000
               MF=(E,L62MFL)                                            08590000
                                                                        08600000
         XC    SPLAREA,SPLAREA      DON'T SHOW AN AREA TO FREE (SBUF)   08610000
         XC    SPLAREAL,SPLAREAL    DON'T SHOW AN AREA TO FREE (SBUF)   08620000
         LR    R1,RSPLIST           PASS SPLIST ADDRESS IN R1           08630000
         BAS   R14,FREESPL          RELEASE THE SPLIST                  08640000
         B     RETURN                                                   08650000
                                                                        08660000
*---------------------------------------------------------------------- 08670000
* PROCESS RECEIVED RESONSE                                              08680000
*---------------------------------------------------------------------- 08690000
                                                                        08700000
NOTCPIC  DS    0H                                                       08710000
                                                                        08720000
         TM    SPLRH,RHQS             WAS IT A RESPONSE?                08730000
         BNO   RCVREQ                 BRANCH IF NOT                     08740000
         TM    SPLRH1,RHERI           IS IT AN EXCEPTION?               08750000
         BNO   RETURN                 BRANCH IF NOT AND IGNORE IT       08760000
         CLC   SPLSEQNO,ISE62CBS      IS IT FOR THE CURRENT BRACKET?    08770000
         BNE   RETURN                 IGNORE IT IF NOT                  08780000
         CLC   SPLSENSE(2),=XL2'0846' ERROR FMH COMING?                 08790000
         BE    RERROR                 BRANCH IF YES TO PROCESS          08800000
         MVI   RETR15+(L'RETR15-1),12 INPUT SPLIST ERROR                08810000
         MVC   RETR0,SPLRETCD         PASS SPLRETCD                     08820000
         MVC   RETR1,SPLRSNCD         PASS SPLRSNCD                     08830000
         B     RETURN                 NOTHING TO DO NOW                 08840000
                                                                        08850000
*---------------------------------------------------------------------- 08860000
* PROCESS RECEIVED REQUEST                                              08870000
*---------------------------------------------------------------------- 08880000
                                                                        08890000
RCVREQ   DS    0H                                                       08900000
                                                                        08910000
         ICM   R15,15,SPLRETCD                WAS RECEIVE OK?           08920000
         BZ    RCVOK                          BRANCH IF YES             08930000
         CLI   SPLRETCD+(L'SPLRETCD-1),$SESS_RC_PROTOCOL                08940000
         BNE   RCVSPLER                       BRANCH IF NOT             08950000
         MVC   RETR0(4),SPLSENSE              SET THE SENSE INFO        08960000
         MVI   RETR15+(L'RETR15-1),4          SET THE RETURN CODE       08970000
         CLC   RETR0(2),=XL2'0813'            BRK BID REJECT?           08980000
         BNE   RCVSNDNG                       BRANCH IF NOT             08990000
         XC    RETR15,RETR15                  DON'T TELL DRIVER TO STOP 09000000
         TM    ISEF2,ISEF2SLU                 ARE WE THE SLU?           09010000
         BNO   RCVSNDNG                       BRANCH IF NOT             09020000
         OI    SPLSEQNO,X'80'                 HI BIT FOR PLU RESPONSE   09030000
                                                                        09040000
RCVSNDNG DS    0H                                                       09050000
                                                                        09060000
         BAS   R14,SENDNRSP                   GO SEND THE NEG RESP      09070000
         B     RCVEFREE                       RELEASE BUFFER & RETURN   09080000
                                                                        09090000
RCVSPLER DS    0H                                                       09100000
                                                                        09110000
         MVI   RETR15+(L'RETR15-1),12         INPUT SPLIST ERROR        09120000
         MVC   RETR0,SPLRETCD                 PASS SPLRETCD             09130000
         MVC   RETR1,SPLRSNCD                 PASS SPLRSNCD             09140000
                                                                        09150000
RCVEFREE DS    0H                                                       09160000
                                                                        09170000
         ICM   R2,15,SPLAREAL                 IS THERE A DATA AREA?     09180000
         BNP   RETURN                         BRANCH IF NOT             09190000
                                                                        09200000
         $RETSTOR *SPLAREA,                                            +09210000
               OWNER=(RITASK)                                           09220000
                                                                        09230000
         B     RETURN                         AND RETURN TO CALLER      09240000
                                                                        09250000
*---------------------------------------------------------------------- 09260000
* PROCESS RECEIVED DATA REQUEST                                         09270000
*---------------------------------------------------------------------- 09280000
                                                                        09290000
RCVOK    DS    0H                                                       09300000
                                                                        09310000
         TM    SPLCNTRL,RPLDATA   WAS IT A CONTROL REQUEST?             09320000
         BNO   NOTDATA            BRANCH IF YES                         09330000
                                                                        09340000
*                                                                       09350000
* CALL THE RECEIVE DATA PROCESSOR                                       09360000
*---------------------------------------------------------------------- 09370000
                                                                        09380000
QSPLIST  DS    0H                                                       09390000
                                                                        09400000
         BAS   R14,COPYSPL        CREATE AN SPLIST COPY TO PASS IN R1   09410000
         L     R15,IL6@DRU        RECEIVE RU PROCESSOR                  09420000
         BASR  R14,R15            CALL THE SERVICE ROUTINE              09430000
         STM   R15,R1,RETREGS     PASS RETURN VALUES                    09440000
         CLI   RETR15+(L'RETR15-1),4 SEND A NEGATIVE RESPONSE?          09450000
         BNE   RETURN             BRANCH IF NOT                         09460000
         BAS   R14,SENDNRSP       SEND NEG RESP TO THE RECEIVED DATA    09470000
         B     RETURN             AND RETURN TO CALLER                  09480000
                                                                        09490000
*---------------------------------------------------------------------- 09500000
* PROCESS RECEIVED CONTROL REQUEST (NON-DATA RECEIVES)                  09510000
*---------------------------------------------------------------------- 09520000
                                                                        09530000
NOTDATA  DS    0H                                                       09540000
                                                                        09550000
*                                                                       09560000
* UNBIND REQUEST                                                        09570000
*---------------------------------------------------------------------- 09580000
                                                                        09590000
         TM    SPLCNTDC,RPLTUNBD  IS IT UNBIND?                         09600000
         BNO   NOTUNBND           BRANCH IF NOT                         09610000
         BAS   R14,SENDPRSP       CALL THE POSITIVE RESPONSE ROUTINE    09620000
         B     RETURN                                                   09630000
                                                                        09640000
NOTUNBND DS    0H                                                       09650000
                                                                        09660000
*                                                                       09670000
* SIGNAL REQUEST                                                        09680000
*---------------------------------------------------------------------- 09690000
                                                                        09700000
         TM    SPLCNTDC,RPLSIGNL  IS IT SIGNAL?                         09710000
         BNO   NOTSIGNL           BRANCH IF NOT                         09720000
         BAS   R14,SENDPRSP       CALL THE POSITIVE RESPONSE ROUTINE    09730000
         CLC   SPLSEQNO,ISE62CBS  IS THIS SIGNAL FOR CURRENT BRACKET?   09740000
         BNE   QSPLIST            BRANCH IF NOT                         09750000
         OI    ISE62FL1,ISE62SIG  SHOW RTS RECEIVED                     09760000
*                                                                       09770000
* IF RECEIVE NOTIFICATION IS ACTIVE...POST THE USER FOR RTS RECEIVED    09780000
*                                                                       09790000
         TM    ISE62FL1,ISE62NOT  RECEIVE NOTIFICATION ACTIVE?          09800000
         BNO   NOTIFIED           BRANCH IF NOT                         09810000
         NI    ISE62FL1,255-ISE62NOT                                    09820000
         BAS   R14,DISPLOCK       SERIALIZE                             09830000
                                                                        09840000
         $WULOC LOCATE,           FIND THE WORK UNIT                   +09850000
               TOKEN=ISE62ENT,    WORK UNIT TOKEN ADDRESS              +09860000
               USERDATA=WUDATA,   XL16 AREA TO RECEIVE USER DATA       +09870000
               LOCKED=YES,        DISP LOCK LOCALLY ACQUIRED           +09880000
               MF=(E,$WUMFL)      VALIDATE WORK UNIT                    09890000
                                                                        09900000
         LTR   R15,R15            LOCATE SUCCESS?                       09910000
         BNZ   NOTIFIED           BRANCH IF NOT, SKIP THE NOTIFICATION  09920000
         ICM   RRCB,15,ISE62RCB   RCB SHOULD BE VALID                   09930000
         BNP   NOTIFIED           BRANCH IF NO RCB                      09940000
         CLC   RCBID,=CL8'RCB'    IS THE ID CORRECT?                    09950000
         BNE   NOTIFIED           BRANCH IF NOT                         09960000
         ICM   R2,15,RCBNEPB      NOTIFY EPB ADDRESS                    09970000
         BZ    NOTIFIED           BRANCH IF NO EPB                      09980000
         XC    RCBNEPB,RCBNEPB    CLEAR THE NOTIFY EPB ADDRESS          09990000
                                                                        10000000
         L62POST (R2),            ADDRESS OF EPB TO POST               +10010000
               =F'4',             ADDRESS OF POST CODE (RTS RECEIVED)  +10020000
               ISE62ENT,          ADDRESS OF ENTITY TOKEN              +10030000
               L62RETCD,          ADDRESS OF RETURN CODE AREA          +10040000
               MF=(E,L62MFL)                                            10050000
                                                                        10060000
         NI    ISE62FL1,255-ISE62SIG  CLEAR THE RTS RECEIVED INDICATION 10070000
                                                                        10080000
NOTIFIED DS    0H                                                       10090000
                                                                        10100000
         BAS   R14,DISPUNLK                                             10110000
         B     RETURN                                                   10120000
                                                                        10130000
NOTSIGNL DS    0H                                                       10140000
                                                                        10150000
*                                                                       10160000
* LUSTAT REQUEST                                                        10170000
*---------------------------------------------------------------------- 10180000
                                                                        10190000
         TM    SPLCNTDC,RPLLUS    IS IT LUSTAT?                         10200000
         BNO   NOTLUS             BRANCH IF NOT                         10210000
         B     QSPLIST            PLACE IT IN THE RECEIVE QUEUE         10220000
                                                                        10230000
NOTLUS   DS    0H                                                       10240000
                                                                        10250000
*                                                                       10260000
* BIS REQUEST                                                           10270000
*---------------------------------------------------------------------- 10280000
                                                                        10290000
         TM    SPLCNTDC,RPLBIS    IS IT BIS?                            10300000
         BNO   NOTBIS             BRANCH IF NOT                         10310000
         B     QSPLIST            PLACE IT IN THE RECEIVE QUEUE         10320000
                                                                        10330000
NOTBIS   DS    0H                                                       10340000
                                                                        10350000
*                                                                       10360000
* RTR REQUEST                                                           10370000
*---------------------------------------------------------------------- 10380000
                                                                        10390000
         TM    SPLCNTDC,RPLRTR    IS IT RTR?                            10400000
         BNO   NOTRTR             BRANCH IF NOT                         10410000
         B     QSPLIST            PLACE IT IN THE RECEIVE QUEUE         10420000
                                                                        10430000
NOTRTR   DS    0H                                                       10440000
                                                                        10450000
*                                                                       10460000
* UNKNOWN REQUEST RECEIVED.  SEND A NEGATIVE RESPONSE & END SESSION     10470000
*---------------------------------------------------------------------- 10480000
                                                                        10490000
         MVC   RETR0,=X'10010002' "RU NOT DEFINED FOR LU6.2"            10500000
         MVI   RETR15+(L'RETR15-1),4 SET RC TO TRIGGER SESSION TAKEDOWN 10510000
         BAS   R14,SENDNRSP       CALL THE NEGATIVE RESPONSE ROUTINE    10520000
         B     RETURN             DONE                                  10530000
                                                                        10540000
*---------------------------------------------------------------------- 10550000
* RETURN TO CALLER                                                      10560000
*---------------------------------------------------------------------- 10570000
                                                                        10580000
RETURN   DS    0H                                                       10590000
                                                                        10600000
         LM    R15,R1,RETREGS     LOAD RETURN VALUES                    10610000
                                                                        10620000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    10630000
                                                                        10640000
*---------------------------------------------------------------------- 10650000
* SUBROUTINE QWE - QUEUE A WORK ELEMENT TO A GIVEN WORK QUEUE           10660000
*                                                                       10670000
* ENTRY            R14 = RETURN ADDRESS                                 10680000
*                  R1  = WORK ELEMENT ADDRESS                           10690000
*                  R0  = QUEUE ADDRESS                                  10700000
*                                                                       10710000
* RETURNS          R15 = 0 --> QUEUEING WAS SUCCESSFUL                  10720000
*                      = 4 --> QUEUEING FAILED, WORK ELEMENT RELEASED   10730000
*---------------------------------------------------------------------- 10740000
                                                                        10750000
QWE      DS    0H                                                       10760000
                                                                        10770000
         STM   R14,R4,SUB0SAVE    SAVE REGISTERS                        10780000
         LR    R3,R0              SAVE QUEUE ADDRESS                    10790000
         LR    R4,R1              SAVE WORK ELEMENT ADDRESS             10800000
                                                                        10810000
         $VTAMQ (R4),             WORK ELEMENT                         +10820000
               (R3)               QUEUE                                 10830000
                                                                        10840000
         L     R14,SUB0SAVE       RESTORE REGISTERS                     10850000
         LM    R0,R4,SUB0SAVE+8   RESTORE REGISTERS                     10860000
         BR    R14                AND RETURN TO CALLER W/R15            10870000
                                                                        10880000
*---------------------------------------------------------------------- 10890000
* SUBROUTINE: TRACESPL                                                  10900000
*      ENTRY: R1 = ADDRESS OF SPLIST TO BE TRACED                       10910000
*             DESC@ = ADDRESS OF TRACE POINT DESCRIPTION                10920000
*             DESCLEN = LENGTH OF TRACE POINT DESCRIPTION               10930000
*             TRACE@ = ADDRESS OF ADDITIONAL DATA TO BE TRACED          10940000
*             TRACELEN = LENGTH OF ADDITIONAL DATA TO BE TRACED         10950000
*---------------------------------------------------------------------- 10960000
                                                                        10970000
TRACESPL DS     0H                                                      10980000
                                                                        10990000
         STM   R14,R12,SUB1SAVE                                         11000000
         LR    RSPLIST,R1               SPLIST TO BE TRACED             11010000
         L     R2,DESC@                 TRACE POINT DESC. ADDRESS       11020000
         L     R3,TRACE@                ADDITIONAL DATA   ADDRESS       11030000
                                                                        11040000
         L62TRCS (RSPLIST),                    @ SPLIST                +11050000
               (RISESS),                       @ ISESS                 +11060000
               (R2),                           @ DESCRIPTION           +11070000
               DESCLEN,                        @ DESCRIPTION LEN       +11080000
               (R3),                           @ ADDITIONAL DATA       +11090000
               TRACELEN,                       @ ADDITIONAL DATA LEN   +11100000
               L62RETCD,                       @ RETURN CODE AREA      +11110000
               MF=(E,L62MFL)                                            11120000
                                                                        11130000
         LM    R14,R12,SUB1SAVE                                         11140000
         BR    R14                                                      11150000
                                                                        11160000
*---------------------------------------------------------------------- 11170000
* SUBROUTINE: FREESPL                                                   11180000
*      ENTRY: R1 = ADDRESS OF SPLIST TO BE RELEASED                     11190000
*---------------------------------------------------------------------- 11200000
                                                                        11210000
FREESPL  DS     0H                                                      11220000
                                                                        11230000
         STM   R14,R12,SUB0SAVE                                         11240000
         LR    R3,R1                     SPLIST ADDRESS                 11250000
         ICM   R2,15,SPLAREAL-SPLIST(R3) IS THERE A DATA AREA?          11260000
         BNP   FSPLIST                   BRANCH IF NOT                  11270000
         L     R4,SPLAREA-SPLIST(,R3)    BUFFER ADDRESS                 11280000
                                                                        11290000
         $RETSTOR (R4),                                                +11300000
               OWNER=(RITASK)                                           11310000
                                                                        11320000
FSPLIST  DS    0H                                                       11330000
                                                                        11340000
         $RETSTOR (R3),                                                +11350000
               OWNER=(RITASK)                                           11360000
                                                                        11370000
         LM    R14,R12,SUB0SAVE                                         11380000
         BR    R14                                                      11390000
                                                                        11400000
*---------------------------------------------------------------------- 11410000
* SUBROUTINE: COPYSPL                                                   11420000
*      ENTRY: RSPLIST = ADDRESS OF SPLIST TO BE COPIED                  11430000
*       EXIT: R1      = ADDRESS OF THE COPY                             11440000
*---------------------------------------------------------------------- 11450000
                                                                        11460000
COPYSPL  DS     0H                                                      11470000
                                                                        11480000
         STM   R14,R12,SUB0SAVE                                         11490000
                                                                        11500000
         $GETSTOR L'SPL,                                               +11510000
               LOC=ANY,                                                +11520000
               OWNER=(RITASK)                                           11530000
                                                                        11540000
         LR    R2,R1                ADDRESS OF SPL COPY                 11550000
         LA    R3,L'SPL             SIZE OF SPL                         11560000
         LR    R14,RSPLIST          ORIGINAL SPL                        11570000
         LR    R15,R3               SIZE OF SPL                         11580000
         MVCL  R2,R14               COPY THE SPL                        11590000
                                                                        11600000
         LM    R14,R0,SUB0SAVE                                          11610000
         LM    R2,R12,SUB0SAVE+16                                       11620000
         BR    R14                                                      11630000
                                                                        11640000
*---------------------------------------------------------------------- 11650000
* SUBROUTINE: SENDPRSP                                                  11660000
*---------------------------------------------------------------------- 11670000
                                                                        11680000
SENDPRSP DS     0H                                                      11690000
                                                                        11700000
         TM    SPLRH0,RHQSRSP       WAS A RESPONSE SENT ALREADY?        11710000
         BOR   R14                  BRANCH IF YES                       11720000
                                                                        11730000
         STM   R14,R12,SUB0SAVE                                         11740000
                                                                        11750000
         $SESS $SESS_SEND_POSRESP,  SEND A RESPONSE AS NEEDED          +11760000
               SESSION=SESSTOKN,                                       +11770000
               AREA=*,              PRESERVE DATA ADDRESS              +11780000
               AREALEN=*,           PRESERVE DATA LENGTH               +11790000
               RH=*,                                                   +11800000
               SEQNO=*,                                                +11810000
               CNTRL=*,                                                +11820000
               SENSE=*,                                                +11830000
               MF=(E,(RSPLIST))                                         11840000
                                                                        11850000
         LA    R1,=CL9'+RSP SENT'                                       11860000
         ST    R1,DESC@                                                 11870000
         MVI   DESCLEN+(L'DESCLEN-1),9                                  11880000
         SR    R1,R1                                                    11890000
         ST    R1,TRACE@                                                11900000
         ST    R1,TRACELEN                                              11910000
         LR    R1,RSPLIST                                               11920000
         BAS   R14,TRACESPL                                             11930000
                                                                        11940000
         ICM   R15,15,SPLRETCD      TEST RETURN CODE                    11950000
         BNZ   ERR$RESP             BRANCH IF ERROR                     11960000
                                                                        11970000
         LM    R14,R12,SUB0SAVE                                         11980000
         BR    R14                                                      11990000
                                                                        12000000
*---------------------------------------------------------------------- 12010000
* SUBROUTINE: SENDNRSP                                                  12020000
*---------------------------------------------------------------------- 12030000
                                                                        12040000
SENDNRSP DS     0H                                                      12050000
                                                                        12060000
         TM    SPLRH0,RHQSRSP       WAS A RESPONSE SENT ALREADY?        12070000
         BOR   R14                  BRANCH IF YES                       12080000
                                                                        12090000
         STM   R14,R12,SUB0SAVE                                         12100000
                                                                        12110000
         $SESS $SESS_SEND_NEGRESP,  SEND A NEGATIVE RESPONSE           +12120000
               SESSION=SESSTOKN,                                       +12130000
               AREA=*,              PRESERVE DATA ADDRESS              +12140000
               AREALEN=*,           PRESERVE DATA LENGTH               +12150000
               RH=*,                                                   +12160000
               SEQNO=*,                                                +12170000
               CNTRL=*,                                                +12180000
               SENSE=RETR0,                                            +12190000
               MF=(E,(RSPLIST))                                         12200000
                                                                        12210000
         LA    R1,=CL9'-RSP SENT'                                       12220000
         ST    R1,DESC@                                                 12230000
         MVI   DESCLEN+(L'DESCLEN-1),9                                  12240000
         SR    R1,R1                                                    12250000
         ST    R1,TRACE@                                                12260000
         ST    R1,TRACELEN                                              12270000
         LR    R1,RSPLIST                                               12280000
         BAS   R14,TRACESPL                                             12290000
                                                                        12300000
         ICM   R15,15,SPLRETCD      TEST RETURN CODE                    12310000
         BNZ   ERR$RESP             BRANCH IF ERROR                     12320000
                                                                        12330000
         LM    R14,R12,SUB0SAVE                                         12340000
         BR    R14                                                      12350000
                                                                        12360000
*---------------------------------------------------------------------- 12370000
*   SUBROUTINE: OBTAIN DISP GLOBAL LOCK                                 12380000
*---------------------------------------------------------------------- 12390000
                                                                        12400000
DISPLOCK DS    0H                                                       12410000
                                                                        12420000
         TM    FLAG,FLAGDLCK        WAS THE LOCK ALREADY OBTAINED?      12430000
         BOR   R14                  RETURN IF YES                       12440000
         STM   R14,R2,SUB0SAVE      SAVE CALLER'S REGISTERS             12450000
                                                                        12460000
         $SER  OBTAIN,                                                 +12470000
               DISP                                                     12480000
                                                                        12490000
         C     R15,=F'4'            WAS LOCK ALREADY HELD?              12500000
         BNE   DISPLOEX             BRANCH IF NOT                       12510000
         OI    FLAG,FLAGDLKD        REMEMBER LOCK HELD ON ENTRY         12520000
                                                                        12530000
DISPLOEX DS    0H                                                       12540000
                                                                        12550000
         OI    FLAG,FLAGDLCK        REMEMBER LOCK IS HELD               12560000
         LM    R14,R2,SUB0SAVE      RESTORE CALLER'S REGISTERS          12570000
         BR    R14                  RETURN                              12580000
                                                                        12590000
*---------------------------------------------------------------------- 12600000
*   SUBROUTINE: RELEASE DISP GLOBAL LOCK                                12610000
*---------------------------------------------------------------------- 12620000
                                                                        12630000
DISPUNLK DS    0H                                                       12640000
                                                                        12650000
         TM    FLAG,FLAGDLCK        IS LOCK HELD?                       12660000
         BNOR  R14                  BRANCH IF NOT                       12670000
         TM    FLAG,FLAGDLKD        WAS LOCK HELD ON ENTRY?             12680000
         BOR   R14                  DON'T RELEASE IF IT WAS             12690000
         STM   R14,R2,SUB0SAVE      SAVE CALLER'S REGISTERS             12700000
                                                                        12710000
         $SER  RELEASE,                                                +12720000
               DISP                                                     12730000
                                                                        12740000
         NI    FLAG,255-FLAGDLCK    SHOW LOCK NOT HELD                  12750000
         LM    R14,R2,SUB0SAVE      RESTORE CALLER'S REGISTERS          12760000
         BR    R14                  RETURN                              12770000
                                                                        12780000
*---------------------------------------------------------------------- 12790000
* ERROR ROUTINES                                                        12800000
*---------------------------------------------------------------------- 12810000
                                                                        12820000
ERR$RESP DS    0H                                                       12830000
                                                                        12840000
         CLI   SPLRETCD+(L'SPLRETCD-1),$SESS_RC_CANCELED                12850000
         BE    RETURN                                                   12860000
         EX    0,*                  HALT HERE                           12870000
                                                                        12880000
*        $ABEND ABE_VTDIAG,                                            +12890000
               SCOPE=PCB,                                              +12900000
               TITLE='$SESS ERR'                                        12910000
                                                                        12920000
ERR$TASK DS    0H                                                       12930000
                                                                        12940000
         EX    0,*                  HALT HERE                           12950000
                                                                        12960000
*        $ABEND ABE_VTDIAG,                                            +12970000
               SCOPE=PCB,                                              +12980000
               TITLE='$TASK ERR'                                        12990000
                                                                        13000000
*---------------------------------------------------------------------- 13010000
*  CONSTANTS AND LITERALS                                               13020000
*---------------------------------------------------------------------- 13030000
                                                                        13040000
         LTORG ,                                                        13050000
         PRINT NOGEN                                                    13060000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                13070000
         ISTRH ,                  VTAM REQUEST HEADER                   13080000
         ISTDBIND ,               VTAM BIND IMAGE                       13090000
         TRACODES ,               INTEGRATOR TRACE CODE EQUATES         13100000
         ICVT  ,                  INTEGRATOR CVT                        13110000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   13120000
         IVUSER ,                 INTEGRATOR IVUSER BLOCK               13130000
         ISESS ,                  INTEGRATOR ISESS BLOCK                13140000
         ITASK ,                  INTEGRATOR TASK BLOCK                 13150000
         IRPL ,                   INTEGRATOR IRPL  BLOCK                13160000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          13170000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       13180000
         EVCODES ,                INTEGRATOR EVENT CODES                13190000
         ABCODES ,                INTEGRATOR $ABEND CODES               13200000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     13210000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        13220000
         $VTAM DSECT=YES          INTEGRATOR $VTAM SERVICES             13230000
         $SESS DSECT=YES          INTEGRATOR $SESS SERVICES             13240000
         SBUF  DSECT=YES          INTEGRATOR SBUF  SERVICES             13250000
         $WULOC DSECT=YES         INTEGRATOR $WULOC SERVICES            13260000
         $TASK DSECT=YES          INTEGRATOR $TASK SERVICES             13270000
         END   ,                                                        13280000
