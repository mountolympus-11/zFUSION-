IRGNTST1 TITLE 'IRGNTST1 - GENERATE REGION TILING AND VERIFY'           00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: IRGNTST1 - GENERATE REGION TILING AND VERIFY                 00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THIS ROUTINE IS USED TO DRIVE REGION / IMAGE VALIDATION            00080000
*    TO ENSURE THAT ALL REQUIRED REGIONS CAN BE MATERIALIZED            00090000
*    AGAINST THE ASSOCIATED MODEL IMAGE.  THE IMAGE IDENTIFIED          00100000
*    BY THE GIVEN STN IS LOADED AND TILED. IRGNVERF IS INVOKED          00110000
*    TO IDENTIFY THOSE REGIONS THAT HAVE INSTANCES ON THE MODEL         00120000
*    IMAGE.  THEN, IRGNANAL IS CALLED TO JOURNAL REGION                 00130000
*    DEFINITION ERRORS AND WARNINGS.  FINALLY, THE MODEL IMAGE          00140000
*    AND ITS TILING ARE DISCARDED.                                      00150000
*                                                                       00160000
*                                                                       00170000
* ON ENTRY:                                                             00180000
*                                                                       00190000
*    R1  CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED           00200000
*        AS FOLLOWS                                                     00210000
*                                                                       00220000
*           +00 - ADDR OF PROJECT DESCRIPTOR BLOCK (IPROJ)              00230000
*           +04 - ADDR OF STN REPRESENTING IMAGE SCREEN / SET           00240000
*                                                                       00250000
* ON EXIT:                                                              00260000
*                                                                       00270000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                     00280000
*                                                                       00290000
*           RC00 - NO IMAGE / REGION CONFLICTS ENCOUNTERED              00300000
*                                                                       00310000
*           RC04 - REGION/IMAGE WARNINGS OR ERRORS NOTED                00320000
*                                                                       00330000
*                  RSN04 - WARNINGS ISSUED                              00340000
*                  RSN08 - ERRORS ENCOUNTERED                           00350000
*                                                                       00360000
*           RC08 - UNABLE TO RETRIEVE SYSIMAGE ENTRY                    00370000
*                                                                       00380000
*           RC12 - ERROR CONSTRUCTING NVIMAGE                           00390000
*                                                                       00400000
**<DOC-OFF>****************************************************         00410000
                                                                        00420000
         EJECT ,                                                        00430000
***************************************************************         00440000
*                                                                       00450000
* MAINTENANCE:                                                          00460000
*                                                                       00470000
*   12/18/93  R. TURGEON                                                00480000
*             INITIAL VERSION                                           00490000
*                                                                       00500000
***************************************************************         00510000
                                                                        00520000
         EJECT                                                          00530000
         #WORK ,                                                        00540000
                                                                        00550000
RETCODE  DS    F                  RETURN CODE                           00560000
RSNCODE  DS    F                  REASON CODE                           00570000
                                                                        00580000
         #ENDWORK ,                                                     00590000
                                                                        00600000
         EJECT                                                          00610000
         REGION ,                 REGION DEFINITIONS                    00620000
                                                                        00630000
         EJECT                                                          00640000
         NAV   ,                  NAVIGATION / IMAGE STRUCTURES         00650000
                                                                        00660000
         EJECT                                                          00670000
         IPROJ ,                  PROJECT CONTROL                       00680000
                                                                        00690000
         EJECT                                                          00700000
         ICATALOG REGIONS         SYSREGIONS CATALOG FORMAT             00710000
                                                                        00720000
         EJECT                                                          00730000
         EQUS  ,                  GENERAL EQUATES                       00740000
                                                                        00750000
         EJECT ,                                                        00760000
IRGNTST1 #ENTER IRGNTST1,PREG=(R8)                                      00770000
                                                                        00780000
         USING ITASK,R10          STDENV                                00790000
         L     R9,TSKPCBC         PROCESS MODE                          00800000
         USING IPCB,R9                                                  00810000
                                                                        00820000
*--------------------------------------------------------------         00830000
*   ACCEPT PASSED PARAMETERS INCLUDING MODEL STN                        00840000
*--------------------------------------------------------------         00850000
         L     R7,0(,R8)          LOCATE PROJECT                        00860000
         USING IPROJ,R7           LIFE OF FUNCTION ADDRESSABILITY       00870000
         L     R4,4(,R8)          MODEL STN                             00880000
         USING NVSTN,R4           LIFE OF FUNCTION ADDRESSABILITY       00890000
                                                                        00900000
*--------------------------------------------------------------         00910000
*   LOAD THE IMAGE CONSTRUCTING NVIMAGE HANDLE TO IMAGE BUFFER          00920000
*--------------------------------------------------------------         00930000
         $CLINK FUNC=IMGLOAD,                                          X00940000
               (STRUCT*,PCBSTG),                                       X00950000
               (STRUCT*,NVSTN)                                          00960000
                                                                        00970000
         C     R15,=A(RC04)       ANALYZE RETURN CODE                   00980000
         BL    CONTINUE           IMAGE LOADED AND TILED                00990000
         BE    RETURN             NO ASSOCIATED IMAGE                   01000000
         ST    R15,RETCODE        IDENTIFY MATERIALIZATION ERROR        01010000
         B     RETURN             END                                   01020000
                                                                        01030000
CONTINUE DS    0H                                                       01040000
                                                                        01050000
         EJECT                                                          01060000
***************************************************************         01070000
*                                                                       01080000
*   IDENTIFY USE OF SELECTED REGION TYPES DEFINED ON THIS IMAGE         01090000
*                                                                       01100000
***************************************************************         01110000
         L     R5,NVSIMGA         IMAGE STRUCTURE BUILT BY IMGLOAD      01120000
         USING NVIMAGE,R5         ESTABLISH ADDRESSABILITY              01130000
         L     R6,NVIRGNTR        REGION (DEFINITION) TREE HDR          01140000
         USING RGNTREE,R6         TEMP ADDRESSABILITY                   01150000
                                                                        01160000
         LA    R2,RGTROOT         HIGHEST LEVEL RGNTRY                  01170000
         USING RGNTRY,R2          ADDRESSABILITY                        01180000
                                                                        01190000
SCANRGNS DS    0H                                                       01200000
         ICM   R15,15,RGNSRGN     LOCATE REGION DEFINITION              01210000
         BZ    SCANRADV           SKIP IF NO ASSOCIATION                01220000
         USING SYSRGN,R15         SYSREGION                             01230000
                                                                        01240000
         CLI   SRAEXCP,FALSE      EXCEPTION REGION?                     01250000
         BE    *+8                SKIP IF NOT                           01260000
         OI    NVSATTRS,NVSAERGN  ELSE INDICATE EXCP RGNS DEFINED       01270000
                                                                        01280000
*--------------------------------------------------------------         01290000
*   EXAMINE ALL REGION DEFINITIONS                                      01300000
*--------------------------------------------------------------         01310000
SCANRADV DS    0H                 ADVANCE TO NEXT REGION TREE NODE      01320000
         ICM   R2,15,RGNNEXT      UNORDERED NODE LIST                   01330000
         BNZ   SCANRGNS           SEARCH ALL NODES                      01340000
         DROP  R2,R15             RGNTRY, RGNTREE, SYSRGN               01350000
                                                                        01360000
         EJECT ,                                                        01370000
***************************************************************         01380000
*                                                                       01390000
*   IDENTIFY REGIONS INSTANTIATED ON THIS IMAGE                         01400000
*                                                                       01410000
***************************************************************         01420000
         LA    R0,RGTROOT         HIGHEST LEVEL RGNTRY                  01430000
         L     R1,NVIRECRT        REGION INSTANCE TREE (RECENTRY)       01440000
                                                                        01450000
         @CALL IRGNVERF,CTYPE=CVT IDENTIFY ALL REGION INSTANCES         01460000
                                                                        01470000
*--------------------------------------------------------------         01480000
*   REGION VALIDATION                                                   01490000
*--------------------------------------------------------------         01500000
         @CALL IRGNANAL,(0,RGTROOT,NVSTSSN,NVSTNAME,PRJEXMCQ,PRJEXSTG),X01510000
               CTYPE=CVT,                                              X01520000
               MF=(E,MFE_LIST)                                          01530000
                                                                        01540000
         ST    R15,RSNCODE        RETURN CODE IS LOCAL REASON CODE      01550000
         LTR   R15,R15            WARNINGS OR ERRORS NOTE?              01560000
         BZ    *+12               SKIP IF NOT                           01570000
         LA    R15,RC04           INDICATE RGN/IMG RELATIONSHIP ISSUES  01580000
         ST    R15,RETCODE        POST RETCODE                          01590000
         DROP  R6,R5              RGNTREE, NVIMAGE                      01600000
                                                                        01610000
*--------------------------------------------------------------         01620000
*   RELEASE IMAGE HANDLE AND BUFFER                                     01630000
*--------------------------------------------------------------         01640000
         $CLINK FUNC=IMGFREE,                                          X01650000
               (STRUCT*,PCBSTG),                                       X01660000
               (STRUCT**,NVSIMGA)                                       01670000
                                                                        01680000
*--------------------------------------------------------------         01690000
*   RETURN TO CALLER                                                    01700000
*--------------------------------------------------------------         01710000
RETURN   DS    0H                                                       01720000
         L     R15,RETCODE        RETURN CODE                           01730000
         L     R0,RSNCODE         REASON CODE                           01740000
                                                                        01750000
         #EXIT ,                                                        01760000
                                                                        01770000
         EJECT ,                                                        01780000
***************************************************************         01790000
*                                                                       01800000
*   LOCAL READ ONLY DATA AREAS, ETC.                                    01810000
*                                                                       01820000
***************************************************************         01830000
         LTORG ,                                                        01840000
                                                                        01850000
         PRINT OFF                                                      01860000
         ICVT  ,                                                        01870000
         ITASK ,                                                        01880000
         IPCB  ,                                                        01890000
                                                                        01900000
         END   ,                                                        01910000
