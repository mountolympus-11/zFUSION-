IHXPCAPI TITLE 'HOST XPORT C-LANGUAGE API'                              00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE:  IHXPCAPI - HOST XPORT C-LANGUAGE API                        00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*   THIS MODULE CONTAIN THE FUNCTIONS REQUIRED TO COMMUNICATE           00080000
*   WITH HOST XPORT FACILITY FROM A C-LANGUAGE PROGRAM.                 00090000
*                                                                       00100000
* FUNCTIONS:                                                            00110000
*                                                                       00120000
*   XPSEND  - SEND REQ/RESP PACKET TO CLIENT LOGICAL SESSION            00130000
*                                                                       00140000
* ON ENTRY:                                                             00150000
*                                                                       00160000
*   R1 CONTAINS THE ADDRESS OF THE PARAMETER LIST FOLLOWING             00170000
*   THE SAS/C STANDARD LINKAGE CONVENTIONS.                             00180000
*                                                                       00190000
* ON EXIT:                                                              00200000
*                                                                       00210000
*   R15 CONTAINS THE RETURN INFO AS DOCUMENTED IN THE                   00220000
*   FUNCTION PROLOG.                                                    00230000
*                                                                       00240000
**<DOC-OFF>*****************************************************        00250000
                                                                        00260000
         EJECT ,                                                        00270000
****************************************************************        00280000
*                                                                       00290000
* MAINTENANCE:                                                          00300000
*                                                                       00310000
*   07/07/93 RON COLMONE                                                00320000
*            INITIAL VERSION                                            00330000
*                                                                       00340000
****************************************************************        00350000
         EJECT ,                                                        00360000
         $XPSEND DSECT=YES        PROCESS SERVICES REQ BLOCK            00370000
                                                                        00380000
         EJECT ,                                                        00390000
         EQUS  ,                  GENERAL EQUATES                       00400000
                                                                        00410000
         EJECT ,                                                        00420000
         COPY  CRAB               "C"  RUNTIME ANCHOR BLOCK             00430000
         USING CRAB,R12           LIFETIME ADDRESSABILITY               00440000
                                                                        00450000
         EJECT ,                                                        00460000
         COPY  DSA                DYNAMIC SAVE AREA                     00470000
FWORD    DS    F                  FULLWORD WORKAREA                     00480000
$XPSNDPL $XPSEND MF=L             $XPSEND PLIST                         00490000
DSALEN   EQU   *-DSA              LENGTH OF DSA                         00500000
                                                                        00510000
         EJECT ,                                                        00520000
**<DOC-ON>******************************************************        00530000
*                                                                       00540000
* FUNCTION: XPSEND - SEND REQUEST/RESPONSE PACKET TO CLIENT             00550000
*                                                                       00560000
* DESCRIPTION:                                                          00570000
*                                                                       00580000
*    THIS FUNCTION INVOKES THE HOST XPORT XPSEND SERVICE TO             00590000
*    TRANSFER DATA TO A CLIENT'S LOGICAL SESSION.  INITIALLY,           00600000
*    THE STANDARD ENVIRONMENT IS RESTORED AND THE $XPSEND               00610000
*    MACRO IS USED TO QUEUE A SEND REQUEST (MSG) TO THE PLU             00620000
*    DRIVER PROCESS AND POST ASSOCIATED MESSAGE EPB.  THE               00630000
*    SEND REQUEST IS INVOKED WITH WAIT=YES THEREFORE THE                00640000
*    ACTIVE PROCESS IS WAITED UNTIL THE SEND REQUEST COMPLETES.         00650000
*    THE RETURN CODE FROM XPSEND SERVICE IS RETURNED TO THE             00660000
*    CALLER OF THIS REQUEST.  A NEGATIVE RETURN CODE FROM THIS          00670000
*    SERVICES INDICATES THAT THE PROCESS HAS BEEN REQUESTED             00680000
*    TERMINATE.                                                         00690000
*                                                                       00700000
* ENTRY:    R1 CONTAINS ADDR OF FOLLOWING PARAMETER LIST:               00710000
*                                                                       00720000
*               +00  - XPORT LOGICAL SESSION HANDLE                     00730000
*               +04  - ADDRESS OF BUFFER TO SEND                        00740000
*               +08  - LENGTH  OF BUFFER TO SEND                        00750000
*                                                                       00760000
* EXIT:     R15 CONTAINS RETURN VALUE AS FOLLOWS:                       00770000
*                 0  - XPSEND COMPLETED SUCCESSFULLY                    00780000
*                >0  - RETURN CODE FROM XPSEND FUNCTION                 00790000
*                -4  - STOP   EVENT RECEIVED                            00800000
*                -8  - CANCEL EVENT RECEIVED                            00810000
*                                                                       00820000
**<DOC-OFF>*****************************************************        00830000
                                                                        00840000
IHXPCAPI CSECT ,                                                        00850000
XPSEND   CENTRY DSA=DSALEN                                              00860000
         USING DSA,R13            ADDRESSABILITY                        00870000
                                                                        00880000
         LM    R3,R5,0(R1)        RETRIVED PASSED PARMS                 00890000
                                                                        00900000
*---------------------------------------------------------------        00910000
*  RESTORE STANDARD ENVIRONMENT                                         00920000
*---------------------------------------------------------------        00930000
         @RESTENV ,                                                     00940000
         USING ICVT,R11           ADDRESSABILITY                        00950000
         USING ITASK,R10          ADDRESSABILITY                        00960000
                                                                        00970000
*---------------------------------------------------------------        00980000
*  ISSUE XPSEND REQUEST TO TRANSFER PACKET TO CLIENT'S                  00990000
*  LOGICAL SESSION.                                                     01000000
*---------------------------------------------------------------        01010000
         $XPSEND (R4),(R5),       SEND XPORT REQ/RESP PACKET           +01020000
               SESSHNDL=(R3),                                          +01030000
               WAIT=YES,                                               +01040000
               CANCEL=ERR_CNCL,                                        +01050000
               STOP=ERR_STOP,                                          +01060000
               MF=(E,$XPSNDPL)                                          01070000
                                                                        01080000
         B     SND_EXIT           RETURN                                01090000
                                                                        01100000
         EJECT ,                                                        01110000
*---------------------------------------------------------------        01120000
*  ERRORS                                                               01130000
*---------------------------------------------------------------        01140000
ERR_STOP DS    0H                                                       01150000
         LA    R15,RC04           STOP RETURN CODE                      01160000
         LNR   R15,R15            INDICATE TERMINATION REQUEST          01170000
         B     SND_EXIT           RETURN                                01180000
                                                                        01190000
ERR_CNCL DS    0H                                                       01200000
         LA    R15,RC08           CANCEL RETURN CODE                    01210000
         LNR   R15,R15            INDICATE TERMINATION REQUEST          01220000
         B     SND_EXIT           RETURN                                01230000
                                                                        01240000
*---------------------------------------------------------------        01250000
*  RETURN                                                               01260000
*---------------------------------------------------------------        01270000
SND_EXIT DS    0H                                                       01280000
         CEXIT RC=(R15)           RETURN                                01290000
                                                                        01300000
         EJECT ,                                                        01310000
*---------------------------------------------------------------        01320000
*  LITERALS AND CONSTANTS                                               01330000
*---------------------------------------------------------------        01340000
         LTORG ,                                                        01350000
                                                                        01360000
         PRINT NOGEN                                                    01370000
         ICVT  ,                                                        01380000
         ITASK ,                                                        01390000
         IPCB  ,                                                        01400000
         IUSER ,                                                        01410000
         IHAPSA ,                                                       01420000
         IKJTCB ,                                                       01430000
         CVT   DSECT=YES,LIST=NO                                        01440000
         PRINT GEN                                                      01450000
                                                                        01460000
         END   ,                                                        01470000
