ITMRSERV TITLE 'ITMRSERV - $TIMER Services'                             00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ITMRSERV - $TIMER Services                                   00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine provides $TSEND linkage to the $TIMER service         00080000
*    manager residing in $INTMAIN.  The PTIMP parameter list            00090000
*    generated by the $TIMER macro is completed and routed to           00100000
*    $INTMAIN via $TSEND.  A discussion of the services can be          00110000
*    found in the $TIMER macro prolog.                                  00120000
*                                                                       00130000
*    For SET requests, a TQE is constructed and a $TIMER ID is          00140000
*    assigned.  The PTIMP, TQE, and ID are all forwarded to the         00150000
*    $TIMER manager. A $TIMER ID is a unique eight byte string          00160000
*    composed as follows:                                               00170000
*                                                                       00180000
*       +00(1) - Queue identifier in the range of X'01'-X'10'           00190000
*       +01(7) - Unique timer handle                                    00200000
*                                                                       00210000
*    $TIMER requests can be processed synchronously or                  00220000
*    asynchronously with with respect to the timer services             00230000
*    manager residing in $INTMAIN.  When $TIMER SYNC=YES is             00240000
*    specified, control does not return to the caller until the         00250000
*    timer services manager completes the requested service.            00260000
*    Non-zero return codes generated by the manager result in           00270000
*    RC08.  SYNC=NO requests never generate that return code.           00280000
*    In general, SYNC=NO should be used unless special                  00290000
*    circumstances dictate otherwise.                                   00300000
*                                                                       00310000
*    For SET requests, notification of the designated interval          00320000
*    can be made via ($TSEND) message or EPB as determined by           00330000
*    the $TIMER SET,NOTIFY= operand.  When NOTIFY=EPB is coded,         00340000
*    an XEPB is initialized by this service.                            00350000
*                                                                       00360000
*                                                                       00370000
* NOTES:                                                                00380000
*                                                                       00390000
*    Task and process mode callers are supported.                       00400000
*                                                                       00410000
*                                                                       00420000
* ON ENTRY:                                                             00430000
*                                                                       00440000
*    R1  contains the address of a parameter list described by          00450000
*        the PTIMP mapping expanded by $TIMER DSECT=YES                 00460000
*                                                                       00470000
*                                                                       00480000
* ON EXIT:                                                              00490000
*                                                                       00500000
*    R15 contains one of the following return codes returned            00510000
*        from the $TIMER manager                                        00520000
*                                                                       00530000
*        RC00 - Request forwarded to $TIMER manager.  The TID=          00540000
*               is synchronously completed for SET requests and         00550000
*               extracted for CANCEL requests regardless of             00560000
*               whether SYNC=YES is coded.                              00570000
*                                                                       00580000
*               For $TIMER SET,NOTIFY=EPB requests, R1 contains         00590000
*               the EPB token                                           00600000
*                                                                       00610000
*        RC04 - A CANCEL request was made but the TID= value is         00620000
*               invalid.  When SYNC=YES is coded the TID= value         00630000
*               does not designate a SET timer.                         00640000
*                                                                       00650000
*        RC08 - STIMERM failure (SYNC=YES only)                         00660000
*                                                                       00670000
*        RC12 - Invalid request                                         00680000
*                                                                       00690000
*                                                                       00700000
* OUTBOUND INTERTASK MESSAGES:                                          00710000
*                                                                       00720000
*    ITM_$TIMER_REQ     - $TIMER manager interface                      00730000
*                                                                       00740000
**<DOC-OFF>****************************************************         00750000
                                                                        00760000
         EJECT                                                          00770000
***************************************************************         00780000
*                                                                       00790000
* MAINTENANCE:                                                          00800000
*                                                                       00810000
*    09/13/94 R. Turgeon                                                00820000
*             Initial version                                           00830000
*    08/18/95 Randy Witek - support $TIMER EXIT= and PARM=              00840000
*                                                                       00850000
***************************************************************         00860000
                                                                        00870000
         EJECT                                                          00880000
         $TIMER DSECT=YES    REQUEST BLOCK                              00890000
                                                                        00900000
         EJECT                                                          00910000
         $TIMEHDR ,          $TIMER STIMER LINKAGE TABLE                00920000
                                                                        00930000
         EJECT                                                          00940000
         $TQE ,              TIMER QUEUE ENTRY                          00950000
                                                                        00960000
         EJECT                                                          00970000
         $TSEND DSECT=YES    INTERTASK MESSAGE REQUEST FORMAT           00980000
                                                                        00990000
         EJECT                                                          01000000
         TMSG  ,             INTERTASK MSG FORMAT                       01010000
                                                                        01020000
         EJECT                                                          01030000
         $TASK DSECT=YES     $TASK SERVICES                             01040000
                                                                        01050000
         EJECT                                                          01060000
         #WORK ,             BEGIN WORKAREA                             01070000
                                                                        01080000
OPTFLAGS DS    X             REQUEST OPTION SUMMARY                     01090000
OFSYNC   EQU   X'80'            SYNCHRONOUS REQUEST                     01100000
OFEPB    EQU   X'40'            EPB NOTIFICATION                        01110000
                                                                        01120000
RETEPB   DS    F             EPB TOKEN IF SET,NOTIFY=YES                01130000
@TQE     DS    A             TQE ADDRESS IF $TIMER SET REQUEST          01140000
@TIMERID DS    XL8           $TIMER ID CREATED FOR SET REQUESTS         01150000
*                            AND ACCEPTED FOR CANCEL REQUESTS           01160000
                                                                        01170000
$TASKMFL $TASK MF=(L,*)      $TASK PLIST CONSTRUCTION AREA              01180000
                                                                        01190000
         #ENDWORK ,          END WORKAREA                               01200000
                                                                        01210000
         EJECT                                                          01220000
         EVCODES ,           EVENT CODES                                01230000
*                                                                       01240000
         ABCODES ,           $ABEND CODES                               01250000
*                                                                       01260000
         MSGCODES ,          INTERTASK MESSAGING CODES                  01270000
*                                                                       01280000
         EQUS  ,                                                        01290000
                                                                        01300000
         EJECT                                                          01310000
ITMRSERV #ENTER PREG=R8                                                 01320000
                                                                        01330000
         USING ITASK,R10          STDENV                                01340000
                                                                        01350000
         EJECT                                                          01360000
***************************************************************         01370000
*                                                                       01380000
*   ACCEPT PARAMETERS - IDENTIFY EXECUTION ENVIRONMENT                  01390000
*                                                                       01400000
***************************************************************         01410000
         USING PTIMP,R8           LIFE OF FUNCTION                      01420000
                                                                        01430000
         MVC   PTIMWTKN,TSKENTKN  ASSUME REQUESTER IN TASK MODE         01440000
         ICM   R9,15,TSKPCBC      PROCESS MODE?                         01450000
         BZ    FUNCANAL           EXTRACT PROCESS NAME IF SO            01460000
         USING IPCB,R9                                                  01470000
                                                                        01480000
         MVC   PTIMPNAM,PCBNAME   PROCESS NAME                          01490000
         MVC   PTIMWTKN,PCBENTKN  PROCESS WORKUNIT TOKEN                01500000
                                                                        01510000
*--------------------------------------------------------------         01520000
*   IDENTIFY REQUEST TYPE AND ROUTE ACCORDINGLY                         01530000
*--------------------------------------------------------------         01540000
FUNCANAL DS    0H                                                       01550000
         L     R15,PTIMFUNC       FUNCTION CODE                         01560000
         B     *+4(R15)           IDENTIFY REQUESTED FUNCTION           01570000
         B     SET                   SET A TIMER                        01580000
         B     CANCEL                CANCEL A TIMER                     01590000
         B     SENDREQ               CANCEL ALL TIMERS FOR WORKUNIT     01600000
         B     WAIT                  AWAIT INTERVAL EXPIRATION          01610000
         EX    R0,*                  UNKNOWN REQUEST                    01620000
                                                                        01630000
         EJECT                                                          01640000
***************************************************************         01650000
*                                                                       01660000
*   WAIT requests                                                       01670000
*                                                                       01680000
*   The requester is blocked until the given time interval              01690000
*   expires.  WAIT requests force notify=epb and that EPB will          01700000
*   be waited on in this routine - the user is not involved.            01710000
*                                                                       01720000
***************************************************************         01730000
WAIT     DS    0H                                                       01740000
         OI    OPTFLAGS,OFEPB     FORCE NOTIFICATION VIA EPB            01750000
         LA    R2,DWORD           THROW-AWAY LOC FOR $TIMER ID          01760000
         B     SWCOMMON           SET / WAIT COMMON CODE                01770000
                                                                        01780000
***************************************************************         01790000
*                                                                       01800000
*   SET requests                                                        01810000
*                                                                       01820000
*   Notification of unblocked interval expirations can be               01830000
*   accomplished via XEPB or $TSEND message.  Additionally,             01840000
*   the requester can elect to block until the timing interval          01850000
*   is actually established by the $TIMER manager.  However,            01860000
*   at this time this offers little benifit to the requester.           01870000
*                                                                       01880000
*   SET requests must provide a $TIMER ID return area.                  01890000
*                                                                       01900000
***************************************************************         01910000
SET      DS    0H                                                       01920000
         ICM   R0,15,PTIMEXIT     EXIT= SPECIFIED?                      01930000
         BNZ   SETNOEPB           BRANCH IF YES                         01940000
         ICM   R0,15,PTIMEPB      EPB NOTIFICATION SPECIFIED?           01950000
         BZ    SETNOEPB           SKIP IF NOT                           01960000
         OI    OPTFLAGS,OFEPB     SUMMARIZE RQMTS                       01970000
SETNOEPB DS    0H                                                       01980000
                                                                        01990000
         ICM   R0,15,PTIMSYNC     SYNCHRONOUS REQUEST?                  02000000
         BZ    *+8                SKIP IF NOT                           02010000
         OI    OPTFLAGS,OFSYNC    SUMMARIZE RQMTS                       02020000
                                                                        02030000
         ICM   R2,15,PTIMTID      $TIMER ID RETURN AREA GIVEN?          02040000
         BZ    ERR_REQ            ERROR IF NOT, ELSE HOLD R2            02050000
                                                                        02060000
***************************************************************         02070000
*                                                                       02080000
*   SET/WAIT request common processing                                  02090000
*                                                                       02100000
*   All SET and WAIT requests must provide an appropriate               02110000
*   timing interval.  Because either of these request types             02120000
*   introduce TQEs in the $TIMER manager task, a bit is set             02130000
*   in the requesting workunit to note that the workunit is             02140000
*   or was a user of $TIMER services, with the intent to guide          02150000
*   workunit termination cleanup later.                                 02160000
*                                                                       02170000
***************************************************************         02180000
SWCOMMON DS    0H                                                       02190000
         ICM   R0,15,PTIMITVL     INTERVAL PROVIDED                     02200000
         BNP   ERR_REQ            ERROR IF NOT                          02210000
                                                                        02220000
         LA    R1,TSKWUFLG        ASSUME TASK MODE                      02230000
         LTR   R9,R9              PROCESS MODE?                         02240000
         BZ    *+8                SKIP IF NOT                           02250000
         LA    R1,PCBWUFLG        PROCESS WORKUNIT FLAGS                02260000
         OI    0(R1),TSKWUFLG_TIMERSET   INDICATE USER OF $TIMER        02270000
                                                                        02280000
*--------------------------------------------------------------         02290000
*   ACQUIRE A UNIQUE TIMER ID                                           02300000
*--------------------------------------------------------------         02310000
         BAS   R14,ASSIGNID       GENERATE $TIMER ID                    02320000
                                                                        02330000
         MVC   @TIMERID,0(R1)     ACCEPT RETURNED $TIMER ID             02340000
         MVC   0(8,R2),0(R1)      AND RETURN A COPY TO REQUESTER        02350000
         LR    R5,R0              $TIMEHDR ENTRY SELECTED               02360000
         USING TIMEHDR,R5         CONTAINS THE $ISTOR QHDR              02370000
                                                                        02380000
*--------------------------------------------------------------         02390000
*   CONSTRUCT A TQE                                                     02400000
*--------------------------------------------------------------         02410000
         $GETSTOR TQELN,QHDR=0    (FORMERLY QHDR=TIMHSTOR)              02420000
                                                                        02430000
         LR    R6,R1              ACQUIRED STORAGE                      02440000
         USING TQE,R6             CONSTRUCT TQE                         02450000
         ST    R6,@TQE            TQE TO BE DELIVERED TO $TIMER MGR     02460000
         MVC   TQEIPNAM,PTIMPNAM  PROCESS NAME                          02470000
         MVC   TQEITNAM,TSKNAME   TASK NAME                             02480000
         MVC   TQETID,@TIMERID    TIMER ID                              02490000
         MVC   TQEWTKN,PTIMWTKN   WORKUNIT TOKEN                        02500000
         MVC   TQEEXIT,PTIMEXIT   EXIT ROUTINE IF SPECIFIED             02510000
         MVC   TQEPARM,PTIMPARM   USER PARM WORD IF SPECIFIED           02520000
                                                                        02530000
*--------------------------------------------------------------         02540000
*   COMPUTE EXPIRATION TOD FROM CLOCK AND INTERVAL                      02550000
*--------------------------------------------------------------         02560000
         L     R1,PTIMITVL        INTERVAL LENGTH IN MILLISECS          02570000
         M     R0,=F'1000'        CONVERT TO MICROSECS                  02580000
         SLDA  R0,12              MICVL FORMAT, BIT 51 IS 1 USEC        02590000
         BO    ERR_REQ            LOSS OF SIGNIFICANCE                  02600000
         LR    R15,R0             MODIFIABLE COPY OF HIGH ORDER         02610000
         SRA   R15,24             EXCESSIVE INTERVAL SIZE?              02620000
         BNZ   ERR_REQ            REQUEST IN ERROR IF SO                02630000
                                                                        02640000
         STCK  DWORD              SAVE CURRENT CLOCK                    02650000
                                                                        02660000
         AL    R0,DWORD+0         TOD HIGH ORDER                        02670000
         AL    R1,DWORD+4         TOD LOW ORDER WORD                    02680000
         BC    B'1100',*+8        SKIP IF NO CARRY                      02690000
         AL    R0,=F'1'           ROLL CARRY INTO HIGH ORDER            02700000
         STM   R0,R1,TQEITOD      EXPIRATION TOD                        02710000
                                                                        02720000
*--------------------------------------------------------------         02730000
*   INITIALIZE AN XEPB IF EPB NOTIFICATION REQUESTED                    02740000
*--------------------------------------------------------------         02750000
         TM    OPTFLAGS,OFEPB     EPB NOTIFICATION?                     02760000
         BNO   SENDREQ            DONE HERE IF NOT                      02770000
                                                                        02780000
         $TASK SETEPB,            INITIALIZE THE EPB                   X02790000
               ECODE=EC$TIMER,    IDENTIFY THE $TIMER EVENT CODE       X02800000
               MF=(E,$TASKMFL)                                          02810000
                                                                        02820000
         ST    R1,TQEEPB          RETAIN XEPB TOKEN                     02830000
         ST    R1,RETEPB          XEPB TOKEN FOR RETURN TO REQUESTER    02840000
         B     SENDREQ            SEND REQUEST TO $TIMER MANAGER        02850000
         DROP  R6,R5              $TQE, $TIMEHDR                        02860000
                                                                        02870000
         EJECT                                                          02880000
***************************************************************         02890000
*                                                                       02900000
*   CANCEL request                                                      02910000
*                                                                       02920000
*   The CANCEL requester identifies the particular interval             02930000
*   timer by the $TIMER ID previously assigned in the SET               02940000
*   request.  The first byte of that ID contains a timer queue          02950000
*   number ranging from X'01' to X'10' inclusive.  Values               02960000
*   lying outside of that range are invalid.                            02970000
*                                                                       02980000
***************************************************************         02990000
CANCEL   DS    0H                                                       03000000
         ICM   R2,15,PTIMTID      $TIMER ID PROVIDED?                   03010000
         BZ    ERR_REQ            ERROR IF NOT                          03020000
         CLI   0(R2),01           VALIDATE STIMERM Q DESIGNATION        03030000
         BL    ERR_TID                                                  03040000
         CLI   0(R2),16                                                 03050000
         BH    ERR_TID                                                  03060000
         MVC   @TIMERID,0(R2)     RETAIN LOCAL COPY                     03070000
         B     SENDREQ            FORWARD THE REQUEST                   03080000
                                                                        03090000
         EJECT                                                          03100000
***************************************************************         03110000
*                                                                       03120000
*   FORWARD REQUEST TO $TIMER MANAGER                                   03130000
*                                                                       03140000
***************************************************************         03150000
SENDREQ  DS    0H                                                       03160000
         SR    R3,R3              PREPARE FOR INSERT                    03170000
         IC    R3,OPTFLAGS        OPTION FLAGS                          03180000
         N     R3,=A(OFSYNC)      ISOLATE SYNCHRONOUS REQUEST FLAG      03190000
                                                                        03200000
         $TSEND '$INTMAIN',                                            X03210000
               TYPE=ITM_$TIMER_REQ,                                    X03220000
               PARMS=(*@TIMERID+0,*@TIMERID+4,*@TQE),                  X03230000
               INFO=(PTIMP,PTIMPLN),                                   X03240000
               REPLY=(R3),                                             X03250000
               MF=(E,MFE_LIST)                                          03260000
                                                                        03270000
         B     *+4(R15)           ANALYZE COMPLETION CODE               03280000
         B     SENDCPT               RC00 - COMPLETE                    03290000
         EX    R0,*                  RC04 - UNKNOWN DESTINATION         03300000
         EX    R0,*                  RC08 - INFO LENGTH (UNACCEPTABLE)  03310000
         B     ERR_STG               RC12 - STORAGE MGMT FAILURE        03320000
                                                                        03330000
*--------------------------------------------------------------         03340000
*   AWAIT REPLY                                                         03350000
*--------------------------------------------------------------         03360000
SENDCPT  DS    0H                 INVALID DESTINATION                   03370000
         LTR   R2,R1              SYNCHRONOUS REQUEST?                  03380000
         BZ    SENDWAIT           DONE HERE IF NOT                      03390000
                                                                        03400000
         $TASK WAIT,EPB=(R2),                                          X03410000
               MF=(E,$TASKMFL)                                          03420000
                                                                        03430000
         LTR   R0,R0              SUCCESSFUL COMPLETION?                03440000
         BNZ   ERR_MGR            TERMINATE WITH ERROR IF NOT           03450000
                                                                        03460000
*--------------------------------------------------------------         03470000
*   IF WAIT REQUEST, AWAIT EXPIRATION OF TIME INTERVAL                  03480000
*--------------------------------------------------------------         03490000
SENDWAIT DS    0H                 AWAIT INTERVAL EXPIRATION             03500000
         CLC   PTIMFUNC,=A(PTIMF_WAIT)                                  03510000
         BNE   NORMRET                                                  03520000
                                                                        03530000
         $TASK WAIT,EPB=*RETEPB,                                       X03540000
               MF=(E,$TASKMFL)                                          03550000
                                                                        03560000
         XC    RETEPB,RETEPB                                            03570000
                                                                        03580000
         EJECT                                                          03590000
***************************************************************         03600000
*                                                                       03610000
*   RETURN COMPLETION STATUS TO CALLER                                  03620000
*                                                                       03630000
***************************************************************         03640000
NORMRET  DS    0H                 REQUEST SENT TO $TIMER MANAGER        03650000
         LA    R15,RC00           RETURN CODE                           03660000
         SR    R0,R0              REASON CODE NOT DEFINED               03670000
         L     R1,RETEPB          EPB TOKEN RETURN                      03680000
         B     RETURN                                                   03690000
                                                                        03700000
ERR_TID  DS    0H                 INVALID $TIMER ID                     03710000
         LA    R15,RC04                                                 03720000
         SR    R0,R0              REASON CODE NOT DEFINED               03730000
         SR    R1,R1              NOT DEFINED                           03740000
         B     RETURN                                                   03750000
                                                                        03760000
ERR_MGR  DS    0H                 ERROR DETECTED BY $TIMER MANAGER      03770000
         LA    R15,RC08           LOCAL RETURN CODE, ERROR CODE IN R0   03780000
         B     RETURN                                                   03790000
                                                                        03800000
ERR_REQ  DS    0H                 REQUEST IN ERROR                      03810000
         LA    R15,RC12                                                 03820000
         SR    R0,R0              REASON CODE NOT DEFINED               03830000
         SR    R1,R1              NOT DEFINED                           03840000
                                                                        03850000
*--------------------------------------------------------------         03860000
*   RETURN TO REQUESTER                                                 03870000
*--------------------------------------------------------------         03880000
RETURN   DS    0H                                                       03890000
         #EXIT ,                                                        03900000
                                                                        03910000
         EJECT                                                          03920000
***************************************************************         03930000
*                                                                       03940000
*   CATASTROPHIC LOGIC FAILURES, ETC.                                   03950000
*                                                                       03960000
***************************************************************         03970000
ERR_STG  DS    0H                                                       03980000
         ST    R15,FWORD                                                03990000
                                                                        04000000
         $ABEND ABE_STORAGE,*FWORD,DUMP=YES,                           X04010000
               TITLE='STORAGE MANAGMENT FAILURE'                        04020000
                                                                        04030000
         EJECT                                                          04040000
***************************************************************         04050000
*                                                                       04060000
* ROUTINE: ASSIGNID - ASSIGN $TIMER ID                                  04070000
*                                                                       04080000
* DESCRIPTION:                                                          04090000
*                                                                       04100000
*    This function generates a unique $TIMER ID and then runs           04110000
*    the TIMEHDR table to select an STIMERM queue favoring              04120000
*    entries that have queued TQEs (attempting to minimize              04130000
*    STIMERM calls) while avoiding extremely long queues                04140000
*    (attempting to reduce the cost of list traversal).                 04150000
*                                                                       04160000
* ON ENTRY:                                                             04170000
*                                                                       04180000
*    N/A                                                                04190000
*                                                                       04200000
* ON EXIT:                                                              04210000
*                                                                       04220000
*    R1  - ADDRESS OF A COMPLETED XL8 $TIMER ID                         04230000
*    R0  - ADDRESS OF THE $TIMEHDR ENTRY SELECTED                       04240000
*                                                                       04250000
***************************************************************         04260000
ASSIGNID DS    0H                                                       04270000
         STM   R14,R12,12(R13)    PRESERVE CALLERS REGS                 04280000
                                                                        04290000
*--------------------------------------------------------------         04300000
*   ACQUIRE UNIQUE $TIMER ID - HANDLE PORTION                           04310000
*--------------------------------------------------------------         04320000
         LM    R0,R1,ICTTID       $TIMER ID - HANDLE PORTION            04330000
                                                                        04340000
ASSICDS  DS    0H                                                       04350000
         LR    R14,R0             SNAPSHOT CURRENT VALUE                04360000
         LR    R15,R1                                                   04370000
         AL    R15,=F'1'          INCREMENT                             04380000
         BC    B'1100',*+8        NO CARRY                              04390000
         AL    R14,=F'1'          CARRY ON                              04400000
         CDS   R0,R14,ICTTID      UPDATE                                04410000
         BNE   ASSICDS            TRY AGAIN                             04420000
         STM   R14,R15,DWORD      $TIMER ID CONSTRUCTION AREA           04430000
                                                                        04440000
*--------------------------------------------------------------         04450000
*   SELECT STIMERM Q BASED ON CURRENT (SAMPLED) QUEUE LENGTH            04460000
*--------------------------------------------------------------         04470000
         L     R3,ICTTIME         FETCH $TIMER HDR TABLE                04480000
         USING TIMEHDR,R3         FORMAT                                04490000
         LA    R4,TIMEHDRL        LENGTH OF EACH ENTRY                  04500000
         LA    R5,TIMH#ENT        NUMBER OF ENTRIES                     04510000
                                                                        04520000
         LA    R6,OPTQLEN         OPTIMUM TQE QUEUE DEPTH               04530000
         L     R7,=X'7FFFFFFF'    STARTING UGLY                         04540000
                                                                        04550000
ASSISCAN DS    0H                                                       04560000
         L     R1,TIMHQC          QUEUE DEPTH                           04570000
         SR    R1,R6              DISTANCE TO PERFECTION                04580000
         LPR   R1,R1              ABSOLUTE VALUE                        04590000
         CLR   R1,R7              BETTER THAN BEFORE?                   04600000
         BNL   ASSIADV            SKIP IF NOT                           04610000
                                                                        04620000
         LR    R7,R1              NEW TARGET                            04630000
         LR    R8,R5              BEST ENTRY (COUNTING BACKWARDS)       04640000
         ST    R3,FWORD           RETAIN TIMER Q HDR PTR                04650000
                                                                        04660000
ASSIADV  DS    0H                                                       04670000
         AR    R3,R4              ADVANCE TO NEXT TIMEHDR ENTRY         04680000
         BCT   R5,ASSISCAN        AGAIN                                 04690000
                                                                        04700000
         LA    R0,TIMH#ENT+1      NORMALIZE ENTRY NUMBER                04710000
         SR    R0,R8              RANGE OF 1 - 16                       04720000
         STC   R0,DWORD           POST IN $TIMER ID                     04730000
                                                                        04740000
*--------------------------------------------------------------         04750000
*   SELECT STIMERM Q BASED EXCLUSIVELY ON CURRENT QUEUE LENGTH          04760000
*--------------------------------------------------------------         04770000
         L     R0,FWORD           RETURN TIMEHDR ENTRY ADDR             04780000
         LA    R1,DWORD           RETURN $TIMER ID                      04790000
         L     R14,12(,R13)       RESTORE RETURN ADDR                   04800000
         LM    R2,R12,28(R13)     RESTORE MAINLINE REGS                 04810000
         BR    R14                RETURN                                04820000
         DROP  R3                 TIMEHDR                               04830000
                                                                        04840000
OPTQLEN  EQU   50                 POSTULATED OPTIMUM QUEUE LENGTH       04850000
                                                                        04860000
         EJECT                                                          04870000
***************************************************************         04880000
*                                                                       04890000
*   LOCAL READ/ONLY DATA AREAS, ETC.                                    04900000
*                                                                       04910000
***************************************************************         04920000
         LTORG ,                                                        04930000
                                                                        04940000
         PRINT NOGEN                                                    04950000
         ICVT  ,                                                        04960000
         ITASK ,                                                        04970000
         IPCB  ,                                                        04980000
         END   ,                                                        04990000
