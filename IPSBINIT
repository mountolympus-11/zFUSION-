IPSBINIT TITLE ' - CREATE PREPARED STATEMENT BLOCK'                     00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: IPSBINIT - CREATE PREPARED STATEMENT BLOCK                   00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THIS ROUTINE IS USED TO CREATE A PREPARED SQL STATEMENT            00080001
*    BLOCK (PSB) AND TO ASSOCIATE IT WITH ITS COOP-ASSIGNED             00090001
*    HANDLE PROVIDED AS INPUT.  THE SQL STATEMENT TEXT IS ALSO          00100001
*    ATTACHED TO THE PSB TO SUPPORT SQL REQUEST TRACING,                00110001
*    DIAGNOSTICS, ETC.                                                  00120001
*                                                                       00130001
*                                                                       00140001
*                                                                       00150001
* ENTRY:                                                                00160000
*                                                                       00170000
*    R1  CONTAINS THE ADDRESS OF PREPARED STATEMENT TOKEN               00180000
*        ASSIGNED BY THE REQUESTER                                      00190000
*                                                                       00200000
*    R0  CONTAINS THE ADDRESS OF THE SQL STATEMENT IN THE               00210001
*        FOLLOWING FORMAT:                                              00220001
*                                                                       00230001
*           XL2 - NONINCLUSIVE SQL STATEMENT LENGTH                     00240001
*           CLN - SQL STATEMENT TEXT                                    00250001
*                                                                       00260001
* EXIT:                                                                 00270000
*                                                                       00280000
*    R15 CONTAIN ZERO                                                   00290000
*    R1  CONTAINS THE ADDRESS OF THE NEWLY CONSTRUCTED PSB              00300000
*                                                                       00310000
**<DOC-OFF>****************************************************         00320000
                                                                        00330000
         EJECT                                                          00340000
***************************************************************         00350000
*                                                                       00360000
* MAINTENANCE:                                                          00370000
*                                                                       00380000
*   04/26/94  R. TURGEON                                                00390000
*             INITIAL VERSION                                           00400000
*                                                                       00410000
*   11/22/94  R. TURGEON   PAR #156358                                  00420001
*             MODIFIED TO ACCEPT THE SQL STATEMENT SERVING AS           00430001
*             OBJECT OF THE PREPARE() FUNCTION                          00440001
*                                                                       00450001
***************************************************************         00460000
                                                                        00470000
         EJECT                                                          00480000
         #WORK ,                                                        00490000
         #ENDWORK                                                       00500000
                                                                        00510000
         EJECT                                                          00520000
         IUSER ,                       COOP INSTANCE (USER) BLOCK       00530000
                                                                        00540002
         EJECT                                                          00550002
         NAV   ,                       NAVIGATION / PLAN STRUCTURES     00560002
                                                                        00570000
         EJECT                                                          00580000
         PSB   ,                       TABLE INTERFACE BLOCK (TIB)      00590000
                                                                        00600000
         EJECT                                                          00610000
         EQUS  ,                                                        00620000
                                                                        00630000
         EJECT                                                          00640000
IPSBINIT #ENTER BASE=R12,PREG=(R8,R7)                                   00650001
                                                                        00660000
         USING ITASK,R10               ITASK ADDRESSABILITY             00670000
         L     R9,TSKPCBC              PROCESS MODE                     00680000
         USING IPCB,R9                                                  00690000
                                                                        00700000
         EJECT                                                          00710000
*--------------------------------------------------------------         00720000
*   LOCATE COOP'S IUSER, CONSTRUCT NEW PSB                              00730000
*--------------------------------------------------------------         00740000
         L     R6,PCBUSER              USER INSTANCE                    00750000
         USING IUSER,R6                                                 00760000
                                                                        00770000
         STGGET PSBLN,QH=USRSTG                                         00780000
                                                                        00790000
         LR    R5,R1                   PSB STORAGE                      00800000
         USING PSB,R5                                                   00810000
         MVC   PSBID,=CL8'PSB'         EYECATCHER                       00820000
         MVC   PSBTOKEN,0(R8)          STMT HANDLE ASSIGNED BY COOP     00830000
                                                                        00840000
         ICM   R4,15,USRPSBS           FIRST PSB                        00850000
         ST    R4,PSBNEXT              FORWARD LINK                     00860000
         ST    R5,USRPSBS              NEW PSB FIRST IN CHAIN           00870000
         BZ    *+8                     ONLY PSB IN CHAIN                00880000
         ST    R5,PSBPREV-PSB(,R4)     BACKWARD LINK                    00890000
                                                                        00900001
*--------------------------------------------------------------         00910001
*   ATTACH THE SQL STATEMENT TO THE PSB                                 00920001
*--------------------------------------------------------------         00930001
         LH    R2,0(,R7)               SQL STATEMENT LENGTH             00940001
         LTR   R2,R2                   STATEMENT TEXT AVAILABLE?        00950001
         BNP   RETURN                  BIZARRE IF NOT                   00960001
                                                                        00970001
         STGGET (R2),QH=USRSTG         ACQUIRE STORAGE FOR SQL STMT     00980001
                                                                        00990001
         ST    R1,PSBQSQLA             SQL STATEMENT ADDRESS            01000001
         ST    R2,PSBQSQLL             RETAIN SQL STATEMENT LENGTH      01010001
                                                                        01020001
         LR    R0,R1                   PREPARE FOR COPY                 01030001
         LR    R1,R2                   STATEMENT TEXT LENGTH            01040001
         LA    R14,2(,R7)              TEXT ORIGIN                      01050001
         LR    R15,R1                  TARGET LENGTH = SOURCE LENGTH    01060001
         MVCL  R0,R14                                                   01070001
                                                                        01080001
*--------------------------------------------------------------         01090000
*   RETURN COMPLETION STATUS AND PSB TO REQUESTER                       01100000
*--------------------------------------------------------------         01110000
RETURN   DS    0H                      PSB FOUND                        01120000
         LA    R15,RC00                INDICATE SUCCESS                 01130000
         LA    R1,PSB                  RETURN MATCHED PSB PTR           01140000
                                                                        01150000
         #EXIT ,                                                        01160000
                                                                        01170000
         EJECT                                                          01180000
***************************************************************         01190000
*                                                                       01200000
*   LOCAL READ ONLY STORAGE                                             01210000
*                                                                       01220000
***************************************************************         01230000
         LTORG ,                                                        01240000
                                                                        01250000
         PRINT NOGEN                                                    01260000
         ICVT  ,                                                        01270000
         ITASK ,                                                        01280000
         IPCB  ,                                                        01290000
         END   ,                                                        01300000
