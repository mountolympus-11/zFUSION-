IDSOBJAC TITLE 'DATASPACE SERVICES - OBJECT ACCESS'                     00010000
**<DOC-ON>*****************************************************         00020001
*                                                                       00030000
* ROUTINE: IDSOBJAC - OBJECT ACCESS                                     00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*                                                                       00080000
* ON ENTRY:                                                             00090000
*                                                                       00100000
*    R1 POINTS TO AN OS/VS PARAMETER LIST CONTAINING                    00110000
*                                                                       00120000
*        +00 - ADDRESS OF THE OBJECT TOKEN                              00130000
*        +04 - OBJECT ACCESS CODE                                       00140000
*                                                                       00150000
*               0 - QUERY - RETURN OBJECT STORAGE EXTENT                00160000
*               4 - CLOSE - RELINQUISH CONTROL                          00170000
*               8 - READ  - READING OBJECT                              00180000
*              12 - WRITE - WRITING / UPDATING OBJECT                   00190000
*                                                                       00200000
*    A/R10 - AR QUALIFIED ADDRESS OF THE STORAGE SPCBLOCK               00210000
*                                                                       00220000
*                                                                       00230000
* ON EXIT:                                                              00240000
*                                                                       00250000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                     00260000
*                                                                       00270000
*        00 - OBJECT ACCESS INTENT NOTED                                00280000
*                                                                       00290000
*             A/R1 - AR QUALIFIED OBJECT BASE ADDRESS                   00300000
*               R0 - LENGTH OF STORAGE OWNED BY APPLICATION             00310000
*                                                                       00320000
*        16 - INVALID REQUEST / PARAMETERS                              00330000
*        20 - ALU TRANSLATION ERROR                                     00340000
*                                                                       00350000
**<DOC-OFF>****************************************************         00360001
                                                                        00370001
         EJECT                                                          00380001
         SPCBLOCK ,                                                     00390001
                                                                        00400001
         EJECT                                                          00410001
         OIE   ,                                                        00420001
                                                                        00430001
         EJECT                                                          00440001
         $TOKEN ,                                                       00450001
                                                                        00460001
         EJECT                                                          00470001
         SPCEQUS ,                                                      00480001
                                                                        00490001
         EJECT                                                          00500001
         EQUS  LINKAGE=VCON                                             00510001
                                                                        00520001
         EJECT                                                          00530001
IDSOBJAC @ENTER ,                                                       00540000
                                                                        00550000
         @LAE  R1,0(R1,0)         TOKENS RESIDE IN PRIMARY              00560000
         LM    R6,R7,0(R1)        FETCH PASSED PARAMETERS               00570000
         @LAE  R6,0(R6,0)         R6 <== OBJECT TOKEN                   00580000
*                                 R7 <== ACCESS TYPE                    00590000
                                                                        00600000
         USING $TOKEN,R6          TOKEN FORMAT                          00610000
         CLC   $TOKTAG,=CL8'OBJTOKEN'                                   00620000
         BNE   ERR_REQ                                                  00630000
                                                                        00640000
         L     R10,$SPCBASE       OBJECT SPACE DESCRIPTOR ADDR          00650000
         LAM   R10,R10,$ALET      PROPERLY QUALIFIED                    00660000
         USING SPCBLOCK,R10       ESTABLISH ADDRESSABILITY              00670000
                                                                        00680000
         @LAE  R11,SPCBLOCK       OPEN WINDOW TO SPACE                  00690000
                                                                        00700000
*--------------------------------------------------------------         00710000
*   LOCATE OBJECT OIE, TAG ACCESS TYPE ACCORDINGLY                      00720000
*--------------------------------------------------------------         00730000
         LOCOIE ALUERR=ERR_ALU                                          00740000
                                                                        00750000
         LR    R11,R1             EXPOSE OIE IN OBJECT SPACE            00760000
         USING OIE,R11            OIE ADDRESSABILITY                    00770000
                                                                        00780000
         B     *+4(R7)            DETERMINE ACCESS TYPE                 00790000
         B     INFO                  0 - ACQUIRE INFO                   00800000
         B     CLOSE                 4 - RELINQUISH CONTROL             00810000
         B     READ                  8 - READ ONLY ACCESS               00820000
         B     WRITE                12 - OBJECT UPDATE                  00830000
                                                                        00840000
CLOSE    DS    0H                                                       00850000
         NI    OIEFLAGS,FF-OIEACCES                                     00860000
         B     INFO                                                     00870000
                                                                        00880000
READ     DS    0H                                                       00890000
         OI    OIEFLAGS,OIEREAD+OIEACCES                                00900000
         B     INFO                                                     00910000
                                                                        00920000
WRITE    DS    0H                                                       00930000
         OI    OIEFLAGS,OIEWRITE+OIEACCES                               00940000
         B     INFO                                                     00950000
                                                                        00960000
*--------------------------------------------------------------         00970000
*   RETURN OBJECT RESIDENCY INFORMATION                                 00980000
*--------------------------------------------------------------         00990000
INFO     DS    0H                                                       01000000
         @LAE  R1,OIE             QUALIFY STORAGE ADDRESS               01010000
         L     R1,OIESTORG        OBJECT ORIGIN ALU #                   01020000
         @ALU  (1)                R1 <== OBJECT BASE                    01030000
         BNZ   ERR_ALU            ALU TRANSLATION ERROR                 01040000
         L     R0,OIESTHWM        R0 <== AMOUNT OF STG MANAGED BY APPL  01050000
                                                                        01060000
*--------------------------------------------------------------         01070000
*   RETURN COMPLETION STATUS TO CALLER                                  01080000
*--------------------------------------------------------------         01090000
         LA    R15,RC00           NORMAL COMPLETION                     01100000
         B     RET                                                      01110000
                                                                        01120000
ERR_REQ  DS    0H                 INVALID REQUEST                       01130000
         SR    R0,R0              NO REASON CODES RETURNED              01140000
         SR    R1,R1              ETC                                   01150000
         LA    R15,RC16                                                 01160000
         B     RET                                                      01170000
                                                                        01180000
ERR_ALU  DS    0H                 ALU TRANSLATION ERROR                 01190000
         SR    R0,R0              NO REASON CODES RETURNED              01200000
         SR    R1,R1              ETC                                   01210000
         LA    R15,RC20                                                 01220000
                                                                        01230000
RET      DS    0H                 EXIT                                  01240000
         @EXIT ,                                                        01250000
                                                                        01260000
         EJECT ,                                                        01270000
***************************************************************         01280000
*                                                                       01290000
*   READ ONLY CONSTANTS, ETC.                                           01300001
*                                                                       01310000
***************************************************************         01320000
         LTORG ,                                                        01330000
         END   ,                                                        01340000
