ISLUTERM TITLE ' - SESSION IMAGING AND RECORDING - TERM'                00010000
***************************************************************         00020000
*                                                                       00030000
* ROUTINE:  ISLUTERM - TERMINATION                                      00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THIS ROUTINE DELETES THE SESSIMAG AND ALL ASSOCIATED DATA          00080000
*    AREAS AND BUFFERS ASSOCIATED WITH A 3270 APPLICATION               00090000
*    SESSION IDENTIFIED BY THE HANDLE PROVIDED.                         00100000
*                                                                       00110000
*                                                                       00120000
* ON ENTRY:                                                             00130000
*                                                                       00140000
*    R1  CONTAINS THE ADDRESS OF A PARAMETER LIST DESCRIBED BY          00150000
*        THE SSTERM PARAMETER LIST AS EXPANDED VIA SESSERV TERM.        00160000
*                                                                       00170000
*                                                                       00180000
* ON EXIT:                                                              00190000
*                                                                       00200000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                     00210000
*                                                                       00220000
*        RC00 - TERMINATION COMPLETE                                    00230000
*                                                                       00240000
*        RC16 - MISSING OR INVALID HANDLE                               00250000
*                                                                       00260000
***************************************************************         00270000
         EJECT                                                          00280000
         #WORK ,                                                        00290000
         #ENDWORK ,                                                     00300000
                                                                        00310000
         EJECT                                                          00320000
         SESSIMAG ,                                                     00330000
                                                                        00340000
         EJECT                                                          00350000
         SESSERV TERM                                                   00360000
                                                                        00370000
         EJECT                                                          00380000
         EQUS ,                                                         00390000
                                                                        00400000
         EJECT                                                          00410000
ISLUTERM #ENTER PREG=R8                                                 00420000
                                                                        00430000
         USING ICVT,R11           STANDARD ENVIRONMENT                  00440000
         USING ITASK,R10                                                00450000
                                                                        00460000
         EJECT                                                          00470000
***************************************************************         00480000
*                                                                       00490000
*   RELEASE SESSIMAG BLOCK AND ASSOCIATED STORAGE AREAS                 00500000
*                                                                       00510000
***************************************************************         00520000
         USING SSTERM,R8          PARAMETER LIST                        00530000
         ICM   R6,15,SSTHPTR      LOCATE SESSIMAG ADDR                  00540000
         BZ    ERR_HNDL           PTR ADDR MISSING                      00550000
         ICM   R7,15,0(R6)        TRAVERSE TO SESSIMAG                  00560000
         BZ    ERR_HNDL           REQUIRED                              00570000
         USING SEI,R7             LIFE OF FUNCTION                      00580000
                                                                        00590000
         SR    R0,R0              INVALIDATE THE HANDLE                 00600000
         ST    R0,0(,R6)          BY DESTROYING THE PTR                 00610000
                                                                        00620000
*--------------------------------------------------------------         00630000
*   RELEASE S0 IMAGE BUFFER                                             00640000
*--------------------------------------------------------------         00650000
         ICM   R3,15,SEIS0IMG     S0 IMAGE BUFFER ALLOCATED?            00660000
         BZ    NOS0               SKIP IF NOT                           00670000
                                                                        00680000
         $RETSTOR (R3)                                                  00690000
                                                                        00700000
NOS0     DS    0H                                                       00710000
                                                                        00720000
*--------------------------------------------------------------         00730000
*   RELEASE S1 IMAGE BUFFER                                             00740000
*--------------------------------------------------------------         00750000
         ICM   R3,15,SEIS1IMG     S1 IMAGE BUFFER ALLOCATED?            00760000
         BZ    NOS1               SKIP IF NOT                           00770000
                                                                        00780000
         $RETSTOR (R3)                                                  00790000
                                                                        00800000
NOS1     DS    0H                                                       00810000
                                                                        00820000
*--------------------------------------------------------------         00830000
*   RELEASE S1 FLDVEC                                                   00840000
*--------------------------------------------------------------         00850000
         ICM   R3,15,SEIS1FLV     S1 FIELD VECTOR - COMPACT FORM?       00860000
         BZ    NOS1FLV            SKIP IF NOT                           00870000
                                                                        00880000
         $RETSTOR (R3)                                                  00890000
                                                                        00900000
         XC    SEIS1FLV,SEIS1FLV                                        00910000
NOS1FLV  DS    0H                                                       00920000
                                                                        00930000
*--------------------------------------------------------------         00940000
*   RELEASE S1 FLDVECX                                                  00950000
*--------------------------------------------------------------         00960000
         ICM   R3,15,SEIS1FLX     S1 FIELD VECTOR - EXPANDED FORM?      00970000
         BZ    NOS1FLX            SKIP IF NOT                           00980000
                                                                        00990000
         $RETSTOR (R3)                                                  01000000
                                                                        01010000
         XC    SEIS1FLX,SEIS1FLX                                        01020000
NOS1FLX  DS    0H                                                       01030000
                                                                        01040000
*--------------------------------------------------------------         01050000
*   RELEASE STORED KEYSTROKE SEQUENCE (SKS)                             01060000
*--------------------------------------------------------------         01070000
         ICM   R3,15,SEISKSA      SYSSKS PENDING?                       01080000
         BZ    NOSKS              SKIP IF NOT                           01090000
         LA    R0,SEISKSRS        DEDICATED SYSSKS CONSTRUCTION AREA    01100000
         CR    R3,R0              RELEASE NEEDED?                       01110000
         BE    NOSKS                                                    01120000
                                                                        01130000
         $RETSTOR (R3)                                                  01140000
                                                                        01150000
         XC    SEISKSA,SEISKSA                                          01160000
NOSKS    DS    0H                                                       01170000
                                                                        01180000
*--------------------------------------------------------------         01190000
*   RELEASE SESSIMAG PROPER                                             01200000
*--------------------------------------------------------------         01210000
         $RETSTOR SEI                                                   01220000
                                                                        01230000
         LA    R15,RC00           NORMAL COMPLETION                     01240000
         B     TERM_FIN           DONE                                  01250000
                                                                        01260000
*--------------------------------------------------------------         01270000
*   MISSING OR INVALID HANDLE / PTR                                     01280000
*--------------------------------------------------------------         01290000
ERR_HNDL DS    0H                                                       01300000
         LA    R15,RC16                                                 01310000
         B     TERM_FIN                                                 01320000
                                                                        01330000
*--------------------------------------------------------------         01340000
*   RETURN COMPLETION STATUS TO REQUESTOR                               01350000
*--------------------------------------------------------------         01360000
TERM_FIN DS    0H                                                       01370000
         #EXIT ,                                                        01380000
                                                                        01390000
         EJECT                                                          01400000
***************************************************************         01410000
*                                                                       01420000
*   LOCAL READ-ONLY DATA AREAS                                          01430000
*                                                                       01440000
***************************************************************         01450000
         LTORG ,                                                        01460000
                                                                        01470000
         PRINT NOGEN                                                    01480000
         ICVT  ,                                                        01490000
         ITASK ,                                                        01500000
         END   ,                                                        01510000
