IODBGTYP TITLE '- ODBC SQLGETTYPEINFO() RESULT SET GENERATOR'           00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: IODBCOLS - ODBC SQLGetTypeInfo() result set generator        00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    That QCS is expected and required to contain the semantic          00080000
*    information acquired from a SQL                                    00090000
*                                                                       00100000
*       SELECT <col-list> FROM SYSVCAT_ODBC_TYPEI WHERE ...             00110000
*                                                                       00120000
*    statement.  The result set generated by this query can be          00130000
*    fashioned to conform to the ODBC SQLGetTypeInfo() function         00140000
*    format by appropriate composition of the <col-list> and            00150000
*    the use of an ORDER BY clause.                                     00160000
*                                                                       00170000
*                                                                       00180000
* IMPLEMENTATION NOTES:                                                 00190000
*                                                                       00200000
*    CREATE_PARAMS    - DDL is not implemented.                         00210000
*                       This column is nulled.                          00220000
*                                                                       00230000
*    CASE_SENSITIVE   - All STDENV character fields are case            00240000
*                       sensitive.  This column is set TRUE             00250000
*                       for all character data types.                   00260000
*                                                                       00270000
*    UNSIGNED_ATTRIBUTE - STDENV integers can be either signed          00280000
*                       or unsigned.  The name of this column           00290000
*                       exceeds the table services capacity of          00300000
*                       16 characters and has been abbreviated          00310000
*                       to UNSIGNED_ATTRIB                              00320000
*                                                                       00330000
*    MONEY            - Not currently implmented, always FALSE          00340000
*                                                                       00350000
*    AUTO_INCREMENT   - Not implemented, always FALSE or NULL           00360000
*                                                                       00370000
*    LOCAL_TYPE_NAME  - Not implmented, always NULL                     00380000
*                                                                       00390000
*                                                                       00400000
* ON ENTRY                                                              00410000
*                                                                       00420000
*    R1  contains the address of the Query Content Summary              00430000
*                                                                       00440000
*    R0  contains the address of a preallocated savearea                00450000
*        not less than 1K in length or zero                             00460000
*                                                                       00470000
*                                                                       00480000
* ON EXIT:                                                              00490000
*                                                                       00500000
*    R15 contains zero or a return code acquired from SQLCODES          00510000
*        if an error is encountered.  R0 and R1 contain reason          00520000
*        and info codes respectively.  The QCSESTAT words are           00530000
*        updated accordingly.                                           00540000
*                                                                       00550000
**<DOC-OFF>****************************************************         00560000
                                                                        00570000
         EJECT                                                          00580000
***************************************************************         00590000
*                                                                       00600000
*  MAINTENANCE:                                                         00610000
*                                                                       00620000
*    01/25/95  R. Turgeon    Int 2.0  ODCB Support                      00630000
*              Initial version                                          00640000
*                                                                       00650000
*    10/31/95  R. Turgeon    Rel 2.1                                    00660000
*              Create transient result set with NOLOCATOR               00670000
*              option                                                   00680000
*                                                                       00690000
***************************************************************         00700000
                                                                        00710000
         EJECT                                                          00720000
         QCS   ,                  QUERY CONTENT SUMMARY                 00730000
                                                                        00740000
         EJECT                                                          00750000
         SQLSEMAL ,               SQL SEMANTIC SUMMARY                  00760000
                                                                        00770000
         EJECT                                                          00780000
         KYNDXRET ,               RESULT SET NDX DEFINITION RETURN AREA 00790000
                                                                        00800000
         EJECT                                                          00810000
         TBSERVIS CREATE,ADD,PSARG,COLUMN                               00820000
                                                                        00830000
         EJECT                                                          00840000
         VCATALOG ODBC_TYPEI      VIRTUAL CATALOG TABLE COMPOSITION     00850000
                                                                        00860000
         EJECT                                                          00870000
         CATINFO ,                COLUMN AND INDEX DEFINTION HEADER     00880000
                                                                        00890000
         EJECT                                                          00900000
         ODBTIREC ,               ODBC DATA TYPE INFORMATION RECORD     00910000
                                                                        00920000
         EJECT                                                          00930000
         ODBCSQLH ,               ODBC CONSTANTS, DEFINITIONS, ETC.     00940000
                                                                        00950000
         EJECT                                                          00960000
         CRSDP ,                  CREATE RESULT SET REQUEST/RESPONSE    00970000
                                                                        00980000
         EJECT                                                          00990000
         EQUS  ,                                                        01000000
                                                                        01010000
         ABCODES ,                                                      01020000
                                                                        01030000
         EJECT                                                          01040000
         #WORK ,                                                        01050000
                                                                        01060000
@NDXDEF  DS    A             RESULT SET INDEX DEFINITION (KYNDXRET)     01070000
RET_CRSD DS    F             RESULT SET DEFINITION SERVICE RTN RETCODE  01080000
                                                                        01090000
RETCODES DS    0F,0F,0F      COMPLETION STATUS                          01100000
RETCODE  DS    F                RETURN CODE                             01110000
RSNCODE  DS    F                REASON CODE                             01120000
INFCODE  DS    F                INFO CODE                               01130000
                                                                        01140000
REGSAVE  DS    16F           LOCAL SUBROUTINE SAVEAREA #1               01150000
WK256    DS    XL256         GENERAL PURPOSE WORKAREA                   01160000
                                                                        01170000
*--------------------------------------------------------------         01180000
*   TABLE COLUMN STATUS MAINTAINED FOR NULLABLE COLUMNS                 01190000
*--------------------------------------------------------------         01200000
                                                                        01210000
STAPRCSN DS    F             PRECISION                                  01220000
STALTPFX DS    F             LITERAL_PREFIX                             01230000
STALTSFX DS    F             LITERAL_SUFFIX                             01240000
STAPARAM DS    F             CREATE_PARAMS                              01250000
STAUNSGN DS    F             UNSIGNED_ATTRIBUTE                         01260000
STAUTINC DS    F             AUTO_INCREMENT                             01270000
STALCLTY DS    F             LOCAL_TYPE_NAME                            01280000
STASCAMN DS    F             MINIMUM_SCALE                              01290000
STASCAMX DS    F             MAXIMUM_SCALE                              01300000
                                                                        01310000
NULL_IND DS    XL4           NULL INDICATORS FOR 32 COLUMNS             01320000
NULL_SAV DS    XL4           NULL INDICATORS - CONSTANTS                01330000
                                                                        01340000
*--------------------------------------------------------------         01350000
*   PLIST CONSTRUCTION AREAS                                            01360000
*--------------------------------------------------------------         01370000
                                                                        01380000
$CRSDP   DS    0F,XL(CRSDPLN)    CREATE RESULT SET DEFINITION REQ/RESP  01390000
$CRSTREF DS    0F,XL(CRSTREFL)   CREATE RESULT SET - TABLE REFERENCE    01400000
                                                                        01410000
*--------------------------------------------------------------         01420000
*   VARDATA COLUMN COLLECTION AND CONSTRUCTION AREA                     01430000
*--------------------------------------------------------------         01440000
                                                                        01450000
VCHAR@   DS    A             FREE AREA PTR IN VARDATA COLLECTION AREA   01460000
VCHAR#   DS    F             FREE STG LEFT IN VARDATA COLLECTION AREA   01470000
VCHAR@T  DS    A             VCHAR@ AFTER TABLE VARDATA POSTED          01480000
VCHAR#T  DS    F             VCHAR# AFTER TABLE VARDATA POSTED          01490000
VCHARBUF DS    XL128         VARDATA COLLECTION AREA                    01500000
                                                                        01510000
*--------------------------------------------------------------         01520000
*   TABLE SERVICES ROW BUFFERS                                          01530000
*--------------------------------------------------------------         01540000
                                                                        01550000
$ODBTROW DS    XL(ODBTYPEI_LENGTH)  SYSVCAT_ODBC_TYPEI SOURCE ROW BUFR  01560000
                                                                        01570000
         #ENDWORK                                                       01580000
                                                                        01590000
         EJECT                                                          01600000
IODBGTYP #ENTER PREG=R8                                                 01610000
                                                                        01620000
         USING ITASK,R10                                                01630000
                                                                        01640000
         EJECT                                                          01650000
***************************************************************         01660000
*                                                                       01670000
*   First, prepare to materialize the ODBC-defined result set           01680000
*   by initializing a SYSVCAT_ODBC_TYPEI table in the execution         01690000
*   space.  We leave it to coop to determine the proper                 01700000
*   ordering and row admittance criterea via the use of                 01710000
*   ALL/DISTINCT and ORDER BY in the source SELECT statement.           01720000
*                                                                       01730000
***************************************************************         01740000
                                                                        01750000
         USING QCS,R8             LIFE OF FUNCTION                      01760000
                                                                        01770000
         GENTBLNM QCSTABLE        GENERATE A NAME FOR THE RESULT SET    01780000
                                                                        01790000
C        USING ODBTYPEI,$ODBTROW  SYSVCAT_ODBC_COLS ROW                 01800000
                                                                        01810000
*--------------------------------------------------------------         01820000
*   GENERATE A RESULT SET DEFINITION FROM THE BASE TABLE                01830000
*--------------------------------------------------------------         01840000
                                                                        01850000
         L     R7,=V(IVCAGTYP)    SYSVCAT_ODBC_TYPEI TABLE FORMAT       01860000
         USING CATINFO,R7         DEFINITION FORMAT                     01870000
                                                                        01880000
TREF     USING CRSTREF,$CRSTREF   SINGLE VIRTUAL TABLE REFERENCE        01890000
         L     R6,QCSSSMRY        LOCATE THE SEMANTIC SUMMARY           01900000
         USING SQSEMAL,R6                                               01910000
         MVC   TREF.CRSTAB,SQSATBLS    RETAIN PTR TO TABLE IDENTIFIER   01920000
         MVC   TREF.CRSTCOL@,CATCOLS   TBCOLDEF PTR ARRAY ORIGIN        01930000
         MVC   TREF.CRSTCOL#,CAT#COLS  NUMBER OF COLUMNS IN BASE TABLE  01940000
         DROP  R7                 CATINFO                               01950000
                                                                        01960000
CRSD     USING CRSDP,$CRSDP       CREATE RESULT SET DEFINITION REQ/RESP 01970000
         ST    R6,CRSD.CRSDSMRY   PROVIDE SEMANTIC SUMMARY AS PARM      01980000
         LA    R0,TREF.CRSTREF    TABLE REFERENCE LIST ORIGIN           01990000
         ST    R0,CRSD.CRSDTBL@   ANCHOR IN CRSDP                       02000000
         LA    R0,1               TABLE REFERENCE IS A SINGLETON        02010000
         ST    R0,CRSD.CRSDTBL#   ANCHOR IN CRSDP                       02020000
         DROP  TREF,R6            CRSDP TABLE REFERENCE, SQSEMAL        02030000
                                                                        02040000
         LA    R1,CRSD.CRSDP      R1 <== RESULT SET DEFINITION REQ/RESP 02050000
         @CALL ISQLCRSD,CTYPE=STD                                       02060000
                                                                        02070000
         ST    R15,RET_CRSD       RETAIN RESULT SET DEFINITION RETCODE  02080000
         CH    R15,=AL2(RC08)     ANALYZE RETURN CODE                   02090000
         BE    ERR_CREF           INVALID COLUMN REFERENCE              02100000
         BH    ERR_RSD            REQUEST IN ERROR                      02110000
                                                                        02120000
*--------------------------------------------------------------         02130000
*   BUILD RESULT SET INDEX DEFINITIONS, RETURN KYNDXRET IN R1           02140000
*--------------------------------------------------------------         02150000
                                                                        02160000
         @CALL ISQKYNDX,(QCS,*CRSD.CRSDPTR@,*CRSD.CRSDRSC#),           X02170000
               MF=(E,MFE_LIST)                                          02180000
                                                                        02190000
         B     *+4(R15)           ANALYZE COMPLETION CODE               02200000
         B     TBLCRE                RC00 - INDEX DEFINITION RETURNED   02210000
         B     TBLCRE                RC04 - NO INDICIES REQUIRED        02220000
         B     ERR_ORD               RC08 - ORDER-BY CLAUSE IN ERROR    02230000
         B     ERR_DIST              RC12 - ERROR RELATED TO DISTINCT   02240000
         EX    R0,*                  RC16 - DEFINED / NOT ANTICIPATED   02250000
                                                                        02260000
*--------------------------------------------------------------         02270000
*   CREATE THE RESULT SET                                               02280000
*--------------------------------------------------------------         02290000
                                                                        02300000
TBLCRE   DS    0H                                                       02310000
         XC    DWORD,DWORD        TBKEYDEF LIST AND ENTRY COUNT         02320000
         ST    R1,@NDXDEF         INDEX DEFINITION BLOCK OR ZERO        02330000
         LTR   R1,R1              INDEX DEFINITIONS PRESENTED?          02340000
         BZ    TBLCRETB           DONE HERE IF NOT                      02350000
                                                                        02360000
         USING KYNDXRET,R1        INDEX DEFINITION RETURN AREA          02370000
         LA    R0,KYNDXLST        TBKEYDEF LIST ORIGIN                  02380000
         ST    R0,DWORD+0         SAVE IN PARAMETER WORKAREA            02390000
         L     R0,KYNDXCNT        TBKEYDEF LIST ENTRY COUNT             02400000
         ST    R0,DWORD+4         SAVE IN PARAMETER WORKAREA            02410000
         DROP  R1                 KYNDXRET                              02420000
                                                                        02430000
TBLCRETB DS    0H                                                       02440000
         TBCREATE QCSTABLE,       PROVIDE GENERATED TABLE NAME         X02450000
               STOKEN=*ICTXSPT@,  EXECUTION SPACE                      X02460000
               TTOKEN=QCSTTOKN,   TABLE TOKEN IS GLOBAL SQL RESOURCE   X02470000
               COLCNT=*CRSD.CRSDTOT#,   COLUMN COUNT                   X02480000
               COLLST=*CRSD.CRSDPTR@,   COLUMN POINTER ARRAY           X02490000
               KEYCNT=*DWORD+4,   KEY COUNT                            X02500000
               KEYLST=*DWORD+0,   KEY LIST                             X02510000
               OPTS=(REPLACE,NOLOCATOR),                               X02520000
               MF=(E,WK256)                                             02530000
                                                                        02540000
*--------------------------------------------------------------         02550000
*   ANALYZE TBCREATE STATUS, RELEASE INDEX & RSD DEFINITIONS            02560000
*--------------------------------------------------------------         02570000
                                                                        02580000
         STM   R15,R1,RETCODES    PRESERVE TBCREATE COMPLETION STATUS   02590000
         ICM   R2,15,@NDXDEF      INDEX DEFINITION WORKAREA PENDING?    02600000
         BZ    TBLNONDX           SKIP IF NOT                           02610000
                                                                        02620000
         $RETSTOR (R2)            STORAGE OBLIGATION                    02630000
                                                                        02640000
TBLNONDX DS    0H                                                       02650000
                                                                        02660000
         CLC   RET_CRSD,=A(RC00)  RESULT SET DEFINITION CREATED?        02670000
         BNE   TBLNORSD           SKIP IF BASE TABLE DEFINITION USED    02680000
                                                                        02690000
         $RETSTOR *CRSD.CRSDPTR@                                        02700000
                                                                        02710000
TBLNORSD DS    0H                                                       02720000
                                                                        02730000
         LM    R15,R1,RETCODES    RESTORE TBCREATE COMPLETION STATUS    02740000
         LTR   R15,R15            TABLE CREATED WITHOUT INCIDENT?       02750000
         BNZ   ERR_TBSV           TERMINATING ERROR OTHERWISE           02760000
                                                                        02770000
         MVI   QCSTDROP,TRUE      AUTO DROP UPON CLOSE                  02780000
         DROP  CRSD               CREATE RESULT SET DEFINITION REQ/RESP 02790000
                                                                        02800000
*--------------------------------------------------------------         02810000
*   TERMINATE AT THIS POINT IF SQLPREPARE()                             02820000
*--------------------------------------------------------------         02830000
                                                                        02840000
         CLI   QCSCLI,QCSC_PRP    SQLPREPARE()?                         02850000
         BE    NORMRET            DONE IF SO                            02860000
                                                                        02870000
         EJECT                                                          02880000
***************************************************************         02890000
*                                                                       02900000
*   Identify columns that accept nulls included in result set.          02910000
*   Some columns have no local interpretation and are set               02920000
*   null for the life of this function.                                 02930000
*                                                                       02940000
***************************************************************         02950000
                                                                        02960000
         TBCOLUMN BYNAME,         IDENTIFY COLUMNS BY NAME             X02970000
               (('PRECISION',STAPRCSN),                                X02980000
               ('LITERAL_PREFIX',STALTPFX),                            X02990000
               ('LITERAL_SUFFIX',STALTSFX),                            X03000000
               ('CREATE_PARAMS',STAPARAM),                             X03010000
               ('UNSIGNED_ATTRIB',STAUNSGN),                           X03020000
               ('AUTO_INCREMENT',STAUTINC),                            X03030000
               ('LOCAL_TYPE_NAME',STALCLTY),                           X03040000
               ('MINIMUM_SCALE',STASCAMN),                             X03050000
               ('MAXIMUM_SCALE',STASCAMX)),                            X03060000
               TTOKEN=QCSTTOKN,                                        X03070000
               MF=(E,WK256)                                             03080000
                                                                        03090000
*--------------------------------------------------------------         03100000
*   PERM NULL COLUMNS NOT POPULATED IN THIS IMPLEMENTATION              03110000
*--------------------------------------------------------------         03120000
                                                                        03130000
         SR    R2,R2              R2 <== COLUMN NUMBER                  03140000
         LA    R3,NULL_SAV        R3 <== NULL INDICATOR MASK ORIGIN     03150000
                                                                        03160000
         ICM   R2,3,STAPARAM      CREATE_PARAMS                         03170000
         BZ    *+8                                                      03180000
         BAS   R14,SETNULL                                              03190000
                                                                        03200000
         ICM   R2,3,STAUTINC      AUTO_INCREMENT                        03210000
         BZ    *+8                                                      03220000
         BAS   R14,SETNULL                                              03230000
                                                                        03240000
         ICM   R2,3,STALCLTY      LOCAL_TYPE_NAME                       03250000
         BZ    *+8                                                      03260000
         BAS   R14,SETNULL                                              03270000
                                                                        03280000
         EJECT                                                          03290000
***************************************************************         03300000
*                                                                       03310000
*   Complete the predicate tree.  TBPSARG is issued to complete         03320000
*   the saearch argument passed to this routine, if any, with           03330000
*   references to the result set table created above.  The              03340000
*   near-ready tree is passed in via QCSSITRE and the TBPSARGed         03350000
*   tree is generally returned via QCSSATRE when it will be             03360000
*   used as a true TBGET search argument.  However, because we          03370000
*   will use it instead as a TBADD filter we leave QCSSATRE             03380000
*   null - all of the result set trimming will be accomplished          03390000
*   up front at TBADD time.                                             03400000
*                                                                       03410000
***************************************************************         03420000
                                                                        03430000
         ICM   R2,15,QCSSITRE     SEARCH ARGUMENT TREE PROVIDED?        03440000
         BZ    SARG_FIN           NO FURTHER PROCESSING IF NOT          03450000
                                                                        03460000
         TBPSARG TTOKEN=QCSTTOKN, CONVERT TO TABLE SERVICES EXEC FORM  X03470000
               SARGS=(R2),                                             X03480000
               XSTGMGR=(IGENCSTG,QCSGPSTG,WK256),                      X03490000
               MF=(E,MFE_LIST)                                          03500000
                                                                        03510000
         ST    R15,QCSPSARC       POST TBPSARG RETCODE                  03520000
         ST    R0,QCSPSARS        POST TBPSARG RSNCODE                  03530000
         LTR   R15,R15            NORMAL COMPLETION?                    03540000
         BNZ   ERR_ANAL           QCS ANALYSIS REQUIRED IF NOT          03550000
                                                                        03560000
         CLM   R0,1,=AL1(TRUE)    SEARCH ARG IS CATEGORICALLY TRUE?     03570000
         BNE   *+10               SKIP IF NOT                           03580000
         XC    QCSSITRE,QCSSITRE  SEARCH ARGUMENT / FILTER WITHDRAWN    03590000
                                                                        03600000
SARG_FIN DS    0H                                                       03610000
                                                                        03620000
         EJECT                                                          03630000
***************************************************************         03640000
*                                                                       03650000
*   Data type information is declared internally in this                03660000
*   routine using the ODBTIPRI (primary) and ODBTINUM (numeric)         03670000
*   data definition macros.  The result set is materialized             03680000
*   by issuing a provisional TBADD for each data type entry             03690000
*   after declaring the appropriate NULL values, etc. for               03700000
*   each ODBTIREC entry.                                                03710000
*                                                                       03720000
***************************************************************         03730000
                                                                        03740000
         LA    R5,TYPEINFO        LOCAL DATA TYPE INFORMATION TABLE     03750000
         USING ODBTIREC,R5                                              03760000
                                                                        03770000
TISCAN   DS    0H                                                       03780000
                                                                        03790000
         LA    R0,VCHARBUF        VARDATA COLLECTION AREA               03800000
         ST    R0,VCHAR@          ENTIRE AREA AVAILABLE FOR USE         03810000
         LA    R0,L'VCHARBUF      VARDATA COLLECTION AREA LENGTH        03820000
         ST    R0,VCHAR#          INITAL AMOUNT AVAILABLE FOR USE       03830000
                                                                        03840000
         XC    C.ODBTYPEI(ODBTYPEI_LENGTH),C.ODBTYPEI                   03850000
                                                                        03860000
*--------------------------------------------------------------         03870000
*   NULLS FOR OMITTED VALUES                                            03880000
*--------------------------------------------------------------         03890000
                                                                        03900000
         MVC   NULL_IND,NULL_SAV  INITIALIZE NULL INDICATOR ARRAY       03910000
         LA    R3,NULL_IND        R3 <== NULL INDICATOR ARRAY AS PARM   03920000
         SR    R2,R2              R2 <== COLUMN NUMBER                  03930000
                                                                        03940000
         CLI   ODBTIR_NULL_PRECISION,0                                  03950000
         BE    NU_PREC            SKIP IF NOT NULL                      03960000
         ICM   R2,3,STAPRCSN      R2 <== COLUMN NUMBER                  03970000
         BAS   R14,SETNULL        POST NULL INDICATOR                   03980000
NU_PREC  DS    0H                                                       03990000
                                                                        04000000
         CLI   ODBTIR_NULL_LITPFX,0                                     04010000
         BE    NU_LPFX            SKIP IF NOT NULL                      04020000
         ICM   R2,3,STALTPFX      R2 <== COLUMN NUMBER                  04030000
         BAS   R14,SETNULL        POST NULL INDICATOR                   04040000
NU_LPFX  DS    0H                                                       04050000
                                                                        04060000
         CLI   ODBTIR_NULL_LITSFX,0                                     04070000
         BE    NU_LSFX            SKIP IF NOT NULL                      04080000
         ICM   R2,3,STALTSFX      R2 <== COLUMN NUMBER                  04090000
         BAS   R14,SETNULL        POST NULL INDICATOR                   04100000
NU_LSFX  DS    0H                                                       04110000
                                                                        04120000
         CLI   ODBTIR_NULL_UNSIGNED,0                                   04130000
         BE    NU_UNSG            SKIP IF NOT NULL                      04140000
         ICM   R2,3,STAUNSGN      R2 <== COLUMN NUMBER                  04150000
         BAS   R14,SETNULL        POST NULL INDICATOR                   04160000
NU_UNSG  DS    0H                                                       04170000
                                                                        04180000
         CLI   ODBTIR_NULL_MINSCALE,0                                   04190000
         BE    NU_MINS            SKIP IF NOT NULL                      04200000
         ICM   R2,3,STASCAMN      R2 <== COLUMN NUMBER                  04210000
         BAS   R14,SETNULL        POST NULL INDICATOR                   04220000
NU_MINS  DS    0H                                                       04230000
                                                                        04240000
         CLI   ODBTIR_NULL_MAXSCALE,0                                   04250000
         BE    NU_MAXS            SKIP IF NOT NULL                      04260000
         ICM   R2,3,STASCAMX      R2 <== COLUMN NUMBER                  04270000
         BAS   R14,SETNULL        POST NULL INDICATOR                   04280000
NU_MAXS  DS    0H                                                       04290000
                                                                        04300000
*--------------------------------------------------------------         04310000
*   CONVERT SZ DESCRIPTOR STRINGS TO VARCHAR FORMAT                     04320000
*--------------------------------------------------------------         04330000
                                                                        04340000
         L     R2,ODBTIR_TYPE_NAME    DATA TYPE NAME                    04350000
         L     R3,ODBTIR_TYPE_NAME_LEN                                  04360000
                                                                        04370000
         $VARTRMC ((R2),(R3)),VCHAR@,VCHAR#                             04380000
                                                                        04390000
         BZ    *+8                                                      04400000
         EX    R0,*                   ASSERT SPACE AVAILABLE            04410000
         ST    R1,C.ODBTYPE_TYPE_NAME                                   04420000
                                                                        04430000
         ICM   R2,15,ODBTIR_LITPFX    LITERAL VALUE PREFIX              04440000
         BZ    NOPFX                  SKIP IF NOT                       04450000
         L     R3,ODBTIR_LITPFX_LEN                                     04460000
                                                                        04470000
         $VARTRMC ((R2),(R3)),VCHAR@,VCHAR#                             04480000
                                                                        04490000
         BZ    *+8                                                      04500000
         EX    R0,*                   ASSERT SPACE AVAILABLE            04510000
         ST    R1,C.ODBTYPE_LITERAL_PREFIX                              04520000
NOPFX    DS    0H                                                       04530000
                                                                        04540000
         ICM   R2,15,ODBTIR_LITSFX    LITERAL VALUE SUFFIX              04550000
         BZ    NOSFX                  SKIP IF NOT                       04560000
         L     R3,ODBTIR_LITSFX_LEN                                     04570000
                                                                        04580000
         $VARTRMC ((R2),(R3)),VCHAR@,VCHAR#                             04590000
                                                                        04600000
         BZ    *+8                                                      04610000
         EX    R0,*                   ASSERT SPACE AVAILABLE            04620000
         ST    R1,C.ODBTYPE_LITERAL_SUFFIX                              04630000
NOSFX    DS    0H                                                       04640000
                                                                        04650000
*--------------------------------------------------------------         04660000
*   POST OTHER ASSOCIATED ATTRIBUTES                                    04670000
*--------------------------------------------------------------         04680000
                                                                        04690000
         MVC   C.ODBTYPE_DATA_TYPE,ODBTIR_DATA_TYPE                     04700000
         MVC   C.ODBTYPE_PRECISION,ODBTIR_PRECISION                     04710000
         MVC   C.ODBTYPE_NULLABLE,ODBTIR_NULLABLE                       04720000
         MVC   C.ODBTYPE_CASE_SENSITIVE,ODBTIR_CASE_SENSITIVE           04730000
         MVC   C.ODBTYPE_SEARCHABLE,ODBTIR_SEARCHABLE                   04740000
         MVC   C.ODBTYPE_UNSIGNED_ATTRIBUTE,ODBTIR_UNSIGNED             04750000
         MVC   C.ODBTYPE_MONEY,ODBTIR_MONEY                             04760000
         MVC   C.ODBTYPE_MINIMUM_SCALE,ODBTIR_MINSCALE                  04770000
         MVC   C.ODBTYPE_MAXIMUM_SCALE,ODBTIR_MAXSCALE                  04780000
                                                                        04790000
***************************************************************         04800000
*                                                                       04810000
*   Add the completed row to the result set                             04820000
*                                                                       04830000
***************************************************************         04840000
                                                                        04850000
         TBADD C.ODBTYPEI,        INSERT ROW IN RESULT SET             X04860000
               TTOKEN=QCSTTOKN,                                        X04870000
               FILTER=*QCSSITRE,  SEARCH ARGUMENT AS FILTER            X04880000
               NULLMASK=NULL_IND, NULL INDICATORS                      X04890000
               MF=(E,MFE_LIST)                                          04900000
                                                                        04910000
         CH    R15,=AL2(RC08)     ADDED OR SUPPRESSED PER REQUEST?      04920000
         BH    ERR_TBSV           ERROR OTHERWISE                       04930000
                                                                        04940000
*--------------------------------------------------------------         04950000
*   ADVANCE TO NEXT COLUMN DESCRIPTOR AND REPEAT                        04960000
*--------------------------------------------------------------         04970000
                                                                        04980000
         LA    R5,ODBTIREC_NEXT   ADVANCE TO NEXT ODBTIREC ENTRY        04990000
         LA    R0,TYPEIFIN        END OF ENTRIES                        05000000
         CR    R5,R0              ENTRIES REMAIN?                       05010000
         BL    TISCAN             NEXT TABLE                            05020000
         DROP  R5                 ODBTIREC                              05030000
                                                                        05040000
         EJECT                                                          05050000
***************************************************************         05060000
*                                                                       05070000
*   RETURN RESULT SET AND/OR COMPLETION STATUS TO REQUESTER             05080000
*                                                                       05090000
***************************************************************         05100000
                                                                        05110000
NORMRET  DS    0H                 FORMAT DATA FOR RETURN                05120000
         MVC   QCSTSPAC,ICTXSPT@  RETURN EXECUTION SPACE TOKEN          05130000
         B     RETURN             DONE                                  05140000
                                                                        05150000
*--------------------------------------------------------------         05160000
*   REFERENCE TO UNDEFINED COLUMN                                       05170000
*--------------------------------------------------------------         05180000
                                                                        05190000
ERR_CREF DS    0H                 INVALID COLUMN REFERENCE              05200000
CREF     USING SQCOLREF,R1        COLUMN OCCURRENCE                     05210000
         MVC   QCSECLEX,CREF.SQCOL@C   #CLEX ADDRESS                    05220000
                                                                        05230000
         SQLSTAT ERC_CREF                                               05240000
                                                                        05250000
         B     RETURN                                                   05260000
         DROP  CREF               SQCOLREF                              05270000
                                                                        05280000
*--------------------------------------------------------------         05290000
*   ORDER BY CLAUSE ERROR                                               05300000
*--------------------------------------------------------------         05310000
                                                                        05320000
ERR_ORD  DS    0H                 ERROR IN 'ORDER BY' CLAUSE            05330000
         LR    R2,R1              SUPPLEMENTAL MESSAGE                  05340000
                                                                        05350000
         SQLSTAT ERC_ORD,INFO=(R15)                                     05360000
                                                                        05370000
         SQLMSG 170,(R2)                                                05380000
                                                                        05390000
         B     RETURN                                                   05400000
                                                                        05410000
*--------------------------------------------------------------         05420000
*   DISTINCT KEYDEF BUILD ERROR                                         05430000
*--------------------------------------------------------------         05440000
                                                                        05450000
ERR_DIST DS    0H                 ERROR BUILDING INDEX serving DISTINCT 05460000
         SQLSTAT ERC_DIST,INFO=(R15)                                    05470000
                                                                        05480000
         B     RETURN                                                   05490000
                                                                        05500000
*--------------------------------------------------------------         05510000
*   RESULT SET DEFINITION - CONSTRUCTION ERROR                          05520000
*--------------------------------------------------------------         05530000
                                                                        05540000
ERR_RSD  DS    0H                 ERROR CONSTRUCTING RSD                05550000
         SQLSTAT ERC_RSD,INFO=(R15)                                     05560000
                                                                        05570000
         B     RETURN                                                   05580000
                                                                        05590000
*--------------------------------------------------------------         05600000
*   TABLE SERVICE FAILURE                                               05610000
*--------------------------------------------------------------         05620000
                                                                        05630000
ERR_TBSV DS    0H                                                       05640000
         SQLIDCMP COMPONENT='TABLE SERVICES'                            05650000
                                                                        05660000
         SQLSTAT ERC_TBSV,INFO=(R15)                                    05670000
                                                                        05680000
         B     RETURN                                                   05690000
                                                                        05700000
*--------------------------------------------------------------         05710000
*   SERVICE FAILURE, QCS ANALYSIS REQUIRED FOR DETAIL                   05720000
*--------------------------------------------------------------         05730000
                                                                        05740000
ERR_ANAL DS    0H                 QCS ANALYSIS REQUIRED                 05750000
         SQLSTAT ERC_ANALYZE                                            05760000
                                                                        05770000
         B     RETURN                                                   05780000
                                                                        05790000
*--------------------------------------------------------------         05800000
*   RETURN                                                              05810000
*--------------------------------------------------------------         05820000
                                                                        05830000
RETURN   DS    0H                                                       05840000
                                                                        05850000
         #EXIT ,                                                        05860000
                                                                        05870000
         EJECT                                                          05880000
***************************************************************         05890000
*                                                                       05900000
*   Catastrophic failures, programming errors, etc.                     05910000
*                                                                       05920000
***************************************************************         05930000
                                                                        05940000
ABN_FAIL $ABEND ABE_ENV,DUMP=YES,                                      X05950000
               TITLE='RESULT SET DEFINITION - GENERATION ERROR'         05960000
                                                                        05970000
                                                                        05980000
         EJECT                                                          05990000
***************************************************************         06000000
*                                                                       06010000
* ROUTINE: SETNULL - SET NULL MASK BIT FOR GIVEN COLUMN                 06020000
*                                                                       06030000
* ON ENTRY:                                                             06040000
*                                                                       06050000
*    R3 - MASK ORIGIN                                                   06060000
*    R2 - COLUMN NUMBER (1 TO N)                                        06070000
*                                                                       06080000
***************************************************************         06090000
                                                                        06100000
SETNULL  DS    0H                                                       06110000
         ST    R14,FWORD          PRESERVE RETURN ADDRESS               06120000
                                                                        06130000
         SETBIT (R3),(R2)                                               06140000
                                                                        06150000
         L     R14,FWORD          RESTORE RETURN ADDRESS                06160000
         BR    R14                RETURN                                06170000
                                                                        06180000
         EJECT                                                          06190000
***************************************************************         06200000
*                                                                       06210000
*   Data type information table                                         06220000
*                                                                       06230000
***************************************************************         06240000
                                                                        06250000
TYPEINFO DS    0F                                                       06260000
                                                                        06270000
         ODBTIPRI BINARY,                   TYPE / TYPE NAME LABEL     X06280000
               TBC_LENGTH_MAX_BINARY,       MAXIMUM PRECISION          X06290000
               SQL_NULLABLE,                NULLABILITY                X06300000
               SQL_ALL_EXCEPT_LIKE,         SEARCHABILITY              X06310000
               FALSE                        CASE SENSITIVITY            06320000
                                                                        06330000
         ODBTIPRI VARBINARY,                TYPE / TYPE NAME LABEL     X06340000
               TBC_LENGTH_MAX_LONG_VARDATA, MAXIMUM PRECISION          X06350000
               SQL_NULLABLE,                NULLABILITY                X06360000
               SQL_ALL_EXCEPT_LIKE,         SEARCHABILITY              X06370000
               FALSE                        CASE SENSITIVITY            06380000
                                                                        06390000
         ODBTIPRI LONGVARBINARY,            TYPE / TYPE NAME LABEL     X06400000
               TBC_LENGTH_MAX_LONG_VARDATA, MAXIMUM PRECISION          X06410000
               SQL_NULLABLE,                NULLABILITY                X06420000
               SQL_ALL_EXCEPT_LIKE,         SEARCHABILITY              X06430000
               FALSE                        CASE SENSITIVITY            06440000
                                                                        06450000
         ODBTIPRI CHAR,                     TYPE / TYPE NAME LABEL     X06460000
               TBC_LENGTH_MAX_CHAR,         MAXIMUM PRECISION          X06470000
               SQL_NULLABLE,                NULLABILITY                X06480000
               SQL_SEARCHABLE,              SEARCHABILITY              X06490000
               TRUE,                        CASE SENSITIVITY           X06500000
               DLMS=(QUOTESZ,QUOTESZ)       LITERAL DLMS                06510000
                                                                        06520000
         ODBTIPRI VARCHAR,                  TYPE / TYPE NAME LABEL     X06530000
               TBC_LENGTH_MAX_LONG_VARDATA, MAXIMUM PRECISION          X06540000
               SQL_NULLABLE,                NULLABILITY                X06550000
               SQL_SEARCHABLE,              SEARCHABILITY              X06560000
               TRUE,                        CASE SENSITIVITY           X06570000
               DLMS=(QUOTESZ,QUOTESZ)       LITERAL DLMS                06580000
                                                                        06590000
         ODBTIPRI LONGVARCHAR,              TYPE / TYPE NAME LABEL     X06600000
               TBC_LENGTH_MAX_LONG_VARDATA, MAXIMUM PRECISION          X06610000
               SQL_NULLABLE,                NULLABILITY                X06620000
               SQL_SEARCHABLE,              SEARCHABILITY              X06630000
               TRUE,                        CASE SENSITIVITY           X06640000
               DLMS=(QUOTESZ,QUOTESZ)       LITERAL DLMS                06650000
                                                                        06660000
         ODBTINUM INTEGER,                  TYPE / TYPE NAME LABEL     X06670000
               TBC_PRECISION_INTEGER,       MAXIMUM PRECISION          X06680000
               SQL_NULLABLE,                NULLABILITY                X06690000
               SQL_ALL_EXCEPT_LIKE,         SEARCHABILITY              X06700000
               FALSE,                       UNSIGNED                   X06710000
               TBC_SCALE_INTEGRAL           SCALE RANGE                 06720000
                                                                        06730000
         ODBTINUM SMALLINT,                 TYPE / TYPE NAME LABEL     X06740000
               TBC_PRECISION_SMALLINT,      MAXIMUM PRECISION          X06750000
               SQL_NULLABLE,                NULLABILITY                X06760000
               SQL_ALL_EXCEPT_LIKE,         SEARCHABILITY              X06770000
               FALSE,                       UNSIGNED                   X06780000
               TBC_SCALE_INTEGRAL           SCALE RANGE                 06790000
                                                                        06800000
         ODBTINUM TINYINT,                  TYPE / TYPE NAME LABEL     X06810000
               TBC_PRECISION_TINYINT,       MAXIMUM PRECISION          X06820000
               SQL_NULLABLE,                NULLABILITY                X06830000
               SQL_ALL_EXCEPT_LIKE,         SEARCHABILITY              X06840000
               FALSE,                       UNSIGNED                   X06850000
               TBC_SCALE_INTEGRAL           SCALE RANGE                 06860000
                                                                        06870000
TYPEIFIN DS    0F                                                       06880000
                                                                        06890000
*--------------------------------------------------------------         06900000
*   DATA TYPE NAMES                                                     06910000
*--------------------------------------------------------------         06920000
                                                                        06930000
BINARY         DC    C'BINARY'                                          06940000
VARBINARY      DC    C'VARBINARY'                                       06950000
LONGVARBINARY  DC    C'LONG VARBINARY'                                  06960000
                                                                        06970000
CHAR           DC    C'CHAR'                                            06980000
VARCHAR        DC    C'VARCHAR'                                         06990000
LONGVARCHAR    DC    C'LONG VARCHAR'                                    07000000
                                                                        07010000
INTEGER        DC    C'INTEGER'                                         07020000
SMALLINT       DC    C'SMALLINT'                                        07030000
TINYINT        DC    C'TINYINT'                                         07040000
                                                                        07050000
QUOTESZ        DC    C''''                                              07060000
                                                                        07070000
         EJECT                                                          07080000
***************************************************************         07090000
*                                                                       07100000
*   Local read-only working storage                                     07110000
*                                                                       07120000
***************************************************************         07130000
                                                                        07140000
         LTORG ,                                                        07150000
                                                                        07160000
         EJECT                                                          07170000
         SQLCODES ,                                                     07180000
                                                                        07190000
         EJECT                                                          07200000
         PRINT NOGEN                                                    07210000
         ICVT ,              ICVT                                       07220000
         ITASK ,             ITASK                                      07230000
         END   ,                                                        07240000
