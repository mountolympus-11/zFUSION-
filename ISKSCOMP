* ?????                                                                 00010000
* ????? COMPLETE SKSLEN FUNCTION. IT IS CURRENTLY NOT NEEDED BECAUSE    00020000
* ????? THE WORKBENCH ENSURES THAT ONLY A SINGLE SCROLL SKS IS          00030000
* ????? DEFINED AGAINST A GIVEN SCREEN SET.                             00040000
* ?????                                                                 00050000
                                                                        00060000
ISKSCOMP TITLE '- RECORDED SKS COMPARE'                                 00070000
**<DOC-ON>*****************************************************         00080000
*                                                                       00090000
* ROUTINE:  ISKSCOMP - RECORDED SKS COMPARE                             00100000
*                                                                       00110000
* DESCRIPTION:                                                          00120000
*                                                                       00130000
*    THIS ROUTINE IS USED TO COMPARE TWO SYSSKS TABLE ENTRIES           00140000
*    CREATED BY SESSION RECORDING.  THE SKS ENTRIES MATCH IF            00150000
*    THEY ARE IDENTICAL (A BYTE-FOR-BYTE COMPARE).                      00160000
*                                                                       00170000
*                                                                       00180000
* NOTES:                                                                00190000
*                                                                       00200000
*    SKS ENTRIES ARE RETRIEVE IF IDENTIFIED ONLY BY ROW ID.             00210000
*    AT PRESENT, THEY ARE DISCARDED UPON EXIT.                          00220000
*                                                                       00230000
*                                                                       00240000
* ON ENTRY:                                                             00250000
*                                                                       00260000
*    R1  CONTAINS THE ADDRESS OF A PARAMETER LIST DESCRIBED BY          00270000
*        THE CSKSPARM MAPPING                                           00280000
*                                                                       00290000
*                                                                       00300000
* ON EXIT:                                                              00310000
*                                                                       00320000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES.  REASON            00330000
*        CODES, WHERE DEFINED, ARE RETURNED VIA R0.                     00340000
*                                                                       00350000
*                                                                       00360000
*        RC00 - MATCH PERFORMED WITHOUT ERROR                           00370000
*                                                                       00380000
*               RSN00 - SKS ENTRIES MATCH                               00390000
*               RSN04 - SKS ENTRIES DO NOT MATCH                        00400000
*                                                                       00410000
*        RC04 - ONE OF THE SKS ENTRIES IDENTIFIED BY ROW ID             00420000
*               WAS NOT FOUND.  R0 CONTAINS THE ERRANT ROW ID           00430000
*                                                                       00440000
*        RC08 - INVALID SKS.  R0 CONTAINS THE ERRANT ROW ID.            00450000
*               R1 CONTAINS A PTR TO THE INVALID SKS CONSTRUCT          00460000
*               OR ZERO                                                 00470000
*                                                                       00480000
*        RC12 - INVALID OR INCOMPLETE REQUEST                           00490000
*                                                                       00500000
**<DOC-OFF>****************************************************         00510000
                                                                        00520000
         EJECT                                                          00530000
         #WORK                                                          00540000
                                                                        00550000
ALEN     DS    F                  LENGTH OF SKS (A)                     00560000
BLEN     DS    F                  LENGTH OF SKS (B)                     00570000
AORG     DS    A                  ADDR OF SKS (A)                       00580000
BORG     DS    A                  ADDR OF SKS (B)                       00590000
                                                                        00600000
STATREGS DS    3F                 R15-R1                                00610000
REGSAVE  DS    16F                LOCAL SUBROUTINE SAVEAREA             00620000
                                                                        00630000
@ABUFR   DS    A,F                SKS (A) BUFFER ORIGIN & LENGT         00640000
@BBUFR   DS    A,F                SKS (B) BUFFER ORIGIN & LENGT         00650000
ASKSBUF  DS    XL64               SKS (A) RETRIEVAL AREA                00660000
BSKSBUF  DS    XL64               SKS (B) RETRIEVAL AREA                00670000
                                                                        00680000
         #ENDWORK                                                       00690000
                                                                        00700000
         EJECT                                                          00710000
***************************************************************         00720000
*                                                                       00730000
* MAPPING: CSKSPARM - RECORDED SKS COMPARE PARAMETER LIST               00740000
*                                                                       00750000
***************************************************************         00760000
CSKSPARM DSECT                                                          00770000
CSKSPROJ DS    A                  PROJECT IPROJ                         00780000
CSKSIDA  DS    F                  SKS (A) ROWID                         00790000
CSKSPTRA DS    A                  SKS (A) ANCHOR ADDRESS OR ZERO        00800000
CSKSIDB  DS    F                  SKS (B) ROWID                         00810000
CSKSPTRB DS    A                  SKS (B) ANCHOR ADDRESS OR ZERO        00820000
CSKSPLN  EQU   *-CSKSPARM         PARAMETER BLOCK LENGTH                00830000
                                                                        00840000
         EJECT                                                          00850000
         IPROJ ,                  PROJECT CONTROL BLOCK                 00860000
                                                                        00870000
         EJECT                                                          00880000
         ICATALOG SKS                                                   00890000
                                                                        00900000
         EJECT                                                          00910000
         TBSERVIS GET             TABLE SERVICES                        00920000
                                                                        00930000
         EJECT                                                          00940000
         ABCODES PRINT=NOGEN                                            00950000
                                                                        00960000
         EQUS  ,                                                        00970000
                                                                        00980000
         EJECT                                                          00990000
ISKSCOMP #ENTER PREG=R8                                                 01000000
                                                                        01010000
         USING  ITASK,R10         STDENV                                01020000
         L      R9,TSKPCBC        PROCESS MODE                          01030000
         USING  IPCB,R9                                                 01040000
                                                                        01050000
         EJECT                                                          01060000
***************************************************************         01070000
*                                                                       01080000
*   GENERAL INITIALIZATION, ACCEPT PASSED PARAMETERS                    01090000
*                                                                       01100000
***************************************************************         01110000
         USING CSKSPARM,R8        LIFE OF FUNCTION PLIST ADDRESSABILITY 01120000
         L     R7,CSKSPROJ        PROJECT BLOCK                         01130000
         USING IPROJ,R7           LIFE OF FUNCTION ADDRESSABILITY       01140000
                                                                        01150000
         ICM   R1,15,CSKSPTRA     ANCHOR PTR PROVIDED FOR SKS (A)?      01160000
         BZ    NOAPTRA            SKIP IF NOT                           01170000
         ICM   R1,15,0(R1)        PTR PLANTED?                          01180000
         BZ    NOAPTRA            SKIP IF NOT                           01190000
         ST    R1,AORG            ELSE RETAIN SKS (A) ORIGIN            01200000
                                                                        01210000
NOAPTRA  DS    0H                                                       01220000
                                                                        01230000
         ICM   R1,15,CSKSPTRB     ANCHOR PTR PROVIDED FOR SKS (B)?      01240000
         BZ    NOAPTRB            SKIP IF NOT                           01250000
         ICM   R1,15,0(R1)        PTR PLANTED?                          01260000
         BZ    NOAPTRB            SKIP IF NOT                           01270000
         ST    R1,BORG            ELSE RETAIN SKS (B) ORIGIN            01280000
                                                                        01290000
NOAPTRB  DS    0H                                                       01300000
                                                                        01310000
***************************************************************         01320000
*                                                                       01330000
*   FETCH SKS ENTRIES BY SYSSKS ROWID WHERE NECESSARY                   01340000
*                                                                       01350000
***************************************************************         01360000
         LA    R0,ASKSBUF         SKS (A) RETRIEVAL AREA                01370000
         O     R0,=X'80000000'    INDICATE STATIC STORAGE               01380000
         LA    R1,L'ASKSBUF       SKS (A) RETRIEVAL AREA LENGTH         01390000
         STM   R0,R1,@ABUFR       POST SKS (A)                          01400000
                                                                        01410000
         LA    R0,BSKSBUF         SKS (B) RETRIEVAL AREA                01420000
         O     R0,=X'80000000'    INDICATE STATIC STORAGE               01430000
         LA    R1,L'BSKSBUF       SKS (B) RETRIEVAL AREA LENGTH         01440000
         STM   R0,R1,@BBUFR       POST SKS (B)                          01450000
                                                                        01460000
*--------------------------------------------------------------         01470000
*   LOAD SKS (A)                                                        01480000
*--------------------------------------------------------------         01490000
         ICM   R0,15,AORG         SKS (A) PRELOADED?                    01500000
         BNZ   AINSTG             SKIP IF SO                            01510000
         ICM   R0,15,CSKSIDA      ROW ID GIVEN?                         01520000
         BNP   ERR_REQ            REQUEST IN ERROR OTHERWISE            01530000
         LA    R1,@ABUFR          SKS (A) RETRIEVAL BUFFER DESC         01540000
         BAS   R14,LOADSKS        LOAD THE SKS                          01550000
         LTR   R15,R15            ANALYZE COMPLETION STATUS             01560000
         BNZ   ERR_NF             SKS NOT FOUND                         01570000
                                                                        01580000
         L     R5,@ABUFR          LOCATE SKS ENTRY                      01590000
         USING SYSSKS,R5          FORMAT                                01600000
         LM    R2,R3,SSKSCRPT     SCRIPT LENGTH AND ORIGIN              01610000
         ST    R2,ALEN            POST LENGTH                           01620000
         ST    R3,AORG            POST ORIGIN                           01630000
         DROP  R5                 SYSSKS                                01640000
                                                                        01650000
AINSTG   DS    0H                                                       01660000
                                                                        01670000
*--------------------------------------------------------------         01680000
*   LOAD SKS (B)                                                        01690000
*--------------------------------------------------------------         01700000
         ICM   R0,15,BORG         SKS (B) PRELOADED?                    01710000
         BNZ   BINSTG             SKIP IF SO                            01720000
         ICM   R0,15,CSKSIDB      ROW ID GIVEN?                         01730000
         BNP   ERR_REQ            REQUEST IN ERROR OTHERWISE            01740000
         LA    R1,@BBUFR          SKS (B) RETRIEVAL BUFFER DESC         01750000
         BAS   R14,LOADSKS        LOAD THE SKS                          01760000
         LTR   R15,R15            ANALYZE COMPLETION STATUS             01770000
         BNZ   ERR_NF             SKS NOT FOUND                         01780000
                                                                        01790000
         L     R5,@BBUFR          LOCATE SKS ENTRY                      01800000
         USING SYSSKS,R5          FORMAT                                01810000
         LM    R2,R3,SSKSCRPT     SCRIPT LENGTH AND ORIGIN              01820000
         ST    R2,BLEN            POST LENGTH                           01830000
         ST    R3,BORG            POST ORIGIN                           01840000
         DROP  R5                 SYSSKS                                01850000
                                                                        01860000
BINSTG   DS    0H                                                       01870000
                                                                        01880000
***************************************************************         01890000
*                                                                       01900000
*   DETERMINE LENGTH OF EACH SKS                                        01910000
*                                                                       01920000
***************************************************************         01930000
         ICM   R0,15,ALEN         FETCH SKS (A) LENGTH                  01940000
         BNZ   ASETLEN            SKIP IF LENGTH PREVIOUSLY DETERMINED  01950000
         L     R1,AORG            ELSE GET SKS ORIGIN                   01960000
         BAS   R14,LENSKS         DETERMINE SKS LENGTH                  01970000
         LTR   R15,R15            ANALYZE COMPLETION STATUS             01980000
         BNZ   ERR_SKS            SKS IS INVALID                        01990000
         ST    R0,ALEN            SAVE SKS LENGTH                       02000000
                                                                        02010000
ASETLEN  DS    0H                                                       02020000
                                                                        02030000
         ICM   R0,15,BLEN         FETCH SKS (B) LENGTH                  02040000
         BNZ   BSETLEN            SKIP IF LENGTH PREVIOUSLY DETERMINED  02050000
         L     R1,BORG            ELSE GET SKS ORIGIN                   02060000
         BAS   R14,LENSKS         DETERMINE SKS LENGTH                  02070000
         LTR   R15,R15            ANALYZE COMPLETION STATUS             02080000
         BNZ   ERR_SKS            SKS IS INVALID                        02090000
         ST    R0,BLEN            SAVE SKS LENGTH                       02100000
                                                                        02110000
BSETLEN  DS    0H                                                       02120000
                                                                        02130000
***************************************************************         02140000
*                                                                       02150000
*   COMPARE THE SKS ENTRIES                                             02160000
*                                                                       02170000
***************************************************************         02180000
         LA    R0,RSN04           ASSUME SKS ENTRIES DO NOT MATCH       02190000
         L     R3,ALEN            LENGTH OF SKS (A)                     02200000
         C     R3,BLEN            MATCHING LENGTHS?                     02210000
         BNE   NORMRET            FAIL IF NOT                           02220000
         LR    R5,R3              SOURCE LENGTH = TARGET LENGTH         02230000
         L     R2,AORG            SKS (A)                               02240000
         L     R4,BORG            SKS (B)                               02250000
         CLCL  R2,R4              COMPARE                               02260000
         BNE   NORMRET            FAIL IF NOT LITERALLY EQUAL           02270000
         LA    R0,RSN00           INDICATE IDENTICAL COPIES             02280000
                                                                        02290000
         EJECT                                                          02300000
***************************************************************         02310000
*                                                                       02320000
*   NORMAL AND ABNORMAL COMPLETION                                      02330000
*                                                                       02340000
***************************************************************         02350000
NORMRET  DS    0H                 MATCH EVALUATED                       02360000
         LA    R15,RC00           NORMAL COMPLETION                     02370000
         B     RETURN             DONE                                  02380000
                                                                        02390000
ERR_NF   DS    0H                 SKS NOT FOUND - ROW ID IN R0          02400000
         LA    R15,RC04           ERROR COMPLETION                      02410000
         B     RETURN             DONE                                  02420000
                                                                        02430000
ERR_SKS  DS    0H                 INVALID SKS - ROW ID IN R0            02440000
         LA    R15,RC08           ERROR COMPLETION                      02450000
         B     RETURN             DONE                                  02460000
                                                                        02470000
ERR_REQ  DS    0H                 INCOMPLETE OR INVALID REQUEST         02480000
         LA    R15,RC12           ERROR COMPLETION                      02490000
         B     RETURN             DONE                                  02500000
                                                                        02510000
*--------------------------------------------------------------         02520000
*   RELEASE SKS SPILL BUFFERS                                           02530000
*--------------------------------------------------------------         02540000
RETURN   DS    0H                                                       02550000
         ICM   R6,15,@ABUFR       SPILL SKS (A) BUFFER ALLOCATED?       02560000
         BNP   SPILLA             SKIP IF NOT                           02570000
                                                                        02580000
         $RETSTOR (R6)            RELEASE ACQUIRED STORAGE              02590000
                                                                        02600000
SPILLA   DS    0H                                                       02610000
                                                                        02620000
         ICM   R6,15,@BBUFR       SPILL SKS (B) BUFFER ALLOCATED?       02630000
         BNP   SPILLB             SKIP IF NOT                           02640000
                                                                        02650000
         $RETSTOR (R6)            RELEASE ACQUIRED STORAGE              02660000
                                                                        02670000
SPILLB   DS    0H                                                       02680000
                                                                        02690000
*--------------------------------------------------------------         02700000
*   RETURN COMPLETION STATUS TO REQUESTOR                               02710000
*--------------------------------------------------------------         02720000
         #EXIT ,                  RETURN                                02730000
                                                                        02740000
         EJECT                                                          02750000
***************************************************************         02760000
*                                                                       02770000
* ROUTINE:  LOADSKS - LOAD AN SKS ENTRY INTO LOCAL STORAGE              02780000
*                                                                       02790000
* ON ENTRY:                                                             02800000
*                                                                       02810000
*    R0  - SKS ROW ID                                                   02820000
*                                                                       02830000
*    R1  - ADDR OF INITIALIZED BUFFER PTR/LENGTH IN $REALLOC            02840000
*          FORMAT                                                       02850000
*                                                                       02860000
* ON EXIT:                                                              02870000
*                                                                       02880000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                     02890000
*                                                                       02900000
*        RC00 - SKS LOADED INTO BUFFER PROVIDED                         02910000
*        RC04 - ROW ID PROVIDED IS NOT VALID                            02920000
*                                                                       02930000
***************************************************************         02940000
LOADSKS  DS    0H                                                       02950000
         STM   R0,R15,REGSAVE     SAVE MAINLINE REGS                    02960000
         LR    R2,R0              ACCEPT ROW ID                         02970000
         LR    R4,R1              BUFFER PTR / LENGTH                   02980000
                                                                        02990000
*--------------------------------------------------------------         03000000
*   FETCH THE DESIGNATED SYSSKS ENTRY                                   03010000
*--------------------------------------------------------------         03020000
LOADFET  DS    0H                                                       03030000
         L     R5,0(,R4)          ROW BUFFER                            03040000
         L     R6,4(,R4)          BUFFER LENGTH                         03050000
                                                                        03060000
         TBGET (R5),              ACQUIRE DESIGNATED SYSSKS ROW        X03070000
               LENGTH=(R6),                                            X03080000
               POS=(R2),                                               X03090000
               TTOKEN=PRJTKSKS,                                        X03100000
               MF=(E,MFE_LIST)                                          03110000
                                                                        03120000
         CH    R15,=AL2(RC12)     ANTICIPATED COMPLETION STATUS?        03130000
         BH    ABN_TBSV           TERMINATE IF NOT                      03140000
         B     *+4(R15)           ANALYZE COMPLETION                    03150000
         B     LOADNORM           ROW ACQUIRED                          03160000
         B     LOADSIZE           LARGER BUFFER NEEDED                  03170000
         B     LOADERR            RETRIEVAL FAILURE                     03180000
                                                                        03190000
*--------------------------------------------------------------         03200000
*   TBGET FAILED BECAUSE BUFFER IS TOO SMALL - REALLOCATE IT            03210000
*--------------------------------------------------------------         03220000
LOADSIZE DS    0H                                                       03230000
         LR    R3,R0              MIN BUFFER SIZE REQUIRED              03240000
                                                                        03250000
         $REALLOC (R4),(R3),      REALLOCATE SKS BUFFER ACCORDINGLY    X03260000
               MF=(E,MFE_LIST)                                          03270000
                                                                        03280000
         B     LOADFET            TRY AGAIN                             03290000
                                                                        03300000
*--------------------------------------------------------------         03310000
*   TBGET FAILED, ALLOW ROW-NOT-FOUND, FAIL ANY OTHER COMP STAT         03320000
*--------------------------------------------------------------         03330000
LOADERR  DS    0H                                                       03340000
         CH    R0,=AL2(RSN12)     ROW NOT FOUND?                        03350000
         BE    LOADNF             INFORM CALLER                         03360000
         B     ABN_TBSV           ELSE MORE SERIOUS PROBLEM             03370000
                                                                        03380000
*--------------------------------------------------------------         03390000
*   RETURN COMPLETION STATUS TO CALLER                                  03400000
*--------------------------------------------------------------         03410000
LOADNORM DS    0H                                                       03420000
         LA    R15,RC00           ROW ACQUIRED                          03430000
         B     LOADEXIT           DONE                                  03440000
                                                                        03450000
LOADNF   DS    0H                                                       03460000
         LA    R15,RC04           ROW NOT CONTAINED IN TABLE            03470000
                                                                        03480000
LOADEXIT DS    0H                                                       03490000
         LM    R0,R14,REGSAVE     RESTORE MAINLINE REGS                 03500000
         LTR   R15,R15            REFLECT COMPLETION STATUS VIA CC'     03510000
         BR    R14                                                      03520000
                                                                        03530000
         EJECT                                                          03540000
***************************************************************         03550000
*                                                                       03560000
* ROUTINE:  LENSKS - DETERMINE LENGTH OF SKS                            03570000
*                                                                       03580000
* ON ENTRY:                                                             03590000
*                                                                       03600000
*    R1  - SKS SCRIPT ORIGIN                                            03610000
*                                                                       03620000
* ON EXIT:                                                              03630000
*                                                                       03640000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                     03650000
*                                                                       03660000
*        RC00 - SKS LENGTH RETURNED IN R0                               03670000
*                                                                       03680000
*        RC04 - SKS CONTAINS AN UNRECOGNIZED VERB, THE ADDRESS          03690000
*               OF WHICH IS RETURNED IN R1                              03700000
*                                                                       03710000
***************************************************************         03720000
LENSKS   DS    0H                                                       03730000
         STM   R0,R15,REGSAVE     SAVE MAINLINE REGS                    03740000
                                                                        03750000
         LA    R0,3               ?????????????????????????????         03760000
         LA    R15,RC00           DONE                                  03770000
                                                                        03780000
         LM    R0,R14,REGSAVE     RESTORE MAINLINE REGS                 03790000
         LTR   R15,R15            REFLECT COMPLETION STATUS VIA CC'     03800000
         BR    R14                                                      03810000
                                                                        03820000
         EJECT ,                                                        03830000
***************************************************************         03840000
*                                                                       03850000
*   CATASTOPHIC FAILURES, ETC.                                          03860000
*                                                                       03870000
***************************************************************         03880000
ABN_TBSV DS    0H                 CATALOG / TABLE SERVICE FAILURE       03890000
         $ABEND ABE_TBSERV,DUMP=YES,                                   X03900000
               TITLE='TABLE SERVICE FAILURE'                            03910000
                                                                        03920000
         EJECT                                                          03930000
***************************************************************         03940000
*                                                                       03950000
*   LOCAL READ-ONLY STORAGE AREAS, ETC.                                 03960000
*                                                                       03970000
***************************************************************         03980000
         LTORG ,                                                        03990000
                                                                        04000000
         PRINT NOGEN                                                    04010000
         ICVT  ,                                                        04020000
         ITASK ,                                                        04030000
         IPCB  ,                                                        04040000
         END   ,                                                        04050000
