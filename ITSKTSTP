ITSKTSTP TITLE '- TASK STOP ASYNC EPB RTN'                              00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE: ITSKTSTP - TASK STOP async EPB routine                       00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine receives control on a POST of the                     00080000
*    stop EPB.  The task flags are mark appropriate                     00090000
*    for the Stop / Cancel event and control is return                  00100000
*    to the task manager dispatcher to begin terminating                00110000
*    the task workunits.                                                00120000
*                                                                       00130000
* ON ENTRY:                                                             00140000
*                                                                       00150000
*    Upon entry to this routine the following register                  00160000
*    conventions are observed:                                          00170000
*                                                                       00180000
*        R0  - Event completion code                                    00190000
*        R15 - Entry address to async EPB routine                       00200000
*        R10 - ITASK Address                                            00210000
*        R11 - ICVT  Address                                            00220000
*                                                                       00230000
* ON EXIT:                                                              00240000
*                                                                       00250000
*    $TASK CALLDSP is issue to return control to the task               00260000
*    manager dispatcher.                                                00270000
*                                                                       00280000
* MODE:                                                                 00290000
*                                                                       00300000
*    TASK                                                               00310000
*    APF/NON-APF                                                        00320000
*    SUP/PROB                                                           00330000
*    AMODE 31, RMODE ANY                                                00340000
*                                                                       00350000
**<DOC-OFF>*****************************************************        00360000
                                                                        00370000
         EJECT ,                                                        00380000
****************************************************************        00390000
*                                                                       00400000
* MAINTENANCE:                                                          00410000
*                                                                       00420000
*   04/26/93 Ron Colmone                                                00430000
*            Initial Version                                            00440000
*                                                                       00450000
****************************************************************        00460000
         EJECT ,                                                        00470000
         $TASK DSECT=YES          TASK MANAGER PLIST                    00480000
                                                                        00490000
         EJECT ,                                                        00500000
         $PROC DSECT=YES          Process MANAGER PLIST                 00510000
                                                                        00520000
         EJECT ,                                                        00530000
         @EPB  ,                  EVENT PROCESS BLOCK                   00540000
                                                                        00550000
         EJECT ,                                                        00560000
         EQUS  ,                  GENERAL EQUATES                       00570000
                                                                        00580000
         EJECT ,                                                        00590000
ITSKTSTP CSECT ,                  TASK SHUTDOWN ASYNC RTN               00600000
         LR    R12,R15            ENTRY ADDRESS                         00610000
         USING ITSKTSTP,R12       ESTABLISH ADDRESSABILITY              00620000
         USING ITASK,R10          ESTABLISH ADDRESSABILITY              00630000
         USING ICVT,R11           ESTABLISH ADDRESSABILITY              00640000
                                                                        00650000
         @CPYRYT ,                COPYRIGHT                             00660000
                                                                        00670000
         LA    R13,TSKDSPSA       CALLDSP SAVEAREA                      00680000
                                                                        00690000
         EJECT ,                                                        00700000
****************************************************************        00710000
*                                                                       00720000
*  TASK SHUTDOWN ASYNC EPB RTN                                          00730000
*                                                                       00740000
****************************************************************        00750000
                                                                        00760000
         LTR   R0,R0              CANCEL SPECIFIED                      00770000
         BNZ   STOP_CNL           STOP_CNL                              00780000
                                                                        00790000
         OI    TSKFLGS,TSK$STOP   MARK TASK TERMINATION IN PROG         00800000
                                                                        00810000
         $PROC STOP,              STOP $MAIN$ PROCESS            159456+00820000
               PCB=*TSKPCB$M,                                    159456+00830000
               WORKA=0,                                          159456+00840000
               MF=(E,TSKP_MFL)                                   159456 00850000
                                                                        00860000
         B     STOP_DSP           CALL DISPATCHER                       00870000
                                                                        00880000
STOP_CNL DS    0H                                                       00890000
         OI    TSKFLGS,TSK$CNCL   MARK TASK CANCEL IN PROG              00900000
                                                                        00910000
         $PROC CANCEL,            CANCEL $MAIN$ PROCESS          159456+00920000
               PCB=*TSKPCB$M,                                    159456+00930000
               WORKA=0,                                          159456+00940000
               MF=(E,TSKP_MFL)                                   159456 00950000
                                                                        00960000
STOP_DSP DS    0H                                                       00970000
         $TASK CALLDSP,           CALL TASKMGR DISPATCHER              +00980000
               WORKA=*TSK@WRKA,                                        +00990000
               MF=(E,TSKT_MFL)                                          01000000
                                                                        01010000
         EJECT ,                                                        01020000
****************************************************************        01030000
*                                                                       01040000
*  CONSTANTS AND LITERALS                                               01050000
*                                                                       01060000
****************************************************************        01070000
                                                                        01080000
         LTORG ,                                                        01090000
                                                                        01100000
         PRINT NOGEN                                                    01110000
         ICVT  ,                                                        01120000
         ITASK ,                                                        01130000
         PRINT GEN                                                      01140000
                                                                        01150000
         END   ,                                                        01160000
