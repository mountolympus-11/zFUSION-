ISRVTRES TITLE '- Task restart routine - RESUME'                        00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE: ISRVTRES - Task restart routine - RESUME                     00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine is called to restart an ITASK running under           00080000
*    a server.  When the ITASK relinquishes control to the              00090000
*    server using a $SERVER SUSPEND,  the current environment           00100000
*    is preserved and the address of this restart routine is            00110000
*    placed in the ITASK.  This routine is called by the                00120000
*    server dispatcher when the task is ready to be dispatched          00130000
*    on the server.  The registers captured on the suspend              00140000
*    request are restored and the ITASK is resumed at the               00150000
*    instruction after the suspend.                                     00160000
*                                                                       00170000
* ON ENTRY:                                                             00180000
*                                                                       00190000
*    No special entry conventions.  R10 contains the address            00200000
*    of the task to be resumed.                                         00210000
*                                                                       00220000
* ON EXIT:                                                              00230000
*                                                                       00240000
*    Control is resumed at the instruction after the                    00250000
*    $SERVER SUSPEND request.                                           00260000
*                                                                       00270000
* MODE:                                                                 00280000
*                                                                       00290000
*    TASK                                                               00300000
*    APF/NON-APF                                                        00310000
*    SUP/PROB                                                           00320000
*    AMODE 31, RMODE ANY                                                00330000
*                                                                       00340000
**<DOC-OFF>*****************************************************        00350000
                                                                        00360000
         EJECT ,                                                        00370000
****************************************************************        00380000
*                                                                       00390000
* MAINTENANCE:                                                          00400000
*                                                                       00410000
*   01/21/95 Ron Colmone          Par# 159456                           00420000
*            Initial Version                                            00430000
*                                                                       00440000
****************************************************************        00450000
                                                                        00460000
         EJECT ,                                                        00470000
         $TASK DSECT=YES          TASK MANAGER PLIST                    00480000
                                                                        00490000
         EJECT ,                                                        00500000
         EQUS  ,                  GENERAL EQUATES                       00510000
*                                                                       00520000
         TRACODES ,               TRACE CODES                           00530000
*                                                                       00540000
         ABCODES ,                ABEND CODES                           00550000
                                                                        00560000
         EJECT ,                                                        00570000
         #WORK LENGTH=512                                               00580000
RESUMREG DS    16F                TASK RESUME REGISTERS                 00590000
         #ENDWORK                                                       00600000
                                                                        00610000
         EJECT ,                                                        00620000
ISRVTRES #ENTER BASE=(R12),       ENTRY LINKAGE                        +00630000
               PREG=R8,                                                +00640000
               WAPASS=YES                                               00650000
                                                                        00660000
         USING ITASK,R10          ESTABLISH ADDRESSABILITY              00670000
                                                                        00680000
*---------------------------------------------------------------        00690000
*  Cut trace record for ITASK resumed                                   00700000
*---------------------------------------------------------------        00710000
         $TRACE TRC_DISPSVTRES,0  TRACE TASK RESTART - RESUME           00720000
                                                                        00730000
*---------------------------------------------------------------        00740000
*  Retrieve task suspend/resume registers and release associated        00750000
*  savearea storage.  Fatal error occurs if resume registers            00760000
*  are not available.                                                   00770000
*---------------------------------------------------------------        00780000
         ICM   R1,15,TSKSUSPR     ADDRESS OF SUSPEND REGISTERS          00790000
         BZ    ABN_REGS           NO SUSPEND REGS AVAILABLE             00800000
         MVC   RESUMREG(16*4),0(R1)  SAVE RESUME REGISTERS              00810000
                                                                        00820000
         $RETSTOR (R1),OWNER=ITASK   RELEASE SAVE AREA                  00830000
         XC    TSKSUSPR,TSKSUSPR  CLEAR SUSPEND REGISTERS               00840000
                                                                        00850000
*---------------------------------------------------------------        00860000
*  Restore task suspend/resume registers                                00870000
*---------------------------------------------------------------        00880000
         LM    R0,R15,RESUMREG    RESTORE SUSPENDED REGISTERS           00890000
         BR    R14                RESUME ITASK                          00900000
                                                                        00910000
         EJECT ,                                                        00920000
****************************************************************        00930000
*                                                                       00940000
*  CATASTROPHIC FAILURES                                                00950000
*                                                                       00960000
****************************************************************        00970000
ABN_REGS DS    0H                                                       00980000
         $ABEND ABE_SUSPREGS,                                          +00990000
               TITLE='TASK SUSPEND/RESUME REGISTERS NOT AVAILABLE'      01000000
                                                                        01010000
         EJECT ,                                                        01020000
****************************************************************        01030000
*                                                                       01040000
*  CONSTANTS AND LITERALS                                               01050000
*                                                                       01060000
****************************************************************        01070000
                                                                        01080000
         LTORG ,                                                        01090000
                                                                        01100000
         PRINT NOGEN                                                    01110000
         ICVT  ,                                                        01120000
         ITASK ,                                                        01130000
                                                                        01140000
         END   ,                                                        01150000
