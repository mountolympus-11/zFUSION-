ILOGCMDS TITLE 'ILOGCMDS - LOGTASK COMMAND ANALYSIS'                    00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ILOGCMDS - LOGTASK COMMAND ANALYSIS                          00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    ACQUIRE AND ANALYZE INTERTASK 'LOG' COMMANDS WHICH ARE             00080000
*    DELIVERED TO THE LOG MANAGER VIA $TSEND.  THE COMMAND              00090000
*    REQUEST BLOCK AND $MSG COLLECTOR RESOURCE ID, IF ANY,              00100000
*    ARE EXTRACTED FROM THE COMMAND PACKET AND POSTED IN                00110000
*    STORAGE AREAS DESIGNATED BY THE CALLER.                            00120000
*                                                                       00130000
*    TO DATE, LOG COMMANDS ARE SIMPLE HAVING EITHER ZERO OR             00140000
*    ONE KEYWORD OPERAND.  FOR THAT REASON, PARSING AND                 00150000
*    RELATED VALIDATION IS EASILY DONE IN THE SINGLE COMMAND            00160000
*    INTERFACE PROVIDED BY THIS ROUTINE.                                00170000
*                                                                       00180000
*                                                                       00190000
* SYNTAX:                                                               00200000
*                                                                       00210000
*    LOG  DISPLAY/D                                                     00220000
*    LOG  FLUSH                                                         00230000
*    LOG  SWITCH/I                                                      00240000
*                                                                       00250000
*                                                                       00260000
* ON ENTRY:                                                             00270000
*                                                                       00280000
*    R1  CONTAINS THE ADDRESS OF A PARAMETER LIST FORMATTED AS          00290000
*        FOLLOWS:                                                       00300000
*                                                                       00310000
*           +00 - ADDR OF STANDARD TMSG FRAMING A COMMAND REQUEST       00320000
*           +04 - CMDREQ PTR RETURN AREA                                00330000
*           +08 - MSGRSRCID PTR RETURN AREA                             00340000
*                                                                       00350000
*                                                                       00360000
* ON EXIT:                                                              00370000
*                                                                       00380000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES. A NON-ZERO         00390000
*        VALUE INDICATES THAT AN ERROR WAS DETECTED.  RETURN            00400000
*        AREA PTRS ARE ZEROED IF NOT VALID.                             00410000
*                                                                       00420000
*        RC00 - COMMAND RECOGNIZED, RSNCODE IDENTIFIES REQ TYPE         00430000
*                                                                       00440000
*               RSN00 - LOG DISPLAY                                     00450000
*               RSN04 - LOG FLUSH                                       00460000
*               RSN08 - LOG SWITCH                                      00470000
*                                                                       00480000
*        RC04 - COMMAND SYNTAX, OR OTHER USER-ORIENTED ERROR.           00490000
*               CMDREQ.CMRQCOMP HAS BEEN SET ACCORDINGLY.               00500000
*                                                                       00510000
*               R0 - STD CCODE_* COMPLETION CODE (REF CMRQCOMP)         00520000
*                                                                       00530000
*        RC08 - UNABLE TO ACKNOWLEDGE RECEIPT OF COMMAND                00540000
*                                                                       00550000
*               R0 - $COMACK RETURN CODE                                00560000
*               R1 - $COMACK REASON CODE                                00570000
*                                                                       00580000
**<DOC-OFF>****************************************************         00590000
                                                                        00600000
***************************************************************         00610000
*                                                                       00620000
* MAINTENANCE:                                                          00630000
*                                                                       00640000
*    05/24/93 R. TURGEON                                                00650000
*             INITIAL VERSION                                           00660000
*                                                                       00670000
***************************************************************         00680000
                                                                        00690000
         EJECT                                                          00700000
         #WORK ,             BEGIN WORKAREA                             00710000
         #ENDWORK ,          END WORKAREA                               00720000
                                                                        00730000
         EJECT                                                          00740000
         TMSG   ,            INTERTASK MESSAGE HEADER                   00750000
                                                                        00760000
         EJECT                                                          00770000
         $COMACK DSECT=YES   COMMAND ACKNOWLEDGEMENT                    00780000
                                                                        00790000
         EJECT                                                          00800000
         CMDREQ  ,           COMMAND REQUEST BLOCK                      00810000
                                                                        00820000
         EJECT                                                          00830000
         CCSUMRY ,           COMMAND OPERAND PREPARSE SUMMARY           00840000
                                                                        00850000
         EJECT                                                          00860000
         KEYCODES COMMANDSET=LOG                                        00870000
*                                                                       00880000
         CMDCODES ,          COMMAND PROCESSING COMPLETION CODES        00890000
*                                                                       00900000
         MSGCODES ,          INTERTASK MESSAGING CODES                  00910000
*                                                                       00920000
         EQUS  ,                                                        00930000
                                                                        00940000
         EJECT                                                          00950000
ILOGCMDS #ENTER PREG=R8                                                 00960000
                                                                        00970000
         USING ITASK,R10                                                00980000
                                                                        00990000
*--------------------------------------------------------------         01000000
*    FETCH PASSED PARAMETERS                                            01010000
*--------------------------------------------------------------         01020000
         LM    R2,R3,4(R8)        RETURN AREA PTRS                      01030000
         XC    0(4,R2),0(R2)      CMDREQ RETURN AREA                    01040000
         XC    0(4,R3),0(R3)      MSGRSRCID RETURN AREA                 01050000
                                                                        01060000
         L     R4,0(,R8)          MESSAGE ORIGIN                        01070000
         USING TMSGSTD,R4         STANDARD FORMAT                       01080000
                                                                        01090000
         $COMACK (R4)             LOCATE COMMAND COMPONENTS             01100000
         BNZ   ERR_ACK            HANDSHAKING ERROR                     01110000
                                                                        01120000
         LR    R5,R1              COMMAND REQUEST BLOCK PTR             01130000
         USING CMDREQ,R5          RETURNED BY SERVICE                   01140000
         ST    R1,0(,R2)          RETURN CMDREQ PTR                     01150000
         ST    R0,0(,R3)          RETURN MSGRSRCID PTR                  01160000
                                                                        01170000
*--------------------------------------------------------------         01180000
*   ENSURE COMMAND SATISFIES REQUIREMENTS                               01190000
*--------------------------------------------------------------         01200000
         LA    R15,RSN00          DISPLAY BY DEFAULT IF NO OPERANDS     01210000
         ICM   R0,15,CMRQSMR#     OPERANDS PROVIDED?                    01220000
         BZ    RETURN             DONE IF NOT                           01230000
         CH    R0,=H'1'           SINGLE OPERAND ACCEPTED               01240000
         BH    SYNTAX             SYNTAX ERROR IF MORE                  01250000
                                                                        01260000
         L     R6,CMRQSMRY        COMMAND OPERAND SUMMARY               01270000
         LA    R6,CMDREQ(R6)      CONVERT BLOCK OFFSET TO ADDRESS       01280000
         USING CCSUMRY,R6         OPERAND DEFINITION                    01290000
                                                                        01300000
         LA    R0,RSN00           PRESUME DISPLAY COMMAND               01310000
         CLC   CCSID,=AL2(LOG_DISPLAY)                                  01320000
         BE    RETURN                                                   01330000
                                                                        01340000
         LA    R0,RSN04           PRESUME FLUSH COMMAND                 01350000
         CLC   CCSID,=AL2(LOG_FLUSH)                                    01360000
         BE    RETURN                                                   01370000
                                                                        01380000
         LA    R0,RSN08           PRESUME SWITCH COMMAND                01390000
         CLC   CCSID,=AL2(LOG_SWITCH)                                   01400000
         BE    RETURN                                                   01410000
         DROP  R6                 CCSUMRY                               01420000
                                                                        01430000
*--------------------------------------------------------------         01440000
*   SYNTAX ERROR, UPDATE CMDREQ ACCORDINGLY WITH ERROR STATUS           01450000
*--------------------------------------------------------------         01460000
SYNTAX   DS    0H                                                       01470000
         LA    R0,CCODE_SYNTAX    INVALID SYNTAX                        01480000
         ST    R0,CMRQCOMP        POST COMPLETION CODE                  01490000
         LA    R15,RC04           INDICATE USER-ORIENTED ERROR          01500000
         B     RETURN                                                   01510000
                                                                        01520000
*--------------------------------------------------------------         01530000
*   RETURN COMMAND IDENTITY OR FAILURE INDICATION TO CALLER             01540000
*--------------------------------------------------------------         01550000
NORMRET  DS    0H                 COMMAND ACCEPTED, CMDCODE IN R0       01560000
         LA    R15,RC00           INDICATE SUCCESS                      01570000
         B     RETURN             DONE                                  01580000
                                                                        01590000
ERR_ACK  DS    0H                                                       01600000
         LR    R1,R0              $COMACK REASON CODE                   01610000
         LR    R0,R15             $COMACK RETURN CODE                   01620000
         LA    R15,RC08           INDICATE SERIOUS PROBLEM              01630000
                                                                        01640000
RETURN   DS    0H                                                       01650000
         #EXIT ,                                                        01660000
                                                                        01670000
         EJECT                                                          01680000
***************************************************************         01690000
*                                                                       01700000
*   LOCAL READ/ONLY DATA AREAS, ETC.                                    01710000
*                                                                       01720000
***************************************************************         01730000
         LTORG ,                                                        01740000
                                                                        01750000
         PRINT NOGEN                                                    01760000
         ICVT  ,                                                        01770000
         ITASK ,                                                        01780000
         END   ,                                                        01790000
