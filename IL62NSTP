IL62NSTP TITLE 'INTEGRATOR - WE PROCESSOR START TRANSACTION PROGRAM'    00010000
                                                                        00020000
         PRINT NOGEN                                                    00030000
         CMINCL ,                 INTEGRATOR CPI-C DEFINITIONS          00040000
         L62INCL ,                INTEGRATOR LU6.2 DEFINITIONS          00050000
         PRINT GEN                                                      00060000
                                                                        00070000
**<DOC-ON>************************************************************* 00080000
*                                                                       00090000
* ROUTINE: IL62NSTP - INTEGRATOR WE PROCESSOR START TRAN PROGRAM        00100000
*                                                                       00110000
* DESCRIPTION:                                                          00120000
*                                                                       00130000
* ON ENTRY:                                                             00140000
*                                                                       00150000
*    R15 = ENTRY POINT ADDRESS                                          00160000
*    R14 = RETURN ADDRESS                                               00170000
*    R13 = AVAILABLE SAVE AREA                                          00180000
*    R11 = ICVT ADDRESS                                                 00190000
*    R10 = ITASK ADDRESS                                                00200000
*    R01 = IWE ADDRESS (WORK ELEMENT)                                   00210000
*                                                                       00220000
* ON EXIT:                                                              00230000
*                                                                       00240000
*    R15 = 0                                                            00250000
*    R00 = 0                                                            00260000
*    R01 = 0                                                            00270000
*                                                                       00280000
*    ALL OTHER REGISTERS ARE RESTORED                                   00290000
*                                                                       00300000
**<DOC-OFF>************************************************************ 00310000
                                                                        00320000
         EJECT ,                                                        00330000
*********************************************************************** 00340000
*                                                                       00350000
* MAINTENANCE:                                                          00360000
*                                                                       00370000
*   07/01/94 RANDY WITEK                                                00380000
*                                                                       00390000
*********************************************************************** 00400000
                                                                        00410000
         EQUS  ,                  GENERAL EQUATES                       00420000
                                                                        00430000
RICVT    EQU   R11                                                      00440000
RITASK   EQU   R10                                                      00450000
RIVTAM   EQU   R9                                                       00460000
RIACB    EQU   R8                                                       00470000
RIRPL    EQU   R7                                                       00480000
RIWE     EQU   R6                                                       00490000
                                                                        00500000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00510000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00520000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00530000
         USING IACB,RIACB         ESTABLISH ADDRESSABILITY              00540000
         USING IRPL,RIRPL         ESTABLISH ADDRESSABILITY              00550000
         USING IWEVTAM,RIWE       ESTABLISH ADDRESSABILITY              00560000
                                                                        00570000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00580000
$WUMFL   $WULOC MF=L              PLIST CONSTRUCTION                    00590000
L62MFL   L62STTP MF=L             PLIST CONSTRUCTION                    00600000
SUB0SAVE DS    18F                SUBROUTINE SAVE AREA                  00610000
WRK256   DS    XL256              GENERAL WORKAREA                      00620000
WUDATA   DS    XL16               WULOC RETURN AREA                     00630000
RETTOKEN DS    XL(L'TSKENTKN)     LU6.2 WU TOKEN   RETURN AREA          00640000
RETCODE  DS    F                  LU6.2 RETURN CODE AREA (POST CODE)    00650000
RETRC    DS    F                  LU6.2 RETURN CODE AREA                00660000
RETR15   DS    F                  RETURN CODE VALUE                     00670000
RETR0    DS    F                  RETURN REGISTER 0                     00680000
RETR1    DS    F                  RETURN REGISTER 1                     00690000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      00700000
FLAG     DS    X                                                        00710000
FLAGDLCK EQU   X'80'              DISP LOCK HELD                        00720000
FLAGDLKD EQU   X'40'              DISP LOCK HELD ON ENTRY               00730000
WORKLEN  #ENDWORK                 END OF WORKAREA                       00740000
                                                                        00750000
         $MSGDFT PREFIX=ICTPID,                                        +00760000
               COMPID='L62',                                           +00770000
               TABLE=*#MSGS,                                           +00780000
               WORKA=0,                                                +00790000
               MF=(E,WRK256),                                          +00800000
               PRINT=NOGEN                                              00810000
                                                                        00820000
IL62NSTP #ENTER BASE=R12,         ENTRY LINKAGE                        +00830000
               AMODE=31,                                               +00840000
               PREG=(RIWE),                                            +00850000
               RMODE=ANY                                                00860000
                                                                        00870000
*---------------------------------------------------------------------- 00880000
* ISSUE START TP CALL                                                   00890000
*---------------------------------------------------------------------- 00900000
                                                                        00910000
         L62STTP IWEXWTPN,        ADDRESS OF TPNAME                    +00920000
               IWEXWPRL,          ADDRESS OF PARM STRING LENGTH        +00930000
               IWEXWPRM,          ADDRESS OF PARM STRING               +00940000
               IWEXWPLU,          ADDRESS OF PARTNER LU NAME           +00950000
               IWEXWMDE,          ADDRESS OF MODE NAME                 +00960000
               IWEXWWUT,          ADDRESS OF WORK UNIT TYPE            +00970000
               IWEXWTOK,          ADDRESS OF SESSION TOKEN             +00980000
               RETTOKEN,          ADDRESS OF WU TOKEN RETURN AREA      +00990000
               RETCODE,           ADDRESS OF RETURN_CODE AREA          +01000000
               MF=(E,L62MFL)      LOAD THE TRANSACTION PROGRAM          01010000
                                                                        01020000
*---------------------------------------------------------------------- 01030000
* IF THE CALL WAS SUCESSFUL PASS BACK THE WORK UNIT TOKEN               01040000
*---------------------------------------------------------------------- 01050000
                                                                        01060000
         OC    RETCODE,RETCODE    SUCCESSFUL CALL?                      01070000
         BNZ   STTPPOST           BRANCH IF NOT                         01080000
                                                                        01090000
         BAS   R14,DISPLOCK       SERIALIZE                             01100000
                                                                        01110000
         $WULOC LOCATE,           FIND THE WORK UNIT                   +01120000
               TOKEN=IWEXWENT,    WORK UNIT TOKEN ADDRESS              +01130000
               USERDATA=WUDATA,   XL16 AREA TO RECEIVE USER DATA       +01140000
               MF=(E,$WUMFL)      VALIDATE WORK UNIT                    01150000
                                                                        01160000
         LTR   R15,R15            LOCATE SUCCESS?                       01170000
         BNZ   STTPPOST           BRANCH IF NOT, LET POST ISSUE MSG     01180000
         L     R1,IWEXWRWU        ADDRESS OF TOKEN RETURN AREA          01190000
         MVC   0(L'TSKENTKN,R1),RETTOKEN                                01200000
                                                                        01210000
*---------------------------------------------------------------------- 01220000
* POST PROCESS WAITING ON START TP                                      01230000
*---------------------------------------------------------------------- 01240000
                                                                        01250000
STTPPOST DS    0H                                                       01260000
                                                                        01270000
         OC    IWEXWEPB,IWEXWEPB  ADDRESS OF ASSOCIATED EPB             01280000
         BZ    EXIT               BRANCH IF NO EPB                      01290000
                                                                        01300000
         L62POST *IWEXWEPB,       ADDRESS OF EPB TO BE POSTED          +01310000
               RETCODE,           ADDRESS OF POST CODE                 +01320000
               IWEXWENT,          ADDRESS OF ENTITY TOKEN              +01330000
               RETRC,             RETURN CODE AREA                     +01340000
               MF=(E,L62MFL)                                            01350000
                                                                        01360000
*---------------------------------------------------------------------- 01370000
* RETURN TO MAIN TASK MAINLINE                                          01380000
*---------------------------------------------------------------------- 01390000
                                                                        01400000
EXIT     DS    0H                                                       01410000
                                                                        01420000
         BAS   R14,DISPUNLK       DESERIALIZE                           01430000
                                                                        01440000
         LM    R15,R1,RETREGS     LOAD RETURN REGISTERS                 01450000
                                                                        01460000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    01470000
                                                                        01480000
*---------------------------------------------------------------------- 01490000
*   SUBROUTINE: OBTAIN DISP GLOBAL LOCK                                 01500000
*---------------------------------------------------------------------- 01510000
                                                                        01520000
DISPLOCK DS    0H                                                       01530000
                                                                        01540000
         TM    FLAG,FLAGDLCK        WAS THE LOCK ALREADY OBTAINED?      01550000
         BOR   R14                  RETURN IF YES                       01560000
         STM   R14,R2,SUB0SAVE      SAVE CALLER'S REGISTERS             01570000
                                                                        01580000
         $SER  OBTAIN,                                                 +01590000
               DISP                                                     01600000
                                                                        01610000
         C     R15,=F'4'            WAS LOCK ALREADY HELD?              01620000
         BNE   DISPLOEX             BRANCH IF NOT                       01630000
         OI    FLAG,FLAGDLKD        REMEMBER LOCK HELD ON ENTRY         01640000
                                                                        01650000
DISPLOEX DS    0H                                                       01660000
                                                                        01670000
         OI    FLAG,FLAGDLCK        REMEMBER LOCK IS HELD               01680000
         LM    R14,R2,SUB0SAVE      RESTORE CALLER'S REGISTERS          01690000
         BR    R14                  RETURN                              01700000
                                                                        01710000
*---------------------------------------------------------------------- 01720000
*   SUBROUTINE: RELEASE DISP GLOBAL LOCK                                01730000
*---------------------------------------------------------------------- 01740000
                                                                        01750000
DISPUNLK DS    0H                                                       01760000
                                                                        01770000
         TM    FLAG,FLAGDLCK        IS LOCK HELD?                       01780000
         BNOR  R14                  BRANCH IF NOT                       01790000
         TM    FLAG,FLAGDLKD        WAS LOCK HELD ON ENTRY?             01800000
         BOR   R14                  DON'T RELEASE IF IT WAS             01810000
         STM   R14,R2,SUB0SAVE      SAVE CALLER'S REGISTERS             01820000
                                                                        01830000
         $SER  RELEASE,                                                +01840000
               DISP                                                     01850000
                                                                        01860000
         NI    FLAG,255-FLAGDLCK    SHOW LOCK NOT HELD                  01870000
         LM    R14,R2,SUB0SAVE      RESTORE CALLER'S REGISTERS          01880000
         BR    R14                  RETURN                              01890000
                                                                        01900000
*---------------------------------------------------------------------- 01910000
* ERROR ROUTINES                                                        01920000
*---------------------------------------------------------------------- 01930000
                                                                        01940000
*---------------------------------------------------------------------- 01950000
*  CONSTANTS AND LITERALS                                               01960000
*---------------------------------------------------------------------- 01970000
                                                                        01980000
         LTORG ,                                                        01990000
         PRINT NOGEN                                                    02000000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                02010000
         ISTDBIND ,               VTAM BIND IMAGE                       02020000
         ICVT  ,                  INTEGRATOR CVT                        02030000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   02040000
         IRPL ,                   INTEGRATOR VTAM RPL+                  02050000
         IACB ,                   INTEGRATOR VTAM ACB+                  02060000
         INIB ,                   INTEGRATOR VTAM NIB+                  02070000
         ISESS ,                  INTEGRATOR SESSION BLOCK              02080000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            02090000
         ITASK ,                  INTEGRATOR TASK BLOCK                 02100000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          02110000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       02120000
         EVCODES ,                INTEGRATOR EVENT CODES                02130000
         ABCODES ,                INTEGRATOR $ABEND CODES               02140000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     02150000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        02160000
         $VTAM DSECT=YES          INTEGRATOR $VTAM SERVICES             02170000
         $WULOC DSECT=YES         INTEGRATOR $WULOC SERVICES            02180000
         IFGEXLST ,               VTAM EXIT LIST                        02190000
         END   ,                                                        02200000
