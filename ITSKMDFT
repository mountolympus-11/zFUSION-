ITSKMDFT TITLE '- Default message processing routine'                   00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE:  ITSKMDFT - Default message processing routine               00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine is called by a message loop processing                00080000
*    routine to perform default message routing of intra/inter          00090000
*    task messages.  This routine will first lookup the message         00100000
*    in the default routing table and call the appropriate              00110000
*    routine to process the message.  If there is no entry in           00120000
*    the message routing table for the unprocessed message,             00130000
*    then the default action (POST reply EPB) is taken.                 00140000
*                                                                       00150000
*                                                                       00160000
* Default Message Processing routines:                                  00170000
*                                                                       00180000
*    Entry: R1   - Address of TMSGSTD                                   00190000
*                                                                       00200000
*    Exit:  RC00 - Message processed by default processing rtn          00210000
*          >RC00 - Message not process / undeliverable                  00220000
*                  Default action should be taken by router             00230000
*                                                                       00240000
* ON ENTRY:                                                             00250000
*                                                                       00260000
*    R1  contains the address of a standard message header              00270000
*        address by TMSGSTD (TMSG HDR=NO).                              00280000
*                                                                       00290000
* ON EXIT:                                                              00300000
*                                                                       00310000
*    R15 = RC00 - Normal completion                                     00320000
*                                                                       00330000
**<DOC-OFF>****************************************************         00340000
                                                                        00350000
***************************************************************         00360000
*                                                                       00370000
* MAINTENANCE:                                                          00380000
*                                                                       00390000
*    03/21/95 R. Colmone                                                00400000
*             Initial Version                                           00410000
*                                                                       00420000
***************************************************************         00430000
                                                                        00440000
         EJECT                                                          00450000
         TMSG   ,                 MESSAGE FORMAT                        00460000
                                                                        00470000
         EJECT                                                          00480000
         $TASK  DSECT=YES         ITASK FORMAT                          00490000
                                                                        00500000
         EJECT                                                          00510000
         EVCODES ,                EVENT/POST CODES                      00520000
                                                                        00530000
         MSGCODES ,               INTERTASK MESSAGE CODES               00540000
                                                                        00550000
         EQUS  ,                  GENERAL EQUATES                       00560000
                                                                        00570000
         EJECT                                                          00580000
WORKAREA #WORK ,                  BEGIN WORKAREA                        00590000
REGSAVE  DS    16F                REGISTER SAVE AREA                    00600000
                                                                        00610000
$TSK_MFL $TASK  MF=(L,*)          TASK MANAGER PLIST                    00620000
         #ENDWORK ,               END WORKAREA                          00630000
                                                                        00640000
         EJECT                                                          00650000
ITSKMDFT #ENTER PREG=R8                                                 00660000
                                                                        00670000
         USING ITASK,R10          STANDARD ENVIRONMENT                  00680000
         USING TMSGSTD,R8         TMSG ADDRESSABILITY                   00690000
                                                                        00700000
         EJECT ,                                                        00710000
***************************************************************         00720000
*                                                                       00730000
*  Default message processing. Locate Default message routine           00740000
*  table entry and call associated processing routine.                  00750000
*                                                                       00760000
***************************************************************         00770000
                                                                        00780000
         LA    R4,$TMSGTAB        ORG OF DEFAULT ROUTING TABLE          00790000
         LA    R3,$TMSGTB#        COUNT OF ENTRIES IN TABLE             00800000
                                                                        00810000
DFT_NEXT DS    0H                                                       00820000
         CLC   TMSGTYPE,4(R4)     DEFAULT MSG ROUTING DEFINED           00830000
         BE    DFT_CALL           YES, CALL DEFAULT MESSAGE RTN         00840000
         LA    R4,L'$TMSGTAB(,R4) ADDRESS OF NEXT DFT ROUTE MSG         00850000
         BCT   R3,DFT_NEXT        PROCESS NEXT MESSAGE                  00860000
         B     DEFAULT            GENERIC DEFAULT MSG PROCESSING        00870000
                                                                        00880000
*--------------------------------------------------------------         00890000
*  Call default message process routine                                 00900000
*--------------------------------------------------------------         00910000
DFT_CALL DS    0H                                                       00920000
         LA    R1,TMSGSTD         ADDRESS OF MESSAGE HEADER             00930000
         ICM   R15,15,0(R4)       ADDRESS OF DFT MSG ROUTE RTN          00940000
         BZ    DEFAULT            NOT AVAILABLE, ASSUME DEFAULT         00950000
         BASR  R14,R15            CALL DEFAULT MESSAGE PROCESSING       00960000
         BZ    RETURN             PROCESSED BY ROUTINE                  00970000
                                                                        00980000
         EJECT ,                                                        00990000
*--------------------------------------------------------------         01000000
*  Default routing routine not available or message not                 01010000
*  processed by default router.  Post message initiator if              01020000
*  reply has been requested.                                            01030000
*--------------------------------------------------------------         01040000
DEFAULT  DS    0H                                                       01050000
         ICM   R3,15,TMSGEPB      REPLY ANTICIPATED?                    01060000
         BZ    RETURN             NO, PROCESSING COMPLETE               01070000
                                                                        01080000
         $TASK POST,EPB=(R3),PCODE=$$MSGDFT,MF=(E,$TSK_MFL)             01090000
                                                                        01100000
         EJECT ,                                                        01110000
*--------------------------------------------------------------         01120000
*   RETURN                                                              01130000
*--------------------------------------------------------------         01140000
RETURN   DS    0H                                                       01150000
         LA    R15,RC00           NORMAL COMPLETION                     01160000
         #EXIT ,                                                        01170000
                                                                        01180000
         EJECT ,                                                        01190000
***************************************************************         01200000
*                                                                       01210000
*  Default message routing table                                        01220000
*                                                                       01230000
***************************************************************         01240000
         DS    0F                                                       01250000
$TMSGTAB EQU   *,4+4                                                    01260000
         DC    V(ITSKMFWD),A(ITM_TMSG_PROCESS)                          01270000
         DC    V(IMSGMFWD),A(ITM_LOG_DATA)                              01280000
$TMSGTBE DS    0H                                                       01290000
$TMSGTB# EQU   (*-$TMSGTAB)/L'$TMSGTAB                                  01300000
                                                                        01310000
         EJECT ,                                                        01320000
***************************************************************         01330000
*                                                                       01340000
*   LOCAL READ-ONLY DATA AREAS                                          01350000
*                                                                       01360000
***************************************************************         01370000
         LTORG ,                                                        01380000
                                                                        01390000
         EJECT                                                          01400000
         PRINT NOGEN                                                    01410000
         ICVT  ,                                                        01420000
         ITASK ,                                                        01430000
         IPCB  ,                                                        01440000
         END                                                            01450000
