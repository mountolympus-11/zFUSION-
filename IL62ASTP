IL62ASTP TITLE 'INTEGRATOR - LU6.2 START TRANSACTION PROGRAM'           00010000
                                                                        00020000
         PRINT NOGEN                                                    00030000
         CMINCL ,                 INTEGRATOR CPI-C DEFINITIONS          00040000
         L62INCL ,                INTEGRATOR LU6.2 DEFINITIONS          00050000
         PRINT GEN                                                      00060000
                                                                        00070000
**<DOC-ON>************************************************************* 00080000
*                                                                       00090000
* ROUTINE: IL62ASTP - LU6.2 START TRANSACTION PROGRAM                   00100000
*                                                                       00110000
* DESCRIPTION:                                                          00120000
*                                                                       00130000
*    THIS ROUTINE IS CALLED TO INITIATE A TRANSACTION PROGRAM           00140000
*                                                                       00150000
* ON ENTRY:                                                             00160000
*                                                                       00170000
*    R15 = ENTRY POINT ADDRESS                                          00180000
*    R14 = RETURN      ADDRESS                                          00190000
*    R13 = SAVE AREA   ADDRESS                                          00200000
*    R01 = PARM LIST   ADDRESS                                          00210000
*                                                                       00220000
*          +00 = ADDRESS OF TPNAME                                      00230000
*          +04 = ADDRESS OF PARM STRING LENGTH                          00240000
*          +08 = ADDRESS OF PARM STRING                                 00250000
*          +0C = ADDRESS OF PARTNER LU NAME                             00260000
*          +10 = ADDRESS OF MODE NAME                                   00270000
*          +14 = ADDRESS OF WORK UNIT TYPE (TASK OR PROC)               00280000
*          +18 = ADDRESS OF SESSION TOKEN IF REMOTELY ATTACHED          00290000
*          +1C = ADDRESS OF WORK UNIT RETURN AREA (ENTITY TOKEN)        00300000
*          +20 = ADDRESS OF RETURN CODE AREA                            00310000
*                                                                       00320000
* ON EXIT:                                                              00330000
*                                                                       00340000
*    R15 = 0                                                            00350000
*                                                                       00360000
*    RETURN_CODE = LU62_OK --> TP SUCCESSFULLY STARTED                  00370000
*                                                                       00380000
*                = LU62_PRODUCT_SPECIFIC_ERROR --> TP NOT STARTED       00390000
*                = LU62_TPN_NOT_RECOGNIZED --> LOAD FAILED FOR TP       00400000
*                                                                       00410000
**<DOC-OFF>************************************************************ 00420000
         EJECT ,                                                        00430000
*********************************************************************** 00440000
*                                                                       00450000
* MAINTENANCE:                                                          00460000
*                                                                       00470000
*   07/01/94 RANDY WITEK                                                00480000
*   12/07/94 RANDY WITEK - FIX S0C4 CAUSED BY PARM FIELD ACCESS TEST    00490000
*   12/31/95 RANDY WITEK - 2.1 TRANSACTION PROGRAM VTAM WU SUPPORT      00500000
*                                                                       00510000
*********************************************************************** 00520000
                                                                        00530000
         EQUS  ,                  GENERAL EQUATES                       00540000
                                                                        00550000
RICVT    EQU   R11                                                      00560000
RITASK   EQU   R10                                                      00570000
RBASE    EQU   R9                                                       00580000
RIVTAM   EQU   R8                                                       00590000
RPLIST   EQU   R7                                                       00600000
RXSP     EQU   R6                                                       00610000
                                                                        00620000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00630000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00640000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00650000
         USING L62LIST,RPLIST     ESTABLISH ADDRESSABILITY              00660000
         USING XSP,RXSP           ESTABLISH ADDRESSABILITY              00670000
                                                                        00680000
         COPY  CRAB               "C" RUNTIME ANCHOR BLOCK              00690000
         USING CRAB,R12           ADDRESSABILITY                        00700000
                                                                        00710000
         COPY  DSA                DYNAMIC SAVE AREA                     00720000
WORKAREA DS    0H                 READ/WRITE WORKAREA                   00730000
WRK256   DS    XL256              GENERAL WORKAREA                      00740000
DWORK    DS    D                  DOUBLEWORD                            00750000
$TASKMFL $TASK MF=L               PLIST CONSTRUCTION                    00760000
$PROCMFL $PROC MF=L               PLIST CONSTRUCTION                    00770000
L62MFL   L62LDTP MF=L             PLIST CONSTRUCTION                    00780000
L62RETRC DS    F                  RETURN CODE RETURN AREA               00790000
L62RETEP DS    A                  ENTRY POINT ADDRESS RETURN AREA       00800000
L62RETWU DS    CL4                WORK UNIT TYPE      RETURN AREA       00810000
SUB0SAVE DS    18F                SUBROUTINE SAVE AREA                  00820000
TPNAME   DS    CL(L'XSPNAME)      TPNAME                                00830000
LUNAME   DS    CL(L'XSPARTLU)     PARTNER LU NAME (MAX OF 17 BYTES)     00840000
         DS    CL3                RESERVED FOR ALIGNMENT                00850000
MODENAME DS    CL(L'XSPMODE)      MODE NAME                             00860000
SESSTOKN DS    XL(L'XSPTOKEN)     SESSION TOKEN (FOR REMOTE ATTACH)     00870000
WUTYPE   DS    CL(L'XSPWUTYP)     WORK UNIT TYPE                        00880000
WUADDR   DS    A                  WORK UNIT ADDRESS                     00890000
WUTOKEN  DS    XL(L'PCBENTKN)     WORK UNIT TOKEN                       00900000
WUNAME   DS    CL8                WORK UNIT NAME CONSTRUCTION           00910000
PARMLEN  DS    F                  PARM STRING LENGTH                    00920000
PARMADDR DS    A                  PARM STRING ADDRESS                   00930000
RETCODE  DS    F                  TEMPORARY RETURN CODE AREA            00940000
FLAG     DS    X                                                        00950000
FLAGLOCK EQU   X'80'                                                    00960000
FLAGLCKD EQU   X'40'                                                    00970000
WORKLEN  EQU   *-WORKAREA         LENGTH OF USER DSA AREA               00980000
DSALEN   EQU   *-DSA              LENGTH OF DSA                         00990000
                                                                        01000000
                                                                        01010000
         $MSGDFT PREFIX=ICTPID,                                        +01020000
               COMPID='L62',                                           +01030000
               TABLE=*#MSGS,                                           +01040000
               WORKA=0,                                                +01050000
               MF=(E,WRK256),                                          +01060000
               PRINT=NOGEN                                              01070000
                                                                        01080000
IL6ASTP@ CSECT ,                                                        01090000
IL62ASTP CENTRY DSA=DSALEN,BASE=RBASE,INDEP=YES                         01100000
                                                                        01110000
         USING DSA,R13            ADDRESSABILITY                        01120000
         LR    RPLIST,R1          SAVE ADDRESS OF PLIST                 01130000
                                                                        01140000
         LA    R0,WORKAREA        ADDRESS OF USER DSA SECTION           01150000
         LA    R1,WORKLEN         LENGTH  OF USER DSA SECTION           01160000
         SR    R15,R15            PREPARE FOR CLEAR                     01170000
         MVCL  R0,R14             CLEAR USER DSA SECTION                01180000
                                                                        01190000
*---------------------------------------------------------------------- 01200000
* INITIALIZATION                                                        01210000
*---------------------------------------------------------------------- 01220000
                                                                        01230000
         @RESTENV ,               ENSURE ENVIRONMENT                    01240000
                                                                        01250000
         L     RIVTAM,ICTVTCVT    ESTABLISH IVTAMCVT POINTER            01260000
         USING IVTAMCVT,RIVTAM    ADDRESSABILITY                        01270000
                                                                        01280000
         L     R1,L62PARM1        TPNAME ADDRESS                        01290000
         MVC   TPNAME,0(R1)       COPY TO LOCAL STORAGE                 01300000
                                                                        01310000
         L     R1,L62PARM2        PARM STRING LENGTH ADDRESS            01320000
         ICM   R2,15,0(R1)        PARM STRING LENGTH                    01330000
         BM    ERRPROD            BRANCH IF BAD LENGTH                  01340000
         C     R2,=F'256'         TOO LONG?                             01350000
         BH    ERRPROD            BRANCH IF YES                         01360000
         ST    R2,PARMLEN         COPY TO LOCAL STORAGE                 01370000
                                                                        01380000
         L     R1,L62PARM3        PARM STRING ADDRESS                   01390000
         ST    R1,PARMADDR        COPY TO LOCAL STORAGE                 01400000
         S     R2,=F'1'           LENGTH CODE OF STRING                 01410000
         BM    NOSTRING           BRANCH IF NULL                        01420000
         IC    R0,0(,R1)          TEST ACCESS TO HEAD OF STRING         01430000
         IC    R0,0(R2,R1)        TEST ACCESS TO TAIL OF STRING         01440000
NOSTRING DS    0H                                                       01450000
                                                                        01460000
         L     R1,L62PARM4        LUNAME ADDRESS                        01470000
         MVC   LUNAME,0(R1)       COPY TO LOCAL STORAGE                 01480000
                                                                        01490000
         L     R1,L62PARM5        MODE NAME ADDRESS                     01500000
         MVC   MODENAME,0(R1)     COPY TO LOCAL STORAGE                 01510000
                                                                        01520000
         L     R1,L62PARM6        WORK UNIT TYPE ADDRESS                01530000
         MVC   WUTYPE,0(R1)       COPY TO LOCAL STORAGE                 01540000
                                                                        01550000
         L     R1,L62PARM7        SESSION TOKEN ADDRESS                 01560000
         MVC   SESSTOKN,0(R1)     COPY TO LOCAL STORAGE                 01570000
                                                                        01580000
         L     R1,L62PARM8        WORK UNIT RETURN AREA                 01590000
         MVC   0(L'PCBENTKN,R1),0(R1) TEST ACCESSIBILITY                01600000
                                                                        01610000
*---------------------------------------------------------------------- 01620000
* ENTRY TRACE                                                           01630000
*---------------------------------------------------------------------- 01640000
                                                                        01650000
         $TRACE *=A(TRC_LU62_IL62ASTP),160 TRACE ENTRY W/160 USER BYTES 01660000
         BNZ   NOETRACE                    BRANCH IF NOT TRACING        01670000
         $APITRC IL62ASTP                  TRACE COMMON STUFF           01680000
         ST    RPLIST,24(,R1)              TRACE PARMLIST ADDRESS       01690000
         MVC   28(4,R1),PARMLEN            TRACE PARM STRING LENGTH     01700000
         MVC   32(64,R1),TPNAME            TRACE TPNAME                 01710000
         MVC   96(17,R1),LUNAME            TRACE PARTNER LU NAME        01720000
         MVC   116(8,R1),MODENAME          TRACE MODE NAME              01730000
         MVC   124(4,R1),WUTYPE            TRACE WORK UNIT TYPE         01740000
         MVC   128(8,R1),SESSTOKN          TRACE SESSION TOKEN          01750000
         LA    R0,136(,R1)                 AREA FOR PARM STRING TRACE   01760000
         LA    R1,24                       MAXIMUM OF 24 BYTES TRACED   01770000
         L     R14,PARMADDR                PARM STRING ADDRESS          01780000
         L     R15,PARMLEN                 PARM STRING LENGTH           01790000
         MVCL  R0,R14                      TRACE UP TO 24 BYTES OF PARM 01800000
NOETRACE DS    0H                                                       01810000
                                                                        01820000
*---------------------------------------------------------------------- 01830000
* DETERMINE THE WORKUNIT ENVIRONMENT FOR THE TP.                        01840000
*---------------------------------------------------------------------- 01850000
                                                                        01860000
         CLI   WUTYPE,C' '        SOMETHING EXPLICIT?                   01870000
         BH    GOTTYPE            BRANCH IF YES                         01880000
                                                                        01890000
         L62LDTP TPNAME,          TRANSACTION PROGRAM NAME             +01900000
               L62RETEP,          EP ADDRESS RETURN AREA               +01910000
               L62RETWU,          WU TYPE    RETURN AREA               +01920000
               L62RETRC,          RETURN CODE AREA                     +01930000
               MF=(E,L62MFL)                                            01940000
                                                                        01950000
         ICM   R1,15,L62RETRC     LOAD SUCCESSFUL?                      01960000
         BNZ   ERRLOAD            BRANCH IF NOT                         01970000
         MVC   WUTYPE,L62RETWU    SAVE THE WU TYPE                      01980000
                                                                        01990000
         L62DLTP TPNAME,          TRANSACTION PROGRAM NAME             +02000000
               L62RETRC,          RETURN CODE AREA                     +02010000
               MF=(E,L62MFL)                                            02020000
                                                                        02030000
         ICM   R1,15,L62RETRC     DELETE SUCCESSFUL?                    02040000
         BNZ   ERRPROD            BRANCH IF NOT                         02050000
                                                                        02060000
GOTTYPE  DS    0H                                                       02070000
                                                                        02080000
*---------------------------------------------------------------------- 02090000
* IF A PROC WORK UNIT IS REQUESTED FOR THE TP...START IT NOW            02100000
* OTHERWISE, A TASK OR VTAM WORK UNIT HAS BEEN REQUESTED.               02110000
* IF START TP NOT ISSUED BY MAIN TASK...SHIFT WORK TO MAIN.             02120000
*---------------------------------------------------------------------- 02130000
                                                                        02140000
         CLC   WUTYPE,=CL4'PROC'  PROC REQUESTED?                       02150000
         BE    STTPMAIN           BRANCH IF YES                         02160000
         CLC   WUTYPE,=CL4'VTAM'  VTAM REQUESTED?                       02170000
         BE    TESTMAIN           BRANCH IF NOT                         02180000
         CLC   WUTYPE,=CL4'TASK'  TASK REQUESTED?                       02190000
         BNE   ERRPROD            BRANCH IF NOT                         02200000
                                                                        02210000
TESTMAIN DS    0H                                                       02220000
                                                                        02230000
         C     RITASK,IVTITASK    EXECUTING IN VTAM MAIN TASK?          02240000
         BE    STTPMAIN           BRANCH IF YES                         02250000
                                                                        02260000
         LA    R2,L'IWEXW         BASIC WORK ELEMENT SIZE               02270000
         A     R2,PARMLEN         PLUS LENGTH OF PARM FIELD             02280000
                                                                        02290000
         $VTAMWE (R2),            SIZE                                 +02300000
               IWECSTTP           CODE                                  02310000
                                                                        02320000
         LR    R4,R1              SAVE WE ADDRESS                       02330000
                                                                        02340000
         USING IWEVTAM,R4                                               02350000
                                                                        02360000
         $TASK SETEPB,            INITIALIZE EPB TO WAIT FOR START     +02370000
               ECODE=EC$62ST,     START TP EVENT                       +02380000
               ERRET=ERR$TASK,                                         +02390000
               MF=(E,$TASKMFL)                                          02400000
                                                                        02410000
         LR    R3,R1              SAVE XEPB ADDRESS                     02420000
                                                                        02430000
         ST    R3,IWEXWEPB        SET XEPB ADDRESS IN WORK ELEMENT      02440000
         L     R1,TSKPCBC         CURRENT PCB                           02450000
         MVC   IWEXWENT,PCBENTKN-IPCB(R1) CURRENT IPCB ENTITY TOKEN     02460000
         MVC   IWEXWTPN,TPNAME    SET TPNAME                            02470000
         MVC   IWEXWPLU,LUNAME    SET PARTNER LU NAME                   02480000
         MVC   IWEXWMDE,MODENAME  SET MODE NAME                         02490000
         MVC   IWEXWWUT,WUTYPE    SET WORK UNIT TYPE                    02500000
         MVC   IWEXWTOK,SESSTOKN  SET SESSION TOKEN                     02510000
         LA    R0,WUTOKEN         WORK UNIT TOKEN RETURN AREA           02520000
         ST    R0,IWEXWRWU        SET WORK UNIT TOKEN RETURN ADDRESS    02530000
         MVC   IWEXWPRL,PARMLEN   SET PARM STRING LENGTH                02540000
         LA    R0,IWEXWPRM        PARM STRING AREA                      02550000
         L     R1,PARMLEN         PARM STRING LENGTH                    02560000
         LR    R15,R1             PARM STRING LENGTH                    02570000
         L     R14,PARMADDR       PARM STRING ADDRESS                   02580000
         MVCL  R0,R14             SET PARM STRING IN WORK ELEMENT       02590000
                                                                        02600000
         $VTAMQ (R4),             WORK ELEMENT                         +02610000
               IVTWEQ             QUEUE                                 02620000
                                                                        02630000
         $TASK WAIT,              WAIT FOR MAIN TO COMPLETE START TP   +02640000
               EPB=(R3),                                               +02650000
               MF=(E,$TASKMFL)                                          02660000
                                                                        02670000
         ST    R0,RETCODE         POST CODE IN R0 IS START TP RC        02680000
         B     RETURN             RETURN AFTER START TP COMPLETE        02690000
                                                                        02700000
*---------------------------------------------------------------------- 02710000
* LOAD THE TRANSACTION PROGRAM                                          02720000
*---------------------------------------------------------------------- 02730000
                                                                        02740000
STTPMAIN DS    0H                                                       02750000
                                                                        02760000
         L62LDTP TPNAME,          TRANSACTION PROGRAM NAME             +02770000
               L62RETEP,          EP ADDRESS RETURN AREA               +02780000
               L62RETWU,          WU TYPE    RETURN AREA               +02790000
               L62RETRC,          RETURN CODE AREA                     +02800000
               MF=(E,L62MFL)                                            02810000
                                                                        02820000
         ICM   R1,15,L62RETRC     LOAD SUCCESSFUL?                      02830000
         BNZ   ERRLOAD            BRANCH IF NOT                         02840000
                                                                        02850000
*---------------------------------------------------------------------- 02860000
* ALLOCATE A PARM AREA TO PASS THINGS TO IL62XINI                       02870000
*---------------------------------------------------------------------- 02880000
                                                                        02890000
         LA    R2,L'XSPMAX        BASIC PARM AREA SIZE                  02900000
         A     R2,PARMLEN         PLUS THE PARM STRING LENGTH           02910000
                                                                        02920000
         $GETSTOR (R2),                                                +02930000
               LOC=ANY,                                                +02940000
               OWNER=*IVTITASK    ALLOCATE THE PARM AREA                02950000
                                                                        02960000
         LR    RXSP,R1            PARM AREA POINTER                     02970000
         MVC   XSPEP,L62RETEP     ENTRY POINT ADDRESS OF TP             02980000
         MVC   XSPNAME,TPNAME     CALLER PROVIDED TPNAME                02990000
         MVC   XSPARTLU,LUNAME    CALLER PROVIDED PARTNER LU NAME       03000000
         MVC   XSPMODE,MODENAME   CALLER PROVIDED MODE NAME             03010000
         MVC   XSPTOKEN,SESSTOKN  CALLER PROVIDED SESSION TOKEN         03020000
         MVC   XSPWUTYP,WUTYPE    CALLER PROVIDED WORKUNIT TYPE         03030000
         MVC   XSPARMLN,PARMLEN   CALLER PROVIDED PARM STRING LENGTH    03040000
         LA    R0,XSPARM          AREA FOR PARM STRING                  03050000
         L     R1,PARMLEN         LENGTH OF PARM STRING                 03060000
         LR    R15,R1             LENGTH OF PARM STRING                 03070000
         L     R14,PARMADDR       ADDRESS OF PARM STRING                03080000
         MVCL  R0,R14             COPY CALLER PROVIDED PARM STRING      03090000
                                                                        03100000
*---------------------------------------------------------------------- 03110000
* CREATE A NEW VTAM ENVIRONMENT TO RUN THE TRANSACTION PROGRAM          03120000
*---------------------------------------------------------------------- 03130000
                                                                        03140000
         CLC   WUTYPE,=CL4'VTAM'       VTAM ENVIRONMENT REQUESTED?      03150000
         BNE   TPTASK                  BRANCH IF NOT                    03160000
         LR    R1,RXSP                 PASS TP STARTUP PARMS            03170000
         L     R15,IVT@NXPG            VTAM ENVIRONMENT START ROUTINE   03180000
         BASR  R14,R15                 LINK TO START IT UP              03190000
         LTR   R1,R15                  ITASK ADDRESS IS RETURNED        03200000
         ST    R1,WUADDR               SAVE FOR TRACE                   03210000
         BNP   RETURN                  SKIP TOKEN COPY IF BAD ITASK PTR 03220000
         MVC   WUTOKEN(L'TSKENTKN),TSKENTKN-ITASK(R1)                   03230000
         B     RETURN                                                   03240000
                                                                        03250000
*---------------------------------------------------------------------- 03260000
* CREATE A NEW TASK TO RUN THE TRANSACTION PROGRAM                      03270000
*---------------------------------------------------------------------- 03280000
                                                                        03290000
TPTASK   DS    0H                                                       03300000
                                                                        03310000
         CLC   WUTYPE,=CL4'TASK'       TASK REQUESTED?                  03320000
         BNE   TPPROC                  BRANCH IF NOT                    03330000
                                                                        03340000
         L     R2,IVTXTSEQ             CURRENT TASK SEQ#                03350000
                                                                        03360000
UPDTTSEQ DS    0H                                                       03370000
                                                                        03380000
         LR    R1,R2                                                    03390000
         AL    R1,=F'1'                BUMP IT BY ONE                   03400000
         CS    R2,R1,IVTXTSEQ          ATTEMPT TO UPDATE                03410000
         BNE   UPDTTSEQ                RETRY UPDATE IF CONTENTION       03420000
                                                                        03430000
         CVD   R1,DWORK                MAKE IT PACKED                   03440000
         OI    DWORK+7,X'0F'           NICE SIGN FOR UNPACKING          03450000
         UNPK  WUNAME+1(7),DWORK+4(4)  GET A NICE ZONED DECIMAL INT.    03460000
         MVC   WUNAME(2),=CL2'XT'      NAME FOR TASK IS XTNNNNNN        03470000
                                                                        03480000
         L     R2,=F'-1'          DPMOD VALUE FOR $TASK CREATE          03490000
                                                                        03500000
         $TASK CREATE,            CREATE TP SUBTASK                    +03510000
               EP=*IL6@XINI,      PROC MAIN CODE FOR TP INITIALIZATION +03520000
               NAME=WUNAME,       TASKNAME IS XTNNNNNN                 +03530000
               PARM=(RXSP),       PASS PARM AREA TO IL62XINI           +03540000
               SYNC=YES,          WAIT FOR SUBTASK TO START            +03550000
               DPMOD=(R2),        DISPATCH AT SLIGHTLY LOWER PRIORITY  +03560000
               ERRET=ERR$TASK,                                         +03570000
               MF=(E,$TASKMFL)                                          03580000
                                                                        03590000
         ST    R1,WUADDR          SAVE FOR TRACE                        03600000
         MVC   WUTOKEN(L'TSKENTKN),TSKENTKN-ITASK(R1)                   03610000
         B     RETURN                                                   03620000
                                                                        03630000
*---------------------------------------------------------------------- 03640000
* CREATE A NEW PROC TO RUN THE TRANSACTION PROGRAM                      03650000
*---------------------------------------------------------------------- 03660000
                                                                        03670000
TPPROC   DS    0H                                                       03680000
                                                                        03690000
         L     R2,IVTXPSEQ             CURRENT TASK SEQ#                03700000
                                                                        03710000
UPDTPSEQ DS    0H                                                       03720000
                                                                        03730000
         LR    R1,R2                                                    03740000
         AL    R1,=F'1'                BUMP IT BY ONE                   03750000
         CS    R2,R1,IVTXPSEQ          ATTEMPT TO UPDATE                03760000
         BNE   UPDTPSEQ                RETRY UPDATE IF CONTENTION       03770000
                                                                        03780000
         CVD   R1,DWORK                MAKE IT PACKED                   03790000
         OI    DWORK+7,X'0F'           NICE SIGN FOR UNPACKING          03800000
         UNPK  WUNAME+1(7),DWORK+4(4)  GET A NICE ZONED DECIMAL INT.    03810000
         MVC   WUNAME(2),=CL2'XP'      NAME FOR PROC IS XPNNNNNN        03820000
                                                                        03830000
         $PROC CREATE,            CREATE TP PROCESS                    +03840000
               EP=*IL6@XINI,      IVTMSESS IS THE ENTRY POINT          +03850000
               NAME=WUNAME,       IPROC NAME                           +03860000
               PARM=(RXSP),       PASS PARM AREA TO IL62XINI           +03870000
               MF=(E,$PROCMFL)                                          03880000
                                                                        03890000
         LTR   R15,R15                                                  03900000
         BNZ   ERR$PROC           BRANCH IF SERVICE ERROR               03910000
         ST    R1,WUADDR          SAVE FOR TRACE                        03920000
         MVC   WUTOKEN(L'PCBENTKN),PCBENTKN-IPCB(R1)                    03930000
         B     RETURN                                                   03940000
                                                                        03950000
*---------------------------------------------------------------------- 03960000
* EXCEPTION ROUTINES                                                    03970000
*---------------------------------------------------------------------- 03980000
                                                                        03990000
ERRPROD  DS    0H                                                       04000000
                                                                        04010000
         MVC   RETCODE,=A(LU62_PRODUCT_SPECIFIC_ERROR)                  04020000
         B     ERRCOMM                                                  04030000
                                                                        04040000
ERRLOAD  DS    0H                                                       04050000
                                                                        04060000
         MVC   RETCODE,=A(LU62_TPN_NOT_RECOGNIZED)                      04070000
         B     ERRCOMM                                                  04080000
                                                                        04090000
ERRCOMM  DS    0H                                                       04100000
                                                                        04110000
         B     RETURN                                                   04120000
                                                                        04130000
*---------------------------------------------------------------------- 04140000
* EXIT TRACE AND RETURN TO CALLER                                       04150000
*---------------------------------------------------------------------- 04160000
                                                                        04170000
RETURN   DS    0H                                                       04180000
                                                                        04190000
         $TRACE *=A(TRC_LU62_EXIT),16 TRACE ENTRY W/ 16 USER BYTES      04200000
         BNZ   NOXTRACE               BRANCH IF TRACING NOT AVAILABLE   04210000
         MVC   0(8,R1),=CL8'IL62ASTP' MODULE NAME                       04220000
         MVC   8(4,R1),RETCODE        RETURN_CODE VALUE                 04230000
         MVC   12(4,R1),WUADDR        TRACE WORK UNIT (ITASK/IPCB) ADDR 04240000
NOXTRACE DS    0H                                                       04250000
                                                                        04260000
         L     R1,L62PARM8              ADDRESS OF WU TOKEN AREA        04270000
         MVC   0(L'PCBENTKN,R1),WUTOKEN SET WU TOKEN VARIABLE           04280000
                                                                        04290000
         L     R1,L62PARM9        ADDRESS OF RETURN_CODE AREA           04300000
         MVC   0(4,R1),RETCODE    SET RETURN_CODE VARIABLE              04310000
                                                                        04320000
         SR    R15,R15            FUNCTION RETURN CODE = 0              04330000
         CEXIT RC=(R15),INDEP=YES RETURN                                04340000
                                                                        04350000
*---------------------------------------------------------------------- 04360000
* ERROR ROUTINES                                                        04370000
*---------------------------------------------------------------------- 04380000
                                                                        04390000
ERR$PROC DS    0H                                                       04400000
                                                                        04410000
         $ABEND ABE_VTDIAG,                                            +04420000
               SCOPE=PCB,                                              +04430000
               TITLE='$PROC FAILURE'                                    04440000
                                                                        04450000
ERR$TASK DS    0H                                                       04460000
                                                                        04470000
         $ABEND ABE_VTDIAG,                                            +04480000
               SCOPE=PCB,                                              +04490000
               TITLE='$TASK FAILURE'                                    04500000
                                                                        04510000
*---------------------------------------------------------------------- 04520000
* LITERALS AND CONSTANTS                                                04530000
*---------------------------------------------------------------------- 04540000
                                                                        04550000
         LTORG ,                                                        04560000
                                                                        04570000
         PRINT NOGEN                                                    04580000
         ISTDBIND ,               VTAM BIND IMAGE                       04590000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                04600000
         IKJTCB ,                 MVS TASK CONTROL BLOCK                04610000
         TRACODES ,               INTEGRATOR TRACE CODE EQUATES         04620000
         ICVT  ,                  INTEGRATOR CVT                        04630000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   04640000
         ITASK ,                  INTEGRATOR TASK BLOCK                 04650000
         IPCB ,                   INTEGRATOR PROCESS BLOCK              04660000
         IACB ,                   INTEGRATOR VTAM ACB                   04670000
         ABCODES ,                INTEGRATOR $ABEND CODES               04680000
         EVCODES ,                INTEGRATOR EVENT CODES                04690000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            04700000
         ISESS ,                  INTEGRATOR SESSION BLOCK              04710000
         IRPL ,                   INTEGRATOR VTAM RPL                   04720000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          04730000
         $TASK DSECT=YES          INTEGRATOR $TASK SERVICES             04740000
         $PROC DSECT=YES          INTEGRATOR $PROC SERVICES             04750000
         END   ,                                                        04760000
