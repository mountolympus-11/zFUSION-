IRESCAPI TITLE 'RESOURCE MANAGER C-LANGUAGE API'                        00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE:  IRESCAPI - RESOURCE MANAGER C-LANGUAGE API                  00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*   THIS MODULE PROVIDES A BRIDGE TO THE RESOURCE MANAGER               00080000
*   SERVICES FROM A C-LANGUAGE CALLER.                                  00090000
*                                                                       00100000
* FUNCTIONS:                                                            00110000
*                                                                       00120000
*   RESMGR  - RESOURCE MANAGER PLIST                                    00130000
*                                                                       00140000
* ON ENTRY:                                                             00150000
*                                                                       00160000
*   R1 CONTAINS THE ADDRESS OF THE PARAMETER LIST FOLLOWING             00170000
*   THE SAS/C STANDARD LINKAGE CONVENTIONS.                             00180000
*                                                                       00190000
* ON EXIT:                                                              00200000
*                                                                       00210000
*   R15 CONTAINS THE RETURN INFO AS DOCUMENTED IN THE                   00220000
*   FUNCTION PROLOG.                                                    00230000
*                                                                       00240000
**<DOC-OFF>*****************************************************        00250000
                                                                        00260000
         EJECT ,                                                        00270000
****************************************************************        00280000
*                                                                       00290000
* MAINTENANCE:                                                          00300000
*                                                                       00310000
*   07/25/95 RON COLMONE          PAR# 134222                           00320000
*            INITIAL VERSION                                            00330000
*                                                                       00340000
****************************************************************        00350000
         EJECT ,                                                        00360000
         $RESMGR DSECT=YES        PROCESS SERVICES REQ BLOCK            00370000
                                                                        00380000
         EJECT ,                                                        00390000
         EQUS  ,                  GENERAL EQUATES                       00400000
                                                                        00410000
         EJECT ,                                                        00420000
         COPY  CRAB               "C"  RUNTIME ANCHOR BLOCK             00430000
         USING CRAB,R12           LIFETIME ADDRESSABILITY               00440000
                                                                        00450000
         EJECT ,                                                        00460000
         COPY  DSA                DYNAMIC SAVE AREA                     00470000
FWORD    DS    F                  FULLWORD WORKAREA                     00480000
$RMGRMFL $RESMGR MF=L             $RESMGR PLIST                         00490000
DSALEN   EQU   *-DSA              LENGTH OF DSA                         00500000
                                                                        00510000
         EJECT ,                                                        00520000
**<DOC-ON>******************************************************        00530000
*                                                                       00540000
* FUNCTION: RESMGR - RESOURCE MANAGER REQUEST                           00550000
*                                                                       00560000
* DESCRIPTION:                                                          00570000
*                                                                       00580000
*    THIS FUNCTION WILL INVOKE THE REQUESTED RESOURCE                   00590000
*    MANAGER SERVICE.  IF NO WORKUNIT ADDRESS IS PROVIDED               00600000
*    THE CURRENT ACTIVE WORKUNIT ADDRESS IS OBTAINED.                   00610000
*                                                                       00620000
*                                                                       00630000
* ENTRY:    R1 CONTAINS ADDR OF FOLLOWING PARAMETER LIST:               00640000
*                                                                       00650000
*               +00  - RESOURCE MANAGER REQUEST                         00660000
*               +04  - ADDRESS OF RESMGR TOKEN                          00670000
*               +08  - ADDRESS OF OWNING WORKUNIT OR 0 (ACTIVE)         00680000
*               +12  - ADDRESS OF RESOURCE MANAGER ROUTINE              00690000
*               +16  - RESOURCE MANAGER PARMS                           00700000
*                                                                       00710000
* EXIT:     R15 CONTAINS RETURN VALUE FROM THE ASSOCIATED               00720000
*               RESOURCE MANAGER SERVICE REQUESTED.                     00730000
*                                                                       00740000
**<DOC-OFF>*****************************************************        00750000
                                                                        00760000
IRESCAPI CSECT ,                                                        00770000
RESMGR   CENTRY DSA=DSALEN                                              00780000
         USING DSA,R13            ADDRESSABILITY                        00790000
                                                                        00800000
         LM    R3,R7,0(R1)        RETRIVED PASSED PARMS                 00810000
                                                                        00820000
*---------------------------------------------------------------        00830000
*  RESTORE STANDARD ENVIRONMENT                                         00840000
*---------------------------------------------------------------        00850000
         @RESTENV ,                                                     00860000
         USING ICVT,R11           ADDRESSABILITY                        00870000
         USING ITASK,R10          ADDRESSABILITY                        00880000
                                                                        00890000
*---------------------------------------------------------------        00900000
*  IF CURRENT WORKUNIT ADDRESS IS REQUESTED,  OBTAIN CURRENT WU         00910000
*---------------------------------------------------------------        00920000
         LTR   R5,R5              WORKUNIT SPECIFIED                    00930000
         BNZ   REQUEST            YES, CONTINUE WITH REQUEST            00940000
         ICM   R5,15,TSKPCBC      PROCESS MODE?                         00950000
         BNZ   REQUEST            YES, CONTINUE WITH REQUEST            00960000
         LR    R5,R10             TASK MODE                             00970000
                                                                        00980000
*---------------------------------------------------------------        00990000
*  OBTAIN REQUESTED FUNCTION CODE AND INVOKE REQUESTED SERVICE          01000000
*---------------------------------------------------------------        01010000
REQUEST  DS    0H                                                       01020000
         BCTR  R3,0               CONVERT FUNC TO INDEX                 01030000
         SLL   R3,2               INDEX INTO BRANCH TABLE               01040000
         B     *+4(R3)            BRANCH ON FUNCTION CODE               01050000
         B     RMGR_ADD           1 - RESMGR ADD REQUEST                01060000
         B     RMGR_DEL           2 - RESMGR DELETE REQUEST             01070000
         B     RMGR_CAL           3 - RESMGR CALL REQUEST               01080000
         EX    0,*                UNSUPPORTED REQUEST                   01090000
         EX    0,*                UNSUPPORTED REQUEST                   01100000
         EX    0,*                UNSUPPORTED REQUEST                   01110000
                                                                        01120000
*---------------------------------------------------------------        01130000
*  ISSUE RESOURCE MANAGER REQUEST - ADD                                 01140000
*---------------------------------------------------------------        01150000
RMGR_ADD DS    0H                                                       01160000
         $RESMGR ADD,            RESOURCE MANAGER ADD REQUEST          +01170000
               TOKEN=(R4),                                             +01180000
               OWNER=(R5),                                             +01190000
               ROUTINE=(R6),                                           +01200000
               PARM=(R7),                                              +01210000
               MF=(E,$RMGRMFL)                                          01220000
                                                                        01230000
          B    RETURN                                                   01240000
                                                                        01250000
*---------------------------------------------------------------        01260000
*  ISSUE RESOURCE MANAGER REQUEST - DELETE                              01270000
*---------------------------------------------------------------        01280000
RMGR_DEL DS    0H                                                       01290000
         $RESMGR DELETE,         RESOURCE MANAGER DELETE REQUEST       +01300000
               TOKEN=(R4),                                             +01310000
               OWNER=(R5),                                             +01320000
               MF=(E,$RMGRMFL)                                          01330000
                                                                        01340000
          B    RETURN                                                   01350000
                                                                        01360000
*---------------------------------------------------------------        01370000
*  ISSUE RESOURCE MANAGER REQUEST - CALL                                01380000
*---------------------------------------------------------------        01390000
RMGR_CAL DS    0H                                                       01400000
         $RESMGR CALL,           RESOURCE MANAGER CALL REQUEST         +01410000
               OWNER=(R5),                                             +01420000
               MF=(E,$RMGRMFL)                                          01430000
                                                                        01440000
          B    RETURN                                                   01450000
                                                                        01460000
         EJECT ,                                                        01470000
*---------------------------------------------------------------        01480000
*  RETURN                                                               01490000
*---------------------------------------------------------------        01500000
RETURN   DS    0H                                                       01510000
         CEXIT RC=(R15)           RETURN                                01520000
                                                                        01530000
         EJECT ,                                                        01540000
*---------------------------------------------------------------        01550000
*  LITERALS AND CONSTANTS                                               01560000
*---------------------------------------------------------------        01570000
         LTORG ,                                                        01580000
                                                                        01590000
         PRINT NOGEN                                                    01600000
         ICVT  ,                                                        01610000
         ITASK ,                                                        01620000
         IPCB  ,                                                        01630000
         IUSER ,                                                        01640000
         IHAPSA ,                                                       01650000
         IKJTCB ,                                                       01660000
         CVT   DSECT=YES,LIST=NO                                        01670000
         PRINT GEN                                                      01680000
                                                                        01690000
         END   ,                                                        01700000
