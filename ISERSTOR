ISERSTOR TITLE '- C STORAGE LOCK OBTAIN/RELEASE'                        00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE: ISERSTOR - C STORAGE LOCK OBTAIN/RELEASE                     00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*   THIS ROUTINE PROVIDES THE SERVICE FOR ALLOCATING AND                00080000
*   RELEASING THE STORAGE LOCK FROM A C-LANGUAGE PROGRAM.               00090000
*                                                                       00100000
* ON ENTRY: N/A                                                         00110000
*                                                                       00120000
* ON EXIT:  N/A                                                         00130000
*                                                                       00140000
* FUNCTIONS:                                                            00150000
*                                                                       00160000
*   XSERSTOR - OBTAIN/RELEASE STORAGE LOCK                              00170000
*                                                                       00180000
**<DOC-OFF>*****************************************************        00190000
                                                                        00200000
         EJECT ,                                                        00210000
****************************************************************        00220000
*                                                                       00230000
* MAINTENANCE:                                                          00240000
*                                                                       00250000
*   04/27/93 RON COLMONE                                                00260000
*            INITIAL VERSION                                            00270000
*                                                                       00280000
****************************************************************        00290000
         EJECT ,                                                        00300000
         EQUS  ,                  GENERAL EQUATES                       00310000
                                                                        00320000
         EJECT ,                                                        00330000
         COPY  CRAB               "C"  RUNTIME ANCHOR BLOCK             00340000
         USING CRAB,R12           LIFETIME ADDRESSABILITY               00350000
                                                                        00360000
         EJECT ,                                                        00370000
         COPY  DSA                DYNAMIC SAVE AREA                     00380000
DSALEN   EQU   *-DSA              LENGTH OF SAVE AREA                   00390000
         USING DSA,R13            ADDRESSABILITY                        00400000
                                                                        00410000
         EJECT ,                                                        00420000
****************************************************************        00430000
*                                                                       00440000
* FUNCTION: XSERSTOR - OBTAIN/RELEASE STORAGE LOCK                      00450000
*                                                                       00460000
* ENTRY:    R1 CONTAINS THE ADDRESS OF THE FOLLOWING PARAMETER          00470000
*           LIST:                                                       00480000
*                                                                       00490000
*              +0 -  0 = OBTAIN  STORAGE LOCK                           00500000
*                   >0 = RELEASE STORAGE LOCK                           00510000
*                                                                       00520000
*                                                                       00530000
* EXIT:     R15 CONTAINS RETURN VALUS AS FOLLOWS:                       00540000
*                                                                       00550000
*              0 - LOCK OBTAINED/RELEASED                               00560000
*              4 - LOCK ALREADY HELD                                    00570000
*              8 - LOCK OBTAIN/RELEASE FAILED                           00580000
*                                                                       00590000
****************************************************************        00600000
                                                                        00610000
ISERSTOR CSECT ,                                                        00620000
XSERSTOR CENTRY DSA=DSALEN        STORAGE ALLOCATION FUNCTION           00630000
                                                                        00640000
         L     R3,0(,R1)          RETAIN PARAMETER ADDR                 00650000
                                                                        00660000
         @RESTENV ,               RESTORE STANDARD ENVIRONMENT          00670000
         USING ITASK,R10          ESTABLISH ADDRESSABILITY              00680000
         USING ICVT,R11           ESTABLISH ADDRESSABILITY              00690000
                                                                        00700000
                                                                        00710000
         LTR   R3,R3              ACQUIRE LOCK REQUEST                  00720000
         BNZ   LOCK_REL           NO, RELEASE STORAGE LOCK              00730000
                                                                        00740000
         $SER  OBTAIN,STOR        OBTAIN  STORAGE LOCK                  00750000
         B     LOCK_XIT           RETURN                                00760000
                                                                        00770000
LOCK_REL DS    0H                                                       00780000
         $SER  RELEASE,STOR       RELEASE STORAGE LOCK                  00790000
                                                                        00800000
LOCK_XIT DS    0H                                                       00810000
         CEXIT RC=(R15)           RETURN                                00820000
                                                                        00830000
         EJECT ,                                                        00840000
*---------------------------------------------------------------        00850000
*  LITERALS AND CONSTANTS                                               00860000
*---------------------------------------------------------------        00870000
                                                                        00880000
         LTORG ,                                                        00890000
                                                                        00900000
         PRINT NOGEN                                                    00910000
         ICVT  ,                                                        00920000
         ITASK ,                                                        00930000
                                                                        00940000
         IHAPSA ,                                                       00950000
         IKJTCB ,                                                       00960000
         PRINT GEN                                                      00970000
                                                                        00980000
         END   ,                                                        00990000
