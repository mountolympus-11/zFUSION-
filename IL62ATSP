IL62ATSP TITLE 'INTEGRATOR - LU6.2 TRACE SPLIST TO LOG'                 00010000
                                                                        00020000
         PRINT NOGEN                                                    00030000
         CMINCL ,                 INTEGRATOR CPI-C DEFINITIONS          00040000
         L62INCL ,                INTEGRATOR LU6.2 DEFINITIONS          00050000
         PRINT GEN                                                      00060000
                                                                        00070000
**<DOC-ON>************************************************************* 00080000
*                                                                       00090000
* ROUTINE: IL62ATSP - LU6.2 TRACE SPLIST TO LOG                         00100000
*                                                                       00110000
* DESCRIPTION:                                                          00120000
*                                                                       00130000
*    THIS ROUTINE IS CALLED TO CREATE A FORMATTED DISPLAY OF AN         00140000
*    SPLIST AND SELECTED LU6.2 INFORMATION WHEN MSGCLASS VTAMTRACE      00150000
*    IS ACTIVE.                                                         00160000
*                                                                       00170000
* ON ENTRY:                                                             00180000
*                                                                       00190000
*    R15 = ENTRY POINT ADDRESS                                          00200000
*    R14 = RETURN      ADDRESS                                          00210000
*    R13 = SAVE AREA   ADDRESS                                          00220000
*    R01 = PARM LIST   ADDRESS                                          00230000
*                                                                       00240000
*     1    +00 = ADDRESS OF SPLIST                                      00250000
*     2    +04 = ADDRESS OF ISESS BLOCK                                 00260000
*     3    +08 = ADDRESS OF TRACE POINT DESCRIPTION                     00270000
*     4    +0C = ADDRESS OF TRACE POINT DESCRIPTION LENGTH              00280000
*     5    +10 = ADDRESS OF ADDITIONAL DATA AREA                        00290000
*     6    +14 = ADDRESS OF ADDITIONAL DATA AREA LENGTH                 00300000
*     7    +18 = ADDRESS OF RETURN CODE AREA                            00310000
*                                                                       00320000
* ON EXIT:                                                              00330000
*                                                                       00340000
*    R15 = 0                                                            00350000
*                                                                       00360000
*    RETURN_CODE = LU62_OK                                              00370000
*                                                                       00380000
**<DOC-OFF>************************************************************ 00390000
         EJECT ,                                                        00400000
*********************************************************************** 00410000
*                                                                       00420000
* MAINTENANCE:                                                          00430000
*                                                                       00440000
*   07/01/94 RANDY WITEK                                                00450000
*                                                                       00460000
*********************************************************************** 00470000
                                                                        00480000
         EQUS  ,                  GENERAL EQUATES                       00490000
                                                                        00500000
RICVT    EQU   R11                                                      00510000
RITASK   EQU   R10                                                      00520000
RBASE    EQU   R9                                                       00530000
RIVTAM   EQU   R8                                                       00540000
RPLIST   EQU   R7                                                       00550000
RSPLIST  EQU   R6                                                       00560000
RISESS   EQU   R5                                                       00570000
                                                                        00580000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00590000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00600000
         USING L62LIST,RPLIST     ESTABLISH ADDRESSABILITY              00610000
         USING SPLIST,RSPLIST     ESTABLISH ADDRESSABILITY              00620000
         USING ISESS,RISESS       ESTABLISH ADDRESSABILITY              00630000
                                                                        00640000
         COPY  CRAB               "C" RUNTIME ANCHOR BLOCK              00650000
         USING CRAB,R12           ADDRESSABILITY                        00660000
                                                                        00670000
         COPY  DSA                DYNAMIC SAVE AREA                     00680000
WORKAREA DS    0H                 READ/WRITE WORKAREA                   00690000
WRK256   DS    XL256              GENERAL WORKAREA                      00700000
SUB0SAVE DS    18F                SUBROUTINE SAVE AREA                  00710000
OFFSET   DS    F                  RELATIVE OFFSET WORK AREA             00720000
OFFZERO  DS    F                  RELATIVE OFFSET WORK AREA             00730000
OFFZEND  DS    F                  RELATIVE OFFSET WORK AREA             00740000
OFFZLST  DS    F                  RELATIVE OFFSET WORK AREA             00750000
CHARLINE DS    XL16                                                     00760000
DATALINE DS    XL16                                                     00770000
PLUNAME  DS    CL8                                                      00780000
SLUNAME  DS    CL8                                                      00790000
RETCODE  DS    F                  TEMPORARY RETURN CODE AREA            00800000
FLAG     DS    X                                                        00810000
WORKLEN  EQU   *-WORKAREA         LENGTH OF USER DSA AREA               00820000
DSALEN   EQU   *-DSA              LENGTH OF DSA                         00830000
                                                                        00840000
         $MSGDFT PREFIX=ICTPID,                                        +00850000
               COMPID='L62',                                           +00860000
               TABLE=*#MSGS,                                           +00870000
               WORKA=0,                                                +00880000
               MF=(E,WRK256),                                          +00890000
               PRINT=NOGEN                                              00900000
                                                                        00910000
IL6ATSP@ CSECT ,                                                        00920000
IL62ATSP CENTRY DSA=DSALEN,BASE=RBASE,INDEP=YES                         00930000
                                                                        00940000
         USING DSA,R13            ADDRESSABILITY                        00950000
         LR    RPLIST,R1          SAVE ADDRESS OF PLIST                 00960000
                                                                        00970000
         LA    R0,WORKAREA        ADDRESS OF USER DSA SECTION           00980000
         LA    R1,WORKLEN         LENGTH  OF USER DSA SECTION           00990000
         SR    R15,R15            PREPARE FOR CLEAR                     01000000
         MVCL  R0,R14             CLEAR USER DSA SECTION                01010000
                                                                        01020000
*---------------------------------------------------------------------- 01030000
* INITIALIZATION                                                        01040000
*---------------------------------------------------------------------- 01050000
                                                                        01060000
         @RESTENV ,               ENSURE ENVIRONMENT                    01070000
                                                                        01080000
         L     RIVTAM,ICTVTCVT    ESTABLISH IVTAMCVT POINTER            01090000
         USING IVTAMCVT,RIVTAM    ADDRESSABILITY                        01100000
                                                                        01110000
         L     RSPLIST,L62PARM1   SPLIST ADDRESS                        01120000
         L     RISESS,L62PARM2    ISESS ADDRESS                         01130000
                                                                        01140000
*---------------------------------------------------------------------- 01150000
* IF THE "VTAMTRACE" MESSAGE CLASS IS NOT ACTIVE...AVOID THE OVERHEAD   01160000
*---------------------------------------------------------------------- 01170000
                                                                        01180000
         $MSGATTR 'VTAMTRACE'                                           01190000
         BNZ   RETURN             EXIT IF "VTAMTRACE" NOT ACTIVE        01200000
                                                                        01210000
*---------------------------------------------------------------------- 01220000
* ISSUE THE BASIC SPLIST DUMP MESSAGE                                   01230000
*---------------------------------------------------------------------- 01240000
                                                                        01250000
         MVC   PLUNAME,ISEILUNM      ASSUME PLU                         01260000
         MVC   SLUNAME,ISERLUNM      ASSUME SLU                         01270000
         TM    ISEF2,ISEF2SLU        ARE WE THE SLU?                    01280000
         BNO   NOTSLU                BRANCH IF NOT                      01290000
         MVC   PLUNAME,ISERLUNM      SET    PLU                         01300000
         MVC   SLUNAME,ISEILUNM      SET    SLU                         01310000
                                                                        01320000
NOTSLU   DS    0H                                                       01330000
                                                                        01340000
         L     R3,L62PARM3           DESCRIPTION ADDRESS                01350000
         L     R2,L62PARM4           @ DESCRIPTION LENGTH               01360000
         L     R2,0(,R2)             DESCRIPTION LENGTH                 01370000
                                                                        01380000
         $MSG  980,                  "SPLIST TRACE..."                 +01390000
               FIELDS=((RSPLIST),    SPLIST ADDRESS                    +01400000
               ((R3),(R2)),          TRACE POINT DESCRIPTION           +01410000
               (RISESS),             ISESS ADDRESS                     +01420000
               (ISETK,4),            ISESS TOKEN                       +01430000
               (ISETK+4,4),          ISESS TOKEN                       +01440000
               (PLUNAME,8),          PLU                               +01450000
               (SLUNAME,8),          SLU                               +01460000
               (SPLSENSE,4),         SENSE                             +01470000
               (SPLF1,4),            FLAGS                             +01480000
               (SPLSTATE,4),         SESSION STATE                     +01490000
               (SPLAREA,4),          AREA  ADDRESS                     +01500000
               (SPLAREAL,4),         AREA  LENGTH                      +01510000
               (SPLCNTRL,3),         RPL CNTRL FLAGS                   +01520000
               (SPLRH,3),            RPL USERRH                        +01530000
               (SPLSEQNO,2),         RPL SEQNO                         +01540000
               (SPLRETCD,4),         THE RETURN CODE                   +01550000
               (SPLRSNCD,4),         THE REASON CODE                   +01560000
               (SPLFUNC,4))          THE FUNCTION                       01570000
                                                                        01580000
         $MSG  981,                  "SPLIST TRACE..."                 +01590000
               FIELDS=((ISE62RCB,4), RCB ADDRESS                       +01600000
               (ISE62SRQ,4),         SHIP REQUEST SPLIST               +01610000
               (ISE62RRQ,4),         RECEIVE REQUEST SPLIST            +01620000
               (ISE62FL1,4),         ISESS LU6.2 FLAGS                 +01630000
               (ISE62RB1,4),         SPLIST QUEUE HEAD                 +01640000
               (ISE62RBL,4),         SPLIST QUEUE TAIL                 +01650000
               (ISE62SSC,2),         CURRENT SEND SEQUENCE #           +01660000
               (ISE62CBS,2),         CURRENT BRACKET #                 +01670000
               (ISE62PBR,2),         CURRENT PRIMARY BRACKET REGISTER  +01680000
               (ISE62SBR,2))         CURRENT SECONDARY BRACKET REGISTER 01690000
                                                                        01700000
         $MSG  982,                  "SPLIST TRACE..."                 +01710000
               FIELDS=((ISE62FSC,1), FSM CHAIN SEND                    +01720000
               (ISE62FRC,1),         FSM CHAIN RECEIVE                 +01730000
               (ISE62FBR,1),         FSM BRACKET                       +01740000
               (ISE62FCD,1))         FSM DIRECTION                      01750000
                                                                        01760000
*---------------------------------------------------------------------- 01770000
* DUMP ANY ADDITIONAL DATA AREA                                         01780000
*---------------------------------------------------------------------- 01790000
                                                                        01800000
         L     R1,L62PARM6           ADDITIONAL DATA LENGTH ADDRESS     01810000
         ICM   R3,15,0(R1)           ADDITIONAL DATA LENGTH             01820000
         BNP   RETURN                BRANCH IF NO ADDITIONAL DATA       01830000
         ICM   R3,B'1000',=X'00'     ENSURE ZERO PADDING BYTE           01840000
         L     R2,L62PARM5           ADDITIONAL DATA ADDRESS            01850000
                                                                        01860000
         $MSG  983,                  "SPLIST TRACE..."                 +01870000
               FIELDS=((R2),         ADDITIONAL DATA ADDRESS           +01880000
               (R3))                 ADDITIONAL DATA LENGTH             01890000
                                                                        01900000
         LR    R0,R3                 LENGTH OF DATA                     01910000
         BCTR  R0,0                  SAVE ENDING OFFSET                 01920000
         ST    R0,OFFZLST            SAVE ENDING OFFSET                 01930000
         MVC   OFFZERO,=XL4'FFFFFFFF' NO ZERO BLOCKS TO REPORT          01940000
                                                                        01950000
NEXTLINE DS    0H                                                       01960000
                                                                        01970000
         LA    R14,DATALINE          OUTPUT AREA                        01980000
         LA    R15,16                OUTPUT AREA LENGTH                 01990000
         MVCL  R14,R2                MOVE UP TO 16 BYTES TO OUTPUT AREA 02000000
         MVC   CHARLINE,DATALINE     COPY THE DATA                      02010000
         TR    CHARLINE(16),NONULL   TRANSLATE NULLS TO PERIODS         02020000
         OC    DATALINE(16),DATALINE ALL ZEROS?                         02030000
         BNZ   NEXTNORM              BRANCH IF NOT                      02040000
         ICM   R0,15,OFFZERO         HAS OFFSET BEEN SET ALREADY?       02050000
         BNM   NEXTZUPD              BRANCH IF YES                      02060000
         MVC   OFFZERO,OFFSET        SET OFFSET OF ZEROS                02070000
         L     R0,OFFSET             SET ENDING OFFSET OF ZERO BLOCK    02080000
         S     R0,=F'1'              SET ENDING OFFSET OF ZERO BLOCK    02090000
         ST    R0,OFFZEND            SET ENDING OFFSET OF ZERO BLOCK    02100000
                                                                        02110000
NEXTZUPD DS    0H                                                       02120000
                                                                        02130000
         L     R0,OFFZEND            ENDING OFFSET OF ZEROS BLOCK       02140000
         A     R0,=F'16'             UPDATE ENDING OFFSET               02150000
         ST    R0,OFFZEND            SET ENDING OFFSET OF ZERO BLOCK    02160000
         LA    R2,16(,R2)            UPDATE ADDRESS OF DATA             02170000
         S     R3,=F'16'             UPDATE LENGTH OF DATA REMAINING    02180000
         B     NEXTEND               AND GO DO NEXT LINE                02190000
                                                                        02200000
NEXTNORM DS    0H                                                       02210000
                                                                        02220000
         ICM   R0,15,OFFZERO         ANY ZERO LINES TO REPORT?          02230000
         BM    NEXTNONZ              BRANCH IF NOT                      02240000
                                                                        02250000
         $MSG  985,                  "LABEL+XXXXXXXX-XXXXXXXX: ALL 0"  +02260000
               FIELDS=((OFFZERO,4),  RELATIVE OFFSET OF ZERO BLOCK     +02270000
               (OFFZEND,4))          RELATIVE OFFSET OF ZERO BLOCK END  02280000
                                                                        02290000
         MVC   OFFZERO,=XL4'FFFFFFFF' NO ZERO BLOCKS TO REPORT          02300000
                                                                        02310000
NEXTNONZ DS    0H                                                       02320000
                                                                        02330000
         $MSG  984,                  "SPLIST TRACE..."                 +02340000
               FIELDS=((OFFSET,4),   RELATIVE OFFSET                   +02350000
               (DATALINE,4),         1ST WORD HEX                      +02360000
               (DATALINE+4,4),       2ND WORD HEX                      +02370000
               (DATALINE+8,4),       3RD WORD HEX                      +02380000
               (DATALINE+12,4),      4TH WORD HEX                      +02390000
               (CHARLINE,16))        ALL WORDS AS A STRING VARIABLE     02400000
                                                                        02410000
NEXTEND  DS    0H                                                       02420000
                                                                        02430000
         L     R4,OFFSET             RELATIVE OFFSET                    02440000
         LA    R4,16(,R4)            BUMP RELATIVE OFFSET               02450000
         ST    R4,OFFSET             SAVE UPDATED RELATIVE OFFSET       02460000
         LTR   R3,R3                 ANY DATA LEFT?                     02470000
         BP    NEXTLINE              BRANCH IF YES                      02480000
         ICM   R0,15,OFFZERO         ANY ZERO LINES TO REPORT?          02490000
         BM    RETURN                BRANCH IF NOT                      02500000
                                                                        02510000
         $MSG  985,                  "LABEL+XXXXXXXX-XXXXXXXX: ALL 0"  +02520000
               FIELDS=((OFFZERO,4),  RELATIVE OFFSET OF ZERO BLOCK     +02530000
               (OFFZLST,4))          RELATIVE OFFSET OF ZERO BLOCK END  02540000
                                                                        02550000
*---------------------------------------------------------------------- 02560000
* RETURN TO CALLER                                                      02570000
*---------------------------------------------------------------------- 02580000
                                                                        02590000
RETURN   DS    0H                                                       02600000
                                                                        02610000
         L     R1,L62PARM7        ADDRESS OF RETURN_CODE AREA           02620000
         MVC   0(4,R1),=A(CM_OK)  SET RETURN_CODE VARIABLE              02630000
                                                                        02640000
         SR    R15,R15            FUNCTION RETURN CODE = 0              02650000
         CEXIT RC=(R15),INDEP=YES RETURN                                02660000
                                                                        02670000
*---------------------------------------------------------------------- 02680000
* LITERALS AND CONSTANTS                                                02690000
*---------------------------------------------------------------------- 02700000
                                                                        02710000
NONULL   DS    0H                                                       02720000
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'                      02730000
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'                      02740000
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'                      02750000
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'                      02760000
         DC    X'404142434445464748494A4B4C4D4E4F'                      02770000
         DC    X'505152535455565758595A5B5C5D5E5F'                      02780000
         DC    X'606162636465666768696A6B6C6D6E6F'                      02790000
         DC    X'707172737475767778797A7B7C7D7E7F'                      02800000
         DC    X'808182838485868788898A8B8C8D8E8F'                      02810000
         DC    X'909192939495969798999A9B9C9D9E9F'                      02820000
         DC    X'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF'                      02830000
         DC    X'B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF'                      02840000
         DC    X'4BC1C2C3C4C5C6C7C8C9CACBCCCDCECF'                      02850000
         DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'                      02860000
         DC    X'4BE1E2E3E4E5E6E7E8E9EAEBECEDEEEF'                      02870000
         DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'                      02880000
                                                                        02890000
         LTORG ,                                                        02900000
                                                                        02910000
         PRINT NOGEN                                                    02920000
         ISTDBIND ,               VTAM BIND IMAGE                       02930000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                02940000
         IKJTCB ,                 MVS TASK CONTROL BLOCK                02950000
         TRACODES ,               INTEGRATOR TRACE CODE EQUATES         02960000
         ICVT  ,                  INTEGRATOR CVT                        02970000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   02980000
         ITASK ,                  INTEGRATOR TASK BLOCK                 02990000
         IPCB ,                   INTEGRATOR PROCESS BLOCK              03000000
         IACB ,                   INTEGRATOR VTAM ACB                   03010000
         ABCODES ,                INTEGRATOR $ABEND CODES               03020000
         EVCODES ,                INTEGRATOR EVENT CODES                03030000
         ISESS ,                  INTEGRATOR SESSION BLOCK              03040000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            03050000
         IRPL ,                   INTEGRATOR VTAM RPL                   03060000
         $SESS DSECT=YES          INTEGRATOR $SESS SERVICES             03070000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          03080000
         END   ,                                                        03090000
