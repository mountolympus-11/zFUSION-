IPRCCHAP TITLE '- Change IPCB Dispatching Priority'                     00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE: IPRCCHAP - Change IPCB Dispatching Priority                  00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine provides a facility to change the dispatching         00080000
*    priority of an IPCB.                                               00090000
*                                                                       00100000
* ON ENTRY:                                                             00110000
*                                                                       00120000
*    R1 contains the addres of the parameter list mapped by             00130000
*    the PROCPL dsect generated by $PROC DSECT=YES.                     00140000
*                                                                       00150000
* ON EXIT:                                                              00160000
*                                                                       00170000
*    Upon completion of this routine R15 will contain one               00180000
*    of the following return codes:                                     00190000
*                                                                       00200000
*        R15 = RC00 - Normal Completion                                 00210000
*                                                                       00220000
* MODE:                                                                 00230000
*                                                                       00240000
*    TASK                                                               00250000
*    APF/NON-APF                                                        00260000
*    SUP/PROB                                                           00270000
*    AMODE 31, RMODE ANY                                                00280000
*                                                                       00290000
**<DOC-OFF>*****************************************************        00300000
                                                                        00310000
         EJECT ,                                                        00320000
****************************************************************        00330000
*                                                                       00340000
* MAINTENANCE:                                                          00350000
*                                                                       00360000
*   01/17/95 Ron Colmone          Par# 159456                           00370000
*            Initial Version                                            00380000
*                                                                       00390000
*   09/12/95 Ron Colmone          Par# 214761                           00400000
*            Control range of Dispatch priority from 0-255.             00410000
*                                                                       00420000
****************************************************************        00430000
                                                                        00440000
         EJECT ,                                                        00450000
         $PROC   DSECT=YES        PROCESS MANAGER PLIST                 00460000
                                                                        00470000
         EJECT ,                                                        00480000
         EQUS  ,                  GENERAL EQUATES                       00490000
                                                                        00500000
         EJECT ,                                                        00510000
         #WORK LENGTH=512         READ/WRITE WORKAREA                   00520000
         #ENDWORK                 END OF WORKAREA                       00530000
                                                                        00540000
         EJECT ,                                                        00550000
IPRCCHAP #ENTER BASE=R12,         ENTRY LINKAGE                        +00560000
               PREG=R8,                                                +00570000
               WAPASS=YES                                               00580000
                                                                        00590000
         USING PROCPL,R8          ESTABLISH ADDRESSABILITY              00600000
         USING ITASK,R10          ESTAB ADDR TO ITASK                   00610000
                                                                        00620000
         EJECT ,                                                        00630000
****************************************************************        00640000
*                                                                       00650000
*  Change IPCB dispatching priority                                     00660000
*                                                                       00670000
****************************************************************        00680000
                                                                        00690000
         ICM   R5,15,PPLPCB       ADDRESS OF IPCB SPECIFIED             00700000
         BNZ   CHAP_VAL           RETRIEVE PRIORITY VALUE               00710000
         ICM   R5,15,TSKPCBC      CURRENT PCB REQUESTED                 00720000
         BZ    CHAP_RET           NO WORKUNIT AVAILABLE                 00730000
         USING IPCB,R5            ADDRESSABILITY                        00740000
                                                                        00750000
CHAP_VAL DS    0H                                                       00760000
         ICM   R3,15,PPLDPRTY     ASSUME PRIORITY SPECIFIED             00770000
         BNZ   CHAP_MOD           CONVERT TO DPMOD                      00780000
         ICM   R3,15,PPLDPMOD     PRIORITY ADJUSTMENT                   00790000
         BZ    CHAP_RET           NO ADJUSTMENT REQUIRED                00800000
         B     CHAP_SET           SET NEW DISPATCH PRIORITY             00810000
                                                                        00820000
CHAP_MOD DS    0H                                                       00830000
         SR    R2,R2              PREPARE FOR INSERT             214761 00840000
         IC    R2,PCBPRTY         RETRIVE CURRENT PRIORITY       214761 00850000
         SR    R3,R2              CONVERT TO DPMOD VALUE         214761 00860000
                                                                        00870000
*---------------------------------------------------------------        00880000
*  Set the updated dispatching priority.                                00890000
*---------------------------------------------------------------        00900000
CHAP_SET DS    0H                                                       00910000
         SR    R2,R2              PREPARE FOR INSERT             214761 00920000
         IC    R2,PCBPRTY         RETRIEVE CURRENT PRIORITY      214761 00930000
         AR    R2,R3              ADD DISPATCH PROIRITY MODIFIER 214761 00940000
         BM    CHAP_DP0           NEGATIVE DPRIO, RESET TO ZERO  214761 00950000
         C     R2,=A(255)         PRIORITY EXCEED LIMIT          214761 00960000
         BNH   CHAP_DP            CONTINUE WITH DP SET           214761 00970000
         LA    R2,255             ADJUST PRIORITY TO LIMIT       214761 00980000
         B     CHAP_DP            CONTINUE WITH DP SET           214761 00990000
                                                                        01000000
CHAP_DP0 DS    0H                                                214761 01010000
         SR    R2,R2              RESET DP PRIO TO ZERO          214761 01020000
                                                                        01030000
CHAP_DP  DS    0H                                                214761 01040000
         STC   R2,PCBPRTY         SAVE UPDATED PRIORITY          214761 01050000
                                                                        01060000
CHAP_RET DS    0H                                                       01070000
         LA    R15,RC00           ASSUME NORMAL COMPLETION              01080000
         B     RETURN             NORMAL COMPLETION                     01090000
                                                                        01100000
         EJECT ,                                                        01110000
****************************************************************        01120000
*                                                                       01130000
*  ERROR RETURN                                                         01140000
*                                                                       01150000
****************************************************************        01160000
                                                                        01170000
RETURN   DS    0H                                                       01180000
         #EXIT ,                  RETURN                                01190000
                                                                        01200000
         EJECT ,                                                        01210000
****************************************************************        01220000
*                                                                       01230000
*  CONSTANTS AND LITERALS                                               01240000
*                                                                       01250000
****************************************************************        01260000
                                                                        01270000
         LTORG ,                                                        01280000
                                                                        01290000
         PRINT NOGEN                                                    01300000
         ICVT  ,                                                        01310000
         ITASK ,                                                        01320000
         IPCB  ,                                                        01330000
                                                                        01340000
         PRINT GEN                                                      01350000
                                                                        01360000
         END   ,                                                        01370000
