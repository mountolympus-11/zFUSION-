ITBEP    TITLE 'TABLE SERVICES - REQUEST ROUTER'                        00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ITBEP - Table services, request router                       00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine serves as the entry point to all table                00080000
*    service facilities requested via the TB* macro series.             00090000
*    The function number is converted to a routine address              00100000
*    which is subsequently entered via BAKR linkage, the                00110000
*    address of a sharable workarea provided in R13.  Refer             00120000
*    to @ENTER for a discussion of the workarea chaining                00130000
*    technique used.                                                    00140000
*                                                                       00150000
*                                                                       00160000
* ON ENTRY:                                                             00170000
*                                                                       00180000
*    R1  points to a service-dependent OS/VS parameter list             00190000
*        residing in the primary address space.                         00200000
*                                                                       00210000
*    R0  contains the address of a workarea used by dataspace           00220000
*        service routines to acquire saveareas (non-ESA) and            00230000
*        other workareas.                                               00240000
*                                                                       00250000
*    R15 contains the service routine access code.                      00260000
*                                                                       00270000
*                                                                       00280000
* ON EXIT:                                                              00290000
*                                                                       00300000
*    R15 contains a service-dependent return code.  R0 and R1           00310000
*        may also contain related reason codes and/or control           00320000
*        block addresses useful for problem resolution.  The            00330000
*        following return codes have standard meanings across           00340000
*        all table services.                                            00350000
*                                                                       00360000
*        RC00 - normal completion. The requested function               00370000
*               completed without error                                 00380000
*                                                                       00390000
*        RC04 - request dependent                                       00400000
*                                                                       00410000
*        RC08 - request dependent                                       00420000
*                                                                       00430000
*        RC12 - improperly constructed or otherwise invalid             00440000
*               request                                                 00450000
*                                                                       00460000
*        RC16 - object management error encountered. Lower level        00470000
*               diagnostic available in R1.                             00480000
*                                                                       00490000
*               RSN04 - could not access the table locator              00500000
*               RSN08 - could not access the named index                00510000
*               RSN12 - could not access the base table object          00520000
*                                                                       00530000
*        RC20 - object space storage exhausted                          00540000
*                                                                       00550000
*        RCnn - request dependent                                       00560000
*                                                                       00570000
**<DOC-OFF>****************************************************         00580000
                                                                        00590000
         EJECT                                                          00600000
***************************************************************         00610000
*                                                                       00620000
* MAINTENANCE:                                                          00630000
*                                                                       00640000
*    05/xx/92 R. Turgeon                                                00650000
*             Initial version                                           00660000
*                                                                       00670000
***************************************************************         00680000
                                                                        00690000
         EJECT                                                          00700000
***************************************************************         00710000
*                                                                       00720000
*   Read / write working storage area                                   00730000
*                                                                       00740000
***************************************************************         00750000
                                                                        00760000
WORKAREA DSECT                                                          00770000
                                                                        00780000
         @WORK ,                                                        00790000
                                                                        00800000
TRACREGS DS    4F                                                       00810000
WORKLEN  EQU   *-WORKAREA                                               00820000
                                                                        00830000
         EJECT                                                          00840000
         TRACODES PRINT=NOGEN                                           00850000
                                                                        00860000
         EQUS  LINKAGE=VCON                                             00870000
                                                                        00880000
         EJECT                                                          00890000
ITBEP    @ENTER WORKA=(WORKAREA,WORKLEN),                              X00900000
               EPA=,              NO ENTRY POINT ADDR PROVIDED         X00910000
               ASC=,              ASC MODE REMAINS UNCHANGED           X00920000
               SERVICE_EPA=YES    INITIAL ENTRY TO TABLE SERVICE        00930000
                                                                        00940000
*--------------------------------------------------------------         00950000
*   Table services is an AMODE31 application                            00960000
*--------------------------------------------------------------         00970000
                                                                        00980000
         LA    R15,CONTINUE       BEGIN AMODE 31                        00990000
         O     R15,=X'80000000'                                         01000000
         BSM   0,R15                                                    01010000
                                                                        01020000
CONTINUE DS    0H                                                       01030000
                                                                        01040000
*--------------------------------------------------------------         01050000
*   Trace request                                                       01060000
*--------------------------------------------------------------         01070000
                                                                        01080000
         EREG  R14,R1             EXTRACT ENTRY REGS                    01090000
         STM   R14,R1,TRACREGS    SAVE FOR TRACE RECORD                 01100000
                                                                        01110000
         $TRACE *=A(TRC_TBSERV_IN),4*4,STDENV=NO                        01120000
                                                                        01130000
         BNZ   *+10               REQUEST FAILED                        01140000
         MVC   0(4*4,R1),TRACREGS INSERT REGS                           01150000
                                                                        01160000
*--------------------------------------------------------------         01170000
*   Invoke table services function                                      01180000
*--------------------------------------------------------------         01190000
                                                                        01200000
         EREG  R15,R1             RESTORE PARM REGS                     01210000
         BCTR  R15,0              ZERO RELATIVE FUNCTION CODE           01220000
         SLL   R15,2              PTR ARRAY INDEX                       01230000
         L     R15,FUNCDIR(R15)   FETCH EPA                             01240000
         BASR  R14,R15            INVOKE DESIGNATED SERVICE RTN         01250000
                                                                        01260000
*--------------------------------------------------------------         01270000
*   Trace results                                                       01280000
*--------------------------------------------------------------         01290000
                                                                        01300000
         STM   R15,R1,TRACREGS+4  SAVE FOR TRACE RECORD                 01310000
                                                                        01320000
         $TRACE *=A(TRC_TBSERV_OUT),4*4,STDENV=NO                       01330000
                                                                        01340000
         BNZ   *+10               REQUEST FAILED                        01350000
         MVC   0(4*4,R1),TRACREGS INSERT REGS                           01360000
                                                                        01370000
         LM    R14,R1,TRACREGS    RESTORE RETURN REGS                   01380000
                                                                        01390000
*--------------------------------------------------------------         01400000
*   Return completion status to caller                                  01410000
*--------------------------------------------------------------         01420000
                                                                        01430000
RET      DS    0H                                                       01440000
         @EXIT ,                                                        01450000
                                                                        01460000
         EJECT                                                          01470000
***************************************************************         01480000
*                                                                       01490000
*   Read only constants, etc.                                           01500000
*                                                                       01510000
***************************************************************         01520000
                                                                        01530000
FUNCDIR  DS    0A                                                       01540000
         DC    V(ITBADD)          01 ROW ADD                            01550000
         DC    V(ITBCLOSE)        02 TABLE CLOSE                        01560000
         DC    V(ITBCRE)          03 TABLE CREATE                       01570000
         DC    V(ITBDEL)          04 ROW DELETE                         01580000
         DC    V(ITBDROP)         05 TABLE DROP                         01590000
         DC    V(ITBGET)          06 ROW GET                            01600000
         DC    V(ITBOPEN)         07 TABLE OPEN                         01610000
         DC    V(ITBSETP)         08 TABLE ESTABLISH CRP                01620000
         DC    V(ITBEXIST)        09 ROW EXISTENCE TEST BY KEY          01630000
         DC    V(ITBMOD)          10 ROW MODIFY                         01640000
         DC    V(ITBDESC)         11 TABLE DESCRIBE                     01650000
         DC    V(ITBPSARG)        12 TABLE PREPARE SEARCH ARGUMENT      01660000
         DC    A(*-*)             13 TABLE COPY - RESERVED FOR ITBCOPY  01670000
         DC    V(ITBRENAM)        14 TABLE RENAME                       01680000
         DC    V(ITBCOLMN)        15 TABLE COLUMN INFO                  01690000
         DC    V(ITBSTATS)        16 TABLE STATISTICS                   01700000
         DC    V(ITBSAOPT)        17 SEARCH ARGUMENT / FILTER OPTIMIZER 01710000
         DC    A(0)               -- RESERVED                           01720000
                                                                        01730000
         LTORG ,                                                        01740000
         END   ,                                                        01750000
