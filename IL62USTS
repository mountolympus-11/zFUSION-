IL62USTS TITLE 'INTEGRATOR - IVUSER START NEW LU6.2 SESSION'            00010000
                                                                        00020000
         PRINT NOGEN                                                    00030000
         CMINCL ,                 INTEGRATOR CPI-C DEFINITIONS          00040000
         L62INCL ,                INTEGRATOR LU6.2 DEFINITIONS          00050000
         PRINT GEN                                                      00060000
                                                                        00070000
**<DOC-ON>************************************************************* 00080000
*                                                                       00090000
* ROUTINE: IL62USTS - IVUSER START NEW LU6.2 SESSION                    00100000
*                                                                       00110000
* DESCRIPTION:                                                          00120000
*                                                                       00130000
* ON ENTRY:                                                             00140000
*                                                                       00150000
*    R15 = ENTRY POINT ADDRESS                                          00160000
*    R14 = RETURN ADDRESS                                               00170000
*    R13 = AVAILABLE SAVE AREA                                          00180000
*    R11 = ICVT ADDRESS                                                 00190000
*    R10 = ITASK ADDRESS                                                00200000
*    R09 = IVTAMCVT ADDRESS                                             00210000
*    R08 = IVUSER ADDRESS                                               00220000
*    R01 = ADDRESS OF AQE                                               00230000
*                                                                       00240000
* ON EXIT:                                                              00250000
*                                                                       00260000
*    R15 = 0 --> SESSION INITIATION STARTED                             00270000
*        = 4 --> UNABLE TO INITIATE                                     00280000
*    R00 = 0                                                            00290000
*    R01 = 0                                                            00300000
*                                                                       00310000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00320000
*                                                                       00330000
**<DOC-OFF>************************************************************ 00340000
                                                                        00350000
         EJECT ,                                                        00360000
*********************************************************************** 00370000
*                                                                       00380000
* MAINTENANCE:                                                          00390000
*                                                                       00400000
*   07/01/94 RANDY WITEK - LU6.2 SUPPORT                                00410000
*                                                                       00420000
*********************************************************************** 00430000
                                                                        00440000
         EQUS  ,                  GENERAL EQUATES                       00450000
                                                                        00460000
RICVT    EQU   R11                                                      00470000
RITASK   EQU   R10                                                      00480000
RIVTAM   EQU   R9                                                       00490000
RIVUSER  EQU   R8                                                       00500000
RAQE     EQU   R7                                                       00510000
RMDE     EQU   R6                                                       00520000
                                                                        00530000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00540000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00550000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00560000
         USING IVUSER,RIVUSER     ESTABLISH ADDRESSABILITY              00570000
         USING AQE,RAQE           ESTABLISH ADDRESSABILITY              00580000
         USING MDE,RMDE           ESTABLISH ADDRESSABILITY              00590000
                                                                        00600000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00610000
WRK256   DS    XL256              GENERAL WORKAREA                      00620000
SUB0SAVE DS    18F                SUBROUTINE SAVE AREA                  00630000
$SESSMFL $SESS MF=L               PLIST CONSTRUCTION                    00640000
$TASKMFL $TASK MF=L               PLIST CONSTRUCTION                    00650000
L62MFL   L62POST MF=L             PLIST CONSTRUCTION                    00660000
L62RETCD DS    F                  LU6.2 RETURN CODE RETURN AREA         00670000
USERTOKN DS    XL8                SESSION INITIATION TOKEN              00680000
RETR15   DS    F                                                        00690000
RETR0    DS    F                                                        00700000
RETR1    DS    F                                                        00710000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      00720000
FLAG     DS    X                                                        00730000
WORKLEN  #ENDWORK                 END OF WORKAREA                       00740000
                                                                        00750000
         $MSGDFT PREFIX=ICTPID,                                        +00760000
               COMPID='L62',                                           +00770000
               TABLE=*#MSGS,                                           +00780000
               WORKA=0,                                                +00790000
               MF=(E,WRK256),                                          +00800000
               PRINT=NOGEN                                              00810000
                                                                        00820000
IL62USTS #ENTER BASE=R12,         ENTRY LINKAGE                        +00830000
               PREG=RAQE,                                              +00840000
               AMODE=31,                                               +00850000
               RMODE=ANY                                                00860000
                                                                        00870000
*---------------------------------------------------------------------- 00880000
* ACCESS THE MDE ASSOCIATED WITH THE REQUEST                            00890000
*---------------------------------------------------------------------- 00900000
                                                                        00910000
         L     RMDE,AQEMDE        SET MDE POINTER                       00920000
                                                                        00930000
*---------------------------------------------------------------------- 00940000
* SEE IF LIMITS ALLOW NEW SESSION TO BE INITIATED                       00950000
*---------------------------------------------------------------------- 00960000
                                                                        00970000
         L     R15,MDEASC         ACTIVE SESSION COUNT                  00980000
         A     R15,MDEPSC         + PENDING SESSION COUNT               00990000
         C     R15,MDESESSL       IS THERE STILL ROOM?                  01000000
         BNL   RETURN4            BRANCH IF NOT                         01010000
                                                                        01020000
         L     R14,MDESESSL       THE SESSION LIMIT                     01030000
         S     R14,MDEMINCL       - MINIMUM CONLOSER                    01040000
         L     R15,MDEACWC        ACTIVE CONWINNER COUNT                01050000
         A     R15,MDEPCWC        + PENDING CONWINNER COUNT             01060000
         CR    R14,R15            CAN WE FIRE UP A CONWINNER SESSION?   01070000
         BNH   CHKLOSER           BRANCH IF NOT                         01080000
         L     R15,MDEPSC         UPDATE PENDING SESSION COUNT          01090000
         LA    R15,1(,R15)        UPDATE PENDING SESSION COUNT          01100000
         ST    R15,MDEPSC         UPDATE PENDING SESSION COUNT          01110000
         L     R15,MDEPCWC        UPDATE PENDING CONWINNER COUNT        01120000
         LA    R15,1(,R15)        UPDATE PENDING CONWINNER COUNT        01130000
         ST    R15,MDEPCWC        UPDATE PENDING CONWINNER COUNT        01140000
         OI    AQEF1,AQEF1WIN     WE WILL START A CONWINNER SESSION     01150000
         B     LU62GO             AND ALLOW THE SESSION TO PROCEED      01160000
                                                                        01170000
CHKLOSER DS    0H                                                       01180000
                                                                        01190000
         L     R14,MDESESSL       THE SESSION LIMIT                     01200000
         S     R14,MDEMINCW       - MINIMUM CONWINNER                   01210000
         L     R15,MDEACLC        ACTIVE CONLOSER COUNT                 01220000
         A     R15,MDEPCLC        + PENDING CONLOSER COUNT              01230000
         CR    R14,R15            CAN WE FIRE UP A CONLOSER SESSION?    01240000
         BNH   RETURN4            BRANCH IF NOT                         01250000
         L     R15,MDEPSC         UPDATE PENDING SESSION COUNT          01260000
         LA    R15,1(,R15)        UPDATE PENDING SESSION COUNT          01270000
         ST    R15,MDEPSC         UPDATE PENDING SESSION COUNT          01280000
         L     R15,MDEPCLC        UPDATE PENDING CONWINNER COUNT        01290000
         LA    R15,1(,R15)        UPDATE PENDING CONWINNER COUNT        01300000
         ST    R15,MDEPCLC        UPDATE PENDING CONWINNER COUNT        01310000
         B     LU62GO             AND ALLOW THE SESSION TO PROCEED      01320000
                                                                        01330000
LU62GO   DS    0H                                                       01340000
                                                                        01350000
*---------------------------------------------------------------------- 01360000
* ALLOCATE AN XEPB                                                      01370000
*---------------------------------------------------------------------- 01380000
                                                                        01390000
         $TASK SETEPB,            INITIALIZE EPB FOR SYNCH REQUEST     +01400000
               RTN=END$SESS,      COMPLETION ROUTINE                   +01410000
               PARM=(RAQE),       COMPLETION ROUTINE PARAMETER         +01420000
               ECODE=EC$SREQ,     SESSION REQUEST COMPLETION EVENT     +01430000
               ERRET=ERR$TASK,                                         +01440000
               MF=(E,$TASKMFL)                                          01450000
                                                                        01460000
         LR    R3,R1              SAVE THE XEPB ADDRESS                 01470000
                                                                        01480000
*---------------------------------------------------------------------- 01490000
* ALLOCATE AN SPLIST FOR THE SESSION REQUEST FROM ITASK STORAGE         01500000
*---------------------------------------------------------------------- 01510000
                                                                        01520000
         $GETSTOR L'SPL,                                               +01530000
               LOC=ANY,                                                +01540000
               OWNER=(RITASK)                                           01550000
                                                                        01560000
         LR    R2,R1              SAVE THE SPLIST ADDRESS               01570000
         ST    R2,AQESPL          LINK AQE TO THIS REQUEST              01580000
         OI    AQEF1,AQEF1SRQ+AQEF1SRA SESS REQ ISSUED AND ACTIVE       01590000
                                                                        01600000
*---------------------------------------------------------------------- 01610000
* ISSUE SESSION REQUEST                                                 01620000
*---------------------------------------------------------------------- 01630000
                                                                        01640000
         LA    R4,=CL16'MAIN62'     POOL NAME                           01650000
                                                                        01660000
         MVC   USERTOKN(4),IVUTKUSR     SET USER PORTION OF TOKEN       01670000
         XC    USERTOKN+4(4),USERTOKN+4 ENSURE SESSION PORTION IS 0     01680000
                                                                        01690000
         TM    AQEF1,AQEF1WIN       ARE WE STARTING A WINNER?           01700000
         BO    STWIN                BRANCH YES                          01710000
         TM    IVUF1,IVUF1PSC       ARE WE PARALLEL?                    01720000
         BO    STLOSPAR             BRANCH IF YES                       01730000
                                                                        01740000
         $SESS $SESS_START_SESSION, START A NEW SESSION                +01750000
               SESSION=USERTOKN,    ON THIS IVUSER                     +01760000
               LUNAME=AQEPLU,       PARTNER LU AS REQUESTED            +01770000
               LOGMODE=AQEMODE,     LOGMODE AS REQUESTED               +01780000
               POOL=(R4),           FORCE MAIN LU6.2 ACB ************  +01790000
               PARSESS=NO,          PARALLEL SESSIONS NOT USED         +01800000
               PLU=YES,             WE WILL BE PLU                     +01810000
               FSPKR=NO,            WE WILL NOT BE FIRST SPEAKER       +01820000
               EPB=(R3),            WE WANT POSTING OF REQUEST         +01830000
               MF=(E,(R2))                                              01840000
                                                                        01850000
         B     RETURN                                                   01860000
                                                                        01870000
STLOSPAR DS    0H                                                       01880000
                                                                        01890000
         $SESS $SESS_START_SESSION, START A NEW SESSION                +01900000
               SESSION=USERTOKN,    ON THIS IVUSER                     +01910000
               LUNAME=AQEPLU,       PARTNER LU AS REQUESTED            +01920000
               LOGMODE=AQEMODE,     LOGMODE AS REQUESTED               +01930000
               POOL=(R4),           FORCE MAIN LU6.2 ACB ************  +01940000
               PARSESS=YES,         PARALLEL SESSIONS ARE OK           +01950000
               PLU=YES,             WE WILL BE PLU                     +01960000
               FSPKR=NO,            WE WILL NOT BE FIRST SPEAKER       +01970000
               EPB=(R3),            WE WANT POSTING OF REQUEST         +01980000
               MF=(E,(R2))                                              01990000
                                                                        02000000
         B     RETURN                                                   02010000
                                                                        02020000
STWIN    DS    0H                                                       02030000
                                                                        02040000
         TM    IVUF1,IVUF1PSC       ARE WE PARALLEL?                    02050000
         BO    STWINPAR             BRANCH IF YES                       02060000
                                                                        02070000
         $SESS $SESS_START_SESSION, START A NEW SESSION                +02080000
               SESSION=USERTOKN,    ON THIS IVUSER                     +02090000
               LUNAME=AQEPLU,       PARTNER LU AS REQUESTED            +02100000
               LOGMODE=AQEMODE,     LOGMODE AS REQUESTED               +02110000
               POOL=(R4),           FORCE MAIN LU6.2 ACB ************  +02120000
               PARSESS=NO,          PARALLEL SESSIONS ARE NOT USED     +02130000
               PLU=YES,             WE WILL BE PLU                     +02140000
               FSPKR=YES,           WE WILL BE FIRST SPEAKER           +02150000
               EPB=(R3),            WE WANT POSTING OF REQUEST         +02160000
               MF=(E,(R2))                                              02170000
                                                                        02180000
         B     RETURN                                                   02190000
                                                                        02200000
STWINPAR DS    0H                                                       02210000
                                                                        02220000
         $SESS $SESS_START_SESSION, START A NEW SESSION                +02230000
               SESSION=USERTOKN,    ON THIS IVUSER                     +02240000
               LUNAME=AQEPLU,       PARTNER LU AS REQUESTED            +02250000
               LOGMODE=AQEMODE,     LOGMODE AS REQUESTED               +02260000
               POOL=(R4),           FORCE MAIN LU6.2 ACB ************  +02270000
               PARSESS=YES,         PARALLEL SESSIONS ARE OK           +02280000
               PLU=YES,             WE WILL BE PLU                     +02290000
               FSPKR=YES,           WE WILL BE FIRST SPEAKER           +02300000
               EPB=(R3),            WE WANT POSTING OF REQUEST         +02310000
               MF=(E,(R2))                                              02320000
                                                                        02330000
         B     RETURN                                                   02340000
                                                                        02350000
*---------------------------------------------------------------------- 02360000
* RETURN TO IVUSER MAINLINE                                             02370000
*---------------------------------------------------------------------- 02380000
                                                                        02390000
RETURN4  DS    0H                                                       02400000
                                                                        02410000
         MVI   RETR15+(L'RETR15-1),4                                    02420000
                                                                        02430000
RETURN   DS    0H                                                       02440000
                                                                        02450000
         LM    R15,R1,RETREGS     LOAD RETURN REGISTERS                 02460000
                                                                        02470000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    02480000
                                                                        02490000
*---------------------------------------------------------------------- 02500000
* THIS IS THE ASYNC EPB ROUTINE FOR THE $SESS SESSION REQUEST           02510000
*                                                                       02520000
* ON ENTRY:                                                             02530000
*                                                                       02540000
*    R15 = ENTRY POINT ADDRESS                                          02550000
*    R14 = ?                                                            02560000
*    R13 = ?                                                            02570000
*    R11 = ICVT ADDRESS                                                 02580000
*    R10 = ITASK ADDRESS                                                02590000
*    R01 = AQE ADDRESS (SETEPB PARM)                                    02600000
*---------------------------------------------------------------------- 02610000
END$SESS DS    0H                                                       02620000
                                                                        02630000
         DROP  R12                                                      02640000
         USING *,R15                                                    02650000
         L     R12,=A(IL62USTS)                                         02660000
         DROP  R15                                                      02670000
         USING IL62USTS,R12       ESTABLISH ADDRESSABILITY              02680000
         LR    RAQE,R1            AQE ADDRESS                           02690000
                                                                        02700000
         $GETSTOR WORKLEN,QHDR=0                                        02710000
*        STORAGE OBTAIN,LENGTH=WORKLEN                                  02720000
                                                                        02730000
         LR    R3,R1              SAVE AREA ADDRESS                     02740000
         LR    R0,R1              ADDR OF STG TO CLEAR                  02750000
         LA    R1,WORKLEN         LENGTH OF WORKAREA                    02760000
         SR    R15,R15            PREPARE FOR CLEAR                     02770000
         MVCL  R0,R14             CLEAR WORKAREA                        02780000
                                                                        02790000
         LR    R13,R3             SAVEAREA ADDRESS                      02800000
         USING WORKAREA,R13       ADDRESSABILITY                        02810000
                                                                        02820000
         L     RMDE,AQEMDE        ASSOCIATED MDE                        02830000
         L     RIVUSER,MDEPLB     ASSOCIATED IVUSER/PLB                 02840000
         L     RIVTAM,ICTVTCVT    VTAM CVT                              02850000
                                                                        02860000
*---------------------------------------------------------------------- 02870000
* VALIDATE ENVIRONMENT                                                  02880000
*---------------------------------------------------------------------- 02890000
                                                                        02900000
         CLC   AQEID,=CL8'AQE'    GOT AN AQE?                           02910000
         BNE   ERR$SESS           BRANCH IF NOT                         02920000
         CLC   MDEID,=CL8'MDE'    GOT AN MDE?                           02930000
         BNE   ERR$SESS           BRANCH IF NOT                         02940000
         CLC   IVUID,=CL8'IVUSER' GOT AN IVUSER/PLB?                    02950000
         BNE   ERR$SESS           BRANCH IF NOT                         02960000
                                                                        02970000
*---------------------------------------------------------------------- 02980000
* LOCATED COMPLETED SPL                                                 02990000
*---------------------------------------------------------------------- 03000000
                                                                        03010000
         TM    AQEF1,AQEF1SRA     WAS A REQUEST ACTIVE                  03020000
         BNO   ERR$SESS           BRANCH IF NOT                         03030000
         NI    AQEF1,255-AQEF1SRA CLEAR THE ACTIVE INDICATION           03040000
         ICM   R2,15,AQESPL       GOT AN SPL?                           03050000
         BNP   ERR$SESS           BRANCH IF NOT                         03060000
         XC    AQESPL,AQESPL      CLEAR THE POINTER                     03070000
                                                                        03080000
*---------------------------------------------------------------------- 03090000
* SAVE THE $SESS RET/RSN AND POSSIBLE SESSION TOKEN                     03100000
*---------------------------------------------------------------------- 03110000
                                                                        03120000
X        USING SPLIST,R2                                                03130000
         MVC   AQE$SRET,X.SPLRETCD  RETCD                               03140000
         MVC   AQE$SRSN,X.SPLRSNCD  RSNCD                               03150000
         MVC   AQE$STKN,X.SPLTOKEN  POSSIBLE NEW SESSION TOKEN          03160000
         DROP  X                                                        03170000
                                                                        03180000
*---------------------------------------------------------------------- 03190000
* RELEASE THE SPLIST STORAGE                                            03200000
*---------------------------------------------------------------------- 03210000
                                                                        03220000
         $RETSTOR (R2),                                                +03230000
               OWNER=(RITASK)                                           03240000
                                                                        03250000
*---------------------------------------------------------------------- 03260000
* QUEUE SESS REQ COMPLETION TO RUN SYNCHRONOUSLY                        03270000
*---------------------------------------------------------------------- 03280000
                                                                        03290000
         $VTAMWE L'IWEXS,         LENGTH                               +03300000
               IWECSREQ           CODE                                  03310000
                                                                        03320000
X        USING IWEVTAM,R1                                               03330000
         ST    RAQE,X.IWEXSAQE    PASS THE AQE ADDRESS                  03340000
         DROP  X                                                        03350000
                                                                        03360000
         LA    R0,IVUWEQ          QUEUE ADDRESS                         03370000
         BAS   R14,QWE            QUEUE THE WORK ELEMENT                03380000
         LTR   R15,R15            SUCCESSFUL QUEUEING?                  03390000
         BZ    RETASY             BRANCH IF YES                         03400000
         TM    IVUF1,IVUF1TRM     IS TERMINATION STARTED?               03410000
         BNO   ERRHALT            BRANCH IF NOT                         03420000
         ICM   R0,15,IVUWEQ       QUEUEING FAIL BECAUSE Q IS ENDED?     03430000
         BZ    ERRPOST            BRANCH IF YES                         03440000
                                                                        03450000
ERRHALT  DS    0H                                                       03460000
                                                                        03470000
         EX    0,*                HALT HERE                             03480000
                                                                        03490000
*---------------------------------------------------------------------- 03500000
* POST THE REQUESTOR                                                    03510000
*---------------------------------------------------------------------- 03520000
                                                                        03530000
ERRPOST  DS    0H                                                       03540000
                                                                        03550000
         LA    R14,MDEWR1ST       ADDRESS OF WAITING REQUEST HEAD       03560000
         S     R14,=A(AQENEXT-AQE) NORMALIZE FOR CHAIN RUN              03570000
                                                                        03580000
AQERUN   DS    0H                                                       03590000
                                                                        03600000
         ICM   R14,15,AQENEXT-AQE(R14) NEXT AQE IN LIST                 03610000
         BM    ERR$SESS                ERROR IF GIVEN AQE NOT IN LIST   03620000
         CR    R14,RAQE                IS THIS THE ONE?                 03630000
         BNE   AQERUN                  BRANCH IF NOT                    03640000
         LM    R14,R15,AQENEXT         R14=NEXT AQE R15=PREVIOUS AQE    03650000
         ST    R15,AQEPREV-AQE(,R14)   POINT NEXT AQE AT THE PREVIOUS   03660000
         ST    R14,AQENEXT-AQE(,R15)   POINT PREVIOUS AQE AT THE NEXT   03670000
                                                                        03680000
         LA    R0,4               SET ERROR POST CODE                   03690000
         BAS   R14,POSTREQ        POST THE REQUEST                      03700000
         BAS   R14,FREEAQE        RELEASE THE QUEUE ELEMENT             03710000
         B     RETASY                                                   03720000
                                                                        03730000
*---------------------------------------------------------------------- 03740000
* RETURN FROM ASYNC EPB ROUTINE.                                        03750000
*---------------------------------------------------------------------- 03760000
                                                                        03770000
RETASY   DS    0H                                                       03780000
                                                                        03790000
         LR    R1,R13             SAVE AREA ADDRESS                     03800000
         LA    R13,TSKDSPSA       USE DISPATCHER SAVEAREA               03810000
                                                                        03820000
         $RETSTOR (R1),QHDR=0                                           03830000
*        STORAGE RELEASE,LENGTH=WORKLEN,ADDR=(R1)                       03840000
                                                                        03850000
         $TASK CALLDSP,           ENTER DISPATCHER                     +03860000
               WORKA=*TSK@WRKA,                                        +03870000
               MF=(E,TSKT_MFL)                                          03880000
                                                                        03890000
*---------------------------------------------------------------------- 03900000
* SUBROUTINE QWE - QUEUE A WORK ELEMENT TO A GIVEN WORK QUEUE           03910000
*                                                                       03920000
* ENTRY            R14 = RETURN ADDRESS                                 03930000
*                  R1  = WORK ELEMENT ADDRESS                           03940000
*                  R0  = QUEUE ADDRESS                                  03950000
*                                                                       03960000
* RETURNS          R15 = 0 --> QUEUEING WAS SUCCESSFUL                  03970000
*                      = 4 --> QUEUEING FAILED, WORK ELEMENT RELEASED   03980000
*---------------------------------------------------------------------- 03990000
                                                                        04000000
QWE      DS    0H                                                       04010000
                                                                        04020000
         STM   R14,R4,SUB0SAVE    SAVE REGISTERS                        04030000
         LR    R3,R0              SAVE QUEUE ADDRESS                    04040000
         LR    R4,R1              SAVE WORK ELEMENT ADDRESS             04050000
                                                                        04060000
         $VTAMQ (R4),             WORK ELEMENT                         +04070000
               (R3)               QUEUE                                 04080000
                                                                        04090000
         L     R14,SUB0SAVE       RESTORE REGISTERS                     04100000
         LM    R0,R4,SUB0SAVE+8   RESTORE REGISTERS                     04110000
         BR    R14                AND RETURN TO CALLER W/R15            04120000
                                                                        04130000
*---------------------------------------------------------------------- 04140000
*   SUBROUTINE: FREE THE AQE                                            04150000
*---------------------------------------------------------------------- 04160000
                                                                        04170000
FREEAQE  DS    0H                                                       04180000
                                                                        04190000
         STM   R14,R2,SUB0SAVE      SAVE CALLER'S REGISTERS             04200000
                                                                        04210000
         $RETSTOR (RAQE),                                              +04220000
               OWNER=(RITASK)                                           04230000
                                                                        04240000
         LM    R14,R2,SUB0SAVE      RESTORE CALLER'S REGISTERS          04250000
         BR    R14                  RETURN                              04260000
                                                                        04270000
*---------------------------------------------------------------------- 04280000
*   SUBROUTINE: POST THE REQUEST (R0 CONTAINS POSTCODE)                 04290000
*---------------------------------------------------------------------- 04300000
                                                                        04310000
POSTREQ  DS    0H                                                       04320000
                                                                        04330000
         STM   R14,R2,SUB0SAVE    SAVE CALLER'S REGISTERS               04340000
                                                                        04350000
         L62POST *AQEEPB,         ADDRESS OF EPB TO BE POSTED          +04360000
               SUB0SAVE+8,        ADDRESS OF POST CODE                 +04370000
               AQEENT,            ADDRESS OF ENTITY TOKEN              +04380000
               L62RETCD,          RETURN CODE AREA                     +04390000
               MF=(E,L62MFL)                                            04400000
                                                                        04410000
         LM    R14,R2,SUB0SAVE    RESTORE CALLER'S REGISTERS            04420000
         BR    R14                RETURN                                04430000
                                                                        04440000
*---------------------------------------------------------------------- 04450000
* ERROR ROUTINES                                                        04460000
*---------------------------------------------------------------------- 04470000
                                                                        04480000
ERR$SESS DS    0H                                                       04490000
                                                                        04500000
         $ABEND ABE_VTDIAG,                                            +04510000
               SCOPE=PCB,                                              +04520000
               TITLE='$SESS COMPLETION ENVIRONMENT FAILURE'             04530000
                                                                        04540000
ERR$TASK DS    0H                                                       04550000
                                                                        04560000
         $ABEND ABE_VTDIAG,                                            +04570000
               SCOPE=PCB,                                              +04580000
               TITLE='$TASK FAILURE'                                    04590000
                                                                        04600000
*---------------------------------------------------------------------- 04610000
*  CONSTANTS AND LITERALS                                               04620000
*---------------------------------------------------------------------- 04630000
                                                                        04640000
         LTORG ,                                                        04650000
         PRINT NOGEN                                                    04660000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                04670000
         ISTDBIND ,               VTAM BIND IMAGE                       04680000
         TRACODES ,               INTEGRATOR TRACE CODES                04690000
         ICVT  ,                  INTEGRATOR CVT                        04700000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   04710000
         IRPL ,                   INTEGRATOR VTAM RPL+                  04720000
         IACB ,                   INTEGRATOR VTAM ACB+                  04730000
         INIB ,                   INTEGRATOR VTAM NIB+                  04740000
         ISESS ,                  INTEGRATOR SESSION BLOCK              04750000
         IRQE ,                   INTEGRATOR RECEIVE QUEUE ELEMENT      04760000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            04770000
         ITASK ,                  INTEGRATOR TASK BLOCK                 04780000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          04790000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       04800000
         EVCODES ,                INTEGRATOR EVENT CODES                04810000
         ABCODES ,                INTEGRATOR $ABEND CODES               04820000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     04830000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        04840000
         $SESS DSECT=YES          INTEGRATOR $SESS SERVICES             04850000
         $TASK DSECT=YES          INTEGRATOR $TASK SERVICES             04860000
         IFGEXLST ,               VTAM EXIT LIST                        04870000
         END   ,                                                        04880000
