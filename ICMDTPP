ICMDTPP  TITLE 'INTEGRATOR - TPPOOLS COMMAND PROCESSOR'                 00010000
                                                                        00020000
**<DOC-ON>************************************************************* 00030000
*                                                                       00040000
*     ROUTINE: ICMDTPP - INTEGRATOR TPPOOLS COMMAND PROCESSOR           00050000
*                                                                       00060000
* DESCRIPTION: THIS ROUTINE PROCESSES THE VARIOUS FORMS OF THE TPPOOLS  00070000
*              COMMAND WHICH IS USED TO DISPLAY INFORMATION ABOUT       00080000
*              THE INTEGRATOR VIRTUAL TERMINAL POOLS.                   00090000
*                                                                       00100000
*      SYNTAX: TPP(OOLS) <POOL(...)>  <ACBS> <SESS> <MAIN>              00110000
*                                                                       00120000
* ON ENTRY:                                                             00130000
*                                                                       00140000
*    R15 = ENTRY POINT ADDRESS                                          00150000
*    R14 = RETURN      ADDRESS                                          00160000
*    R13 = SAVE AREA   ADDRESS                                          00170000
*    R11 = ICVT        ADDRESS                                          00180000
*    R10 = ITASK       ADDRESS                                          00190000
*    R01 = CMDEQ       ADDRESS                                          00200000
*                                                                       00210000
* ON EXIT:                                                              00220000
*                                                                       00230000
*    R15 = 0                                                            00240000
*    R00 = 0                                                            00250000
*    R01 = 0                                                            00260000
*                                                                       00270000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00280000
*                                                                       00290000
**<DOC-OFF>************************************************************ 00300000
                                                                        00310000
*********************************************************************** 00320000
*                                                                       00330000
* MAINTENANCE:                                                          00340000
*                                                                       00350000
*   10/01/93 RANDY WITEK                                                00360000
*   01/23/96 RANDY WITEK - ALLOW STARTUP WITHOUT MAIN ACB               00370000
*                                                                       00380000
*********************************************************************** 00390000
                                                                        00400000
         EQUS  ,                  GENERAL EQUATES                       00410000
                                                                        00420000
RICVT    EQU   R11                                                      00430000
RITASK   EQU   R10                                                      00440000
RIVTAM   EQU   R9                                                       00450000
RCMDREQ  EQU   R8                                                       00460000
RCCSUMRY EQU   R7                                                       00470000
RIPOOL   EQU   R6                                                       00480000
RIACB    EQU   R5                                                       00490000
RISESS   EQU   R4                                                       00500000
                                                                        00510000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00520000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00530000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00540000
         USING CMDREQ,RCMDREQ     ESTABLISH ADDRESSABILITY              00550000
         USING CCSUMRY,RCCSUMRY   ESTABLISH ADDRESSIBILITY              00560000
         USING IPOOL,RIPOOL       ESTABLISH ADDRESSIBILITY              00570000
         USING IACB,RIACB         ESTABLISH ADDRESSIBILITY              00580000
         USING ISESS,RISESS       ESTABLISH ADDRESSIBILITY              00590000
                                                                        00600000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00610000
WRK256   DS    XL256              GENERAL WORKAREA                      00620000
SUB0SAVE DS    18F                SUBROUTINE SAVE AREA                  00630000
RETR15   DS    F                                                        00640000
RETR0    DS    F                                                        00650000
RETR1    DS    F                                                        00660000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      00670000
POOLCNT  DS    F                  NUMBER OF IPOOLS IN SYSTEM            00680000
POOLNAME DS    CL16               SPECIFIC POOL NAME REQUESTED          00690000
OPENNOTE DS    CL8                "OPEN" / "NOT OPEN" ... MESSAGE TEXT  00700000
SKIPNOTE DS    CL4                "SKIP" MESSAGE TEXT                   00710000
USAGE    DS    CL8                "EXCL" / "MULTI" / "PASS"   TEXT      00720000
TASKNAME DS    CL8                ISESS TASK NAME                       00730000
PROCNAME DS    CL8                ISESS PROC NAME                       00740000
FLAGS    DS    X                                                        00750000
FLAGLOCK EQU   X'80'              VTAM GLOBAL LOCK HELD                 00760000
FLAGLCKD EQU   X'40'              VTAM GLOBAL LOCK HELD ON ENTRY        00770000
FLAGACBS EQU   X'20'              ACB DISPLAY REQUESTED                 00780000
FLAGSESS EQU   X'10'              SESSION DISPLAY REQUESTED             00790000
FLAGPOOL EQU   X'08'              SPECIFIC POOL REQUESTED               00800000
FLAGFIND EQU   X'04'              SPECIFIC POOL WAS FOUND               00810000
FLAGMAIN EQU   X'02'              MAIN ACB INFORMATION REQUESTED        00820000
WORKLEN  #ENDWORK                 END OF WORKAREA                       00830000
                                                                        00840000
         $MSGDFT PREFIX=ICTPID,                                        +00850000
               COMPID='CMD',                                           +00860000
               TABLE=*#MSGS,                                           +00870000
               WORKA=0,                                                +00880000
               CONID=*CMRQCNID,CONNAME=CMRQCNAM,CART=CMRQCART,         +00890000
               DESTADD=*CMRQDMSK,                                      X00900000
               MSGQA=*CMRQMQA,STGQH=*CMRQSTGQ,                         +00910000
               MF=(E,WRK256),                                          +00920000
               PRINT=NOGEN                                              00930000
                                                                        00940000
ICMDTPP  #ENTER BASE=R12,                                              +00950000
               PREG=(RCMDREQ),     R1 --> RCMDREQ                      +00960000
               AMODE=31,                                               +00970000
               RMODE=ANY                                                00980000
                                                                        00990000
*--------------------------------------------------------------         01000000
* INITIALIZATION                                                        01010000
*--------------------------------------------------------------         01020000
                                                                        01030000
         L     RIVTAM,ICTVTCVT      VTAM CVT                            01040000
         ICM   RCCSUMRY,15,CMRQSMRY ASSOC COMMAND SUMMARY               01050000
         BZ    PARSDONE             AMBIGUOUS REQUEST                   01060000
         ICM   R0,15,CMRQSMR#       TOTAL NUMBER OF OPERAND ENTRIES     01070000
         BZ    PARSDONE             AMBIGUOUS REQUEST IF ZERO           01080000
                                                                        01090000
*---------------------------------------------------------------------- 01100000
* IDENTIFY AND VALIDATE THE KEYWORDS AND VALUES THAT WERE SPECIFIED     01110000
*---------------------------------------------------------------------- 01120000
                                                                        01130000
PARSENXT DS    0H                                                       01140000
                                                                        01150000
         CLC   CCSID,=AL2(TPPOOLS_ACBS)                                 01160000
         BE    PARSACBS                 BRANCH IF ACBS KEYWORD          01170000
                                                                        01180000
         CLC   CCSID,=AL2(TPPOOLS_SESS)                                 01190000
         BE    PARSSESS                 BRANCH IF SESS KEYWORD          01200000
                                                                        01210000
         CLC   CCSID,=AL2(TPPOOLS_MAIN)                                 01220000
         BE    PARSMAIN                 BRANCH IF MAIN KEYWORD          01230000
                                                                        01240000
         CLC   CCSID,=AL2(TPPOOLS_POOL)                                 01250000
         BE    PARSPOOL                 BRANCH IF POOL(AAA...) KEYWORD  01260000
                                                                        01270000
         B     ERREJECT                 REJECT OTHERWISE                01280000
                                                                        01290000
*                                                                       01300000
* ACBS KEYWORD WAS SPECIFIED                                            01310000
*---------------------------------------------------------------------- 01320000
                                                                        01330000
PARSACBS DS    0H                                                       01340000
                                                                        01350000
         OI    FLAGS,FLAGACBS     ACB DETAIL REQUESTED                  01360000
         B     PARSBUMP           ADVANCE TO NEXT OPERAND               01370000
                                                                        01380000
*                                                                       01390000
* SESS KEYWORD WAS SPECIFIED                                            01400000
*---------------------------------------------------------------------- 01410000
                                                                        01420000
PARSSESS DS    0H                                                       01430000
                                                                        01440000
         OI    FLAGS,FLAGSESS     SESS DETAIL REQUESTED                 01450000
         OI    FLAGS,FLAGACBS     SESS DETAIL REQUIRES ACB DETAIL       01460000
         B     PARSBUMP           ADVANCE TO NEXT OPERAND               01470000
                                                                        01480000
*                                                                       01490000
* MAIN KEYWORD WAS SPECIFIED                                            01500000
*---------------------------------------------------------------------- 01510000
                                                                        01520000
PARSMAIN DS    0H                                                       01530000
                                                                        01540000
         OI    FLAGS,FLAGMAIN     MAIN INFORMATION REQUESTED            01550000
         B     PARSBUMP           ADVANCE TO NEXT OPERAND               01560000
                                                                        01570000
*                                                                       01580000
* POOL(AAA...) KEYWORD WAS SPECIFIED                                    01590000
*---------------------------------------------------------------------- 01600000
                                                                        01610000
PARSPOOL DS    0H                                                       01620000
                                                                        01630000
         OC    POOLNAME,POOLNAME   WAS POOL(AAA...) ALREADY SPECIFIED?  01640000
         BNZ   ERRCNFLC            BRANCH IF YES                        01650000
         CLC   CCSVALCT,=H'1'      SINGLE VALUE SPECIFIED?              01660000
         BNE   ERRSYNTX            BRANCH IF NOT                        01670000
         LH    R15,CCSVLEN         LENGTH OF SPECIFIED POOL NAME        01680000
         LTR   R15,R15             IS THE LENGTH OK?                    01690000
         BNP   ERRSYNTX            BRANCH IF NOT                        01700000
         CH    R15,=AL2(L'IPONAME) IS THE LENGTH OK?                    01710000
         BH    ERRSYNTX            BRANCH IF NOT                        01720000
         L     R14,CCSVDISP        OFFSET TO POOLNAME IN CMD LINE       01730000
         A     R14,CMRQOPST        CONVERT OFFSET TO ADDRESS            01740000
         LA    R2,POOLNAME         MVCL COPY-TO ADDRESS                 01750000
         LA    R3,L'IPONAME        MVCL COPY-TO LENGTH                  01760000
         ICM   R15,8,=C' '         MVCL PAD BYTE                        01770000
         MVCL  R2,R14              COPY POOL NAME                       01780000
         OI    FLAGS,FLAGPOOL      SPECIFIC POOL NAME PROVIDED          01790000
         B     PARSBUMP            CONTINUE ON WITH THE PARSE           01800000
                                                                        01810000
*                                                                       01820000
* ADVANCE THE SCAN TO THE NEXT KEYWORD ENTRY IN THE SUMMARY             01830000
*---------------------------------------------------------------------- 01840000
                                                                        01850000
PARSBUMP DS    0H                                                       01860000
                                                                        01870000
         LA    R15,CCSVSLN                    LENGTH OF VALUE ENTRY     01880000
         MH    R15,CCSVALCT                   TIMES NUMBER OF ENTRIES   01890000
         LA    RCCSUMRY,CCSPFXL(R15,RCCSUMRY) ADDRESS OF NEXT KEYWORD   01900000
         BCT   R0,PARSENXT                    BRANCH IF MORE KEYWORDS   01910000
                                                                        01920000
PARSDONE DS    0H                                                       01930000
                                                                        01940000
*---------------------------------------------------------------------- 01950000
* COMMAND WAS VALIDATED.  GENERATE THE COMMAND OUTPUT                   01960000
*---------------------------------------------------------------------- 01970000
                                                                        01980000
         BAS   R14,VTAMLOCK                  ACQUIRE VTAM LOCK          01990000
                                                                        02000000
         $MSG  331                           INTRO MSG                  02010000
                                                                        02020000
*                                                                       02030000
* DISPLAY MAIN ACB INFORMATION IF REQUESTED BY "MAIN"                   02040000
*---------------------------------------------------------------------- 02050000
                                                                        02060000
         TM    FLAGS,FLAGMAIN     MAIN ACB INFORMATION REQUESTED?       02070000
         BNO   MSGOSTRP           BRANCH IF NOT                         02080000
                                                                        02090000
         $MSG  337,FIELDS=(ICTAPLID)                                    02100000
                                                                        02110000
         TM    FLAGS,FLAGACBS     ACB DETAIL REQUESTED?                 02120000
         BNO   MSGLU62            BRANCH IF NOT                         02130000
         L     RIACB,IVTACB       ADDRESS OF MAIN ACB                   02140000
         BAS   R14,DISPIACB       PERFORM A DISPLAY                     02150000
                                                                        02160000
MSGLU62  DS    0H                                                       02170000
                                                                        02180000
         CLI   ICTAPL62,C' '      IS A MAIN LU6.2 ACB PRESENT?          02190000
         BNH   MSGOSTRP           BRANCH IF NOT                         02200000
                                                                        02210000
         $MSG  338,FIELDS=(ICTAPL62)                                    02220000
                                                                        02230000
         TM    FLAGS,FLAGACBS     ACB DETAIL REQUESTED?                 02240000
         BNO   MSGOSTRP           BRANCH IF NOT                         02250000
         L     RIACB,IVTACB62     ADDRESS OF MAIN ACB FOR LU6.2         02260000
         BAS   R14,DISPIACB       PERFORM A DISPLAY                     02270000
                                                                        02280000
MSGOSTRP DS    0H                                                       02290000
                                                                        02300000
*                                                                       02310000
* LOCATE THE NEXT IPOOL TO BE DISPLAYED                                 02320000
*---------------------------------------------------------------------- 02330000
                                                                        02340000
         LA    RIPOOL,IVTIP1ST-(IPONEXT-IPO) NORMALIZED HEADER ADDRESS  02350000
                                                                        02360000
MSGONXTP DS    0H                                                       02370000
                                                                        02380000
         ICM   RIPOOL,15,IPONEXT  ADDRESS OF NEXT IPOOL BLOCK           02390000
         BM    MSGOSUMM           END OF POOLS, DO SUMMARY LINE         02400000
         L     R1,POOLCNT         NUMBER OF IPOOLS                      02410000
         A     R1,=F'1'           BUMP BY ONE                           02420000
         ST    R1,POOLCNT         SAVE UPDATED COUNT                    02430000
         TM    FLAGS,FLAGPOOL     SPECIFIC POOL REQUESTED?              02440000
         BNO   MSGODISP           BRANCH IF NOT                         02450000
         CLC   IPONAME(L'IPONAME),POOLNAME                              02460000
         BNE   MSGONXTP           BRANCH IF THIS IS NOT THE ONE         02470000
         OI    FLAGS,FLAGFIND     SHOW THAT IT WAS FOUND                02480000
                                                                        02490000
MSGODISP DS    0H                                                       02500000
                                                                        02510000
         $MSG  333,FIELDS=(IPONAME,                                    +02520000
               IPOFLAGS,                                               +02530000
               IPO#ACB)                                                 02540000
                                                                        02550000
*                                                                       02560000
* DISPLAY A DETAIL LINE FOR EACH ACB IN THE POOL                        02570000
*--------------------------------------------------------------         02580000
                                                                        02590000
         TM    FLAGS,FLAGACBS         ACB DETAIL REQUESTED?             02600000
         BNO   MSGONXTP               BRANCH IF NOT                     02610000
         LA    RIACB,IPOIA1ST         NORMALIZED HEADER ADDRESS         02620000
         S     RIACB,=A(IACIANXT-IAC) NORMALIZED HEADER ADDRESS         02630000
                                                                        02640000
MSGONXTA DS    0H                                                       02650000
                                                                        02660000
         ICM   RIACB,15,IACIANXT      NEXT IACB IN THE POOL             02670000
         BM    MSGONXTP               BRANCH WHEN ACBS EXHAUSTED        02680000
         BAS   R14,DISPIACB           DISPLAY THE IACB (& ISESS'S)      02690000
         B     MSGONXTA               GO GET THE NEXT IACB              02700000
                                                                        02710000
*                                                                       02720000
* GENERATE THE FINAL SUMMARY LINE                                       02730000
*---------------------------------------------------------------------- 02740000
                                                                        02750000
MSGOSUMM DS    0H                                                       02760000
                                                                        02770000
         TM    FLAGS,FLAGPOOL     SPECIFIC POOL REQUESTED?              02780000
         BNO   MSGOLAST           BRANCH IF NOT                         02790000
         TM    FLAGS,FLAGFIND     WAS IT FOUND?                         02800000
         BO    MSGOLAST           BRANCH IF YES                         02810000
                                                                        02820000
         $MSG  332,FIELDS=(POOLNAME)  "POOL ... NOT FOUND"              02830000
                                                                        02840000
MSGOLAST DS    0H                                                       02850000
                                                                        02860000
         $MSG  336,FIELDS=(POOLCNT)                                     02870000
                                                                        02880000
         B     RETURN             DONE                                  02890000
                                                                        02900000
*---------------------------------------------------------------------- 02910000
* EXCEPTION ROUTINES                                                    02920000
*---------------------------------------------------------------------- 02930000
                                                                        02940000
ERRSYNTX DS    0H                                                       02950000
         MVC   RETR15,=A(CCODE_SYNTAX)   SYNTAX ERROR                   02960000
         B     RETURN                                                   02970000
                                                                        02980000
ERRCNFLC DS    0H                                                       02990000
         MVC   RETR15,=A(CCODE_CONFLICT) CONFLICTING OPERANDS           03000000
         B     RETURN                                                   03010000
                                                                        03020000
ERREJECT DS    0H                                                       03030000
         MVC   RETR15,=A(CCODE_REJECT)   COMMAND REJECTED               03040000
         B     RETURN                                                   03050000
                                                                        03060000
*---------------------------------------------------------------------- 03070000
* RETURN TO CALLER                                                      03080000
*---------------------------------------------------------------------- 03090000
                                                                        03100000
RETURN   DS    0H                                                       03110000
                                                                        03120000
         BAS   R14,VTAMUNLK       RELEASE SERIALIZATION IF APPROPRIATE  03130000
         MVC   CMRQCOMP(4),RETR15 SET COMMAND PROCESSOR COMPLETION CODE 03140000
         LM    R15,R1,RETREGS     LOAD RETURN VALUES                    03150000
                                                                        03160000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    03170000
                                                                        03180000
*---------------------------------------------------------------------- 03190000
*   SUBROUTINE: DISPLAY IACB DETAIL (AND SUBORDINATE ISESS DETAIL)      03200000
*---------------------------------------------------------------------- 03210000
                                                                        03220000
DISPIACB DS    0H                                                       03230000
                                                                        03240000
         STM   R0,R15,SUB0SAVE      SAVE CALLER'S REGISTERS             03250000
                                                                        03260000
         MVC   OPENNOTE,=CL8'STOPPED'                                   03270000
         TM    IACF1,IACF1UNU         IS ACB OUT OF SERVICE?            03280000
         BO    DACBIACB               BRANCH IF YES                     03290000
         MVC   OPENNOTE,=CL8'OPEN'                                      03300000
         TM    ACBOFLGS,ACBOPEN       IS THE ACB OPEN?                  03310000
         BO    DACBIACB               BRANCH IF YES                     03320000
         MVC   OPENNOTE,=CL8'NOT-OPEN'                                  03330000
                                                                        03340000
DACBIACB DS    0H                                                       03350000
                                                                        03360000
         MVC   SKIPNOTE,=CL4' '       CLEAR THE NOTE                    03370000
         TM    IACF1,IACF1SKP         IS "SKIP" SET?                    03380000
         BNO   D334IACB               BRANCH IF NOT                     03390000
         MVC   SKIPNOTE,=CL4'SKIP'                                      03400000
                                                                        03410000
D334IACB DS    0H                                                       03420000
                                                                        03430000
         $MSG  334,FIELDS=(IACNAME,                                    +03440000
               (RIACB),                                                +03450000
               IACFLAGS,                                               +03460000
               IACRECSZ,                                               +03470000
               IAC#SESS,                                               +03480000
               OPENNOTE,                                               +03490000
               SKIPNOTE)                                                03500000
                                                                        03510000
*                                                                       03520000
* DISPLAY A DETAIL LINE FOR EACH ISESS ON THE IACB                      03530000
*--------------------------------------------------------------         03540000
                                                                        03550000
         TM    FLAGS,FLAGSESS     SESSION DETAIL REQUESTED?             03560000
         BNO   DACBRET            BRANCH IF NOT                         03570000
         LA    RISESS,IACIS1ST-(ISEISNXT-ISE) NORMALIZED HEADER ADDRESS 03580000
                                                                        03590000
DACBNXTS DS    0H                                                       03600000
                                                                        03610000
         ICM   RISESS,15,ISEISNXT   NEXT ISESS ON THE IACB              03620000
         BM    DACBRET              BRANCH WHEN ISESS'S EXHAUSTED       03630000
                                                                        03640000
         MVC   TASKNAME(8),=CL8' '  CLEAR TASK NAME                     03650000
         ICM   R1,15,ISEITASK       ITASK ADDRESS                       03660000
         BZ    DACBNOTK             BRANCH IF NO TASK                   03670000
         MVC   TASKNAME(8),TSKNAME-ITASK(R1)                            03680000
                                                                        03690000
DACBNOTK DS    0H                                                       03700000
                                                                        03710000
         MVC   PROCNAME(8),=CL8' '  CLEAR PROC NAME                     03720000
         ICM   R1,15,ISEIPCB        IPROC ADDRESS                       03730000
         BZ    DACBNOPR             BRANCH IF NO PROC                   03740000
         MVC   PROCNAME(8),PCBNAME-IPCB(R1)                             03750000
                                                                        03760000
DACBNOPR DS    0H                                                       03770000
                                                                        03780000
         MVC   USAGE(8),=CL8'EXCL'  SET USAGE NOTE                      03790000
         C     RISESS,IACISEXC      EXCLUSIVE USER?                     03800000
         BE    DACBSESS             BRANCH IF YES                       03810000
         MVC   USAGE(8),=CL8'MULTI' SET USAGE NOTE                      03820000
         C     RISESS,IACISMPS      MULTI-PASS USER?                    03830000
         BE    DACBSESS             BRANCH IF YES                       03840000
         MVC   USAGE(8),=CL8'PASS'  SET USAGE NOTE                      03850000
         C     RISESS,IACISPSS      PASS USER?                          03860000
         BE    DACBSESS             BRANCH IF YES                       03870000
         MVC   USAGE(8),=CL8' '     CLEAR USAGE NOTE                    03880000
                                                                        03890000
DACBSESS DS    0H                                                       03900000
                                                                        03910000
         $MSG  335,FIELDS=(ISERLUNM,                                   +03920000
               ISEILUNM,                                               +03930000
               (RISESS),                                               +03940000
               ISETKUSR,                                               +03950000
               ISETKSES,                                               +03960000
               TASKNAME,                                               +03970000
               PROCNAME,                                               +03980000
               USAGE)                                                   03990000
                                                                        04000000
         B     DACBNXTS           GO DO THE NEXT SESSION                04010000
                                                                        04020000
*                                                                       04030000
* RETURN TO CALLER                                                      04040000
*--------------------------------------------------------------         04050000
                                                                        04060000
DACBRET  DS    0H                                                       04070000
                                                                        04080000
         LM    R0,R15,SUB0SAVE      RESTORE CALLER'S REGISTERS          04090000
         BR    R14                  RETURN                              04100000
                                                                        04110000
*---------------------------------------------------------------------- 04120000
*   SUBROUTINE: OBTAIN VTAM GLOBAL LOCK                                 04130000
*---------------------------------------------------------------------- 04140000
                                                                        04150000
VTAMLOCK DS    0H                                                       04160000
                                                                        04170000
         TM    FLAGS,FLAGLOCK       IS LOCK HELD?                       04180000
         BOR   R14                  BRANCH IF YES, DON'T DO IT AGAIN    04190000
         STM   R14,R2,SUB0SAVE      SAVE CALLER'S REGISTERS             04200000
                                                                        04210000
         $SER  OBTAIN,                                                 +04220000
               VTAM                                                     04230000
                                                                        04240000
         C     R15,=F'4'            WAS LOCK ALREADY HELD?              04250000
         BNE   VTAMLOEX             BRANCH IF NOT                       04260000
         OI    FLAGS,FLAGLCKD       REMEMBER LOCK HELD ON ENTRY         04270000
                                                                        04280000
VTAMLOEX DS    0H                                                       04290000
                                                                        04300000
         OI    FLAGS,FLAGLOCK       REMEMBER LOCK IS HELD               04310000
         LM    R14,R2,SUB0SAVE      RESTORE CALLER'S REGISTERS          04320000
         BR    R14                  RETURN                              04330000
                                                                        04340000
*---------------------------------------------------------------------- 04350000
*   SUBROUTINE: RELEASE VTAM GLOBAL LOCK                                04360000
*---------------------------------------------------------------------- 04370000
                                                                        04380000
VTAMUNLK DS    0H                                                       04390000
                                                                        04400000
         TM    FLAGS,FLAGLOCK       IS LOCK HELD?                       04410000
         BNOR  R14                  BRANCH IF NOT                       04420000
         TM    FLAGS,FLAGLCKD       WAS LOCK HELD ON ENTRY?             04430000
         BOR   R14                  DON'T RELEASE IF IT WAS             04440000
         STM   R14,R2,SUB0SAVE      SAVE CALLER'S REGISTERS             04450000
                                                                        04460000
         $SER  RELEASE,                                                +04470000
               VTAM                                                     04480000
                                                                        04490000
         NI    FLAGS,255-FLAGLOCK   SHOW LOCK NOT HELD                  04500000
         LM    R14,R2,SUB0SAVE      RESTORE CALLER'S REGISTERS          04510000
         BR    R14                  RETURN                              04520000
                                                                        04530000
*---------------------------------------------------------------------- 04540000
*  CONSTANTS AND LITERALS                                               04550000
*---------------------------------------------------------------------- 04560000
                                                                        04570000
         LTORG ,                                                        04580000
         PRINT NOGEN                                                    04590000
         CMDREQ  ,                COMMAND REQUEST BLOCK                 04600000
         CCSUMRY ,                COMMAND OPERAND PREPARSE SUMMARY      04610000
         KEYCODES COMMANDSET=TPPOOLS                                    04620000
         CMDCODES ,                                                     04630000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                04640000
         ISTDBIND ,               VTAM BIND IMAGE                       04650000
         TRACODES ,               INTEGRATOR TRACE CODE EQUATES         04660000
         ICVT  ,                  INTEGRATOR CVT                        04670000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   04680000
         ITASK ,                  INTEGRATOR TASK BLOCK                 04690000
         IPCB  ,                  INTEGRATOR PROC BLOCK                 04700000
         ISESS ,                  INTEGRATOR ISESS BLOCK                04710000
         IPOOL ,                  INTEGRATOR IPOOL BLOCK                04720000
         IACB  ,                  INTEGRATOR IACB  BLOCK                04730000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       04740000
         EVCODES ,                INTEGRATOR EVENT CODES                04750000
         ABCODES ,                INTEGRATOR $ABEND CODES               04760000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     04770000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        04780000
         $VTAM DSECT=YES          INTEGRATOR $VTAM SERVICES             04790000
         END   ,                                                        04800000
