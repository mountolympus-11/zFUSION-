IL62ALOG TITLE 'INTEGRATOR - LU6.2 LOG THE ERROR LOG DATA'              00010000
                                                                        00020000
         PRINT NOGEN                                                    00030000
         CMINCL ,                 INTEGRATOR CPI-C DEFINITIONS          00040000
         L62INCL ,                INTEGRATOR LU6.2 DEFINITIONS          00050000
         PRINT GEN                                                      00060000
                                                                        00070000
**<DOC-ON>************************************************************* 00080000
*                                                                       00090000
* ROUTINE: IL62ALOG - LU6.2 LOG THE ERROR LOG DATA                      00100000
*                                                                       00110000
* DESCRIPTION:                                                          00120000
*                                                                       00130000
*    THIS ROUTINE IS CALLED TO TRACE AND LOG A RECEIVED ERROR LOG       00140000
*    GDS VARIABLE WHICH MAY BE HELPFUL FOR PROBLEM DETERMINATION.       00150000
*                                                                       00160000
* ON ENTRY:                                                             00170000
*                                                                       00180000
*    R15 = ENTRY POINT ADDRESS                                          00190000
*    R14 = RETURN      ADDRESS                                          00200000
*    R13 = SAVE AREA   ADDRESS                                          00210000
*    R01 = PARM LIST   ADDRESS                                          00220000
*                                                                       00230000
*     1    +00 = ADDRESS OF ERROR LOG GDS VARIABLE                      00240000
*     2    +04 = ADDRESS OF ISESS BLOCK                                 00250000
*     2    +08 = ADDRESS OF DESCRIPTION                                 00260000
*     2    +0C = ADDRESS OF DESCRIPTION LENGTH                          00270000
*     3    +10 = ADDRESS OF RETURN CODE AREA                            00280000
*                                                                       00290000
* ON EXIT:                                                              00300000
*                                                                       00310000
*    R15 = 0                                                            00320000
*                                                                       00330000
*    RETURN_CODE = LU62_OK                                              00340000
*                                                                       00350000
**<DOC-OFF>************************************************************ 00360000
         EJECT ,                                                        00370000
*********************************************************************** 00380000
*                                                                       00390000
* MAINTENANCE:                                                          00400000
*                                                                       00410000
*   10/01/94 RANDY WITEK                                                00420000
*                                                                       00430000
*********************************************************************** 00440000
                                                                        00450000
         EQUS  ,                  GENERAL EQUATES                       00460000
                                                                        00470000
RICVT    EQU   R11                                                      00480000
RITASK   EQU   R10                                                      00490000
RBASE    EQU   R9                                                       00500000
RIVTAM   EQU   R8                                                       00510000
RPLIST   EQU   R7                                                       00520000
RDATA    EQU   R6                                                       00530000
RISESS   EQU   R5                                                       00540000
                                                                        00550000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00560000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00570000
         USING L62LIST,RPLIST     ESTABLISH ADDRESSABILITY              00580000
         USING ISESS,RISESS       ESTABLISH ADDRESSABILITY              00590000
                                                                        00600000
         COPY  CRAB               "C" RUNTIME ANCHOR BLOCK              00610000
         USING CRAB,R12           ADDRESSABILITY                        00620000
                                                                        00630000
         COPY  DSA                DYNAMIC SAVE AREA                     00640000
WORKAREA DS    0H                 READ/WRITE WORKAREA                   00650000
WRK256   DS    XL256              GENERAL WORKAREA                      00660000
OFFSET   DS    F                  RELATIVE OFFSET WORK AREA             00670000
OFFZERO  DS    F                  RELATIVE OFFSET WORK AREA             00680000
OFFZEND  DS    F                  RELATIVE OFFSET WORK AREA             00690000
OFFZLST  DS    F                  RELATIVE OFFSET WORK AREA             00700000
CHARLINE DS    XL16                                                     00710000
DATALINE DS    XL16                                                     00720000
PLUNAME  DS    CL8                                                      00730000
SLUNAME  DS    CL8                                                      00740000
RETCODE  DS    F                  TEMPORARY RETURN CODE AREA            00750000
FLAG     DS    X                                                        00760000
WORKLEN  EQU   *-WORKAREA         LENGTH OF USER DSA AREA               00770000
DSALEN   EQU   *-DSA              LENGTH OF DSA                         00780000
                                                                        00790000
         $MSGDFT PREFIX=ICTPID,                                        +00800000
               COMPID='L62',                                           +00810000
               TABLE=*#MSGS,                                           +00820000
               WORKA=0,                                                +00830000
               MF=(E,WRK256),                                          +00840000
               PRINT=NOGEN                                              00850000
                                                                        00860000
IL6ALOG@ CSECT ,                                                        00870000
IL62ALOG CENTRY DSA=DSALEN,BASE=RBASE,INDEP=YES                         00880000
                                                                        00890000
         USING DSA,R13            ADDRESSABILITY                        00900000
         LR    RPLIST,R1          SAVE ADDRESS OF PLIST                 00910000
                                                                        00920000
         LA    R0,WORKAREA        ADDRESS OF USER DSA SECTION           00930000
         LA    R1,WORKLEN         LENGTH  OF USER DSA SECTION           00940000
         SR    R15,R15            PREPARE FOR CLEAR                     00950000
         MVCL  R0,R14             CLEAR USER DSA SECTION                00960000
                                                                        00970000
*---------------------------------------------------------------------- 00980000
* INITIALIZATION                                                        00990000
*---------------------------------------------------------------------- 01000000
                                                                        01010000
         @RESTENV ,               ENSURE ENVIRONMENT                    01020000
                                                                        01030000
         L     RIVTAM,ICTVTCVT    ESTABLISH IVTAMCVT POINTER            01040000
         USING IVTAMCVT,RIVTAM    ADDRESSABILITY                        01050000
                                                                        01060000
         L     RDATA,L62PARM1     LOG DATA ADDRESS                      01070000
         L     RISESS,L62PARM2    ISESS ADDRESS                         01080000
                                                                        01090000
         MVC   PLUNAME,ISEILUNM      ASSUME PLU                         01100000
         MVC   SLUNAME,ISERLUNM      ASSUME SLU                         01110000
         TM    ISEF2,ISEF2SLU        ARE WE THE SLU?                    01120000
         BNO   NOTSLU                BRANCH IF NOT                      01130000
         MVC   PLUNAME,ISERLUNM      SET    PLU                         01140000
         MVC   SLUNAME,ISEILUNM      SET    SLU                         01150000
                                                                        01160000
NOTSLU   DS    0H                                                       01170000
                                                                        01180000
*---------------------------------------------------------------------- 01190000
* TRACE THE LOG DATA (IF TRACING IS ACTIVE)                             01200000
*---------------------------------------------------------------------- 01210000
                                                                        01220000
         $TRACE *=A(TRC_LU62_LOGHEADER),48  GET A TRACE ENTRY           01230000
         BNZ   NOXTRACE               BRANCH IF TRACING NOT AVAILABLE   01240000
         ST    RISESS,0(,R1)          TRACE ISESS ADDRESS               01250000
         MVC   4(8,R1),ISETK          TRACE SESSION TOKEN               01260000
         MVC   16(8,R1),PLUNAME       TRACE PLU NAME                    01270000
         MVC   24(8,R1),SLUNAME       TRACE SLU NAME                    01280000
         L     R2,L62PARM3            DESCRIPTION ADDRESS               01290000
         L     R3,L62PARM4            @ DESCRIPTION LENGTH              01300000
         L     R3,0(,R3)              DESCRIPTION LENGTH                01310000
         LA    R0,32(,R1)             AREA TO TRACE DESCRIPTION         01320000
         LA    R1,16                  MAXIMUM LENGTH TO TRACE           01330000
         ICM   R3,B'1000',=C' '       PADDING                           01340000
         MVCL  R0,R2                  TRACE THE DESCRIPTION             01350000
                                                                        01360000
         SR    R3,R3                  CLEAR FOR ICM                     01370000
         ICM   R3,B'0011',0(RDATA)    LENGTH OF ERROR LOG DATA          01380000
         BNP   NOXTRACE               BRANCH IF NO LOG DATA             01390000
         LR    R2,RDATA               START OF LOG DATA                 01400000
         SR    R4,R4                  STARTING OFFSET                   01410000
XTRCDATA DS    0H                                                       01420000
         $TRACE *=A(TRC_LU62_LOGDATA),144 LOG DATA TRACE                01430000
         BNZ   NOXTRACE               BRANCH IF TRACING NOT AVAILABLE   01440000
         MVC   0(8,R1),ISETK          TRACE SESSION TOKEN               01450000
         MVC   8(4,R1),=F'128'        SET MAX TRACE DATA LENGTH         01460000
         C     R3,=F'128'             AT LEAST 128 TO GO?               01470000
         BNL   *+8                    BRANCH IF YES                     01480000
         ST    R3,8(,R1)              SET ACTUAL DATA LENGTH REMAINING  01490000
         ST    R4,12(,R1)             SET STARTING OFFSET IN BUFFER     01500000
         LA    R14,16(,R1)            ADDRESS OF SEND DATA AREA         01510000
         LA    R15,128                MAX OF 128 BYTES                  01520000
         MVCL  R14,R2                 TRACE THE RECEIVED DATA           01530000
         LA    R4,128(,R4)            UPDATE DATA OFFSET                01540000
         LTR   R3,R3                  MORE DATA TO TRACE?               01550000
         BP    XTRCDATA               BRANCH IF YES                     01560000
NOXTRACE DS    0H                                                       01570000
                                                                        01580000
                                                                        01590000
*---------------------------------------------------------------------- 01600000
* RECORD THE DATA ON THE INTEGRATOR LOG DATASET                         01610000
*---------------------------------------------------------------------- 01620000
                                                                        01630000
         L     R3,L62PARM3           DESCRIPTION ADDRESS                01640000
         L     R2,L62PARM4           @ DESCRIPTION LENGTH               01650000
         L     R2,0(,R2)             DESCRIPTION LENGTH                 01660000
                                                                        01670000
         $MSG  003,                  "ERROR LOG DATA..."               +01680000
               FIELDS=(((R3),(R2)),  DESCRIPTION (E.G. RECEIVED/SENT)  +01690000
               (RISESS),             ISESS ADDRESS                     +01700000
               (ISETK,4),            ISESS TOKEN                       +01710000
               (ISETK+4,4),          ISESS TOKEN                       +01720000
               (PLUNAME,8),          PLU                               +01730000
               (SLUNAME,8))          SLU                                01740000
                                                                        01750000
         LTR   R2,RDATA              LOG DATA ADDRESS                   01760000
         BNP   RETURN                BRANCH IF BAD ADDRESS              01770000
         SR    R3,R3                 CLEAR FOR ICM                      01780000
         ICM   R3,B'0011',0(RDATA)   LOG DATA LENGTH                    01790000
         BNP   RETURN                BRANCH IF NO DATA                  01800000
                                                                        01810000
         LR    R0,R3                 LENGTH OF DATA                     01820000
         BCTR  R0,0                  SAVE ENDING OFFSET                 01830000
         ST    R0,OFFZLST            SAVE ENDING OFFSET                 01840000
         MVC   OFFZERO,=XL4'FFFFFFFF' NO ZERO BLOCKS TO REPORT          01850000
                                                                        01860000
NEXTLINE DS    0H                                                       01870000
                                                                        01880000
         LA    R14,DATALINE          OUTPUT AREA                        01890000
         LA    R15,16                OUTPUT AREA LENGTH                 01900000
         MVCL  R14,R2                MOVE UP TO 16 BYTES TO OUTPUT AREA 01910000
         MVC   CHARLINE,DATALINE     COPY THE DATA                      01920000
         TR    CHARLINE(16),NONULL   TRANSLATE NULLS TO PERIODS         01930000
         OC    DATALINE(16),DATALINE ALL ZEROS?                         01940000
         BNZ   NEXTNORM              BRANCH IF NOT                      01950000
         ICM   R0,15,OFFZERO         HAS OFFSET BEEN SET ALREADY?       01960000
         BNM   NEXTZUPD              BRANCH IF YES                      01970000
         MVC   OFFZERO,OFFSET        SET OFFSET OF ZEROS                01980000
         L     R0,OFFSET             SET ENDING OFFSET OF ZERO BLOCK    01990000
         S     R0,=F'1'              SET ENDING OFFSET OF ZERO BLOCK    02000000
         ST    R0,OFFZEND            SET ENDING OFFSET OF ZERO BLOCK    02010000
                                                                        02020000
NEXTZUPD DS    0H                                                       02030000
                                                                        02040000
         L     R0,OFFZEND            ENDING OFFSET OF ZEROS BLOCK       02050000
         A     R0,=F'16'             UPDATE ENDING OFFSET               02060000
         ST    R0,OFFZEND            SET ENDING OFFSET OF ZERO BLOCK    02070000
         LA    R2,16(,R2)            UPDATE ADDRESS OF DATA             02080000
         S     R3,=F'16'             UPDATE LENGTH OF DATA REMAINING    02090000
         B     NEXTEND               AND GO DO NEXT LINE                02100000
                                                                        02110000
NEXTNORM DS    0H                                                       02120000
                                                                        02130000
         ICM   R0,15,OFFZERO         ANY ZERO LINES TO REPORT?          02140000
         BM    NEXTNONZ              BRANCH IF NOT                      02150000
                                                                        02160000
         $MSG  005,                  "LABEL+XXXXXXXX-XXXXXXXX: ALL 0"  +02170000
               FIELDS=((OFFZERO,4),  RELATIVE OFFSET OF ZERO BLOCK     +02180000
               (OFFZEND,4))          RELATIVE OFFSET OF ZERO BLOCK END  02190000
                                                                        02200000
         MVC   OFFZERO,=XL4'FFFFFFFF' NO ZERO BLOCKS TO REPORT          02210000
                                                                        02220000
NEXTNONZ DS    0H                                                       02230000
                                                                        02240000
         $MSG  004,                  "SPLIST TRACE..."                 +02250000
               FIELDS=((OFFSET,4),   RELATIVE OFFSET                   +02260000
               (DATALINE,4),         1ST WORD HEX                      +02270000
               (DATALINE+4,4),       2ND WORD HEX                      +02280000
               (DATALINE+8,4),       3RD WORD HEX                      +02290000
               (DATALINE+12,4),      4TH WORD HEX                      +02300000
               (CHARLINE,16))        ALL WORDS AS A STRING VARIABLE     02310000
                                                                        02320000
NEXTEND  DS    0H                                                       02330000
                                                                        02340000
         L     R4,OFFSET             RELATIVE OFFSET                    02350000
         LA    R4,16(,R4)            BUMP RELATIVE OFFSET               02360000
         ST    R4,OFFSET             SAVE UPDATED RELATIVE OFFSET       02370000
         LTR   R3,R3                 ANY DATA LEFT?                     02380000
         BP    NEXTLINE              BRANCH IF YES                      02390000
         ICM   R0,15,OFFZERO         ANY ZERO LINES TO REPORT?          02400000
         BM    RETURN                BRANCH IF NOT                      02410000
                                                                        02420000
         $MSG  005,                  "LABEL+XXXXXXXX-XXXXXXXX: ALL 0"  +02430000
               FIELDS=((OFFZERO,4),  RELATIVE OFFSET OF ZERO BLOCK     +02440000
               (OFFZLST,4))          RELATIVE OFFSET OF ZERO BLOCK END  02450000
                                                                        02460000
*---------------------------------------------------------------------- 02470000
* RETURN TO CALLER                                                      02480000
*---------------------------------------------------------------------- 02490000
                                                                        02500000
RETURN   DS    0H                                                       02510000
                                                                        02520000
         L     R1,L62PARM5        ADDRESS OF RETURN_CODE AREA           02530000
         MVC   0(4,R1),=A(CM_OK)  SET RETURN_CODE VARIABLE              02540000
                                                                        02550000
         SR    R15,R15            FUNCTION RETURN CODE = 0              02560000
         CEXIT RC=(R15),INDEP=YES RETURN                                02570000
                                                                        02580000
*---------------------------------------------------------------------- 02590000
* LITERALS AND CONSTANTS                                                02600000
*---------------------------------------------------------------------- 02610000
                                                                        02620000
NONULL   DS    0H                                                       02630000
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'                      02640000
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'                      02650000
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'                      02660000
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'                      02670000
         DC    X'404142434445464748494A4B4C4D4E4F'                      02680000
         DC    X'505152535455565758595A5B5C5D5E5F'                      02690000
         DC    X'606162636465666768696A6B6C6D6E6F'                      02700000
         DC    X'707172737475767778797A7B7C7D7E7F'                      02710000
         DC    X'808182838485868788898A8B8C8D8E8F'                      02720000
         DC    X'909192939495969798999A9B9C9D9E9F'                      02730000
         DC    X'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF'                      02740000
         DC    X'B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF'                      02750000
         DC    X'4BC1C2C3C4C5C6C7C8C9CACBCCCDCECF'                      02760000
         DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'                      02770000
         DC    X'4BE1E2E3E4E5E6E7E8E9EAEBECEDEEEF'                      02780000
         DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'                      02790000
                                                                        02800000
         LTORG ,                                                        02810000
                                                                        02820000
         PRINT NOGEN                                                    02830000
         ISTDBIND ,               VTAM BIND IMAGE                       02840000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                02850000
         IKJTCB ,                 MVS TASK CONTROL BLOCK                02860000
         TRACODES ,               INTEGRATOR TRACE CODE EQUATES         02870000
         ICVT  ,                  INTEGRATOR CVT                        02880000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   02890000
         ITASK ,                  INTEGRATOR TASK BLOCK                 02900000
         IPCB ,                   INTEGRATOR PROCESS BLOCK              02910000
         IACB ,                   INTEGRATOR VTAM ACB                   02920000
         ABCODES ,                INTEGRATOR $ABEND CODES               02930000
         EVCODES ,                INTEGRATOR EVENT CODES                02940000
         ISESS ,                  INTEGRATOR SESSION BLOCK              02950000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            02960000
         IRPL ,                   INTEGRATOR VTAM RPL                   02970000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          02980000
         END   ,                                                        02990000
