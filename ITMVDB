ITMVDB   TITLE 'ITMVDB - VIRTUAL DATABASE FUNCTION ROUTER'              00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE: ITMVDB - Virtual Database Function Router                    00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*   This routine process all request for virtual database               00080000
*   services from the workstation.   VDB services are                   00090000
*   requested from the administrators workbench to maintain             00100000
*   the SYSTABLES and SYSCOLUMNS project catalog tables.  This          00110000
*   router will call the approrpiate processing routine                 00120000
*   associated function.                                                00130000
*                                                                       00140000
* ENTRY:                                                                00150000
*                                                                       00160000
*   R1 contains the address of the RU transaction parameter             00170000
*   list mapped by the @XH macro.                                       00180000
*                                                                       00190000
* EXIT:                                                                 00200000
*                                                                       00210000
*   R15 contain the return code as follows:                             00220000
*                                                                       00230000
*       RC00 - Processing completed                                     00240000
*                                                                       00250000
**<DOC-OFF>*****************************************************        00260000
                                                                        00270000
****************************************************************        00280000
*                                                                       00290000
* MAINTENANCE:                                                          00300000
*                                                                       00310000
*    11/XX/92  R. TURGEON                                               00320000
*              INITIAL VERSION                                          00330000
*                                                                       00340000
*    08/15/93  R. COLMONE                                               00350000
*              CONVERTED FOR NEW ENVIRONMENT                            00360000
*                                                                       00370000
****************************************************************        00380000
                                                                        00390000
         EJECT ,                                                        00400000
         #WORK ,                                                        00410000
WORKFREE DS    XL1024                  WORKAREA FOR FUNC PROCESSORS     00420000
         #ENDWORK ,                                                     00430000
                                                                        00440000
         EJECT ,                                                        00450000
         @XH   ,                       REQUEST HEADER FORMAT            00460000
                                                                        00470000
         EJECT ,                                                        00480000
         EQUS  ,                       GENERAL EQUATES                  00490000
                                                                        00500000
         ABCODES ,                                                      00510000
                                                                        00520000
         EJECT ,                                                        00530000
ITMVDB   #ENTER ITMVDB,PREG=R8         ENTRY LINKAGE                    00540000
                                                                        00550000
         USING ITASK,R10               ITASK ADDRESSABILITY             00560000
         USING @XH,R8                  RUHDR ADDRESSABILITY             00570000
                                                                        00580000
*--------------------------------------------------------------         00590000
*   ACQUIRE RESPONSE AREA                                               00600000
*--------------------------------------------------------------         00610000
         $XPBUFR INIT,                 INITIALIZE XP BUFFER            +00620000
               SIZE=*$$XPBUFR,                                         +00630000
               XH=@XH,                                                 +00640000
               MF=(E,MFE_LIST)                                          00650000
                                                                        00660000
         BNZ   CLEANUP                 INITIALIZATION FAILED            00670000
                                                                        00680000
*--------------------------------------------------------------         00690000
*   INVOKE TABLE INTERFACE SERVICE ROUTINE                              00700000
*--------------------------------------------------------------         00710000
         L     R2,@XHSFNC              OBTAIN REQUESTED SUBFUNC         00720000
         BCTR  R2,0                    CONVERT TO INDEX                 00730000
         SLL   R2,2                                                     00740000
                                                                        00750000
         L     R15,RTNS(R2)            FETCH SERVICE ROUTINE ADDRESS    00760000
         LR    R1,R8                   PLIST ADDRESS                    00770000
         LA    R0,WORKFREE             WORKING STORAGE                  00780000
         BASR  R14,R15                 INVOKE SERVICE ROUTINE           00790000
                                                                        00800000
*--------------------------------------------------------------         00810000
*   SEND RESPONSE TO WORK STATION                                       00820000
*--------------------------------------------------------------         00830000
         $XPBUFR XMIT,MF=(E,MFE_LIST)  SEND VDB RESPONSE                00840000
         BNZ   ABE_TXP                                                  00850000
                                                                        00860000
*--------------------------------------------------------------         00870000
*   NORMAL TERMINATION / RECOVERY                                       00880000
*--------------------------------------------------------------         00890000
CLEANUP  DS    0H                                                       00900000
         $XPBUFR FREE,MF=(E,MFE_LIST)  FREE RESPONSE BUFFER             00910000
         BNZ   ABE_TXP                                                  00920000
                                                                        00930000
*--------------------------------------------------------------         00940000
*   RELEASE WORKING STORAGE AND EXIT                                    00950000
*--------------------------------------------------------------         00960000
         LA    R15,RC00                NORMAL COMPLETION                00970000
         #EXIT ,                       RETURN                           00980000
                                                                        00990000
         EJECT                                                          01000000
***************************************************************         01010000
*                                                                       01020000
* CATASTROPIC ERRORS                                                    01030000
*                                                                       01040000
***************************************************************         01050000
ABE_TXP  DS    0H                                                       01060000
         $ABEND ABE_TXPSERV,DUMP=YES,                                  X01070000
               TITLE='TXP BUFFER SERVICE FAILURE'                       01080000
                                                                        01090000
         EJECT ,                                                        01100000
***************************************************************         01110000
*                                                                       01120000
*   LOCAL READ ONLY STORAGE                                             01130000
*                                                                       01140000
***************************************************************         01150000
$$XPBUFR DC    A(1024)                  INITIAL XP BUFFER SIZE          01160000
                                                                        01170000
RTNS     DS    0F                                                       01180000
         DC    V(IVDBDEL)               1 - VIRTUAL DATABASE DELETE     01190000
         DC    A(*-*)                   2 - RESERVED                    01200000
         DC    A(*-*)                   3 - RESERVED                    01210000
         DC    A(*-*)                   4 - RESERVED                    01220000
                                                                        01230000
         LTORG ,                                                        01240000
                                                                        01250000
         PRINT NOGEN                                                    01260000
         ICVT  ,                                                        01270000
         ITASK ,                                                        01280000
                                                                        01290000
         END   ,                                                        01300000
