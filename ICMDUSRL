         TITLE 'ICMDUSRL - USER LIST DISPLAY CMDPROC'                   00010000
         #WORK ,             BEGIN WORKAREA                             00020000
                                                                        00030000
MAJID    DS    X             MAJOR KEYWORD ID (MUTEXC)                  00040000
MIN1ID   DS    X             MINOR KEYWORD ID (MUTEXC) GROUP1           00050000
MIN2ID   DS    X             MINOR KEYWORD ID (MUTEXC) GROUP2           00060000
MATCHFLG DS    X             USER FOUND                                 00070000
                                                                        00080000
TASKNAME DS    CL8           TASK() OR MASKTASK() DESIGNATION           00090000
TASKZERO DS    F             TASKNAME AS NTS FOR PATMATCH ROUTINE       00100000
                                                                        00110000
USERNAME DS    CL8           USER() OR MASKUSER() DESIGNATION           00120000
USERZERO DS    F             USERNAME AS NTS FOR PATMATCH ROUTINE       00130000
                                                                        00140000
CURRUSER DS    CL8           CURRENT USERID NAME                        00150000
USERTYPE DS    CL2           USER CLIENT TYPE                           00160000
                                                                        00170000
*--------------------------------------------------------------         00180000
*   'UL NAMES' REPORT LINE                                              00190000
*--------------------------------------------------------------         00200000
@UNMCURR DS    A             ADDR NEXT Entity Entry                     00210000
                                                                        00220000
@UNMLIST DS    0C            User DISPLAY LINE AS N-ACROSS              00230000
@UNMS1   DS    CL8           UserNAME PLUS BUSY DESIGNATION             00240000
@UNMS2   DS    CL8                                                      00250000
@UNMS3   DS    CL8                                                      00260000
@UNMS4   DS    CL8                                                      00270000
@UNMS5   DS    CL8                                                      00280000
@UNMS6   DS    CL8                                                      00290000
@UNMLEND EQU   *             END OF COLLECTOR ARRAY                     00300000
@UNMLN   EQU   *-@UNMLIST    LENGTH OF COLLECTOR ARRAY                  00310000
                                                                        00320000
*--------------------------------------------------------------         00330000
REGSAVE  DS    16F           LOCAL ROUTINE SAVEAREA                     00340000
WK256    DS    XL256         LARGE PLIST CONSTRUCTION, ETC.             00350000
         #ENDWORK ,          END WORKAREA                               00360000
                                                                        00370000
         EJECT                                                          00380000
         CMDREQ  ,           COMMAND REQUEST BLOCK                      00390000
                                                                        00400000
         EJECT                                                          00410000
         CCSUMRY ,           COMMAND OPERAND PREPARSE SUMMARY           00420000
                                                                        00430000
         EJECT                                                          00440000
         $ENTITY DSECT=ALL   COMMAND OPERAND PREPARSE SUMMARY           00450000
                                                                        00460000
         EJECT                                                          00470000
         USRENTUD DSECT=YES  USER ENTITY USER DATA                      00480000
                                                                        00490000
         EJECT                                                          00500000
         KEYCODES COMMANDSET=USERLIST                                   00510000
                                                                        00520000
         CMDCODES ,                                                     00530000
                                                                        00540000
         @VERSION ,                                                     00550000
                                                                        00560000
         EQUS  ,                                                        00570000
                                                                        00580000
         $MSGDFT PREFIX=ICTPID,COMPID='CMD',TABLE=*#MSGS,              X00590000
               CONID=*CMRQCNID,CONNAME=CMRQCNAM,CART=CMRQCART,         X00600000
               DESTADD=*CMRQDMSK,                                      X00610000
               MSGQA=*CMRQMQA,STGQH=*CMRQSTGQ,                         X00620000
               MF=(E,WK256),                                           X00630000
               PRINT=NOGEN                                              00640000
         EJECT                                                          00650000
                                                                        00660000
**<DOC-ON>*****************************************************         00670000
*                                                                       00680000
* ROUTINE: ICMDUSRL - USERLIST DISPLAY CMDPROC                          00690000
*                                                                       00700000
* DESCRIPTION:                                                          00710000
*                                                                       00720000
*    This routine processes the various forms of the                    00730000
*    'USERLIST' Command which is used to present information            00740000
*    about the current logged on users in the system. Optionally,       00750000
*    a detailed user display containing the task name, process          00760000
*    name, user type (WB/RT) and client code verison may                00770000
*    be selected.  If the command contains no operands, the             00780000
*    number of active users is displayed.  The userlist display         00790000
*    and be trimmed for the desired results by specifying               00800000
*    TASK(), MASKTASK(), USER(), or MASKUSER().                         00810000
*                                                                       00820000
*                                                                       00830000
* SYNTAX:                                                               00840000
*                                                                       00850000
*    USERLIST íNAMES | ALLù íTASK(<name>)ù        íUSER(<name>ù         00860000
*                           íMASKTASK(<pattern>)ù íMASKUSER(<pattern>)ù 00870000
*                                                                       00880000
*    IF ONE USER(), MASKUSER(), TASK(), OR MASKTASK() IS PROVIDED       00890000
*    BUT NO DISPLAY TYPE IS GIVEN, 'ALL' IS ASSUMED BY DEFAULT.         00900000
*                                                                       00910000
*                                                                       00920000
* ON ENTRY:                                                             00930000
*                                                                       00940000
*    R1  ADDR OF COMMAND REQUEST BLOCK (CMDREQ) IN LOCAL                00950000
*        CMDPROC FORMAT                                                 00960000
*                                                                       00970000
**<DOC-OFF>****************************************************         00980000
                                                                        00990000
                                                                        01000000
***************************************************************         01010000
*                                                                       01020000
* MAINTENANCE:                                                          01030000
*                                                                       01040000
*    08/01/94 R. Colmone          Par# 133649                           01050000
*             INITIAL VERSION                                           01060000
*                                                                       01070000
***************************************************************         01080000
                                                                        01090000
         EJECT ,                                                        01100000
ICMDUSRL #ENTER PREG=R8                                                 01110000
                                                                        01120000
         USING ICVT,R11                                                 01130000
         USING ITASK,R10                                                01140000
                                                                        01150000
*--------------------------------------------------------------         01160000
*    LOCATE COMMAND REQUEST BLOCK, COMMAND SUMMARY, AND OPS             01170000
*--------------------------------------------------------------         01180000
         USING CMDREQ,R8          COMMAND REQUEST BLOCK                 01190000
         ICM   R7,15,CMRQSMRY     ASSOC COMMAND SUMMARY                 01200000
         BZ    COUNTS             AMBIGUOUS REQUEST                     01210000
         USING CCSUMRY,R7         COMMAND OPERAND SUMMARY FORMAT        01220000
         ICM   R5,15,CMRQSMR#     TOTAL NUMBER OF OPERAND ENTRIES       01230000
         BZ    COUNTS             AMBIGUOUS REQUEST IF ZERO             01240000
         L     R6,CMRQOPST        OPERAND STRING ORIGIN                 01250000
                                                                        01260000
*--------------------------------------------------------------         01270000
*   IDENTIFY THE OPERANDS PROVIDED AND VALIDATE                         01280000
*--------------------------------------------------------------         01290000
PARSENXT DS    0H                                                       01300000
         SR    R2,R2              NO PROCESSING ROUTINE                 01310000
         LA    R1,UL_ALL          ALL TASKS                             01320000
         CH    R1,CCSID           CURRENT KEYWORD?                      01330000
         BE    MAJKEY             BREAK IF SO                           01340000
                                                                        01350000
         SR    R2,R2              NO PROCESSING ROUTINE                 01360000
         LA    R1,UL_NAMES        USER NAMES                            01370000
         CH    R1,CCSID           CURRENT KEYWORD?                      01380000
         BE    MAJKEY             BREAK IF SO                           01390000
                                                                        01400000
         LA    R2,PUSRNM          EXTRACT USER NAME                     01410000
         LA    R1,UL_USER         SPECIFIC USER                         01420000
         CH    R1,CCSID           CURRENT KEYWORD?                      01430000
         BE    MIN1KEY            BREAK IF SO                           01440000
         LA    R1,UL_MUSER        USER NAME PATTERN                     01450000
         CH    R1,CCSID           CURRENT KEYWORD?                      01460000
         BE    MIN1KEY            BREAK IF SO                           01470000
                                                                        01480000
         LA    R2,PTSKNM          EXTRACT TASK NAME                     01490000
         LA    R1,UL_TASK         SPECIFIC TASK                         01500000
         CH    R1,CCSID           CURRENT KEYWORD?                      01510000
         BE    MIN2KEY            BREAK IF SO                           01520000
         LA    R1,UL_MTASK        USER TASK PATTERN                     01530000
         CH    R1,CCSID           CURRENT KEYWORD?                      01540000
         BE    MIN2KEY            BREAK IF SO                           01550000
                                                                        01560000
         B     ERREJECT           REJECT OTHERWISE                      01570000
                                                                        01580000
*--------------------------------------------------------------         01590000
*   POST SENTINELS AND VALUES FOR MAJOR AND MINOR KEYS FOUND            01600000
*--------------------------------------------------------------         01610000
MAJKEY   DS    0H                                                       01620000
         CLI   MAJID,0            ONLY KEYWORD OF MAJOR GROUP?          01630000
         BNE   ERRCNFLC           CONFLICTING OPERANDS OTHERWISE        01640000
         STC   R1,MAJID           POST REQUEST TYPE                     01650000
         LTR   R2,R2              RESUMPTION POINT PROVIDED?            01660000
         BNZR  R2                 ONWARD IF SO                          01670000
         B     ADVANCE            ADVANCE TO NEXT OPERAND               01680000
                                                                        01690000
MIN1KEY  DS    0H                                                       01700000
         CLI   MIN1ID,0           ONLY KEYWORD OF MINOR GROUP1?         01710000
         BNE   ERRCNFLC           CONFLICTING OPERANDS OTHERWISE        01720000
         STC   R1,MIN1ID          POST REQUEST TYPE                     01730000
         LTR   R2,R2              RESUMPTION POINT PROVIDED?            01740000
         BNZR  R2                 ONWARD IF SO                          01750000
         B     ADVANCE            ADVANCE TO NEXT OPERAND               01760000
                                                                        01770000
MIN2KEY  DS    0H                                                       01780000
         CLI   MIN2ID,0           ONLY KEYWORD OF MINOR GROUP2?         01790000
         BNE   ERRCNFLC           CONFLICTING OPERANDS OTHERWISE        01800000
         STC   R1,MIN2ID          POST REQUEST TYPE                     01810000
         LTR   R2,R2              RESUMPTION POINT PROVIDED?            01820000
         BNZR  R2                 ONWARD IF SO                          01830000
         B     ADVANCE            ADVANCE TO NEXT OPERAND               01840000
                                                                        01850000
*------- USER(<NAME>) OR MASKUSER(<PATTERN>) ------------------         01860000
                                                                        01870000
PUSRNM   DS    0H                 USER(<TASKNAME>)                      01880000
         CLC   CCSVALCT,=H'1'     SINGLE VALUE?                         01890000
         BNE   ERRSYNTX           SYNTAX PROBLEM OTHERWISE              01900000
         LH    R2,CCSVLEN         FETCH VALUE LENGTH                    01910000
         LTR   R2,R2              LENGTH OF STRING                      01920000
         BNP   ERRSYNTX           SYNTAX ERROR                          01930000
         CH    R2,=AL2(L'TASKNAME)   CORRECT LENGTH?                    01940000
         BH    ERRSYNTX           ERROR IF NOT                          01950000
                                                                        01960000
         MVC   USERNAME,BLANKS    BLANK PAD                             01970000
         L     R3,CCSVDISP        OFFSET TO USERNAME IN CMD LINE        01980000
         AR    R3,R6              CONVERT OFFSET TO ADDRESS             01990000
         BCTR  R2,0               PREPARE FOR EX                        02000000
         EX    R2,*+4             LOCAL COPY OF USERNAME                02010000
         MVC   USERNAME(*-*),0(R3)                                      02020000
         B     ADVANCE            ADVANCE TO NEXT OPERAND               02030000
                                                                        02040000
*------- TASK(<NAME>) OR MASKTASK(<PATTERN>) ------------------         02050000
                                                                        02060000
PTSKNM   DS    0H                 TASK(<TASKNAME>)                      02070000
         CLC   CCSVALCT,=H'1'     SINGLE VALUE?                         02080000
         BNE   ERRSYNTX           SYNTAX PROBLEM OTHERWISE              02090000
         LH    R2,CCSVLEN         FETCH VALUE LENGTH                    02100000
         LTR   R2,R2              LENGTH OF STRING                      02110000
         BNP   ERRSYNTX           SYNTAX ERROR                          02120000
         CH    R2,=AL2(L'TASKNAME)   CORRECT LENGTH?                    02130000
         BH    ERRSYNTX           ERROR IF NOT                          02140000
                                                                        02150000
         MVC   TASKNAME,BLANKS    BLANK PAD                             02160000
         L     R3,CCSVDISP        OFFSET TO TASKNAME IN CMD LINE        02170000
         AR    R3,R6              CONVERT OFFSET TO ADDRESS             02180000
         BCTR  R2,0               PREPARE FOR EX                        02190000
         EX    R2,*+4             LOCAL COPY OF TASKNAME                02200000
         MVC   TASKNAME(*-*),0(R3)                                      02210000
         B     ADVANCE            ADVANCE TO NEXT OPERAND               02220000
                                                                        02230000
*--------------------------------------------------------------         02240000
*   PROCESS ALL KEYWORDS, VALIDATE REQUEST COMPLETENESS                 02250000
*--------------------------------------------------------------         02260000
ADVANCE  DS    0H                                                       02270000
         LA    R15,CCSVSLN        LENGTH OF EACH VALUE ENTRY            02280000
         MH    R15,CCSVALCT       TOTAL SIZE CONSUMED BY VALUES         02290000
         LA    R7,CCSUMRY+CCSPFXL(R15)                                  02300000
         BCT   R5,PARSENXT        EXAMINE ALL OPERANDS                  02310000
                                                                        02320000
         CLI   MAJID,0            MAJOR OPERAND PROVIDED?               02330000
         BNE   *+8                READY TO ROLL IF SO                   02340000
         MVI   MAJID,UL_ALL       ASSUME DETAIL LIST OF USERS           02350000
                                                                        02360000
         CLI   MAJID,UL_NAMES     USER NAMES?                           02370000
         BE    NAMES              DISPLAY ACCORDINGLY                   02380000
         CLI   MAJID,UL_ALL       DETAIL DISPLAY OF USERS?              02390000
         BE    DETAIL             DISPLAY ACCORDINGLY                   02400000
         B     DETAIL             UNRECOGNIZED REQ, FOR NOW             02410000
         DROP  R7                 CCSUMRY                               02420000
                                                                        02430000
         EJECT ,                                                        02440000
***************************************************************         02450000
*                                                                       02460000
*   'UL NAMES' CONDENSED USER NAME LIST DISPLAY                         02470000
*                                                                       02480000
***************************************************************         02490000
NAMES    DS    0H                                                       02500000
         $SER  OBTAIN,DISP        ACQUIRE DISPATCHER LOCK               02510000
                                                                        02520000
*--------------------------------------------------------------         02530000
*   SCAN USER ENTITY STRUCTURE FOR MATCHING USERS                       02540000
*--------------------------------------------------------------         02550000
         BAS   R14,UNMINIT        INITIALIZE USER NAME COLLECTION LINE  02560000
                                                                        02570000
         L     R5,ICTUSERE        USER ENTITY STRUCTURE ORIGIN          02580000
         USING ENTCNTL,R5         ADDRESSABILITY                        02590000
         ICM   R5,15,ENTQ         ADDRESS OF FIRST ENTITY ENTRY         02600000
         BZ    NAMENONE           NO ACTIVE USERS                       02610000
         USING ENENTRY,R5         ADDRESSABILITY                        02620000
NAMENEXT DS    0H                                                       02630000
         MVC   CURRUSER,BLANKS    INITIALIZE CURRENT USER               02640000
         LH    R1,ENENTLN         LENGTH OF ENTITY NAME                 02650000
         BCTR  R1,0               PREPARE FOR EX                        02660000
         EX    R1,*+4             COPY USERID TO WORKAREA               02670000
         MVC   CURRUSER(*-*),ENENTITY  *** EX OBJECT **                 02680000
                                                                        02690000
         LA    R1,ENEUSER         ADDRESS OF USER DATA                  02700000
         BAS   R14,USERTEST       APPLY USER FILTERS IF ANY             02710000
         BNZ   NAMEADV            SKIP IF NO MATCH                      02720000
                                                                        02730000
         CLI   MATCHFLG,0         ENTRIES PREVIOUS SELECTED             02740000
         BNE   NAMEGO             YES, CONTINUE WITH INSERT             02750000
         $MSG  231                'UL NAMES' HEADER MESSAGE             02760000
                                                                        02770000
NAMEGO   DS    0H                                                       02780000
         MVI   MATCHFLG,4         MATCHING USER IDENTIFIED              02790000
         BAS   R14,UNMISRT        INSERT ENTRY                          02800000
                                                                        02810000
*--------------------------------------------------------------         02820000
*   ADVANCE TO NEXT USER ENTITY ENTRY                                   02830000
*--------------------------------------------------------------         02840000
NAMEADV  DS    0H                                                       02850000
         ICM   R5,15,ENEQFWD      ELSE ADVANCE TO NEXT ENENTITY         02860000
         BNZ   NAMENEXT           AND TRY AGAIN                         02870000
         BAS   R14,UNMPRNT        ENSURE LAST LINE IS WRITTEN           02880000
         DROP  R5                 ENENTITY                              02890000
         B     NAMEREL            RELEASE LOCK                          02900000
                                                                        02910000
NAMENONE DS    0H                                                       02920000
         MVI   MATCHFLG,8         NO USERS ACTIVE                       02930000
         $MSG  235                NO ACTIVE USERS                       02940000
                                                                        02950000
NAMEREL  DS    0H                                                       02960000
         $SER  RELEASE,DISP       RELEASE TASKS / PROCESS LOCK          02970000
         B     RESULT             COMPLETE                              02980000
                                                                        02990000
         EJECT ,                                                        03000000
***************************************************************         03010000
*                                                                       03020000
*   'UL ALL'   - DETAIL USERLIST DISPLAY                                03030000
*                                                                       03040000
***************************************************************         03050000
DETAIL   DS    0H                                                       03060000
         $SER  OBTAIN,DISP        ACQUIRE DISPATCHER LOCK               03070000
                                                                        03080000
*--------------------------------------------------------------         03090000
*   SCAN USER ENTITY ENTRIES                                            03100000
*--------------------------------------------------------------         03110000
         L     R5,ICTUSERE        USER ENTITY STRUCTURE ORIGIN          03120000
         USING ENTCNTL,R5         ADDRESSABILITY                        03130000
         ICM   R5,15,ENTQ         ADDRESS OF FIRST ENTITY ENTRY         03140000
         BZ    DETLNONE           NO ACTIVE USERS                       03150000
         USING ENENTRY,R5         ADDRESSABILITY                        03160000
                                                                        03170000
DETLNXT  DS    0H                                                       03180000
         MVC   CURRUSER,BLANKS    INITIALIZE CURRENT USER               03190000
         LH    R1,ENENTLN         LENGTH OF ENTITY NAME                 03200000
         BCTR  R1,0               PREPARE FOR EX                        03210000
         EX    R1,*+4             COPY USERID TO WORKAREA               03220000
         MVC   CURRUSER(*-*),ENENTITY  *** EX OBJECT **                 03230000
                                                                        03240000
         LA    R1,ENEUSER         ADDRESS OF ENTITY USERDATA            03250000
         BAS   R14,USERTEST       APPLY TASK FILTERS IF ANY             03260000
         BNZ   DETLADV            NO, SKIP ENTRY                        03270000
                                                                        03280000
         CLI   MATCHFLG,0         ANY ENTRIES SELECTED?                 03290000
         BNE   DETLGO             YES, CONTINUE WITH PRINT LINE         03300000
         $MSG  233                GENERATE HEADER                       03310000
                                                                        03320000
DETLGO   DS    0H                                                       03330000
         MVI   MATCHFLG,4         MATCHING USER IDENTIFIED              03340000
         LA    R1,ENEUSER         ADDRESS OF ENTITY USERDATA            03350000
         BAS   R14,DETLPRNT       PRINT DETAIL LINE                     03360000
                                                                        03370000
*--------------------------------------------------------------         03380000
*   ADVANCE TO NEXT USER ENTITY ENTRY                                   03390000
*--------------------------------------------------------------         03400000
DETLADV  DS    0H                                                       03410000
         ICM   R5,15,ENEQFWD      ELSE ADVANCE TO NEXT ENTITY           03420000
         BNZ   DETLNXT            AND TRY AGAIN                         03430000
         DROP  R5                 ENTITY                                03440000
         B     DETLREL            RELEASE DISP LOCK                     03450000
                                                                        03460000
DETLNONE DS    0H                                                       03470000
         MVI   MATCHFLG,8         NO USERS ACTIVE                       03480000
         $MSG  235                NO USER ARE CURRENTLY ACTIVE          03490000
                                                                        03500000
DETLREL  DS    0H                                                       03510000
         $SER  RELEASE,DISP       RELEASE TASKS / PROCESS LOCK          03520000
         B     RESULT             COMPLETE                              03530000
                                                                        03540000
         EJECT ,                                                        03550000
***************************************************************         03560000
*                                                                       03570000
*   DETERMINE WHETHER COMMAND SEARCH ARGS WERE SATISFIED                03580000
*                                                                       03590000
***************************************************************         03600000
RESULT   DS    0H                                                       03610000
         CLI   MATCHFLG,0         MATCHING ITASK FOUND?                 03620000
         BNE   NORMRET            SEARCH SATISFIED IF SO                03630000
                                                                        03640000
         TM    USERNAME,BF        USER OR MASKUSER SPECIFIED            03650000
         BNZ   *+10               YES, SKIP DEFAULT                     03660000
         MVC   USERNAME,=8C'*'    ASSUME ALL USERS                      03670000
                                                                        03680000
         TM    TASKNAME,BF        TASK OR MASKTASK SPECIFIED            03690000
         BNZ   *+10               YES, SKIP DEFAULT                     03700000
         MVC   TASKNAME,=8C'*'    ASSUME ALL TASKS                      03710000
                                                                        03720000
         $MSG  236,FIELDS=(USERNAME,TASKNAME) SEARCH FAILED             03730000
         B     NORMRET            DONE                                  03740000
                                                                        03750000
         EJECT ,                                                        03760000
***************************************************************         03770000
*                                                                       03780000
*   SUMMARY DISPLAY OF ACTIVE TASK AND PROCESS COUNTS                   03790000
*                                                                       03800000
***************************************************************         03810000
COUNTS   DS    0H                                                       03820000
         L     R5,ICTUSERE        ADDRESS OF USER ENTITY STRUCTURE      03830000
         USING ENTCNTL,R5         ADDRESSABILITY                        03840000
                                                                        03850000
         $MSG  230,FIELDS=(ENTRIES)                                     03860000
                                                                        03870000
         DROP  R5                 ENTCNTL                               03880000
                                                                        03890000
         EJECT ,                                                        03900000
***************************************************************         03910000
*                                                                       03920000
*   RETURN COMPLETION STATUS TO REQUESTOR                               03930000
*                                                                       03940000
***************************************************************         03950000
NORMRET  DS    0H                                                       03960000
         LA    R15,CCODE_NORESP   NO ADDITIONAL RESPONSE REQUIRED       03970000
         B     CMDRET                                                   03980000
                                                                        03990000
ERRSYNTX DS    0H                                                       04000000
         LA    R15,CCODE_SYNTAX   SYNTAX ERROR                          04010000
         B     CMDRET             DONE                                  04020000
                                                                        04030000
ERRAMBIG DS    0H                                                       04040000
         LA    R15,CCODE_AMBIG    AMBIGUOUS REQUEST                     04050000
         B     CMDRET             DONE                                  04060000
                                                                        04070000
ERRCNFLC DS    0H                                                       04080000
         LA    R15,CCODE_CONFLICT CONFLICTING OPERANDS                  04090000
         B     CMDRET             DONE                                  04100000
                                                                        04110000
ERREJECT DS    0H                                                       04120000
         LA    R15,CCODE_REJECT   COMMAND REJECTED                      04130000
         B     CMDRET             DONE                                  04140000
                                                                        04150000
CMDRET   DS    0H                                                       04160000
         ST    R15,CMRQCOMP       POST COMPLETION CODE PER CONVENTION   04170000
         #EXIT ,                                                        04180000
                                                                        04190000
         EJECT ,                                                        04200000
** UL NAMES ***************************************************         04210000
*                                                                       04220000
* ROUTINE: UNMISRT - ADD USER NAME TO COLLECTION ARRAY                  04230000
*                                                                       04240000
***************************************************************         04250000
UNMISRT  DS    0H                                                       04260000
         STM   R0,R15,REGSAVE                                           04270000
                                                                        04280000
UNMISRT1 DS    0H                                                       04290000
         L     R2,@UNMCURR        SLOT PTR                              04300000
         LA    R0,@UNMLEND        END OF COLLECTOR ARRAY                04310000
         CR    R2,R0              INFRINGEMENT?                         04320000
         BL    UNMISRT2           ACCEPT NEW ENTRY                      04330000
                                                                        04340000
         BAS   R14,UNMPRNT        DISPOSE OF CURRENT ENTRY              04350000
         BAS   R14,UNMINIT        PREPARE FOR NEW PASS                  04360000
         B     UNMISRT1           TRY AGAIN                             04370000
                                                                        04380000
UNMISRT2 DS    0H                                                       04390000
         MVC   0(L'CURRUSER,R2),CURRUSER   ADD CURRENT USER             04400000
         LA    R2,L'@UNMS1(,R2)   IDENTIFY SLOT FOR NEXT PASS           04410000
         ST    R2,@UNMCURR        POST                                  04420000
                                                                        04430000
         LM    R0,R14,REGSAVE     RESTORE REGS                          04440000
         BR    R14                RETURN                                04450000
                                                                        04460000
** UL NAMES ***************************************************         04470000
*                                                                       04480000
* ROUTINE: UNMPRNT - PRINT NAMES DISPLAY LINE                           04490000
*                                                                       04500000
***************************************************************         04510000
UNMPRNT  DS    0H                                                       04520000
         ST    R14,FWORD          PRESERVE RETURN ADDRESS               04530000
                                                                        04540000
         L     R1,@UNMCURR        NEXT AVAILABLE SLOT                   04550000
         LA    R0,@UNMLIST        END OF COLLECTOR ARRAY                04560000
         CR    R1,R0              ANY ENTRIES PRESENT?                  04570000
         BNHR  R14                DONE IF NOT                           04580000
                                                                        04590000
         $MSG  232,FIELDS=(@UNMS1,@UNMS2,@UNMS3,@UNMS4,@UNMS5,@UNMS6)   04600000
                                                                        04610000
         L     R14,FWORD          PRESERVE RETURN ADDRESS               04620000
         BR    R14                                                      04630000
                                                                        04640000
** UL NAMES ***************************************************         04650000
*                                                                       04660000
* ROUTINE: UNMINIT - INTIALIZE USER COLLECTION ARRAY                    04670000
*                                                                       04680000
***************************************************************         04690000
UNMINIT  DS    0H                                                       04700000
         LA    R0,@UNMLIST   LIST ORIGIN                                04710000
         ST    R0,@UNMCURR   FRESH LINE                                 04720000
                                                                        04730000
         MVI   @UNMLIST,C' ' CLEAR COLLECTION AREA                      04740000
         MVC   @UNMLIST+1(@UNMLN-1),@UNMLIST                            04750000
         BR    R14                                                      04760000
                                                                        04770000
         EJECT ,                                                        04780000
** UL ALL *****************************************************         04790000
*                                                                       04800000
* ROUTINE: DETLPRNT - PRINT USER DETAIL LINE                            04810000
*                                                                       04820000
***************************************************************         04830000
DETLPRNT DS    0H                                                       04840000
         STM   R0,R15,REGSAVE     PRESERVE REGISTERS                    04850000
         LR    R4,R1              ADDRESS OF USERDATA                   04860000
         USING USRENTUD,R4        ADDRESSABILITY                        04870000
                                                                        04880000
         L     R5,UUDITASK        ADDRESS OF ITASK                      04890000
T        USING ITASK,R5           ADDRESSABILITY                        04900000
         L     R6,UUDIUSER        ADDRESS OF IUSER                      04910000
U        USING IUSER,R6           ADDRESSABILITY                        04920000
                                                                        04930000
         CLI   U.USRTYPE,USRTY_RT RUNTIME USER?                         04940000
         BNE   *+10               NO, CONTINUE                          04950000
         MVC   USERTYPE,=C'RT'    SET RUNTIME USER                      04960000
                                                                        04970000
         CLI   U.USRTYPE,USRTY_WB WORKBENCH USER?                       04980000
         BNE   *+10               NO, CONTINUE                          04990000
         MVC   USERTYPE,=C'WB'    WORKBENCH USER                        05000000
                                                                        05010000
         CLI   U.USRTYPE,USRTY_OP OPERATOR USER?                        05020000
         BNE   *+10               NO, CONTINUE                          05030000
         MVC   USERTYPE,=C'HD'    HELPDESK OPERATOR USER                05040000
                                                                        05050000
         LA    R3,U.USRCLVER      ADDRESS OF CLIENT VERSION             05060000
         USING VERSION,R3         ADDRESSABILITY                        05070000
                                                                        05080000
         $MSG  234,FIELDS=(CURRUSER,T.TSKNAME,UUDUPROC,USERTYPE,       X05090000
               VERID,VERRLSE,VERMODLV,VERTYPE)                          05100000
                                                                        05110000
         LM    R0,R15,REGSAVE     RESTORE REGISTERS                     05120000
         BR    R14                                                      05130000
                                                                        05140000
         DROP  T,U,R3             ITASK, IUSER, VERSION                 05150000
                                                                        05160000
         EJECT                                                          05170000
***************************************************************         05180000
*                                                                       05190000
* ROUTINE: USERTEST - DETERMINE IF USER INCLUDED OR EXCLUDED            05200000
*                                                                       05210000
* DESCRIPTION:                                                          05220000
*                                                                       05230000
*    THIS ROUTINE DETERMINES WHETHER A USER(), MASKUSER(),              05240000
*    TASK() OR MASKTASK() OPERAND SPECIFICALLY EXCLUDES THE             05250000
*    CANDIDATE USER FROM THE REQUEST.                                   05260000
*                                                                       05270000
* ON ENTRY:                                                             05280000
*                                                                       05290000
*    R1 - ADDRESS OF USER ENTITY USERDATA                               05300000
*                                                                       05310000
* ON EXIT:                                                              05320000
*                                                                       05330000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                     05340000
*                                                                       05350000
*        R15 = RC00 - ENTRY SELECTED                                    05360000
*              RC04 - ENTRY NOT SELECTED                                05370000
*                                                                       05380000
***************************************************************         05390000
USERTEST DS    0H                                                       05400000
         STM   R0,R15,REGSAVE     PRESERVE MAINLINE REGS                05410000
         LR    R4,R1              USER ENTITY USERDATA                  05420000
         USING USRENTUD,R4        ADDRESSABILITY                        05430000
                                                                        05440000
*--------------------------------------------------------------         05450000
*  TEST FOR SELECTABLE ENTRY BY USER() OR MASKUSER() MATCH              05460000
*--------------------------------------------------------------         05470000
         TM    USERNAME,BF        USER NAME / PATTERN FILTER?           05480000
         BZ    UTTASK             NO USER FILTER REQUIRED               05490000
                                                                        05500000
         CLI   MIN1ID,UL_USER     SIMPLE USER NAME FILTER?              05510000
         BNE   UTUSRPAT           TRY NEXT OPTION IF NOT                05520000
         CLC   USERNAME,CURRUSER  COMPARE SELECTED USER                 05530000
         BE    UTTASK             MATCH, CONTINUE WITH TASK             05540000
         B     UTNOMAT            NO MATCH                              05550000
                                                                        05560000
*--------------------------------------------------------------         05570000
*   PATTERN MATCH REQUIRES USE OF A SERVICE ROUTINE                     05580000
*--------------------------------------------------------------         05590000
UTUSRPAT DS    0H                 USER PATTERN MATCH REQUEST            05600000
         CLI   MIN1ID,UL_MUSER    USER NAME PATTERN?                    05610000
         BNE   UTTASK             NO, CONTINUE WITH TASK                05620000
                                                                        05630000
         LA    R3,L'CURRUSER      LENGTH OF USERNAME                    05640000
         LA    R4,X'40'           SCAN_PATTERN                          05650000
                                                                        05660000
         $CLINK FUNC=PATMTCH,     MATCH PATTERN AGAINST CANDIDATE      X05670000
               (CHAR*,USERNAME),  NTS PATTERN                          X05680000
               (CHAR*,CURRUSER),                                       X05690000
               (REGISTER_INT,(R3)), LENGTH OF USERNAME                 X05700000
               (REGISTER_INT,(R4)), PATTERN MATCH REQUEST              X05710000
               (INT,ICTZERO),                                          X05720000
               (INT,ICTZERO)                                            05730000
                                                                        05740000
         LTR   R15,R15            PATMATCH USES FALSE AS NO MATCH       05750000
         BZ    UTNOMAT                                                  05760000
                                                                        05770000
*--------------------------------------------------------------         05780000
*  TEST FOR SELECTABLE ENTRY BY TASK() OR MASKTASK() MATCH              05790000
*--------------------------------------------------------------         05800000
UTTASK   DS    0H                                                       05810000
         TM    TASKNAME,BF        TASK NAME / PATTERN FILTER?           05820000
         BZ    UTMATCH            NO TASK FILTER REQUIRED               05830000
                                                                        05840000
         L     R5,UUDITASK        ADDRESS OF CANDIDATE ITASK            05850000
T        USING ITASK,R5           ADDRESSABILITY                        05860000
                                                                        05870000
         CLI   MIN2ID,UL_TASK     SIMPLE TASK NAME FILTER?              05880000
         BNE   UTTSKPAT           TRY NEXT OPTION IF NOT                05890000
         CLC   TASKNAME,T.TSKNAME COMPARE SELECTED TASK                 05900000
         BE    UTMATCH            MATCH                                 05910000
         B     UTNOMAT            NO MATCH                              05920000
                                                                        05930000
*--------------------------------------------------------------         05940000
*   PATTERN MATCH REQUIRES USE OF A SERVICE ROUTINE                     05950000
*--------------------------------------------------------------         05960000
UTTSKPAT DS    0H                 TASK PATTERN MATCH REQUEST            05970000
         CLI   MIN2ID,UL_MTASK    TASK NAME PATTERN?                    05980000
         BNE   UTMATCH            NO, ASSUME MATCH                      05990000
                                                                        06000000
         LA    R3,L'T.TSKNAME     LENGTH OF TASKNAME                    06010000
         LA    R4,X'40'           SCAN_PATTERN                          06020000
                                                                        06030000
         $CLINK FUNC=PATMTCH,     MATCH PATTERN AGAINST CANDIDATE      X06040000
               (CHAR*,TASKNAME),  NTS PATTERN                          X06050000
               (CHAR*,T.TSKNAME),                                      X06060000
               (REGISTER_INT,(R3)), LENGTH OF TASKNAME                 X06070000
               (REGISTER_INT,(R4)), PATTERN MATCH REQUEST              X06080000
               (INT,ICTZERO),                                          X06090000
               (INT,ICTZERO)                                            06100000
                                                                        06110000
         LTR   R15,R15            PATMATCH USES FALSE AS NO MATCH       06120000
         BZ    UTNOMAT                                                  06130000
                                                                        06140000
*--------------------------------------------------------------         06150000
*  SET APPROPRIATE RETURN CODE AND RETURN                               06160000
*--------------------------------------------------------------         06170000
UTMATCH  DS    0H                                                       06180000
         LA    R15,RC00           ENTRY SELECTED                        06190000
         B     UTEXIT             RETURN                                06200000
                                                                        06210000
UTNOMAT  DS    0H                                                       06220000
         LA    R15,RC04           ENTRY NOT SELECTED                    06230000
         B     UTEXIT             RETURN                                06240000
                                                                        06250000
UTEXIT   DS    0H                                                       06260000
         LM    R0,R14,REGSAVE     RESTORE CALLERS REGS                  06270000
         LTR   R15,R15                                                  06280000
         BR    R14                RETURN                                06290000
         DROP  R4,T               USRENTUD, T.ITASK                     06300000
                                                                        06310000
         EJECT ,                                                        06320000
***************************************************************         06330000
*                                                                       06340000
*   LOCAL READ/ONLY DATA AREAS, ETC.                                    06350000
*                                                                       06360000
***************************************************************         06370000
BLANKS   DC    CL16' '                                                  06380000
                                                                        06390000
         LTORG ,                                                        06400000
                                                                        06410000
         PRINT NOGEN                                                    06420000
         ICVT  ,                                                        06430000
         ITASK ,                                                        06440000
         IPCB  ,                                                        06450000
         IUSER ,                                                        06460000
         END   ,                                                        06470000
