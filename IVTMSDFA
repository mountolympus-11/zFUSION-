IVTMSDFA TITLE 'INTEGRATOR - ISESS DFASY PROCESSOR'                     00010000
**<DOC-ON>************************************************************* 00020000
*                                                                       00030000
* ROUTINE: IVTMSDFA - ISESS DFASY PROCESSOR                             00040000
*                                                                       00050000
* DESCRIPTION: THIS ROUTINE IS CALLED BY IVTMSESS TO PROCESS THE        00060000
*              DFASY WORK ELEMENT.                                      00070000
*                                                                       00080000
* ON ENTRY:                                                             00090000
*                                                                       00100000
*    R15 = ENTRY POINT ADDRESS                                          00110000
*    R14 = RETURN ADDRESS                                               00120000
*    R13 = AVAILABLE SAVE AREA                                          00130000
*    R11 = ICVT ADDRESS                                                 00140000
*    R10 = ITASK ADDRESS                                                00150000
*    R09 = IVTAMCVT ADDRESS                                             00160000
*    R08 = ISESS ADDRESS                                                00170000
*    R01 = ADDRESS OF DFASY WORK ELEMENT (IWEX0)                        00180000
*                                                                       00190000
* ON EXIT:                                                              00200000
*                                                                       00210000
*    R15 = 0                                                            00220000
*    R00 = 0                                                            00230000
*    R01 = 0                                                            00240000
*                                                                       00250000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00260000
*                                                                       00270000
**<DOC-OFF>************************************************************ 00280000
                                                                        00290000
         EJECT ,                                                        00300000
*********************************************************************** 00310000
*                                                                       00320000
* MAINTENANCE:                                                          00330000
*                                                                       00340000
*   08/01/93 RANDY WITEK                                                00350000
*                                                                       00360000
*********************************************************************** 00370000
                                                                        00380000
         EQUS  ,                  GENERAL EQUATES                       00390000
                                                                        00400000
RICVT    EQU   R11                                                      00410000
RITASK   EQU   R10                                                      00420000
RIVTAM   EQU   R9                                                       00430000
RISESS   EQU   R8                                                       00440000
RIACB    EQU   R7                                                       00450000
RIRPL    EQU   R6                                                       00460000
RIWE     EQU   R5                                                       00470000
RIRQE    EQU   R4                                                       00480000
                                                                        00490000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00500000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00510000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00520000
         USING ISESS,RISESS       ESTABLISH ADDRESSABILITY              00530000
         USING IACB,RIACB         ESTABLISH ADDRESSABILITY              00540000
         USING IRPL,RIRPL         ESTABLISH ADDRESSABILITY              00550000
         USING IWEVTAM,RIWE       ESTABLISH ADDRESSABILITY              00560000
         USING ISTDBIND,ISEBIND   ESTABLISH ADDRESSABILITY              00570000
         USING IRQE,RIRQE         ESTABLISH ADDRESSABILITY              00580000
                                                                        00590000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00600000
WRK256   DS    XL256              GENERAL WORKAREA                      00610000
RETR15   DS    F                                                        00620000
RETR0    DS    F                                                        00630000
RETR1    DS    F                                                        00640000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      00650000
WORKLEN  #ENDWORK                 END OF WORKAREA                       00660000
                                                                        00670000
         $MSGDFT PREFIX=ICTPID,                                        +00680000
               COMPID='VTM',                                           +00690000
               TABLE=*#MSGS,                                           +00700000
               WORKA=0,                                                +00710000
               MF=(E,WRK256),                                          +00720000
               PRINT=NOGEN                                              00730000
                                                                        00740000
IVTMSDFA #ENTER BASE=R12,         ENTRY LINKAGE                        +00750000
               PREG=RIWE,                                              +00760000
               AMODE=31,                                               +00770000
               RMODE=ANY                                                00780000
                                                                        00790000
         L     RIACB,IWEX0ACB       ASSOCIATED ACB                      00800000
         LA    RIRPL,IWEX0RPL       ADDRESS OF READ-ONLY RPL COPY       00810000
                                                                        00820000
*---------------------------------------------------------------------- 00830000
* VERIFY THE SESSION CID, IGNORE WORK ELEMENT IF NO MATCH               00840000
*---------------------------------------------------------------------- 00850000
                                                                        00860000
         CLC   ISECID,IWEX0CID      CID MATCH?                          00870000
         BNE   RETURN               BRANCH IF NOT                       00880000
                                                                        00890000
*---------------------------------------------------------------------- 00900000
* QUEUE DFASY DATA TO SESSION RECEIVE QUEUE & SATISFY $SESS RECEIVE     00910000
*---------------------------------------------------------------------- 00920000
                                                                        00930000
         $GETSTOR L'IRQ,                                               +00940000
               LOC=ANY,                                                +00950000
               OWNER=(RITASK)       ALLOCATE AN IRQE                    00960000
                                                                        00970000
         LR    RIRQE,R1             ESTABLISH ADDRESSIBILITY            00980000
         MVC   IRQID,=CL8'IRQE'     SET BLOCK ID                        00990000
         MVC   IRQRH(3),RPLURH      COPY REQUEST HEADER                 01000000
         MVC   IRQCNTRL(3),RPLCNTRL COPY CONTROL FLAGS                  01010000
         MVC   IRQSEQNO(2),RPLSEQNO COPY SEQUENCE NUMBER                01020000
         MVC   IRQSENSE(4),RPLFDBK2 COPY SENSE INFORMATION              01030000
         MVC   IRQSIGDA(4),RPLSIGDA COPY SIGNAL DATA                    01040000
                                                                        01050000
         L     R3,ISERCVTL          LAST IRQE ON THE QUEUE              01060000
         L     R2,IRQNEXT-IRQ(,R3)  NULL ELEMENT POINTER                01070000
         ST    RIRQE,IRQNEXT-IRQ(,R3) SET NEXT POINTER IN LAST IRQE     01080000
         ST    RIRQE,IRQPREV-IRQ(,R2) SET PREV POINTER IN ISERCVTL      01090000
         STM   R2,R3,IRQNEXT        LINK NEW ELEMENT NEXT/PREV          01100000
                                                                        01110000
         L     R15,IVT@SREC       RECEIVE MODULE                        01120000
         BASR  R14,R15            SATISFY THE RECEIVE REQUEST           01130000
                                                                        01140000
*---------------------------------------------------------------------- 01150000
* RETURN TO CALLER                                                      01160000
*---------------------------------------------------------------------- 01170000
                                                                        01180000
RETURN   DS    0H                                                       01190000
                                                                        01200000
         LM    R15,R1,RETREGS     LOAD RETURN VALUES                    01210000
                                                                        01220000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    01230000
                                                                        01240000
*---------------------------------------------------------------------- 01250000
*  CONSTANTS AND LITERALS                                               01260000
*---------------------------------------------------------------------- 01270000
                                                                        01280000
         LTORG ,                                                        01290000
         PRINT NOGEN                                                    01300000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                01310000
         ISTDBIND ,               VTAM BIND IMAGE                       01320000
         ICVT  ,                  INTEGRATOR CVT                        01330000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   01340000
         IRPL ,                   INTEGRATOR VTAM RPL+                  01350000
         IACB ,                   INTEGRATOR VTAM ACB+                  01360000
         INIB ,                   INTEGRATOR VTAM NIB+                  01370000
         ISESS ,                  INTEGRATOR SESSION BLOCK              01380000
         IRQE ,                   INTEGRATOR RECEIVE QUEUE ELEMENT      01390000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            01400000
         ITASK ,                  INTEGRATOR TASK BLOCK                 01410000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          01420000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       01430000
         EVCODES ,                INTEGRATOR EVENT CODES                01440000
         ABCODES ,                INTEGRATOR $ABEND CODES               01450000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     01460000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        01470000
         END   ,                                                        01480000
