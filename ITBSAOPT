ITBSAOPT TITLE 'TABLE SERVICES - SEARCH ARGUMENT OPTIMIZATION'          00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ITBSAOPT - Search argument optimization                      00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine promotes truth values found in the predicate          00080000
*    leaf nodes of the search argument tree up through the              00090000
*    the boolean connectors using the following commutitive             00100000
*    tautologies:                                                       00110000
*                                                                       00120000
*       1)  <TRUE>  OR  <any>   is TRUE                                 00130000
*       2)  <FALSE> OR  <FALSE> is FALSE                                00140000
*       3)  <TRUE>  AND <TRUE>  is TRUE                                 00150000
*       4)  <FALSE> AND <any>   is FALSE                                00160000
*                                                                       00170000
*                                                                       00180000
* ATTRIBUTES:  recursive, BAKR linkage                                  00190000
*                                                                       00200000
*                                                                       00210000
* ON ENTRY:                                                             00220000
*                                                                       00230000
*    R1  contains the address of a pspace resident parameter            00240000
*        list described by the @TBSAOPT mapping                         00250000
*                                                                       00260000
*                                                                       00270000
* ON EXIT:                                                              00280000
*                                                                       00290000
*    R15 contains one of the following return codes                     00300000
*                                                                       00310000
*        RC00 - optimization complete                                   00320000
*                                                                       00330000
*               R0 contains a code indicating whether or not            00340000
*                  the SARG is catagorically true, false, or            00350000
*                  undetermined as follows:                             00360000
*                                                                       00370000
*                  00 - truth value not determined                      00380000
*                  01 - SARG is categorically true                      00390000
*                  FF - SARG is categorically false                     00400000
*                                                                       00410000
*        RC04 - error encountered in the search argument                00420000
*                                                                       00430000
*               R1 contains the address of the invalid SARG             00440000
*                  node or subtree in error                             00450000
*                                                                       00460000
**<DOC-OFF>****************************************************         00470000
                                                                        00480000
         EJECT                                                          00490000
***************************************************************         00500000
*                                                                       00510000
* MAINTENANCE:                                                          00520000
*                                                                       00530000
*    06/15/95 R. Turgeon                                                00540000
*             Initial version                                           00550000
*                                                                       00560000
***************************************************************         00570000
                                                                        00580000
         EJECT                                                          00590000
         @TBSAOPT ,               ENTRANCE LIST                         00600000
                                                                        00610000
         EJECT                                                          00620000
         TBBNODES ,               SEARCH ARG, ETC.                      00630000
                                                                        00640000
         EJECT                                                          00650000
         EQUS  ,                                                        00660000
                                                                        00670000
         EJECT                                                          00680000
ITBSAOPT @ENTER ,                                                       00690000
                                                                        00700000
         EJECT                                                          00710000
***************************************************************         00720000
*                                                                       00730000
*   General initialization and request validation                       00740000
*                                                                       00750000
***************************************************************         00760000
                                                                        00770000
         LAM   R1,R7,=7A(0)       PRIMARY SPACE WINDOWS                 00780000
                                                                        00790000
         LR    R7,R1              ACQUIRE TBSARG ENTRANCE LIST          00800000
         USING TBSAOPT,R7         PLIST FORMAT                          00810000
                                                                        00820000
         L     R1,TBSASARG        SARG ORIGIN IN PSPACE                 00830000
         USING TBSARG1,R1         PREPARE FOR VALIDATIO                 00840000
         CLI   TBS1VER,TBS1SAV1   LEVEL 1 OR BETTER?                    00850000
         BL    ERR_SARG           SARG IN ERROR IF NOT                  00860000
         ICM   R0,15,TBS1NODE     SARG TREE ORIGIN                      00870000
         BZ    ERR_SARG           INVALID IF OMITTED                    00880000
                                                                        00890000
         LR    R1,R0              R1 <== ROOT OF SEARCH ARG TREE        00900000
         BAS   R14,OPTSARG        RETURN TRUTH VALUE                    00910000
         B     RETURN             COMPLETE                              00920000
                                                                        00930000
***************************************************************         00940000
*                                                                       00950000
*   Return completion status to caller                                  00960000
*                                                                       00970000
***************************************************************         00980000
                                                                        00990000
ERR_SARG DS    0H                 R1 <== INVALID SARG NODE              01000000
         LA    R15,RC04           INDICATE ERROR                        01010000
                                                                        01020000
RETURN   DS    0H                                                       01030000
                                                                        01040000
         @EXIT ,                                                        01050000
         DROP  R7                 TBSAOPT ENTRANCE LIST                 01060000
                                                                        01070000
         EJECT                                                          01080000
***************************************************************         01090000
*                                                                       01100000
* ROUTINE: OPTSARG - Recursive promotion of truth values                01110000
*                                                                       01120000
* ON ENTRY:                                                             01130000
*                                                                       01140000
*    R1 address of a level 1 SARG subtree                               01150000
*                                                                       01160000
* ON EXIT:                                                              01170000
*                                                                       01180000
*    R15 contains zero (no validations performed)                       01190000
*    R0  contains a truth value or zero if undetermined                 01200000
*                                                                       01210000
***************************************************************         01220000
                                                                        01230000
OPTSARG  DS    0H                                                       01240000
         SR    R15,R15            PRESUME SUCCESSFUL COMPLETION         01250000
         SR    R0,R0              TRUTH VALUE RETURN REG                01260000
                                                                        01270000
OPTSARG1 DS    0H                                                       01280000
         BAKR  R14,0              PRESERVE CALLERS ENVIRONMENT          01290000
         LR    R2,R1              CURRENT NODE                          01300000
                                                                        01310000
P        USING TBBPRED,R2         PREDICATE NODE                        01320000
C        USING TBCONN,R2          CONNECTOR NODE                        01330000
                                                                        01340000
***************************************************************         01350000
*                                                                       01360000
*   Predicate (leaf) node                                               01370000
*                                                                       01380000
***************************************************************         01390000
                                                                        01400000
         CLI   P.TBPRTYPE,TBCO$CON   CONNECTOR?                         01410000
         BE    OPTSCONN                                                 01420000
                                                                        01430000
         IC    R0,P.TBPRTV        TRUTH VALUE IF KNOWN (0,1,FF)         01440000
         PR    ,                  DONE                                  01450000
                                                                        01460000
***************************************************************         01470000
*                                                                       01480000
*   Boolean connector (AND,OR) node                                     01490000
*                                                                       01500000
***************************************************************         01510000
                                                                        01520000
OPTSCONN DS    0H                                                       01530000
         SR    R4,R4              # TRUE  SUBTREES (0-2)                01540000
         SR    R5,R5              # FALSE SUBTREES (0-2)                01550000
                                                                        01560000
         L     R1,C.TBCOLEFT      R1 <== LEFT SUBTREE                   01570000
         BAS   R14,OPTSARG1                                             01580000
         CH    R0,=AL2(TBCO$T)    CLASSIFY TRUTH VALUE RETURNED         01590000
         BNE   *+8                                                      01600000
         LA    R4,1(,R4)                                                01610000
         BNH   *+8                                                      01620000
         LA    R5,1(,R5)                                                01630000
                                                                        01640000
         L     R1,C.TBCORGHT      R1 <== RIGHT SUBTREE                  01650000
         BAS   R14,OPTSARG1                                             01660000
         CH    R0,=AL2(TBCO$T)    CLASSIFY TRUTH VALUE RETURNED         01670000
         BNE   *+8                                                      01680000
         LA    R4,1(,R4)                                                01690000
         BNH   *+8                                                      01700000
         LA    R5,1(,R5)                                                01710000
                                                                        01720000
*--------------------------------------------------------------         01730000
*   IDENTIFY TAUTOLOGIES                                                01740000
*--------------------------------------------------------------         01750000
                                                                        01760000
OPTSTAUT DS    0H                                                       01770000
         CH    R4,=H'2'           BOTH SUBTREES <TRUE>?                 01780000
         BNE   *+8                SKIP IF NOT                           01790000
         MVI   C.TBCOTV,TBCO$T    INDICATE RESULT ALWAYS <TRUE>         01800000
         CH    R5,=H'2'           BOTH SUBTRESS <FALSE>?                01810000
         BNE   *+8                SKIP IF NOT                           01820000
         MVI   C.TBCOTV,TBCO$F    INDICATE RESULT ALWAYS <FALSE>        01830000
                                                                        01840000
         CLI   C.TBCOCTYP,TBCO$AND   IDENTIFY CONNECTOR TYPE            01850000
         BE    OPTSCAND           ELSEWHERE FOR AND                     01860000
         LTR   R4,R4              OR CONNECTOR, ANY <TRUE>?             01870000
         BZ    *+8                SKIP IF NOT                           01880000
         MVI   C.TBCOTV,TBCO$T    INDICATE RESULT ALWAYS <TRUE>         01890000
         B     OPTSRET            DONE                                  01900000
                                                                        01910000
OPTSCAND DS    0H                 AND CONNECTOR                         01920000
         LTR   R5,R5              ANY <FALSE>?                          01930000
         BZ    *+8                SKIP IF NOT                           01940000
         MVI   C.TBCOTV,TBCO$F    INDICATE RESULT ALWAYS <FALSE>        01950000
                                                                        01960000
*--------------------------------------------------------------         01970000
*   RETURN TRUTH VALUE IF KNOWN                                         01980000
*--------------------------------------------------------------         01990000
                                                                        02000000
OPTSRET  DS    0H                                                       02010000
         IC    R0,C.TBCOTV        TRUTH VALUE IF KNOWN (0,1,FF)         02020000
         PR    ,                  DONE                                  02030000
         DROP  P,C                SEARCH ARG NODES                      02040000
                                                                        02050000
         EJECT                                                          02060000
***************************************************************         02070000
*                                                                       02080000
*   Local read-only data areas, etc.                                    02090000
*                                                                       02100000
***************************************************************         02110000
                                                                        02120000
         LTORG ,                                                        02130000
         END   ,                                                        02140000
