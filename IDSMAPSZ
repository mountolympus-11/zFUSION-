IDSMAPSZ TITLE 'DATASPACE SVCS - COMPUTE SIZE OF STORAGE MAP'           00010000
**<DOC-ON>*****************************************************         00020001
*                                                                       00030000
* ROUTINE:  IDSMAPSZ - COMPUTE SIZE OF STORAGE MAP                      00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THIS ROUTINE ACCEPTS THE SIZE OF A SPACE STORAGE AND THE           00080000
*    SIZE OF AN ALU AND RETURNS INFORMATION USED TO BUILD A             00090000
*    STORAGE MAP.  EACH SPACE MAP BYTE CONTAINS AN INTEGRAL             00100000
*    NUMBER OF ALU ENTRIES.  THE NUMBER OF ALU'S CONTAINED IN           00110000
*    THE SPACE IS ROUNDED DOWN TO A MULTIPLE OF THAT NUMBER,            00120000
*    ENSURING THAT THE STORAGE MAP WILL NOT CONTAIN PARTIAL             00130000
*    ENTRIES.                                                           00140000
*                                                                       00150000
*                                                                       00160000
* ON ENTRY:                                                             00170000
*                                                                       00180000
*    R1 POINTS TO AN OS/VS PARAMETER LIST CONTAINING                    00190000
*                                                                       00200000
*        +00 - SIZE OF SPACE IN BYTES                                   00210000
*        +04 - SIZE OF AN ALLOCATION UNIT (ALU)                         00220000
*                                                                       00230000
* ON EXIT:                                                              00240000
*                                                                       00250000
*    R15 - # USABLE ALU'S IN SPACE                                      00260000
*    R1  - # ALU'S REQUIRED BY STORAGE MAP                              00270000
*    R0  - # BYTES REQUIRED BY STORAGE MAP                              00280000
*                                                                       00290000
*                                                                       00300000
* AMODE:   ANY                                                          00310000
* RMODE:   ANY                                                          00320000
* ASCMODE: ANY                                                          00330000
*                                                                       00340000
**<DOC-OFF>****************************************************         00350001
                                                                        00360001
         EJECT                                                          00370001
         SPCEQUS ,                SPACE CONSTANTS                       00380001
                                                                        00390001
         EJECT                                                          00400001
         EQUS  ,                                                        00410001
                                                                        00420001
         EJECT                                                          00430001
IDSMAPSZ @ENTER ,                                                       00440000
                                                                        00450000
         LM    R3,R4,0(R1)        FETCH PASSED PARAMETERS               00460000
*                                 R3 <== SIZE OF SPACE                  00470000
*                                 R4 <== SIZE OF ALU                    00480000
                                                                        00490000
         SR    R8,R8              DOUBLEWORD VALUE FOR...               00500000
         LR    R9,R3              SPACE SIZE                            00510000
         DR    R8,R4              GET # ALU'S IN SPACE                  00520000
         SR    R8,R8              DROP REMAINDER                        00530000
         D     R8,=A(#MAP_ALUS_BYTE)                                    00540000
         LR    R0,R9              R0  <== # COMPLETE SPACE MAP BYTES    00550000
                                                                        00560000
         MH    R9,=AL2(#MAP_ALUS_BYTE)                                  00570000
         LR    R15,R9             R15 <== # USABLE ALU'S                00580000
                                                                        00590000
         LR    R9,R0              SPACE MAP BYTES                       00600000
         AR    R9,R4              ROUNDING BYTES UP TO ALU'S            00610000
         BCTR  R9,0                                                     00620000
         SR    R8,R8              PREPARE FOR DIVIDE                    00630000
         DR    R8,R4              # ALU'S REQUIRED FOR SPACE MAP        00640000
         LR    R1,R9              R1  <== # ALU'S                       00650000
                                                                        00660000
         @EXIT ,                                                        00670000
                                                                        00680000
*--------------------------------------------------------------         00690000
*   LOCAL READ ONLY DATA AREAS, ETC.                                    00700000
*--------------------------------------------------------------         00710000
         LTORG ,                                                        00720000
         END                                                            00730000
