IDSSPCCF TITLE 'DATASPACE SERVICES - POST/EXTRACT CONFIG DATA'          00010000
***************************************************************         00020000
*                                                                       00030000
*   READ / WRITE WORKING STORAGE AREA                                   00040000
*                                                                       00050000
***************************************************************         00060000
WORKAREA DSECT                                                          00070000
                                                                        00080001
         @WORK ,                  STANDARD WORKAREA                     00090001
                                                                        00100001
WORKLEN  EQU   *-WORKAREA         WORKAREA LENGTH                       00110000
                                                                        00120001
         EJECT ,                                                        00130000
         SPCBLOCK ,                                                     00140000
                                                                        00150001
         EJECT ,                                                        00160000
         OIE  ,                                                         00170000
                                                                        00180001
         EJECT ,                                                        00190000
         $TOKEN ,                                                       00200000
                                                                        00210001
         EJECT ,                                                        00220000
         SPCEQUS ,                                                      00230000
                                                                        00240001
         EJECT ,                                                        00250000
         EQUS  LINKAGE=VCON                                             00260000
                                                                        00270001
         EJECT ,                                                        00280000
**<DOC-ON>*****************************************************         00290001
*                                                                       00300000
* ROUTINE: IDSSPCCF - SPACE POST/EXTRACT CONFIG DATA                    00310000
*                                                                       00320000
* DESCRIPTION:                                                          00330000
*                                                                       00340000
*    $SPACE SERVICES FORMALIZE THE ASSOCIATION OF "USERDATA"            00350000
*    WITH A PARTICULAR SPACE BY PROVIDING AN API FOR UPDATING           00360000
*    AND RETRIEVING "CONFIGURATION WORDS" THAT RESIDE IN THE            00370000
*    SPACE PREFIX. THE CONFIGURATION WORDS ARE IMPORTABLE AND           00380000
*    EXPORTABLE.                                                        00390000
*                                                                       00400000
*                                                                       00410000
* ON ENTRY:                                                             00420000
*                                                                       00430000
*    R1 POINTS TO AN OS/VS PARAMETER LIST CONTAINING                    00440000
*                                                                       00450000
*        +00 - ADDR OF THE $SPACE OR $OBJECT TOKEN                      00460000
*        +04 - FUNCTION CODE:  0-POST, 4-EXTRACT                        00470000
*        +08 - SPACE CONFIGURATION WORD ID (1-N)                        00480000
*        +12 - PRIMARY ADDR OF CONFIGURATION DATA WORD                  00490000
*                                                                       00500000
*    A/R10 - ADDRESS OF THE STORAGE SPACE BLOCK (SPCBLOCK)              00510000
*                                                                       00520000
*                                                                       00530000
* ON EXIT:                                                              00540000
*                                                                       00550000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                     00560000
*                                                                       00570000
*         RC00 - OPERATION COMPLETE                                     00580000
*         RC16 - INVALID REQUEST                                        00590000
*                                                                       00600000
**<DOC-OFF>****************************************************         00610001
                                                                        00620001
         EJECT ,                                                        00630000
IDSSPCCF @ENTER WORKA=(WORKAREA,WORKLEN)                                00640000
                                                                        00650000
         LAM   AR1,AR7,MFE_LIST   PRIMARY SPACE WINDOWS                 00660000
                                                                        00670000
         LM    R8,R9,0(R1)        FETCH PASSED PARAMETERS               00680000
*                                 R8 <== ADDR OF $SPACE TOKEN           00690000
*                                 R9 <== FUNCTION CODE                  00700000
                                                                        00710000
         LM    R6,R7,8(R1)        FETCH REMAINING PARAMETERS            00720000
*                                 R6 <== SPACE CONFIG WORD NUMBER       00730000
*                                 R7 <== PSPACE ADDR OF CONFIG DATA     00740000
                                                                        00750000
*--------------------------------------------------------------         00760000
*   VALIDATE OBJECT SPACE DESIGNATION                                   00770000
*--------------------------------------------------------------         00780000
         LAE   R8,0(R8,0)         RESIDES IN PRIMARY                    00790000
         USING $TOKEN,R8          ADDRESSABILITY                        00800000
         CLC   $TOKTAG,=CL8'OBJTOKEN'                                   00810000
         BE    VALIDTOK                                                 00820000
         CLC   $TOKTAG,=CL8'SPCTOKEN'                                   00830000
         BNE   ERR_REQ                                                  00840000
                                                                        00850000
VALIDTOK DS    0H                                                       00860000
         L     R10,$SPCBASE       ESTABLISH SPACE ACCESS WINDOW         00870000
         USING SPCBLOCK,R10                                             00880000
         LAM   R10,R10,$ALET                                            00890000
                                                                        00900000
*--------------------------------------------------------------         00910000
*   CONVERT CONFIGURATION WORD NUMBER TO ADDRESS AND VALIDATE           00920000
*--------------------------------------------------------------         00930000
         LTR   R6,R6              WORK NUMBER IN RANGE                  00940000
         BNP   ERR_REQ            REJECT OUT OF HAND                    00950000
         BCTR  R6,0               CONVERT TO ZERO-RELATIVE INDEX        00960000
         SLL   R6,2               FULLWORD INDEX                        00970000
         CL    R6,=A(SPC_APPLDATALN)   VALID CONFIG WORD?               00980000
         BNL   ERR_REQ                 FAIL IF SO                       00990000
         LAE   R11,SPC_APPLDATA(R6)    ADDRESS CONFIG WORD IN SPACE     01000000
                                                                        01010000
*--------------------------------------------------------------         01020000
*   REPLACE CONFIG WORD IF POST, RETURN TO PSPACE IF EXTRACT            01030000
*--------------------------------------------------------------         01040000
         LTR   R9,R9              POST REQUEST?                         01050000
         BNZ   EXTR               SKIP IF NOT                           01060000
         MVC   0(4,R11),0(R7)     INSTALL CONFIG WORD                   01070000
         B     NORMRET                                                  01080000
                                                                        01090000
EXTR     DS    0H                                                       01100000
         MVC   0(4,R7),0(R11)     EXTRACT CONFIG WORD                   01110000
                                                                        01120000
*--------------------------------------------------------------         01130000
*   RETURN COMPLETION STATUS TO CALLER                                  01140000
*--------------------------------------------------------------         01150000
NORMRET  DS    0H                                                       01160000
         LA    R15,RC00           NORMAL COMPLETION                     01170000
         B     RET                                                      01180000
                                                                        01190000
ERR_REQ  DS    0H                 INVALID REQUEST                       01200000
         LA    R15,RC16           PER CONVENTION                        01210000
                                                                        01220000
*--------------------------------------------------------------         01230000
*   RELEASE SPACE, RETURN COMPLETION STATUS TO CALLER                   01240000
*--------------------------------------------------------------         01250000
RET      DS    0H                 RETURN TO CALLER                      01260000
         @EXIT ,                                                        01270000
                                                                        01280000
         EJECT ,                                                        01290000
***************************************************************         01300000
*                                                                       01310000
*   READ ONLY CONSTANTS, ETC.                                           01320000
*                                                                       01330000
***************************************************************         01340000
         LTORG ,                                                        01350000
         END   ,                                                        01360000
