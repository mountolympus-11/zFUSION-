ITIUPDEL TITLE 'TIUPDT - DELETE ROW REQUEST'                            00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ITIUPDEL - TIUPDT - DELETE ROW REQUEST                       00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THIS ROUTINE RECEIVES CONTROL TO DELETE THE ROW AT                 00080000
*    CURRENT POSITION IDENTIFIED BY THE PASSED TABLE TOKEN              00090000
*    FOR THE TABLE CURRENTLY BEING PROCESSED BY THE TIUPDT              00100000
*    SERVICE ROUTINE.                                                   00110000
*                                                                       00120000
* ON ENTRY:                                                             00130000
*                                                                       00140000
*    R1  POINTS TO A STANDARD OS PARAMETER LIST                         00150000
*                                                                       00160000
*         0 - ADDR OF ROW BUFFER                                        00170000
*         4 - ADDR OF TABLE REQUEST (TIUPREQ)                           00180000
*         8 - ADDR OF TABLE DESC    (TBFMT)                             00190000
*        12 - ADDR OF TABLE TOKEN                                       00200000
*        16 - ADDR OF MSG WORK AREA                                     00210000
*                                                                       00220000
* ON EXIT:                                                              00230000
*                                                                       00240000
*        R15 =  0 - REQUEST COMPLETED SUCCESSFULLY                      00250000
*              >0 - REQUEST FAILED                                      00260000
*                                                                       00270000
*               R15-R1 PRESERVED FROM TABLE SERVICE REQUEST             00280000
*                                                                       00290000
**<DOC-OFF>****************************************************         00300000
                                                                        00310000
         EJECT ,                                                        00320000
***************************************************************         00330000
*                                                                       00340000
* MAINTENANCE:                                                          00350000
*                                                                       00360000
*   01/XX/93  RON COLMONE                                               00370000
*             INITIAL VERSION                                           00380000
*                                                                       00390000
*   08/05/93  RON COLMONE                                               00400000
*             CONVERTED TO NEW ENVIRONMENT                              00410000
*                                                                       00420000
***************************************************************         00430000
                                                                        00440000
         EJECT ,                                                        00450000
         @TIUPDT ,                REQUEST BLOCK FORMAT                  00460000
         EJECT ,                                                        00470000
         TBSERVIS DELETE                                                00480000
         EJECT ,                                                        00490000
         EQUS  ,                  GENERAL EQUATES                       00500000
                                                                        00510000
         EJECT ,                                                        00520000
         #WORK LENGTH=256         READ / WRITE WORKAREA                 00530000
ROWBUFR  DS    A                  ADDR OF ROW BUFFER                    00540000
TFORMAT  DS    A                  ADDR OF TABLE FORMAT                  00550000
TTOKEN@  DS    A                  ADDR OF TABLE TOKEN                   00560000
MSGBUF@  DS    A                  ADDR OF MESSAGE BUFFER                00570000
                                                                        00580000
ERRINFO  DS    0F                 TABLE SERVICE ERROR INFO              00590000
ERR_R15  DS    F                                                        00600000
ERR_R0   DS    F                                                        00610000
ERR_R1   DS    F                                                        00620000
         #ENDWORK ,               END OF WORKAREA                       00630000
                                                                        00640000
         EJECT ,                                                        00650000
ITIUPDEL #ENTER BASE=R12,WAPASS=YES,PREG=R8                             00660000
                                                                        00670000
         USING ITASK,R10          ITASK ADDRESSABILITY                  00680000
         L     R9,TSKPCBC         ADDR OF CURRENT PCB                   00690000
         USING IPCB,R9            IPCB  ADDRESSABILITY                  00700000
                                                                        00710000
*-------------------------------------------------------------          00720000
                                                                        00730000
         L     R7,PCBUSER         ADDRESS OF IUSER BLOCK                00740000
         USING IUSER,R7           TEMP ADDRESSABILITY                   00750000
         L     R7,USRPROJ         ADDRESS OF IPROJ                      00760000
         USING IPROJ,R7           LIFE OF FUNCTION                      00770000
                                                                        00780000
         LM    R2,R6,0(R8)        GET PASSED PARMS                      00790000
         ST    R2,ROWBUFR         ADDR OF ROW BUFFER                    00800000
         ST    R4,TFORMAT         ADDR OF TABLE FORMAT                  00810000
         ST    R5,TTOKEN@         ADDR OF TABLE TOKEN                   00820000
         ST    R6,MSGBUF@         ADDR OF MESSAGE BUFFER                00830000
                                                                        00840000
         LR    R8,R3              ADDR OF REQUEST BLOCK                 00850000
         USING TIUPREQ,R8         ESTABLISH ADDRESSABILITY              00860000
                                                                        00870000
         EJECT ,                                                        00880000
**************************************************************          00890000
*                                                                       00900000
*   DELETE CURRENT TABLE ROW                                            00910000
*                                                                       00920000
**************************************************************          00930000
                                                                        00940000
         TBDELETE TTOKEN=*TTOKEN@,                                     +00950000
               POS=CURRENT,                                            +00960000
               MF=(E,MFE_LIST)                                          00970000
                                                                        00980000
         LTR   R15,R15            DELETE SUCCESSFUL?                    00990000
         BNZ   ETBSRV             NO, ISSUE ERROR MESSAGE               01000000
                                                                        01010000
         EJECT ,                                                        01020000
**************************************************************          01030000
*                                                                       01040000
*   POST UPDATE STATUS TO IPROJ                                         01050000
*                                                                       01060000
**************************************************************          01070000
                                                                        01080000
         @CALL IMNTCTLG,(TIUPRNAM),  UPDATE MAINTENANCE  FLAG          +01090000
               CTYPE=CVT,MF=(E,MFE_LIST)                                01100000
                                                                        01110000
         LA    R15,RC00           SET  RETURN CODE                      01120000
         ST    R15,ERRINFO        SAVE RETURN CODE                      01130000
         B     EXIT               RETURN                                01140000
                                                                        01150000
         EJECT ,                                                        01160000
***************************************************************         01170000
*                                                                       01180000
*  TABLE SERVICE ERROR                                                  01190000
*                                                                       01200000
***************************************************************         01210000
ETBSRV   DS    0H                                                       01220000
         STM   R15,R1,ERRINFO     SAVE TBSERV ERROR INFO                01230000
         L     R3,MSGBUF@         ADDR OF MESSAGE BUFFER                01240000
         LA    R3,2(,R3)          PAST MESSAGE LENGTH                   01250000
         LA    R2,L'DELMSG        LENGTH OF DELETE MESSAGE              01260000
         BCTR  R2,0               PREPARE FOR EX                        01270000
         EX    R2,*+4             MOVE DEL FAILED MESSAGE TO BFR        01280000
         MVC   0(*-*,R3),DELMSG   *** EX OBJECT ***                     01290000
         LA    R3,1(R2,R3)        MSG ADDR OF TABLE NAME                01300000
         MVC   0(L'TIUPRNAM,R3),TIUPRNAM                                01310000
                                                                        01320000
         L     R3,MSGBUF@         ADDR OF MESSAGE BUFFER                01330000
         LA    R2,L'TIUPRNAM+1(,R2)   TOTAL MESSAGE LENGTH              01340000
         STH   R2,0(R3)           SET LENGTH OF MESSAGE                 01350000
                                                                        01360000
         EJECT ,                                                        01370000
***************************************************************         01380000
*                                                                       01390000
*  RETURN TO CALLER                                                     01400000
*                                                                       01410000
***************************************************************         01420000
                                                                        01430000
EXIT     DS    0H                                                       01440000
         #EXIT ,                  RETURN                                01450000
         DROP  R8                 TIUPREQ                               01460000
                                                                        01470000
         EJECT ,                                                        01480000
***************************************************************         01490000
*                                                                       01500000
*  MESSAGES, CONSTANTS AND LITERALS                                     01510000
*                                                                       01520000
***************************************************************         01530000
                                                                        01540000
DELMSG   DC    C'TBDELETE REQUEST FAILED FOR TABLE: '                   01550000
                                                                        01560000
         LTORG ,                                                        01570000
                                                                        01580000
         PRINT NOGEN                                                    01590000
         ICVT  ,                                                        01600000
         ITASK ,                                                        01610000
         IPCB  ,                                                        01620000
         IUSER ,                                                        01630000
         IPROJ ,                                                        01640000
         PRINT GEN                                                      01650000
                                                                        01660000
         END   ,                                                        01670000
