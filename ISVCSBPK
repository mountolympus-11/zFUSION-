                                                                        00010000
ISVCSBPK TITLE 'INTEGRATOR SERVICE ROUTINE: SBUF PACK'                  00020000
                                                                        00030000
**<DOC-ON>************************************************************* 00040000
*                                                                       00050000
* ROUTINE: ISVCSBPK - INTEGRATOR SERVICE ROUTINE: SBUF PACK             00060000
*                                                                       00070000
* DESCRIPTION:                                                          00080000
*                                                                       00090000
* ON ENTRY:                                                             00100000
*                                                                       00110000
*    R15 = ENTRY POINT ADDRESS                                          00120000
*    R14 = RETURN ADDRESS                                               00130000
*    R13 = AVAILABLE SAVE AREA                                          00140000
*    R11 = ICVT ADDRESS                                                 00150000
*    R10 = ITASK ADDRESS                                                00160000
*    R01 = SBFLIST ADDRESS                                              00170000
*                                                                       00180000
* ON EXIT:                                                              00190000
*                                                                       00200000
*    R15 = 0 --> BUFFER OBTAIN OR RELEASED                              00210000
*          4 --> DATA WILL NOT FIT, NO DATA COPIED                      00220000
*    R00 = 0                                                            00230000
*    R01 = SBFLIST ADDRESS                                              00240000
*                                                                       00250000
*    ALL OTHER REGISTERS ARE RESTORED                                   00260000
*                                                                       00270000
**<DOC-OFF>************************************************************ 00280000
         EJECT ,                                                        00290000
*********************************************************************** 00300000
*                                                                       00310000
* MAINTENANCE:                                                          00320000
*                                                                       00330000
*   10/01/93 RANDY WITEK                                                00340000
*                                                                       00350000
*********************************************************************** 00360000
         EQUS  ,                  GENERAL EQUATES                       00370000
RICVT    EQU   R11                                                      00380000
RITASK   EQU   R10                                                      00390000
RIVTAM   EQU   R9                                                       00400000
RSBFLIST EQU   R8                                                       00410000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00420000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00430000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00440000
         USING SBFLIST,RSBFLIST   ESTABLISH ADDRESSABILITY              00450000
                                                                        00460000
ISVCSBPK #ENTER BASE=R12,         R12 IS BASE REGISTER                 +00470000
               AMODE=31,                                               +00480000
               RMODE=ANY,                                              +00490000
               PREG=RSBFLIST,     R1 --> RSBFLIST                      +00500000
               RESTENV=NO,        ICVT AND ITASK POINTERS ARE OK       +00510000
               SAVE=NO,           DON'T ALLOCATE A SAVE AREA           +00520000
               WAPASS=NO,         NO WORK AREA PASSED IN R0            +00530000
               LINKAGE=STD        CALLED BY BAS/BASR                    00540000
                                                                        00550000
         LR    R1,RSBFLIST        RETURN LIST ADDRESS IN R1             00560000
         SR    R15,R15            SET RETURN CODE 0                     00570000
         SR    R0,R0              CLEAR R0                              00580000
                                                                        00590000
*---------------------------------------------------------------------- 00600000
* COPY DATA TO BUFFER                                                   00610000
*---------------------------------------------------------------------- 00620000
                                                                        00630000
         ICM   R3,15,SBFAREAL     DATA LENGTH                           00640000
         BNP   RETURN             BRANCH IF NO DATA                     00650000
         LR    R6,R3              COPY LENGTH                           00660000
         A     R6,SBFBUFO         LENGTH OF CURRENT CONTENTS            00670000
         C     R6,SBFBUFL         WILL IT FIT IN THE CURRENT BUFFER     00680000
         BH    BADCOPY            BRANCH IF NOT                         00690000
         L     R2,SBFBUFA         BUFFER ADDRESS                        00700000
         A     R2,SBFBUFO         ADDRESS WHERE NEW DATA GOES           00710000
         L     R4,SBFAREA         ADDRESS OF NEW DATA                   00720000
         LR    R5,R3              LENGTH OF NEW DATA                    00730000
         MVCL  R2,R4              COPY DATA TO BUFFER                   00740000
         ST    R6,SBFBUFO         UPDATE LENGTH OF CURRENT CONTENTS     00750000
         B     RETURN             AND RETURN                            00760000
                                                                        00770000
*---------------------------------------------------------------------- 00780000
* ERROR ROUTINES                                                        00790000
*---------------------------------------------------------------------- 00800000
                                                                        00810000
BADCOPY  DS    0H                                                       00820000
                                                                        00830000
         LA    R15,4              RC=4 --> TOO SMALL, DATA NOT COPIED   00840000
                                                                        00850000
*---------------------------------------------------------------------- 00860000
* RETURN TO CALLER                                                      00870000
*---------------------------------------------------------------------- 00880000
                                                                        00890000
RETURN   DS    0H                                                       00900000
                                                                        00910000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    00920000
                                                                        00930000
         LTORG ,                                                        00940000
         PRINT NOGEN                                                    00950000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                00960000
         ICVT  ,                  INTEGRATOR CVT                        00970000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   00980000
         ITASK ,                  INTEGRATOR TASK BLOCK                 00990000
         SBUF  DSECT=YES          INTEGRATOR SBUF SERVICES              01000000
         END   ,                                                        01010000
