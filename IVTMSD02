IVTMSD02 TITLE 'INTEGRATOR - DRIVER 3270 INITIALIZATION'                00010000
**<DOC-ON>************************************************************* 00020000
*                                                                       00030000
* ROUTINE: IVTMSD02 - DRIVER 3270 INITIALIZATION                        00040000
*                                                                       00050000
* DESCRIPTION: THE 3270 INITIALIZATION SET THE SCREEN SIZES FOR THE     00060000
*              SESSION AND COLLECT QUERY REPLIES FROM SLU DEVICES       00070000
*              (IF THE DEVICE IS QUERIABLE).                            00080000
*                                                                       00090000
* ON ENTRY:                                                             00100000
*                                                                       00110000
*    R15 = ENTRY POINT ADDRESS                                          00120000
*    R14 = RETURN      ADDRESS                                          00130000
*    R13 = SAVE AREA   ADDRESS                                          00140000
*    R11 = ICVT        ADDRESS                                          00150000
*    R10 = ITASK       ADDRESS                                          00160000
*    R09 = IVTAMCVT    ADDRESS                                          00170000
*    R08 = ISESS       ADDRESS                                          00180000
*                                                                       00190000
* ON EXIT:                                                              00200000
*                                                                       00210000
*    R15 = 0                                                            00220000
*    R00 = 0                                                            00230000
*    R01 = 0                                                            00240000
*                                                                       00250000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00260000
*                                                                       00270000
**<DOC-OFF>************************************************************ 00280000
                                                                        00290000
         EJECT ,                                                        00300000
*********************************************************************** 00310000
*                                                                       00320000
* MAINTENANCE:                                                          00330000
*                                                                       00340000
*   08/01/93 RANDY WITEK                                                00350000
*                                                                       00360000
*********************************************************************** 00370000
                                                                        00380000
         EQUS  ,                  GENERAL EQUATES                       00390000
                                                                        00400000
RICVT    EQU   R11                                                      00410000
RITASK   EQU   R10                                                      00420000
RIVTAM   EQU   R9                                                       00430000
RISESS   EQU   R8                                                       00440000
RSPLIST  EQU   R7                                                       00450000
                                                                        00460000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00470000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00480000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00490000
         USING ISESS,RISESS       ESTABLISH ADDRESSABILITY              00500000
         USING SPLIST,RSPLIST     ESTABLISH ADDRESSABILITY              00510000
         USING ISTDBIND,ISEBIND   ESTABLISH ADDRESSABILITY              00520000
                                                                        00530000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00540000
WRK256   DS    XL256              GENERAL WORKAREA                      00550000
                                                                        00560000
SUB0SAVE DS    18F                SUBROUTINE SAVE AREA                  00570000
                                                                        00580000
$SESSMFL $SESS MF=L,FIELDS=((,,,,)) $SESS PLIST CONSTRUCTION            00590000
                                                                        00600000
$TASKMFL $TASK MF=L               $TASK PLIST CONSTRUCTION              00610000
                                                                        00620000
RETR15   DS    F                                                        00630000
RETR0    DS    F                                                        00640000
RETR1    DS    F                                                        00650000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      00660000
                                                                        00670000
FLAGS    DS    X                  FLAG BYTE                             00680000
                                                                        00690000
TEMPDROW DS    X                  SCREEN SIZE ROWS    DEFAULT           00700000
TEMPDCOL DS    X                  SCREEN SIZE COLUMNS DEFAULT           00710000
TEMPAROW DS    X                  SCREEN SIZE ROWS    ALTERNATE         00720000
TEMPACOL DS    X                  SCREEN SIZE COLUMNS ALTERNATE         00730000
                                                                        00740000
WORKLEN  #ENDWORK                 END OF WORKAREA                       00750000
                                                                        00760000
         $MSGDFT PREFIX=ICTPID,                                        +00770000
               COMPID='VTM',                                           +00780000
               TABLE=*#MSGS,                                           +00790000
               WORKA=0,                                                +00800000
               MF=(E,WRK256),                                          +00810000
               PRINT=NOGEN                                              00820000
                                                                        00830000
IVTMSD02 #ENTER BASE=R12,         ENTRY LINKAGE                        +00840000
               AMODE=31,                                               +00850000
               RMODE=ANY                                                00860000
                                                                        00870000
*---------------------------------------------------------------------- 00880000
* CORRECT THE RU SUPPORT VECTORS FOR THE 3270 LU2 IMPLEMENTATION        00890000
*---------------------------------------------------------------------- 00900000
                                                                        00910000
         TM    ISEF2,ISEF2SLU        IS INTEGRATOR THE SLU PARTNER?     00920000
         BO    LU2SLURU              BRANCH IF YES                      00930000
         NI    ISERR2,255-ISER2RQS   LU2 PLU WILL NOT RECEIVE RSHUTD    00940000
         NI    ISERR3,255-ISER3RTR   LU2 PLU WILL NOT RECEIVE RTR       00950000
         B     LU2RUEND              DONE                               00960000
                                                                        00970000
LU2SLURU DS    0H                                                       00980000
                                                                        00990000
         NI    ISER2,255-ISER2RQS    LU2 SLU WILL NOT SEND RSHUTD       01000000
         NI    ISER3,255-ISER3RTR    LU2 SLU WILL NOT SEND RTR          01010000
         B     LU2RUEND              DONE                               01020000
                                                                        01030000
LU2RUEND DS    0H                                                       01040000
                                                                        01050000
*---------------------------------------------------------------------- 01060000
* DETERMINE SCREEN SIZES FOR THE SESSION                                01070000
*---------------------------------------------------------------------- 01080000
                                                                        01090000
         MVI   TEMPDROW,24        ASSUME MODEL 2 DEFAULT                01100000
         MVI   TEMPDCOL,80        ASSUME MODEL 2 DEFAULT                01110000
         MVI   TEMPAROW,24        ASSUME MODEL 2 ALTERNATE              01120000
         MVI   TEMPACOL,80        ASSUME MODEL 2 ALTERNATE              01130000
                                                                        01140000
         CLI   BINPRESZ,BINPSZ2   MODEL 2?                              01150000
         BE    SIZEDONE           BRANCH IF YES, MODEL 2 IS CORRECT     01160000
                                                                        01170000
         CLI   BINPRESZ,BINPSZ1   MODEL 1?                              01180000
         BNE   SIZEX7E            BRANCH IF NOT                         01190000
         MVI   TEMPDROW,12        MODEL 1 DEFAULT                       01200000
         MVI   TEMPDCOL,40        MODEL 1 DEFAULT                       01210000
         MVI   TEMPAROW,12        MODEL 1 ALTERNATE                     01220000
         MVI   TEMPACOL,40        MODEL 1 ALTERNATE                     01230000
         B     SIZEDONE           BRANCH TO COMPLETE                    01240000
                                                                        01250000
SIZEX7E  DS    0H                                                       01260000
                                                                        01270000
         CLI   BINPRESZ,BINPSFX     FIXED SIZE DEFINED BY DEFAULT ?     01280000
         BNE   SIZEX7F              BRANCH IF NOT                       01290000
         MVC   TEMPDROW(1),BINSPRIR BIND DEFAULT ROWS                   01300000
         MVC   TEMPDCOL(1),BINSPRIC BIND DEFAULT COLUMNS                01310000
         MVC   TEMPAROW(1),BINSPRIR BIND DEFAULT ROWS                   01320000
         MVC   TEMPACOL(1),BINSPRIC BIND DEFAULT COLUMNS                01330000
         B     SIZEDONE             BRANCH TO COMPLETE                  01340000
                                                                        01350000
SIZEX7F  DS    0H                                                       01360000
                                                                        01370000
         CLI   BINPRESZ,BINPSZRC    FIXED SIZE DEFINED BY DEFAULT ?     01380000
         BNE   SIZEDONE             BRANCH IF NOT, USE DEFAULT FOR NOW  01390000
         MVC   TEMPDROW(1),BINSPRIR BIND DEFAULT ROWS                   01400000
         MVC   TEMPDCOL(1),BINSPRIC BIND DEFAULT COLUMNS                01410000
         MVC   TEMPAROW(1),BINSALTR BIND ALTERNATE ROWS                 01420000
         MVC   TEMPACOL(1),BINSALTC BIND ALTERNATE COLUMNS              01430000
         B     SIZEDONE             BRANCH TO COMPLETE                  01440000
                                                                        01450000
SIZEDONE DS    0H                                                       01460000
                                                                        01470000
         SR    R1,R1              CLEAR                                 01480000
         SR    R2,R2              CLEAR                                 01490000
         IC    R1,TEMPDROW        DEFAULT ROWS                          01500000
         STC   R1,ISEDROW+1       SET DEFAULT ROWS                      01510000
         IC    R2,TEMPDCOL        DEFAULT COLUMNS                       01520000
         STC   R2,ISEDCOL+1       SET DEFAULT COLUMNS                   01530000
         MR    R0,R2              DEFAULT SCREEN SIZE                   01540000
         ST    R1,ISEDSIZE        SET DEFAULT SCREEN SIZE               01550000
                                                                        01560000
         SR    R1,R1              CLEAR                                 01570000
         SR    R2,R2              CLEAR                                 01580000
         IC    R1,TEMPAROW        ALTERNATE ROWS                        01590000
         STC   R1,ISEAROW+1       SET ALTERNATE ROWS                    01600000
         IC    R2,TEMPACOL        ALTERNATE COLUMNS                     01610000
         STC   R2,ISEACOL+1       SET ALTERNATE COLUMNS                 01620000
         MR    R0,R2              ALTERNATE SCREEN SIZE                 01630000
         ST    R1,ISEASIZE        SET ALTERNATE SCREEN SIZE             01640000
                                                                        01650000
*---------------------------------------------------------------------- 01660000
* IF WE ARE THE SLU PARTNER, SKIP THE QUERY LOGIC & START DRIVER        01670000
*---------------------------------------------------------------------- 01680000
                                                                        01690000
         TM    ISEF2,ISEF2SLU     IS INTEGRATOR THE SLU PARTNER?        01700000
         BO    QUERYD             BRANCH IF YES                         01710000
                                                                        01720000
*---------------------------------------------------------------------- 01730000
* IF THE BIND IS NOT "QUERIABLE", SKIP THE QUERY LOGIC & START DRIVER   01740000
*---------------------------------------------------------------------- 01750000
                                                                        01760000
         TM    BINDFLAG,BINSEDS   QUERIABLE LOGMODE?                    01770000
         BNO   QUERYD             BRANCH IF NOT                         01780000
                                                                        01790000
*---------------------------------------------------------------------- 01800000
* START QUERY OPERATIONS - ALLOCATE $SESS PLIST FROM ITASK STORAGE      01810000
*---------------------------------------------------------------------- 01820000
                                                                        01830000
         $GETSTOR L'SPL,                                               +01840000
               LOC=ANY,                                                +01850000
               OWNER=(RITASK)                                           01860000
                                                                        01870000
         ST    R1,ISEISPL         SET ADDRESS FOR INTERNAL OPERATIONS   01880000
         LR    RSPLIST,R1         ESTABLISH ADDRESSIBILITY              01890000
         LA    R1,END$SESS        COMPLETION ROUTINE                    01900000
         ST    R1,ISEWTG@         SET THE ADDRESS                       01910000
                                                                        01920000
*---------------------------------------------------------------------- 01930000
* SEND THE READ PARTITION QUERY                                         01940000
*---------------------------------------------------------------------- 01950000
                                                                        01960000
         BAS   R14,ALLOCEPB       ALLOCATE AN XEPB                      01970000
         LR    R2,R1              COPY XEPB ADDRESS                     01980000
                                                                        01990000
         LA    R1,RCVQRPLY        COMPLETION ROUTINE                    02000000
         ST    R1,ISEWTG@@        2ND LEVEL COMPLETION                  02010000
                                                                        02020000
         $SESS $SESS_SEND_DATA,                                        +02030000
               SESSION=ISETK,                                          +02040000
               AREA=RPQ,                                               +02050000
               AREALEN=L'RPQ,                                          +02060000
               AUTO_PROTOCOL=YES,                                      +02070000
               EPB=(R2),                                               +02080000
               MF=(E,(RSPLIST))                                         02090000
                                                                        02100000
         LTR   R15,R15            SEND OK?                              02110000
         BNZ   QUERYBAD           BRANCH IF NOT                         02120000
         B     EXITNOW            EXIT AND WAIT FOR COMPLETION RTN      02130000
                                                                        02140000
*---------------------------------------------------------------------- 02150000
* ISSUE A RECEIVE TO OBTAIN THE QUERY REPLY                             02160000
*---------------------------------------------------------------------- 02170000
                                                                        02180000
RCVQRPLY DS    0H                                                       02190000
                                                                        02200000
         BAS   R14,ALLOCEPB       ALLOCATE AN XEPB                      02210000
         LR    R2,R1              COPY XEPB ADDRESS                     02220000
                                                                        02230000
         LA    R1,RSPQRPLY        COMPLETION ROUTINE                    02240000
         ST    R1,ISEWTG@@        2ND LEVEL COMPLETION                  02250000
                                                                        02260000
         $SESS $SESS_RECEIVE,                                          +02270000
               SESSION=ISETK,                                          +02280000
               EPB=(R2),                                               +02290000
               MF=(E,(RSPLIST))                                         02300000
                                                                        02310000
         LTR   R15,R15            RCV OK?                               02320000
         BNZ   QUERYBAD           BRANCH IF NOT, GIVE UP ON QUERY       02330000
         B     EXITNOW            EXIT AND WAIT FOR COMPLETION RTN      02340000
                                                                        02350000
*---------------------------------------------------------------------- 02360000
* SAVE THE QUERY REPLY & ISSUE A RESPONSE TO THE QUERY REPLY DATA       02370000
*---------------------------------------------------------------------- 02380000
                                                                        02390000
RSPQRPLY DS    0H                                                       02400000
                                                                        02410000
         TM    SPLCNTRL,RPLDATA   WAS DATA RECEIVED?                    02420000
         BNO   RSPQRNOW           BRANCH IF NOT                         02430000
         MVC   ISEQRP,SPLAREA     PROBABLE QUERY DATA                   02440000
         MVC   ISEQRPL,SPLAREAL   PROBABLE QUERY DATA LENGTH            02450000
                                                                        02460000
RSPQRNOW DS    0H                                                       02470000
                                                                        02480000
         BAS   R14,ALLOCEPB       ALLOCATE AN XEPB                      02490000
         LR    R2,R1              COPY XEPB ADDRESS                     02500000
                                                                        02510000
         LA    R1,CHKQRPLY        COMPLETION ROUTINE                    02520000
         ST    R1,ISEWTG@@        2ND LEVEL COMPLETION                  02530000
                                                                        02540000
         $SESS $SESS_SEND_POSRESP,  SEND A RESPONSE AS NEEDED          +02550000
               SESSION=ISETK,                                          +02560000
               RH=*,                                                   +02570000
               SEQNO=*,                                                +02580000
               CNTRL=*,                                                +02590000
               SENSE=*,                                                +02600000
               EPB=(R2),                                               +02610000
               MF=(E,(RSPLIST))                                         02620000
                                                                        02630000
         LTR   R15,R15            SEND OK?                              02640000
         BNZ   QUERYBAD           BRANCH IF NOT, GIVE UP ON QUERY       02650000
         B     EXITNOW            EXIT AND WAIT FOR COMPLETION RTN      02660000
                                                                        02670000
*---------------------------------------------------------------------- 02680000
* VERIFY THE QUERY REPLY DATA.                                          02690000
*---------------------------------------------------------------------- 02700000
                                                                        02710000
CHKQRPLY DS    0H                                                       02720000
                                                                        02730000
         TM    SPLCNTRL,RPLDATA   WAS DATA RECEIVED?                    02740000
         BNO   QUERYBAD           BRANCH IF NOT                         02750000
                                                                        02760000
         L     R1,ISEQRPL         QUERY DATA LENGTH                     02770000
         C     R1,=F'5'           DOES IT LOOK LIKE QUERY DATA?         02780000
         BL    QUERYBAD           BRANCH IF NOT                         02790000
         L     R1,ISEQRP          QUERY DATA ADDRESS                    02800000
         CLI   0(R1),X'88'        DOES IT LOOK LIKE QUERY DATA?         02810000
         BNE   QUERYBAD           BRANCH IF NOT                         02820000
         CLI   3(R1),X'81'        DOES IT LOOK LIKE QUERY DATA?         02830000
         BNE   QUERYBAD           BRANCH IF NOT                         02840000
         B     QUERYD             BRANCH, QUERY IS DONE                 02850000
                                                                        02860000
*---------------------------------------------------------------------- 02870000
* QUERY FAILED. ISSUE A DIAGNOSTIC MESSAGE                              02880000
*---------------------------------------------------------------------- 02890000
                                                                        02900000
QUERYBAD DS    0H                                                       02910000
                                                                        02920000
         OC    ISEQRPL,ISEQRPL    ANY QUERY DATA LENGTH?                02930000
         BZ    QBADMSG            BRANCH IF NOT                         02940000
         ICM   R2,15,ISEQRP       ANY QUERY DATA?                       02950000
         BZ    QBADMSG            BRANCH IF NOT                         02960000
                                                                        02970000
         $RETSTOR (R2),                                                +02980000
               OWNER=(RITASK)     RELEASE THE BAD QUERY DATA            02990000
                                                                        03000000
QBADMSG  DS    0H                                                       03010000
                                                                        03020000
         XC    ISEQRP,ISEQRP      SHOW NO QUERY DATA                    03030000
         XC    ISEQRPL,ISEQRPL    SHOW NO QUERY DATA LENGTH             03040000
                                                                        03050000
         $MSG  971,               "3270 QUERY FAILED ..."              +03060000
               FIELDS=((ISETK,4),    SESSION TOKEN                     +03070000
               (ISETK+4,4),          SESSION TOKEN PART2               +03080000
               (RITASK),             ITASK ADDRESS                     +03090000
               (TSKPCBC,4),          IPROC ADDRESS                     +03100000
               (TSKNAME,8))          ITASK NAME                         03110000
                                                                        03120000
         B     QUERYD                                                   03130000
                                                                        03140000
*---------------------------------------------------------------------- 03150000
* RESOLVE SCREEN SIZES FOR UNSPECIFIED SCREEN SIZE BIND                 03160000
*---------------------------------------------------------------------- 03170000
                                                                        03180000
QUERYD   DS    0H                                                       03190000
                                                                        03200000
         CLI   BINPRESZ,BINPSZ3     UNSPECIFIED SCREEN SIZE BIND?       03210000
         BNE   NOTUNSPC             BRANCH IF NOT                       03220000
         XC    WRK256(4),WRK256     CLEAR THE LENGTH RETURN AREA        03230000
                                                                        03240000
         $SESS $SESS_EXTRACT,                                          +03250000
               SESSION=ISETK,                                          +03260000
               AREA=*ISEQRP,                                           +03270000
               AREALEN=*ISEQRPL,                                       +03280000
               FIELDS=((QREPLYA6,WRK256+4,WRK256,252)),                +03290000
               MF=(E,$SESSMFL)                                          03300000
                                                                        03310000
         ICM   R2,15,WRK256         DID WE GET THE 81A6 REPLY?          03320000
         BZ    NOTUNSPC             BRANCH IF NOT, MODEL2 DEFAULT STAYS 03330000
         LA    R1,WRK256+10         ADDRESS OF 1ST SELF-DEFINING TERM   03340000
         SH    R2,=H'6'             UPDATE THE REMAINING LENGTH         03350000
         BNP   NOTUNSPC             BRANCH IF NO REMAINING LENGTH       03360000
                                                                        03370000
UNSPCCHK DS    0H                                                       03380000
                                                                        03390000
         CLI   1(R1),X'01'        IS THIS THE ONE TO MODIFY?            03400000
         BNE   UNSPCNXT           BRANCH IF NOT                         03410000
         CLI   0(R1),X'0B'        IS THE LENGTH CORRECT?                03420000
         BE    UNSPCNOW           BRANCH IF YES                         03430000
                                                                        03440000
UNSPCNXT DS    0H                                                       03450000
                                                                        03460000
         SR    R3,R3              CLEAR                                 03470000
         IC    R3,0(R1)           LENGTH OF SELF-DEFINING PARM          03480000
         AR    R1,R3              ADDRESS OF NEXT SELF-DEFINING PARM    03490000
         SR    R2,R3              REMAINING LENGTH OF 81A6 REPLY        03500000
         BP    UNSPCCHK           GO LOOK FOR THE ONE TO MODIFY         03510000
         B     NOTUNSPC           COULDN'T FIND IT                      03520000
                                                                        03530000
UNSPCNOW DS    0H                                                       03540000
                                                                        03550000
         MVC   ISEDCOL(2),3(R1)   DEFAULT COLUMNS                       03560000
         MVC   ISEDROW(2),5(R1)   DEFAULT ROWS                          03570000
         LH    R14,ISEDCOL        DEFAULT COLUMNS                       03580000
         MH    R14,ISEDROW        BUFFER SIZE                           03590000
         ST    R14,ISEDSIZE       SET DEFAULT SCREEN SIZE               03600000
                                                                        03610000
         MVC   ISEACOL(2),7(R1)   DEFAULT COLUMNS                       03620000
         MVC   ISEAROW(2),9(R1)   DEFAULT ROWS                          03630000
         LH    R14,ISEACOL        DEFAULT COLUMNS                       03640000
         MH    R14,ISEAROW        BUFFER SIZE                           03650000
         ST    R14,ISEASIZE       SET DEFAULT SCREEN SIZE               03660000
                                                                        03670000
NOTUNSPC DS    0H                                                       03680000
                                                                        03690000
*---------------------------------------------------------------------- 03700000
* CALL DRIVER START ROUTINE                                             03710000
*---------------------------------------------------------------------- 03720000
                                                                        03730000
         L     R15,IVT@SDST       DRIVER START ROUTINE                  03740000
         BASR  R14,R15            CALL DRIVER START ROUTINE             03750000
                                                                        03760000
*---------------------------------------------------------------------- 03770000
* EXIT FROM 3270 INITIALIZATION                                         03780000
*---------------------------------------------------------------------- 03790000
                                                                        03800000
RETURN   DS    0H                                                       03810000
                                                                        03820000
*                                                                       03830000
* RELEASE INTERNAL SPLIST FROM ITASK STORAGE                            03840000
*---------------------------------------------------------------------- 03850000
                                                                        03860000
         ICM   R2,15,ISEISPL      $SESS SPLIST TO RELEASE?              03870000
         BZ    EXITNOW            BRANCH IF NOT                         03880000
                                                                        03890000
         $RETSTOR (R2),                                                +03900000
               OWNER=(RITASK)                                           03910000
                                                                        03920000
         XC    ISEISPL,ISEISPL    SHOW NO INTERNAL SPLIST               03930000
                                                                        03940000
*                                                                       03950000
* LOAD RETURN REGISTERS AND RETURN                                      03960000
*---------------------------------------------------------------------- 03970000
                                                                        03980000
EXITNOW  DS    0H                                                       03990000
                                                                        04000000
         LM    R15,R1,RETREGS     LOAD RETURN REGISTERS                 04010000
                                                                        04020000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    04030000
                                                                        04040000
*---------------------------------------------------------------------- 04050000
* SUBROUTINE: ALLOCEPB                                                  04060000
*---------------------------------------------------------------------- 04070000
                                                                        04080000
ALLOCEPB DS    0H                                                       04090000
                                                                        04100000
         STM   R14,R1,SUB0SAVE                                          04110000
                                                                        04120000
         $TASK SETEPB,                                                 +04130000
               ECODE=EC$ISES,                                          +04140000
               ERRET=ERR$TASK,                                         +04150000
               MF=(E,$TASKMFL)    ALLOCATE AN XEPB                      04160000
                                                                        04170000
         LM    R14,R0,SUB0SAVE    LEAVE XEPB ADDRESS IN R1              04180000
         BR    R14                                                      04190000
                                                                        04200000
*---------------------------------------------------------------------- 04210000
* THIS IS THE $SESS COMPLETION ROUTINE                                  04220000
*                                                                       04230000
* ON ENTRY:                                                             04240000
*                                                                       04250000
*    R15 = ENTRY POINT ADDRESS                                          04260000
*    R14 = RETURN ADDRESS                                               04270000
*    R13 = AVAILABLE SAVE AREA                                          04280000
*    R11 = ICVT ADDRESS                                                 04290000
*    R10 = ITASK ADDRESS                                                04300000
*    R09 = IVTAMCVT ADDRESS                                             04310000
*    R08 = ISESS ADDRESS                                                04320000
*---------------------------------------------------------------------- 04330000
                                                                        04340000
         DROP  R12                                                      04350000
                                                                        04360000
END$SESS #ENTER BASE=R12,         ENTRY LINKAGE                        +04370000
               EP=YES             THIS IS AN ENTRY POINT                04380000
                                                                        04390000
         L     RSPLIST,ISEISPL    INTERNAL SPLIST ADDRESS               04400000
         L     R15,ISEWTG@@       2ND LEVEL COMPLETION                  04410000
         OC    SPLRETCD,SPLRETCD  TEST RC                               04420000
         BNZ   QUERYBAD           BRANCH IF NON-ZERO                    04430000
         BASR  R14,R15            CONTINUE EXECUTION AT 2ND LEVEL RTN   04440000
                                                                        04450000
*---------------------------------------------------------------------- 04460000
* ERROR ROUTINES                                                        04470000
*---------------------------------------------------------------------- 04480000
                                                                        04490000
ERR$TASK DS    0H                                                       04500000
                                                                        04510000
         $ABEND ABE_VTDIAG,                                            +04520000
               SCOPE=PCB,                                              +04530000
               TITLE='$TASK FAILURE'                                    04540000
                                                                        04550000
*---------------------------------------------------------------------- 04560000
*  CONSTANTS AND LITERALS                                               04570000
*---------------------------------------------------------------------- 04580000
                                                                        04590000
RPQ      DC    X'F300064000F182000601FF0380'                            04600000
                                                                        04610000
         LTORG ,                                                        04620000
         PRINT NOGEN                                                    04630000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                04640000
         ISTDBIND ,               VTAM BIND IMAGE                       04650000
         ISTRH ,                  VTAM SNA REQUEST HEADER               04660000
         ICVT  ,                  INTEGRATOR CVT                        04670000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   04680000
         IRPL ,                   INTEGRATOR VTAM RPL+                  04690000
         IACB ,                   INTEGRATOR VTAM ACB+                  04700000
         INIB ,                   INTEGRATOR VTAM NIB+                  04710000
         ISESS ,                  INTEGRATOR SESSION BLOCK              04720000
         IRQE ,                   INTEGRATOR RECEIVE QUEUE ELEMENT      04730000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            04740000
         ITASK ,                  INTEGRATOR TASK BLOCK                 04750000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          04760000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       04770000
         EVCODES ,                INTEGRATOR EVENT CODES                04780000
         ABCODES ,                INTEGRATOR $ABEND CODES               04790000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     04800000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        04810000
         $TASK DSECT=YES          INTEGRATOR $TASK SERVICES             04820000
         $PROC DSECT=YES          INTEGRATOR $PROC SERVICES             04830000
         $VTAM DSECT=YES          INTEGRATOR $VTAM SERVICES             04840000
         $SESS DSECT=YES          INTEGRATOR $SESS SERVICES             04850000
         SLUHANDL ,               INTEGRATOR SLUHANDL                   04860000
         SESSIMAG ,               INTEGRATOR SESSIMAGE                  04870000
         IFGEXLST ,               VTAM EXIT LIST                        04880000
         END   ,                                                        04890000
