ITBNDXVY TITLE 'TABLE SERVICES - INDEX NAME VALIDATION'                 00010001
**<DOC-ON>*****************************************************         00020001
*                                                                       00030000
* ROUTINE:  ITBNDXVY - INDEX NAME VALIDATION                            00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THIS ROUTINE VALIDATES A LIST OF CANDIDATE INDEX NAMES             00080000
*    REPRESENTED BY AN ARRAY OF INDEX NAME POINTERS. EACH NAME          00090000
*    IS CLASHED AGAINST THE KEYD DEFINITION LIST MAINTAINED IN          00100000
*    THE BASE TABLE PREFIX.  WHEN USED WITH A SINGLE INDEX              00110000
*    NAME, THIS ROUTINE CAN BE USED TO PERFORM THE VALIDATION           00120000
*    DESCRIBED ABOVE AS WELL AS TO ACQUIRE THE INDEX IDENTIFIER         00130000
*    NUMBER AND THE AR QUALIFIED ADDRESS OF THE INDEX DEFINITION        00140000
*    MAPPED BY TBKEYDEF.                                                00150000
*                                                                       00160000
*                                                                       00170000
* ON ENTRY:                                                             00180000
*                                                                       00190000
*    R1  POINTS TO A PARAMETER LIST DESCRIBED BY THE VNDXPARM           00200000
*        MAPPING MACRO. THE PLIST IS NOT AR-QUALIFIED.                  00210000
*                                                                       00220000
* ON EXIT:                                                              00230000
*                                                                       00240000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                     00250000
*                                                                       00260000
*         RC00 - ALL INDEX NAMES VALIDATED                              00270000
*                                                                       00280000
*                R0 - INDEX IDENTIFIER # OF LAST INDEX IN LIST          00290000
*              A/R1 - KEY DEFINITION ENTRY ADDRESS (TBKEYDEF)           00300000
*                                                                       00310000
*         RC04 - AT LEAST ONE INDEX NAME IS NOT VALID                   00320000
*                                                                       00330000
**<DOC-OFF>****************************************************         00340001
                                                                        00350001
         EJECT                                                          00360001
         VNDXPARM ,               INDEX NAME VALIDATION PLIST           00370001
                                                                        00380001
         EJECT                                                          00390001
         @TABLE ,                 BASE TABLE PREFIX                     00400001
                                                                        00410001
         EJECT                                                          00420001
         @TBKEYDF ,               INDEX DEFINITION                      00430001
                                                                        00440001
         EJECT                                                          00450001
         $STG  TYPE=DSECT         STORAGE MANAGER                       00460001
                                                                        00470001
         EJECT                                                          00480001
         EQUS  LINKAGE=VCON                                             00490001
                                                                        00500001
         EJECT                                                          00510001
ITBNDXVY @ENTER ASC=ENTRY                                               00520001
                                                                        00530001
         LAE   R5,0(R1,0)         PARAMETER LIST                        00540000
         USING VNDXPARM,R5                                              00550000
                                                                        00560000
         SR    R2,R2              ADDRESS PRIMARY STORAGE               00570000
         SAR   AR3,R2                                                   00580000
         SAR   AR4,R2                                                   00590000
                                                                        00600000
         L     R3,VNDXLIST        INDEX NAME LIST                       00610000
         ICM   R2,15,VNDXCNT      NUMBER OF LIST ENTRIES                00620000
         BNP   VFAIL              ERROR                                 00630000
                                                                        00640000
         L     R10,VNDXBASE       BASE TABLE PTR                        00650000
         LAM   AR10,AR10,VNDXALE  QUALIFIED                             00660000
         USING TABLE,R10          TABLE PREFIX                          00670000
                                                                        00680000
*--------------------------------------------------------------         00690000
*   LOCATE TBKEYDEF ASSOCIATED WITH NAME                                00700000
*--------------------------------------------------------------         00710000
LOCATE   DS    0H                                                       00720000
         ICM   R7,15,TBL#KEYS     NUMBER OF INDEXES DEFINED             00730000
         BNP   VFAIL              TABLE IS NOT INDEXED                  00740000
         LAE   R11,TBLKYLST-(TBKLINK-TBKEYDEF)                          00750000
         USING TBKEYDEF,R11       ADDRESSABILITY                        00760000
         SR    R8,R8              INIT INDEX IDENTIFIER #               00770000
         L     R4,0(,R3)          LOCATE CANDIDATE INDEX NAME           00780000
                                                                        00790000
LOCSCAN  DS    0H                 SCAN INDEX DEFINITIONS                00800000
         LA    R8,1(,R8)          INDEX ID # IS POSITION IN LIST        00810000
         L     R11,TBKLINK        ADVANCE TO NEXT DEFINITION            00820000
         ALR   R11,R10            CONVERT OFFLINK TO ADDRESS            00830000
         CLC   TBKEYNAM,0(R4)     MATCHING INDEX NAME?                  00840000
         BE    MATCH              SUCCESS IF SO                         00850000
         BCT   R7,LOCSCAN         ELSE TRY NEXT ENTRY                   00860000
         B     VFAIL              NAME IS INVALID                       00870000
                                                                        00880000
MATCH    DS    0H                 NAME IS VALID                         00890000
         LA    R3,4(,R3)          ADVANCE TO NEXT CANDIDATE             00900000
         BCT   R2,LOCATE          VALIDATE INDEX NAME                   00910000
                                                                        00920000
*--------------------------------------------------------------         00930000
*   RETURN COMPLETION STATUS TO CALLER                                  00940000
*--------------------------------------------------------------         00950000
         LAE   R0,0(R8,0)         RETURN INDEX IDENTIFIER #             00960000
         LAE   R1,TBKEYDEF        RETURN CORR INDEX DEFINITION          00970000
         LA    R15,RC00           UPDATE COMPLETE                       00980000
         B     EXIT               DONE                                  00990000
                                                                        01000000
VFAIL    DS    0H                 SOMETHING AMISS                       01010000
         LAE   R0,0                                                     01020000
         LAE   R1,0                                                     01030000
         LA    R15,RC04                                                 01040000
                                                                        01050000
EXIT     NOP   0                  RETURN                                01060000
         @EXIT ,                                                        01070000
                                                                        01080000
         EJECT                                                          01090001
***************************************************************         01100000
*                                                                       01110000
*   LOCAL READ-ONLY DATA AREAS, ETC.                                    01120000
*                                                                       01130000
***************************************************************         01140000
         LTORG ,                                                        01150000
         END   ,                                                        01160000
