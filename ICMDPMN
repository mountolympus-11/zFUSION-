ICMDPMN  TITLE 'ISSUEND - END AUTOMATED COMMAND SUBMISSION'             00010000
***************************************************************         00020000
*                                                                       00030000
* ROUTINE: ICMDPMN - ISSUEND - END AUTOMATED COMMAND SUBMISSION         00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This command process (CMDPROC) implements the ISSUEND              00080000
*    (formerly STOPMON) command which is used to terminate              00090000
*    automatic command submission processes created by the              00100000
*    ISSUE COMMANDS() command.                                          00110000
*                                                                       00120000
*    The command can be directed against a specific ISSUE class         00130000
*    identifier provided by the ID() operand, or all active ISSUE       00140000
*    classes can be designated via the ALL keyword.                     00150000
*                                                                       00160000
*                                                                       00170000
* BASIC SYNTAX:                                                         00180000
*                                                                       00190000
*    ISSUEND  ALL                                                       00200000
*    ISE      ID( <name> )                                              00210000
*                                                                       00220000
*                                                                       00230000
*    <name>, if provided, is an ISSUE class identifier.  The            00240000
*    class ID is established by ISSUE COMMANDS() ID(<name>)             00250000
*    and is used in ISSUEND to identify a single, active monitor.       00260000
*                                                                       00270000
*                                                                       00280000
* ON ENTRY:                                                             00290000
*                                                                       00300000
*    R1  contains the address of the command request block              00310000
*        (CMDREQ) in local CMDPROC format                               00320000
*                                                                       00330000
**<DOC-OFF>****************************************************         00340000
                                                                        00350000
                                                                        00360000
***************************************************************         00370000
*                                                                       00380000
* MAINTENANCE:                                                          00390000
*                                                                       00400000
*    09/30/94 R. Turgeon                                                00410000
*             Initial Version                                           00420000
*                                                                       00430000
*    05/11/95 R. Colmone                                                00440000
*             Modified auto command submission stop command             00450000
*             to utilize stop service.                                  00460000
*                                                                       00470000
***************************************************************         00480000
                                                                        00490000
         EJECT                                                          00500000
         #WORK ,             BEGIN WORKAREA                             00510000
                                                                        00520000
MAJOPT   DS    X             MAJOR FUNCTION                             00530000
MAJALL   EQU   X'80'            ALL CLASSES                             00540000
MAJID    EQU   X'40'            SPECIFIED CLASS NAME                    00550000
                                                                        00560000
$MONID   DS    CL8           ISSUE CLASS ID FROM ID() OPERAND           00570000
                                                                        00580000
$MSGMFL  $MSG  MF=L,FIELDS=(,,,,)                                       00590000
                                                                        00600000
         #ENDWORK ,          END OF WORKAREA                            00610000
                                                                        00620000
         EJECT                                                          00630000
         CMDREQ ,            COMMAND REQUEST BLOCK                      00640000
                                                                        00650000
         EJECT                                                          00660000
         CCSUMRY ,           COMMAND OPERAND PREPARSE SUMMARY           00670000
                                                                        00680000
         EJECT                                                          00690000
         $PMON  DSECT=YES    AUTO COMMAND SUBMISSION TERM SERVICE       00700000
                                                                        00710000
         EJECT                                                          00720000
         AMNREC ,            AUTOMATED COMMAND ISSUER RECORD            00730000
                                                                        00740000
         EJECT                                                          00750000
         KEYCODES COMMANDSET=ISSUEND                                    00760000
                                                                        00770000
         EVCODES ,                                                      00780000
                                                                        00790000
         CMDCODES ,                                                     00800000
                                                                        00810000
         ABCODES ,                                                      00820000
                                                                        00830000
         EQUS  ,                                                        00840000
                                                                        00850000
         $MSGDFT PREFIX=ICTPID,COMPID='CMD',TABLE=*#MSGS,              X00860000
               CONID=*CMRQCNID,CONNAME=CMRQCNAM,CART=CMRQCART,         X00870000
               DESTADD=*CMRQDMSK,                                      X00880000
               MSGQA=*CMRQMQA,STGQH=*CMRQSTGQ,                         X00890000
               MF=(E,$MSGMFL),                                         X00900000
               PRINT=NOGEN                                              00910000
                                                                        00920000
         EJECT                                                          00930000
                                                                        00940000
         EJECT                                                          00950000
ICMDPMN  #ENTER PREG=R8                                                 00960000
                                                                        00970000
         USING ITASK,R10          STDENV                                00980000
                                                                        00990000
         EJECT                                                          01000000
***************************************************************         01010000
*                                                                       01020000
*    COMMAND PARSE                                                      01030000
*                                                                       01040000
***************************************************************         01050000
         USING CMDREQ,R8          COMMAND REQUEST BLOCK                 01060000
         ICM   R7,15,CMRQSMRY     ASSOC COMMAND SUMMARY                 01070000
         BZ    VALIDATE           ASSUME DEFAULTS                       01080000
         USING CCSUMRY,R7         COMMAND OPERAND SUMMARY FORMAT        01090000
         ICM   R5,15,CMRQSMR#     TOTAL NUMBER OF OPERAND ENTRIES       01100000
         BZ    VALIDATE           ASSUME DEFAULTS                       01110000
         L     R6,CMRQOPST        OPERAND STRING ORIGIN                 01120000
                                                                        01130000
*--------------------------------------------------------------         01140000
*   IDENTIFY THE OPERANDS PROVIDED AND VALIDATE                         01150000
*--------------------------------------------------------------         01160000
PARSENXT DS    0H                                                       01170000
         LA    R1,MAJALL                                                01180000
         CLC   CCSID,=AL2(ISE_ALL)                                      01190000
         BE    ALLIDS                                                   01200000
                                                                        01210000
         CLC   CCSID,=AL2(ISE_ID)                                       01220000
         BE    MONID                                                    01230000
         B     ERREJECT           REJECT OTHERWISE                      01240000
                                                                        01250000
*--------------------------------------------------------------         01260000
*   ALL IDENTIFIERS SELECTED                                            01270000
*--------------------------------------------------------------         01280000
ALLIDS   DS    0H                                                       01290000
         CLI   MAJOPT,0           ONLY KEYWORD OF MAJOR GROUP?          01300000
         BNE   ERRCNFLC           CONFLICTING OPERANDS OTHERWISE        01310000
         OI    MAJOPT,MAJALL      POST REQUEST TYPE                     01320000
         B     ADVANCE            ADVANCE TO NEXT OPERAND               01330000
                                                                        01340000
*--------------------------------------------------------------         01350000
*   SINGLE IDENTIFIER SELECTED                                          01360000
*--------------------------------------------------------------         01370000
MONID    DS    0H                                                       01380000
         CLI   MAJOPT,0           ONLY KEYWORD OF MAJOR GROUP?          01390000
         BNE   ERRCNFLC           CONFLICTING OPERANDS OTHERWISE        01400000
         OI    MAJOPT,MAJID       POST REQUEST TYPE                     01410000
                                                                        01420000
         LH    R2,CCSVLEN         LENGTH OF VALUE                       01430000
         BCTR  R2,0               PREPARE FOR EX                        01440000
         CL    R2,=A(L'$MONID)    VALID VALUE LENGTH?                   01450000
         BNL   ERRSYNTX           SYNTAX ERROR OTHERWISE                01460000
                                                                        01470000
         L     R3,CCSVDISP        OFFSET TO VALUE ORIGIN                01480000
         AR    R3,R6              ADDR OF ID() VALUE IN COMMAND LINE    01490000
         MVC   $MONID,BLANKS      APPROPRIATE VALUE PAD                 01500000
         EX    R2,*+4             RETAIN IDENTIFIER                     01510000
         MVC   $MONID(*-*),0(R3)  EX OBJECT                             01520000
                                                                        01530000
*--------------------------------------------------------------         01540000
*   PROCESS ALL COMMAND KEYWORDS                                        01550000
*--------------------------------------------------------------         01560000
ADVANCE  DS    0H                                                       01570000
         LA    R15,CCSVSLN        LENGTH OF EACH VALUE ENTRY            01580000
         MH    R15,CCSVALCT       TOTAL SIZE CONSUMED BY VALUES         01590000
         LA    R7,CCSUMRY+CCSPFXL(R15)                                  01600000
         BCT   R5,PARSENXT        EXAMINE ALL OPERANDS                  01610000
         DROP  R7                 CCSUMRY                               01620000
                                                                        01630000
         EJECT                                                          01640000
***************************************************************         01650000
*                                                                       01660000
*    COMMAND VALIDATION - ENSURE REQUEST COMPLETENESS                   01670000
*                                                                       01680000
***************************************************************         01690000
VALIDATE DS    0H                                                       01700000
         CLI   MAJOPT,0           MAJOR KEYWORD PROVIDED?               01710000
         BE    ERRAMBIG           AMBIGUOUS REQUEST IF NOT              01720000
                                                                        01730000
         EJECT                                                          01740000
***************************************************************         01750000
*                                                                       01760000
*   NOTIFY ALL/IDENTIFIED MONITORS OF TERMINATION REQUEST               01770000
*                                                                       01780000
***************************************************************         01790000
                                                                        01800000
         SR    R2,R2              ASSUME ATTEMPTING DELETE ALL          01810000
         TM    MAJOPT,MAJALL      ASSUMTION CORRECT?                    01820000
         BO    *+8                YES, ONWARD                           01830000
         LA    R2,$MONID          ADDRESS OF SPECIFIC MONITOR ID        01840000
                                                                        01850000
         $PMON MONITORID=(R2),    TERMIATE REQUESTED ISSUE PROCS       X01860000
               CMDREQ=CMDREQ,                                          X01870000
               MF=(E,MFE_LIST)                                          01880000
         BZ    NORMRET            MONITOR STOPPED                       01890000
                                                                        01900000
         $MNO  R2,380             ASSUME ATTEMPTING DELETE ALL          01910000
         TM    MAJOPT,MAJALL      ASSUMPTION CORRECT?                   01920000
         BO    *+8                SKIP IF SO                            01930000
         $MNO  R2,381             ELSE SELECTIVE DELETE FAILED          01940000
                                                                        01950000
         $MSG  (R2)                                                     01960000
                                                                        01970000
         EJECT                                                          01980000
***************************************************************         01990000
*                                                                       02000000
*   RETURN COMPLETION STATUS TO REQUESTER                               02010000
*                                                                       02020000
***************************************************************         02030000
NORMRET  DS    0H                                                       02040000
         LA    R15,CCODE_NORESP   NO ADDITIONAL RESPONSE REQUIRED       02050000
         B     CMDEXIT                                                  02060000
                                                                        02070000
ERRSYNTX DS    0H                                                       02080000
         LA    R15,CCODE_SYNTAX   SYNTAX ERROR                          02090000
         B     CMDEXIT            DONE                                  02100000
                                                                        02110000
ERRAMBIG DS    0H                                                       02120000
         LA    R15,CCODE_AMBIG    AMBIGUOUS REQUEST                     02130000
         B     CMDEXIT            DONE                                  02140000
                                                                        02150000
ERRCNFLC DS    0H                                                       02160000
         LA    R15,CCODE_CONFLICT CONFLICTING OPERANDS                  02170000
         B     CMDEXIT            DONE                                  02180000
                                                                        02190000
ERREJECT DS    0H                                                       02200000
         LA    R15,CCODE_REJECT   COMMAND REJECTED                      02210000
         B     CMDEXIT            DONE                                  02220000
                                                                        02230000
*--------------------------------------------------------------         02240000
*   PROCESS TERMINATION                                                 02250000
*--------------------------------------------------------------         02260000
CMDEXIT  DS    0H                                                       02270000
         #EXIT ,                                                        02280000
                                                                        02290000
         EJECT                                                          02300000
***************************************************************         02310000
*                                                                       02320000
*   LOCAL READ ONLY DATA AREAS, ETC.                                    02330000
*                                                                       02340000
***************************************************************         02350000
BLANKS   DC    CL8' '                                                   02360000
                                                                        02370000
         LTORG ,                                                        02380000
                                                                        02390000
         PRINT NOGEN                                                    02400000
         ICVT  ,                                                        02410000
         ITASK ,                                                        02420000
         END   ,                                                        02430000
