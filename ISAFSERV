ISAFSERV TITLE '- SECURITY AUTHORIZATION FACILITY INTERFACE'            00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE:  ISAFSERV - Security Authorization Facility Interface        00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*   This routine provides an interface to the MVS SAF (Security         00080000
*   Authorization Facility) based external security system.             00090000
*   This routine support the following types of security                00100000
*   events:                                                             00110000
*                                                                       00120000
*      Create  - Verify user access and create security environment     00130000
*      Delete  - Delete security environment                            00140000
*      Reschk  - Verify user access to a resource                       00150000
*      Stat    - Check security system / resource status                00160000
*                                                                       00170000
*   Request made for specific resource classes are looked up            00180000
*   in the SAF CLASS table created during initialization processing.    00190000
*   This table is used to convert the internal resource class name      00200000
*   to the external class name specified by the start options.  It      00210000
*   is also used to determine whether the class is active or            00220000
*   inactive.  Security messages are returned in the specified          00230000
*   message buffer and are journaled to the appropriate destinations    00240000
*   if LOG=YES is specified or assumed by default.                      00250000
*                                                                       00260000
*   Security related information maintained in the IUSER block          00270000
*   is managed by this routine.                                         00280000
*                                                                       00290000
*                                                                       00300000
* Entry:  R1 contains the address of the parameter list                 00310000
*         mapped by the ISAFPL dsect generated using                    00320000
*         $SAF DSECT=YES macro.                                         00330000
*                                                                       00340000
* Exit:   Upon completion of the security request,  R15 will            00350000
*         contain one of the following return codes:                    00360000
*                                                                       00370000
*             RC00 - Access Allowed                                     00380000
*                                                                       00390000
*             RC04 - External Security or resource class not active     00400000
*                                                                       00410000
*             RC08 - Access Denied                                      00420000
*                                                                       00430000
*             RC12 - User entity add error                              00440000
*                                                                       00450000
*             RC20 - Request in error                                   00460000
*                                                                       00470000
*          For return codes 0-8,  R0 will contain the SAF               00480000
*          based security system return code from the SAFPRRET          00490000
*          field and R1 will contain the reason code from the           00500000
*          SAFPRREA field.                                              00510000
*                                                                       00520000
* Note:                                                                 00530000
*                                                                       00540000
*   On all calls, if a message buffer is supplied,  messages            00550000
*   generated by the SAF based security product will be                 00560000
*   formatted into the message buffer supplied by the $SAF              00570000
*   caller.  The message buffer prefix is mapped by the  MSGBUF         00580000
*   mapping macro.                                                      00590000
*                                                                       00600000
**<DOC-OFF>*****************************************************        00610000
                                                                        00620000
****************************************************************        00630000
*                                                                       00640000
* MAINTENANCE:                                                          00650000
*                                                                       00660000
*   08/17/93  R. Colmone                                                00670000
*      Initial Version                                                  00680000
*                                                                       00690000
*   04/11/94  R. Colmone      Par# 103656                       103656  00700000
*      Added LOG=NOSTAT on Request=AUTH SAF calls for LOG=NO    103656  00710000
*      $SAF requests.                                           103656  00720000
*                                                                       00730000
*   04/11/94  R. Colmone      Par# 116328                       116328  00740000
*      Added UTOKEN support to Request=Auth calls for third     116328  00750000
*      party RACHECKS.                                          116328  00760000
*                                                                       00770000
*   07/27/94  R. Colmone      Par# 133649                       133649  00780000
*      Added support for active user entity structure           133649  00790000
*                                                                       00800000
****************************************************************        00810000
                                                                        00820000
         EJECT ,                                                        00830000
         $SAF  DSECT=YES          PARAMETER LIST                        00840000
         EJECT ,                                                        00850000
         $SAFCLAS ,               SAF RESOURCE CLASS TABLE FORMAT       00860000
         EJECT ,                                                        00870000
         EQUS  ,                  GENERAL EQUATES                       00880000
         EJECT ,                                                        00890000
         TRACODES ,               TRACE EVENT CODES                     00900000
                                                                        00910000
         EJECT ,                                                        00920000
         #WORK ,                  READ/WRITE WORKAREA                   00930000
REGSAVE  DS    16F                REGISTER SAVE AREA                    00940000
REGSAVE2 DS    16F                REGISTER SAVE AREA                    00950000
WRK256   DS    XL256              WORKAREA                              00960000
WRK512   DS    XL512              WORKAREA                              00970000
                                                                        00980000
RSRCLASL DS    AL1                LENGTH OF RESOURCE CLASS              00990000
RSRCLAS  DS    CL8                RESOURCE CLASS                        01000000
USERIDL  DS    AL1                LENGTH OF USER ID                     01010000
USERID   DS    CL8                USER ID                               01020000
PSWDL    DS    AL1                LENGTH OF PASSWORD                    01030000
PSWD     DS    CL8                PASSWORD                              01040000
NEWPSWDL DS    AL1                LENGTH OF NEW PASSWORD                01050000
NEWPSWD  DS    CL8                NEW PASSWORD                          01060000
GROUPL   DS    AL1                LENGTH OF GROUP ID                    01070000
GROUP    DS    CL8                GROUP ID                              01080000
NAME     DS    CL20               USER NAME                             01090000
REQUEST  DS    CL8                SAF REQUEST TYPE                      01100000
                                                                        01110000
RETINFO  DS    0F                 RC/RSN/INFO CODES                     01120000
RETCODE  DS    F                  RETURN CODE  (ROUTER RETURN CODE)     01130000
RSNCODE  DS    F                  REASON CODE  (SAFPRRET)               01140000
INFCODE  DS    F                  INFO   CODE  (SAFPRREA)               01150000
                                                                        01160000
MSGID    DS    F                  MESSAGE ID                            01170000
MSGRTN   DS    A                  ADDRESS OF MESSAGE ROUTINE            01180000
MSGBF@   DS    A                  ADDRESS OF MESSAGE BUFFER             01190000
MSGBFL   DS    F                  LENGTH  OF MESSAGE BUFFER             01200000
                                                                        01210000
MSGTEXT@ DS    A                  ADDRESS OF MESSAGE TEXT               01220000
MSGTEXTL DS    A                  LENGTH  OF MESSAGE TEXT               01230000
                                                                        01240000
$SAF_MFL $SAF  MF=L               $SAF PARAMETER LIST                   01250000
                                                                        01260000
         PRINT  NOGEN                                                   01270000
*--------------------------------------------------------------         01280000
*  SAF parameter list macro expansions.  Each RACROUTE request          01290000
*  perform is expanded starting at location RACF_MFL.  This             01300000
*  will ensure the plist storage is available for the largest           01310000
*  SAF request parameter list.                                          01320000
*--------------------------------------------------------------         01330000
RACF_MFL RACROUTE REQUEST=VERIFY,RELEASE=1.9,MF=L                       01340000
         ORG   RACF_MFL                                                 01350000
         RACROUTE REQUEST=AUTH,RELEASE=1.9,MF=L                         01360000
         ORG   RACF_MFL                                                 01370000
         RACROUTE REQUEST=STAT,RELEASE=1.9,MF=L                         01380000
         ORG   ,                  RESET LOC COUNTER                     01390000
         PRINT  GEN                                                     01400000
                                                                        01410000
         #ENDWORK ,               END OF WORKAREA                       01420000
                                                                        01430000
         $MSGDFT PREFIX=ICTPID,COMPID='SAF',TABLE=*#MSGS,              +01440000
               PRINT=NOGEN,MF=(E,WRK256)                                01450000
                                                                        01460000
         EJECT ,                                                        01470000
ISAFSERV #ENTER BASE=R12,PREG=R8                                        01480000
                                                                        01490000
         USING ITASK,R10          ITASK ADDRESSABILITY                  01500000
                                                                        01510000
         USING ISAFPL,R8          PLIST ADDRESSABILITY                  01520000
                                                                        01530000
         MVC   USERID,BLANKS      INITIALIZE USERID TO BLANKS           01540000
         MVC   GROUP,BLANKS       INITIALIZE GROUP NAME TO BLANKS       01550000
         MVC   NAME,BLANKS        INITIALIZE USERNAME TO BLANKS         01560000
                                                                        01570000
         ICM   R9,15,TSKPCBC      ADDRESS OF IPCB                       01580000
         BZ    INITMSG            NO PCB, INITIAL MSG BUFFER            01590000
         USING IPCB,R9            IPCB  ADDRESSABILITY                  01600000
         ICM   R7,15,ISAFUSER     IUSER SPECIFIED                       01610000
         BNZ   INITUSER           YES, CONTINUE                         01620000
         ICM   R7,15,PCBUSER      ADDRESS OF IUSER                      01630000
         BZ    INITMSG            NO USER, INITIAL MSG BUFFER           01640000
         USING IUSER,R7           ADDRESSABILITY                        01650000
                                                                        01660000
INITUSER DS    0H                                                       01670000
         MVC   USERID,USRNAME     ID OF REQUESTING USER                 01680000
         ICM   R1,15,USRACEE      SECURITY ENVIRONMENT AVAILABLE?       01690000
         BZ    *+8                NO, CONTINUE                          01700000
         BAS   R14,COPYACEE       COPY ACEE INFORMATION                 01710000
                                                                        01720000
         EJECT ,                                                        01730000
*---------------------------------------------------------------        01740000
*  Initialize return message buffer if available                        01750000
*---------------------------------------------------------------        01760000
INITMSG  DS    0H                                                       01770000
         ICM   R0,15,ISAFMSGA     MESSAGE BUFFER SUPPLIED               01780000
         BZ    SAF_REQ            NO, PROCESS SAF REQUEST               01790000
         ICM   R1,15,ISAFMSGL     LENGTH OF MESSAGE BUFFER              01800000
         SR    R15,R15            PREPARE FOR CLEAR                     01810000
         MVCL  R0,R14             CLEAR MESSAGE BUFFER                  01820000
                                                                        01830000
*---------------------------------------------------------------        01840000
*  Process requested function code                                      01850000
*---------------------------------------------------------------        01860000
SAF_REQ  DS    0H                                                       01870000
         ICM   R2,15,ISAFREQ      OBTAIN REQUESTED FUNCTION             01880000
         BZ    ERR_REQ            INVALID REQUEST TYPE                  01890000
                                                                        01900000
         BCTR  R2,0               CONVERT TO INDEX                      01910000
         SLL   R2,2                                                     01920000
         B     *+4(R2)            BRANCH ON REQUESTED FUNC              01930000
         B     CREATE             CREATE SECURITY ENVIRONMENT           01940000
         B     DELETE             DELETE SECURITY ENVIRONMENT           01950000
         B     STATUS             VERIFY RESOURCE STATUS                01960000
         B     RESCHECK           CHECK  RESOURCE ACCESS                01970000
         EX    0,*                UNSUPPORTTED                          01980000
         EX    0,*                UNSUPPORTTED                          01990000
         EX    0,*                UNSUPPORTTED                          02000000
         EX    0,*                UNSUPPORTTED                          02010000
                                                                        02020000
         EJECT ,                                                        02030000
****************************************************************        02040000
*                                                                       02050000
*  REQUEST: CREATE                                                      02060000
*                                                                       02070000
*  Process request to create a security environment.  If a              02080000
*  security environment (ACEE) already exists,  then issue a            02090000
*  delete request prior to calling external security product to         02100000
*  authenticate the user and create security environment.               02110000
*                                                                       02120000
****************************************************************        02130000
CREATE   DS    0H                                                       02140000
         MVC   USERID,BLANKS      CLEAR PREVIOUS USERID                 02150000
         MVC   GROUP,BLANKS       INFORMATION                           02160000
         MVC   NAME,BLANKS                                              02170000
                                                                        02180000
         ICM   R1,15,ISAFUSID     ADDRESS OF USER ID                    02190000
         BZ    ERR_REQ            EXTERNAL SECURITY NOT ACTIVE          02200000
         MVC   USERID,0(R1)       COPY USERID                           02210000
         LA    R1,USERIDL         ADDRESS OF USERID LENGTH              02220000
         BAS   R14,SETLEN         SET LENGTH OF USERID                  02230000
                                                                        02240000
         ICM   R1,15,ISAFPSWD     ADDRESS OF PASSWORD                   02250000
         BZ    ERR_REQ            PASSWORD REQUIRED                     02260000
         MVC   PSWD,0(R1)         COPY PASSWORD                         02270000
         LA    R1,PSWDL           ADDRESS OF PSWD LENGTH                02280000
         BAS   R14,SETLEN         SET LENGTH OF PSWD                    02290000
                                                                        02300000
         ICM   R4,15,ISAFGRP      ADDRESS OF GROUPID                    02310000
         BZ    CREA_NPW           NONE, CHECK PASSWORD                  02320000
         MVC   GROUP,0(R4)        COPY GROUP ID                         02330000
         LA    R1,GROUPL          ADDRESS OF GROUP id LENGTH            02340000
         BAS   R14,SETLEN         SET LENGTH OF GROUP ID                02350000
         SR    R4,R4              ASSUME GROUP LENGTH IS ZERO           02360000
         ICM   R4,1,GROUPL        IS GROUP SPECIFIED?                   02370000
         BZ    CREA_NPW           NO,  GROUP NOT SPECIFIED              02380000
         LA    R4,GROUPL          ADDRESS OF GROUP ID LENGTH            02390000
                                                                        02400000
CREA_NPW DS    0H                                                       02410000
         ICM   R5,15,ISAFNPSW     ADDRESS OF NEW PASSWORD               02420000
         BZ    CREA_ENA           CHECK IF SAF ENABLED                  02430000
         MVC   NEWPSWD,0(R5)      COPY NEW PSWD                         02440000
         LA    R1,NEWPSWDL        ADDRESS OF NEW PSWD                   02450000
         BAS   R14,SETLEN         SET LENGTH OF NEWPSWD                 02460000
         SR    R5,R5              ASSUME NEW PASSWORD LENGTH IS 0       02470000
         ICM   R5,1,NEWPSWDL      NEWPSWD SPECIFIED?                    02480000
         BZ    CREA_ENA           NO, NEWPASSWORD NOT SPECIFIED         02490000
         LA    R5,NEWPSWDL        ADDRESS OF NEW PASSWORD LENGTH        02500000
                                                                        02510000
*---------------------------------------------------------------        02520000
* Determine if external security is active                              02530000
*---------------------------------------------------------------        02540000
CREA_ENA DS    0H                                                       02550000
         TM    ICTSAFOP,ICTS$ENA  EXTERNAL SECURITY ACTIVE              02560000
         BO    CREA_DEL           YES, CHECK IF ENVIRON EXIST           02570000
                                                                        02580000
         MVC   USRNAME,USERID     COPY USERID TO IUSER BLOCK            02590000
         LA    R1,001             LOG USER'S ACCESS                     02600000
         BAS   R14,MSGRTN1        CALL MESSAGE ROUTINE                  02610000
                                                                        02620000
         @CALL ISAFUADD,(IUSER,*ISAFMSGA,*ISAFMSGL),            133649 +02630000
               MF=(E,MFE_LIST)                                  133649  02640000
         LTR   R15,R15            ENTITY ADD SUCCESSFUL         133649  02650000
         BNZ   ERR_ENT            NO, FAIL LOGON REQUEST        133649  02660000
                                                                        02670000
         B     WRN_NACT           EXTERNAL SECURITY NOT ACTIVE          02680000
                                                                        02690000
*---------------------------------------------------------------        02700000
*  Delete security environment if ACEE is currently present             02710000
*---------------------------------------------------------------        02720000
CREA_DEL DS    0H                                                       02730000
         ICM   R0,15,USRACEE      USER ALREADY ACTIVE?                  02740000
         BZ    CREA_ENV           NO, CREATE ENVIRONMENT                02750000
                                                                        02760000
         $SAF  DELETE,USER=IUSER,MF=(E,$SAF_MFL)                        02770000
                                                                        02780000
*---------------------------------------------------------------        02790000
*  Authenticate user's access and create security environment           02800000
*---------------------------------------------------------------        02810000
CREA_ENV DS    0H                                                       02820000
         MVC   USRNAME,USERID     COPY USERID TO IUSER BLOCK    133649  02830000
                                                                        02840000
         @CALL ISAFUADD,(IUSER,*ISAFMSGA,*ISAFMSGL),            133649 +02850000
               MF=(E,MFE_LIST)                                  133649  02860000
         LTR   R15,R15            ENTITY ADD SUCCESSFUL         133649  02870000
         BNZ   ERR_ENT            NO, FAIL LOGON REQUEST        133649  02880000
                                                                        02890000
         LM    R0,R1,$$RRVERF     ADDR/LEN OR VERIFY PLIST              02900000
         LA    R14,RACF_MFL       TARGET ADDRESS                        02910000
         LR    R15,R1             TARGET LENGTH                         02920000
         MVCL  R14,R0             COPY VERIFY PLIST                     02930000
                                                                        02940000
         RACROUTE REQUEST=VERIFY, VERIFY USER AUTHENTICATION           +02950000
               MSGSP=0,           ALLOC MSGS IN SUBPOOL 0              +02960000
               MSGRTRN=YES,       RETURN MESSAGE TO REQUESTOR          +02970000
               REQSTOR=$INT,      INTEGRATOR IS REQUESTOR              +02980000
               SUBSYS=$INT,       INTEGRATOR IS SUBSYS                 +02990000
               DECOUPL=YES,       DON'T VERIFY REQSTOR/SUBSYS          +03000000
               WORKA=WRK512,      SAF ROUTER WORKAREA                  +03010000
               ENVIR=CREATE,      CREATE SECURITY ENVIRONMENT          +03020000
               ACEE=USRACEE,      WE'LL MANAGE THE ACEE                +03030000
               LOC=ANY,           ACEE ABOVE THE LINE                  +03040000
               USERID=USERIDL,    ADDRESS OF USERID                    +03050000
               PASSWRD=PSWDL,     ADDRESS OF PASSWORD                  +03060000
               NEWPASS=(R5),      ADDRESS OF NEWPASSWORD (IF SUPPLIED) +03070000
               PASSCHK=YES,       VERIFY USER'S PASSWORD               +03080000
               APPL=ICTAPLID,     INTEGRATOR APPLID                    +03090000
               TERMID=TSKNAME,    LUNAME                               +03100000
               GROUP=(R4),        ADDRESS OF GROUP       (IF SUPPLIED) +03110000
               RELEASE=1.9,       RELEASE 1.9 PLIST                    +03120000
               MF=(E,RACF_MFL)                                          03130000
                                                                        03140000
*---------------------------------------------------------------        03150000
*  Process SAF return codes and messages                                03160000
*---------------------------------------------------------------        03170000
         LA    R6,RACF_MFL        ADDRESS OF RACROUTE PLIST             03180000
         USING SAFP,R6            ADDRESSABILITY                        03190000
                                                                        03200000
         C     R15,=A(RC04)       DECISSION MADE BY SECURITY?           03210000
         BNE   CREA_RC            YES, SAVE SECURITY INFO               03220000
         CLC   SAFPRRET,=A(RC20)  SECURITY NOT ACTIVE?                  03230000
         BE    CREA_RC            YES, LEAVE AS RC04                    03240000
         LA    R15,RC08           FAIL ACCESS OTHERWISE                 03250000
         MVC   SAFPRRET,=A(RC20)  USER NOT DEFINED TO GROUP             03260000
         MVC   SAFPRREA,=A(RSN00)                                       03270000
                                                                        03280000
CREA_RC  DS    0H                                                       03290000
         ST    R15,RETCODE        SAVE SAF RETURN CODE                  03300000
         MVC   RSNCODE,SAFPRRET   SAVE REQUEST RETURN CODE              03310000
         MVC   INFCODE,SAFPRREA   SAVE REQUEST REASON CODE              03320000
                                                                        03330000
         C     R15,=A(RC04)       VERIFY REQUEST FAILED?                03340000
         BNH   CREA_DOC           NO, CONTINUE WITH MSG EXTRACT 133649  03350000
                                                                        03360000
         @CALL ISAFUDEL,(IUSER),MF=(E,MFE_LIST)                 133649  03370000
         MVC   USRNAME,BLANKS     CLEAR USERID                  133649  03380000
                                                                        03390000
CREA_DOC DS    0H                                               133649  03400000
         LA    R1,RACF_MFL        ADDRESS OF SAF PLIST                  03410000
         BAS   R14,SAFMSGS        PROCESS SAF MESSAGES                  03420000
                                                                        03430000
         CLC   RETCODE,=A(RC04)   ACCESS ALLOWED?                       03440000
         BH    RETURN             NO,  RETURN                           03450000
         ICM   R1,15,USRACEE      ADDRESS OF SECURITY ENVIRONMENT       03460000
         BZ    *+8                NO, SKIP ACEE INFO                    03470000
         BAS   R14,COPYACEE       COPY ACEE USER INFO                   03480000
                                                                        03490000
         LA    R1,001             LOG USER'S ACCESS                     03500000
         BAS   R14,MSGRTN1        CALL MESSAGE ROUTINE                  03510000
                                                                        03520000
         B     RETURN             RETURN                                03530000
                                                                        03540000
         EJECT ,                                                        03550000
****************************************************************        03560000
*                                                                       03570000
*  REQUEST: DELETE                                                      03580000
*                                                                       03590000
*  Process request to delete the current security environment.          03600000
*                                                                       03610000
****************************************************************        03620000
DELETE   DS    0H                                                       03630000
         MVC   USRNAME,BLANKS     RESET USERID IN IUSER BLOCK           03640000
         CLC   USERID,BLANKS      IS USERID AVAILABLE                   03650000
         BE    RETURN             NO, RETURN                            03660000
         LA    R1,002             USER LOGOFF                           03670000
         BAS   R14,MSGRTN1        ISSUE LOGOFF MESSAGE                  03680000
                                                                        03690000
         @CALL ISAFUDEL,(IUSER),MF=(E,MFE_LIST)                 133649  03700000
                                                                        03710000
         ICM   R0,15,USRACEE      SECURITY ENVIRONMENT AVAIL            03720000
         BZ    RETURN             NO, RETURN                            03730000
                                                                        03740000
*---------------------------------------------------------------        03750000
*  Delete Security environment (Signoff)                                03760000
*---------------------------------------------------------------        03770000
         LM    R0,R1,$$RRDEL      ADDR/LEN OF DELETE REQUEST PLIST      03780000
         LA    R14,RACF_MFL       TARGET ADDRESS                        03790000
         LR    R15,R1             TARGET LENGTH                         03800000
         MVCL  R14,R0             COPY DELETE PLIST                     03810000
                                                                        03820000
         RACROUTE REQUEST=VERIFY, DELETE SECURITY ENVIRONMENT          +03830000
               MSGSP=0,           ALLOC MSGS IN SUBPOOL 0              +03840000
               MSGRTRN=YES,       RETURN MESSAGE TO REQUESTOR          +03850000
               REQSTOR=$INT,      INTEGRATOR IS REQUESTOR              +03860000
               SUBSYS=$INT,       INTEGRATOR IS SUBSYS                 +03870000
               DECOUPL=YES,       DON'T VERIFY REQSTOR/SUBSYS          +03880000
               WORKA=WRK512,      SAF ROUTER WORKAREA                  +03890000
               ENVIR=DELETE,      CREATE SECURITY ENVIRONMENT          +03900000
               ACEE=USRACEE,      ACEE MANAGEMENT ANCHOR               +03910000
               RELEASE=1.9,       RELEASE 1.9 PLIST                    +03920000
               MF=(E,RACF_MFL)                                          03930000
                                                                        03940000
         XC    USRACEE,USRACEE    CLEAR ACEE ADDRESS                    03950000
                                                                        03960000
*---------------------------------------------------------------        03970000
*   Process SAF return codes and messages                               03980000
*---------------------------------------------------------------        03990000
         LA    R6,RACF_MFL        ADDRESS OF RACROUTE PLIST             04000000
         USING SAFP,R6            ADDRESSABILITY                        04010000
                                                                        04020000
         ST    R15,RETCODE        SAVE SAF RETURN CODE                  04030000
         MVC   RSNCODE,SAFPRRET   SAVE REQUEST RETURN CODE              04040000
         MVC   INFCODE,SAFPRREA   SAVE REQUEST REASON CODE              04050000
                                                                        04060000
         LA    R1,RACF_MFL        ADDRESS OF SAF PLIST                  04070000
         BAS   R14,SAFMSGS        PROCESS SAF MESSAGES                  04080000
         B     RETURN             RETURN                                04090000
                                                                        04100000
         EJECT ,                                                        04110000
****************************************************************        04120000
*                                                                       04130000
*  REQUEST: STATUS                                                      04140000
*                                                                       04150000
*  Determine the status of the SAF (Security Authorization              04160000
*  Facility) router or specified resource class.                        04170000
*                                                                       04180000
****************************************************************        04190000
STATUS   DS    0H                                                       04200000
         TM    ICTSAFOP,ICTS$ENA  EXTERNAL SECURITY ACTIVE              04210000
         BZ    WRN_NACT           NO, RETURN                            04220000
                                                                        04230000
*---------------------------------------------------------------        04240000
*  If class name provided,  locate associated SAF Class name            04250000
*  in SAF class table.                                                  04260000
*---------------------------------------------------------------        04270000
         SR    R2,R2              ASSUME CLASS NOT PROVIDED             04280000
         ICM   R1,15,ISAFCLAS     CLASS NAME PROVIDED                   04290000
         BZ    STAT_CHK           NONE, DETERMINE IF RACF ACTIVE        04300000
         BAS   R14,CLASSLOC       LOCATE CLASS NAME                     04310000
         BNZ   STAT_RC            NOT FOUND OR INACTIVE                 04320000
         MVC   RSRCLAS,0(R1)      COPY RESOURCE CLASS                   04330000
         LA    R1,RSRCLASL        ADDRESS OF RESOURCE CLASS LENGTH      04340000
         BAS   R14,SETLEN         SET LENGTH OF RESOURCE CLASS          04350000
         SR    R2,R2              ASSUME RSRC CLASS LENGTH IS ZERO      04360000
         ICM   R2,1,RSRCLASL      IS RESOURCE CLASS SPECIFIED?          04370000
         BZ    STAT_CHK           NO,  GROUP NOT SPECIFIED              04380000
         LA    R2,RSRCLAS         ADDRESS OF RESOURCE CLASS NAME        04390000
                                                                        04400000
*---------------------------------------------------------------        04410000
*  Test status of external security system or resource class            04420000
*---------------------------------------------------------------        04430000
STAT_CHK DS    0H                                                       04440000
         LM    R0,R1,$$RRSTAT     ADDR/LEN OF STAT PLIST                04450000
         LA    R14,RACF_MFL       TARGET ADDRESS                        04460000
         LR    R15,R1             TARGET LENGTH                         04470000
         MVCL  R14,R0             COPY STAT PLIST                       04480000
                                                                        04490000
         RACROUTE REQUEST=STAT,   VERIFY SAF ROUTER STATUS             +04500000
               REQSTOR=$INT,      INTEGRATOR IS REQUESTOR              +04510000
               SUBSYS=$INT,       INTEGRATOR IS SUBSYS                 +04520000
               DECOUPL=YES,       DON'T VERIFY REQSTOR/SUBSYS          +04530000
               WORKA=WRK512,      SAF ROUTER WORKAREA                  +04540000
               CLASS=(R2),        ADDRESS OF CLASS NAME (IF PROVIDED)  +04550000
               RELEASE=1.9,       RELEASE 1.9 PLIST                    +04560000
               MF=(E,RACF_MFL)                                          04570000
                                                                        04580000
*---------------------------------------------------------------        04590000
*  Process SAF return codes and messages                                04600000
*---------------------------------------------------------------        04610000
STAT_RC  DS    0H                                                       04620000
         LA    R6,RACF_MFL        ADDRESS OF SAF PARAMETER LIST         04630000
         USING SAFP,R6            ADDRESSABILITY                        04640000
                                                                        04650000
         ST    R15,RETCODE        SAVE RETURN CODE                      04660000
         MVC   RSNCODE,SAFPRRET   SAVE REQUEST RETURN CODE              04670000
         MVC   INFCODE,SAFPRREA   SAVE REQUEST REASON CODE              04680000
                                                                        04690000
         B     RETURN             RETURN                                04700000
                                                                        04710000
         EJECT ,                                                        04720000
****************************************************************        04730000
*                                                                       04740000
*  REQUEST: RESCHECK                                                    04750000
*                                                                       04760000
*  Locate the specified resource class in the $SAF class                04770000
*  table.  If the class is not active,  return with not                 04780000
*  active class return code.  If the class is active,  issue            04790000
*  a SAF authorization check to determine if the user has               04800000
*  access to the specified resource (entity) for the requested          04810000
*  access level.                                                        04820000
*                                                                       04830000
*  If no security environment exists for the user and the               04840000
*  class is active,  then fail the request.                             04850000
*                                                                       04860000
****************************************************************        04870000
RESCHECK DS    0H                                                       04880000
         TM    ICTSAFOP,ICTS$ENA  EXTERNAL SECURITY ACTIVE              04890000
         BZ    WRN_NACT           NO, RETURN                            04900000
                                                                        04910000
*---------------------------------------------------------------        04920000
*  Obtain resource class name and determine if class is active          04930000
*---------------------------------------------------------------        04940000
         ICM   R1,15,ISAFCLAS     CLASS NAME PROVIDED                   04950000
         BZ    ERR_REQ            NO, REQUEST ERROR                     04960000
         BAS   R14,CLASSLOC       LOCATE CLASS NAME                     04970000
         BNZ   RCHK_RC            RESC CHECK RETURN CODE PROCESSING     04980000
         MVC   RSRCLAS,0(R1)      COPY RESOURCE CLASS NAME              04990000
         LA    R1,RSRCLASL        ADDRESS OF CLASS LENGTH               05000000
         BAS   R14,SETLEN         SET LENGTH OF CLASS NAME              05010000
                                                                        05020000
         ICM   R0,15,USRACEE      SECURITY ENVIRONMENT EXIST            05030000
         BZ    ERR_ACC            YES, FAIL ACCESS ATTEMPT              05040000
                                                                        05050000
*---------------------------------------------------------------        05060000
*  Construct ENTITYX format                                             05070000
*---------------------------------------------------------------        05080000
RCHK_ENT DS    0H                                                       05090000
         ICM   R3,15,ISAFENTL     LENGTH OF RESOURCE ENTITY             05100000
         BZ    ERR_REQ            REQUEST ERROR IF ZERO                 05110000
         ICM   R4,15,ISAFENTY     ADDRESS OF RESOURCE ENTITY            05120000
                                                                        05130000
         @TRIM (R4),(R3),CHAR=NULL CALCULATE TRIMMED LENGTH             05140000
         LTR   R1,R1              ENTITY NAME SUPPLIED?                 05150000
         BZ    ERR_REQ            NO, REQUEST ERROR                     05160000
                                                                        05170000
         LA    R0,L'WRK256-1      LENGTH OF ENTITYX BUFFER              05180000
         STH   R0,WRK256          SET LENGTH OF BUFFER                  05190000
         STH   R1,WRK256+2        SET LENGTH OF ENTITY                  05200000
                                                                        05210000
         BCTR  R1,0               PREPARE FOR EX                        05220000
         EX    R1,*+4             MOVE ENTITY INTO BUFFER               05230000
         MVC   WRK256+4(*-*),0(R4)  *** EX OBJECT ***                   05240000
                                                                        05250000
*---------------------------------------------------------------        05260000
*  Verify user's access to resource                                     05270000
*---------------------------------------------------------------        05280000
         L     R3,ISAFACCS        RESOURCE ACCESS TYPE                  05290000
         SR    R4,R4              CLEAR ACEE POINTER            116328  05300000
         ICM   R5,15,ISAFUTKN     UTOKEN PROVIDED?              116328  05310000
         BNZ   RCHK_TKN           USE UTOKEN FOR RESOURCE CHECK 116328  05320000
         LTR   R7,R7              IUSER ADDRESS AVAILABLE?      116328  05330000
         BZ    ERR_ACC            ERROR, IUSER REQUIRED         116328  05340000
         L     R4,USRACEE         ADDRESS OF SECURITY ENVIRON           05350000
                                                                        05360000
RCHK_TKN DS    0H                                                       05370000
         LM    R0,R1,$$RRCHCK     ADDR/LEN OF AUTH PLIST                05380000
         LA    R14,RACF_MFL       TARGET ADDRESS                        05390000
         LR    R15,R1             TARGET LENGTH                         05400000
         MVCL  R14,R0             COPY AUTH PLIST                       05410000
                                                                        05420000
         ICM   R0,15,ISAFLOGG     LOGGING ACTIVE?               103656  05430000
         BZ    RCHK_NLG           NO, DON'T LOG REQUEST         103656  05440000
                                                                        05450000
         RACROUTE REQUEST=AUTH,   VERIFY SAF ROUTER STATUS             +05460000
               MSGSP=0,           ALLOC MSGS IN SUBPOOL 0              +05470000
               MSGRTRN=YES,       RETURN MESSAGE TO REQUESTOR          +05480000
               REQSTOR=$INT,      INTEGRATOR IS REQUESTOR              +05490000
               SUBSYS=$INT,       INTEGRATOR IS SUBSYS                 +05500000
               DECOUPL=YES,       DON'T VERIFY REQSTOR/SUBSYS          +05510000
               WORKA=WRK512,      SAF ROUTER WORKAREA                  +05520000
               ACEE=(R4),         USER'S SECURITY ENVIRONMENT          +05530000
               UTOKEN=(R5),       UTOKEN                        116328 +05540000
               CLASS=RSRCLASL,    ADDRESS OF CLASS NAME                +05550000
               ENTITYX=WRK256,    ADDRESS OF RESOURCE ENTITY           +05560000
               ATTR=(R3),         ACCESS TYPE                          +05570000
               RELEASE=1.9,       RELEASE 1.9 PLIST                    +05580000
               MF=(E,RACF_MFL)                                          05590000
                                                                        05600000
         B     RCHK_RC            PROCESS SAF RETURN CODE               05610000
                                                                        05620000
RCHK_NLG DS    0H                                               103656  05630000
         RACROUTE REQUEST=AUTH,   VERIFY SAF ROUTER STATUS      103656 +05640000
               MSGSP=0,           ALLOC MSGS IN SUBPOOL 0       103656 +05650000
               MSGRTRN=YES,       RETURN MESSAGE TO REQUESTOR   103656 +05660000
               REQSTOR=$INT,      INTEGRATOR IS REQUESTOR       103656 +05670000
               SUBSYS=$INT,       INTEGRATOR IS SUBSYS          103656 +05680000
               DECOUPL=YES,       DON'T VERIFY REQSTOR/SUBSYS   103656 +05690000
               WORKA=WRK512,      SAF ROUTER WORKAREA           103656 +05700000
               LOG=NOSTAT,        DON'T LOG USER'S ACCESS       103656 +05710000
               ACEE=(R4),         USER'S SECURITY ENVIRONMENT   103656 +05720000
               UTOKEN=(R5),       UTOKEN                        103656 +05730000
               CLASS=RSRCLASL,    ADDRESS OF CLASS NAME         103656 +05740000
               ENTITYX=WRK256,    ADDRESS OF RESOURCE ENTITY    103656 +05750000
               ATTR=(R3),         ACCESS TYPE                   103656 +05760000
               RELEASE=1.9,       RELEASE 1.9 PLIST             103656 +05770000
               MF=(E,RACF_MFL)                                  103656  05780000
                                                                        05790000
*---------------------------------------------------------------        05800000
*  Process SAF return codes and messages                                05810000
*---------------------------------------------------------------        05820000
RCHK_RC  DS    0H                                                       05830000
         LA    R6,RACF_MFL        ADDRESS OF SAF PARAMETER LIST         05840000
         USING SAFP,R6            ADDRESSABILITY                        05850000
                                                                        05860000
         ST    R15,RETCODE        SAVE RETURN CODE                      05870000
         MVC   RSNCODE,SAFPRRET   SAVE REQUEST RETURN CODE              05880000
         MVC   INFCODE,SAFPRREA   SAVE REQUEST REASON CODE              05890000
                                                                        05900000
         LA    R1,RACF_MFL        ADDRESS OF SAF PLIST                  05910000
         BAS   R14,SAFMSGS        PROCESS SAF MESSAGES                  05920000
         B     RETURN             RETURN                                05930000
                                                                        05940000
         EJECT ,                                                        05950000
****************************************************************        05960000
*                                                                       05970000
*  RETURN                                                               05980000
*                                                                       05990000
****************************************************************        06000000
                                                                        06010000
WRN_NACT DS    0H                                                       06020000
         LA    R15,RC04           SAF / RESOURCE NOT ACTIVE             06030000
         ST    R15,RETCODE        SAVE RETURN CODE                      06040000
         B     RETURN             RETURN                                06050000
                                                                        06060000
ERR_ACC  DS    0H                                                       06070000
         LA    R15,RC08           ACCESS DENIED                         06080000
         ST    R15,RETCODE        SAVE RETURN CODE                      06090000
         B     RETURN             RETURN                                06100000
                                                                        06110000
ERR_ENT  DS    0H                                               133649  06120000
         LA    R15,RC12           ENTITY ERROR                  133649  06130000
         ST    R15,RETCODE        SAVE RETURN CODE              133649  06140000
         B     RETURN             RETURN                        133649  06150000
                                                                        06160000
ERR_REQ  DS    0H                                                       06170000
         LA    R15,RC20           REQUEST ERROR                         06180000
         ST    R15,RETCODE        SAVE RETURN CODE                      06190000
         B     RETURN             RETURN                                06200000
                                                                        06210000
RETURN   DS    0H                                                       06220000
         ICM   R0,15,ISAFLOGG     LOG=YES SPECIFIED             103656  06230000
         BZ    RET_TRAC           NO, SKIP DEFAULT MESSAGE      103656  06240000
         LA    R1,RACF_MFL        ADDRESS OF SAF PLIST                  06250000
         BAS   R14,MSGDFT         BUILD DEFAULT MESSAGE                 06260000
                                                                        06270000
RET_TRAC DS    0H                                               103656  06280000
         $TRACE *=A(TRC_ACFSAF),32 SECURITY TRACE EVENT                 06290000
         BNZ   RET_EXIT           TRACE EVENT NOT ACTIVE                06300000
         MVC   0(4,R1),ISAFREQ    REQUEST CODE                          06310000
         MVC   4(12,R1),RETINFO   R15-R1                                06320000
         MVC   16(L'USERID,R1),USERID                                   06330000
         MVC   24(L'RSRCLAS,R1),RSRCLAS                                 06340000
                                                                        06350000
RET_EXIT DS    0H                                                       06360000
         LM    R15,R1,RETINFO     RETRIEVE RETURN INFORMATION           06370000
         #EXIT ,                  RETURN                                06380000
         DROP  R6                 SAFP                                  06390000
                                                                        06400000
         EJECT ,                                                        06410000
****************************************************************        06420000
*                                                                       06430000
* ROUTINE: CLASSLOC - Locate Resource Class name                        06440000
*                                                                       06450000
* DESCRIPTION:                                                          06460000
*                                                                       06470000
*   This routine will attempt to locate the resource class              06480000
*   in the SAF class table.  If the internal class name is              06490000
*   located successfully,  the address of the SAF class                 06500000
*   name is returned and the return code is set to indicate             06510000
*   whether or not the class is active.                                 06520000
*                                                                       06530000
* ENTRY: R1 Contains the address of the internal class name             06540000
*                                                                       06550000
* EXIT:  R15 Contains one of the following return codes:                06560000
*                                                                       06570000
*            RC00 - Resource class found and active                     06580000
*                   R1 = Address of the SAF Class name                  06590000
*                                                                       06600000
*            RC04 - Resource class not active                           06610000
*                   R1 = Address of the SAF Class name                  06620000
*                                                                       06630000
*            RC20 - Request Error. Invalid Class name                   06640000
*                                                                       06650000
****************************************************************        06660000
CLASSLOC DS    0H                                                       06670000
         STM   R0,R15,REGSAVE     SAVE CALLER'S REGISTERS               06680000
                                                                        06690000
         ICM   R5,15,ICTCLAS@     ADDRESS OF CLASS TABLE                06700000
         BZ    CLOC_ERR           TABLE NOT FOUND                       06710000
         USING $SCHDR,R5          SAF CLASS TABLE HEADER FORMAT         06720000
                                                                        06730000
         ICM   R4,15,$SCHCNT      TOTAL NUMBER OF RSRC ENTRIES          06740000
         BZ    CLOC_ERR           CLASS NOT FOUND IN TABLE              06750000
         L     R5,$SCHFRST        ADDRESS OF FIRST ENTRY                06760000
         USING $SCLENT,R5         SAF CLASS TABLE ENTRY FORMAT          06770000
                                                                        06780000
CLOC_NXT DS    0H                                                       06790000
         CLC   $SCLRSRC,0(R1)     RESOURCE SPECIFIED IN CLASS TABLE     06800000
         BE    CLOC_MAT           YES, ENTRY MATCH                      06810000
         LA    R5,$SCLLN(,R5)     ADDRESS OF NEXT ENTRY                 06820000
         BCT   R4,CLOC_NXT        CHECK NEXT ENTRY                      06830000
         B     CLOC_ERR           CLASS NOT FOUND                       06840000
                                                                        06850000
CLOC_MAT DS    0H                                                       06860000
         LA    R1,$SCLNAME        RESOURCE CLASS NAME                   06870000
         LA    R15,RC00           ASSUME CLASS IS ACTIVE                06880000
         TM    $SCLFLAG,$SCL$ACT  RESOURCE CLASS ACTIVE                 06890000
         BO    CLOC_RET           RETURN                                06900000
         LA    R15,RC04           RESOURCE CLASS NOT ACTIVE             06910000
         B     CLOC_RET           RETURN                                06920000
                                                                        06930000
CLOC_ERR DS    0H                                                       06940000
         LA    R15,RC20           REQUEST ERROR                         06950000
                                                                        06960000
CLOC_RET DS    0H                                                       06970000
         LM    R2,R14,REGSAVE+8   RESTORE CALLER'S REGISTERS            06980000
         LTR   R15,R15            SET COMPLETION STATUS                 06990000
         BR    R14                RETURN                                07000000
         DROP  R5                 $SCLENT                               07010000
                                                                        07020000
         EJECT ,                                                        07030000
****************************************************************        07040000
*                                                                       07050000
*  ROUTINE: COPYACEE - COPY USER INFO FROM ACEE                         07060000
*                                                                       07070000
*  DESCRIPTION:                                                         07080000
*                                                                       07090000
*    THIS ROUTINE WILL COPY THE USERID, GROUP, AND USERNAME             07100000
*    FROM THE ACEE.                                                     07110000
*                                                                       07120000
*  ENTRY:  R1 ADDRESS OF THE ACEE CONTROL BLOCK.                        07130000
*                                                                       07140000
*  EXIT:   N/A                                                          07150000
*                                                                       07160000
****************************************************************        07170000
COPYACEE DS    0H                                                       07180000
         STM   R0,R15,REGSAVE     SAVE CALLER'S REGISTER                07190000
                                                                        07200000
         LR    R2,R1              ADDRESS OF ACEE                       07210000
         USING ACEE,R2            ADDRESSABILTY                         07220000
                                                                        07230000
         MVC   USERID,ACEEUSRI    COPY USERID NAME                      07240000
         MVC   GROUP,ACEEGRPN     COPY GROUP  NAME                      07250000
                                                                        07260000
         ICM   R1,15,ACEEUNAM     USER NAME ADDRESS                     07270000
         BZ    ACEE_RET           NO, RETURN                            07280000
         SR    R3,R3              PREPARE FOR INSERT                    07290000
         ICM   R3,1,0(R1)         GET LENGTH OF USER                    07300000
         BZ    ACEE_RET           0, RETURN                             07310000
         C     R3,=A(L'NAME)      GREATER THAN NAME MAX                 07320000
         BL    *+8                NO, COPY NAME                         07330000
         LA    R3,L'NAME          MAXIMUM NAME LENGTH                   07340000
         MVC   NAME,BLANKS        PAD ENTIRE FIELD W/ BLANKS            07350000
         MVC   NAME(*-*),1(R1)    *** EX OBJECT ***                     07360000
         EX    R3,*-6             COPY PROGRAMMER NAME FIELD            07370000
                                                                        07380000
ACEE_RET DS    0H                                                       07390000
         LM    R0,R15,REGSAVE     RESTORE CALLER'S REGISTER             07400000
         BR    R14                RETURN                                07410000
                                                                        07420000
         EJECT ,                                                        07430000
****************************************************************        07440000
*                                                                       07450000
*  ROUTINE: SETLEN  - SET STRING LENGTH                                 07460000
*                                                                       07470000
*  DESCRIPTION:                                                         07480000
*                                                                       07490000
*    This routine will calculate the trimmed length of the              07500000
*    8-byte string following the 1-byte string length and               07510000
*    set the trimmed string length.                                     07520000
*                                                                       07530000
*  ENTRY:  R1 contains the address of a 1 byte area followed            07540000
*          by an 8-byte string padded with blanks.                      07550000
*                                                                       07560000
*  EXIT:   N/A                                                          07570000
*                                                                       07580000
****************************************************************        07590000
SETLEN   DS    0H                                                       07600000
         STM   R0,R15,REGSAVE     SAVE CALLER'S REGISTER                07610000
         LR    R2,R1              ADDRESS OF LEN/STRING                 07620000
                                                                        07630000
         @TRIM 1(R2),8,CHAR=NULL  CALC LENGTH OF STRING                 07640000
         STC   R1,0(R2)           SET STRING LENGTH                     07650000
                                                                        07660000
         LM    R0,R15,REGSAVE     RESTORE CALLER'S REGISETER            07670000
         BR    R14                RETURN                                07680000
                                                                        07690000
         EJECT ,                                                        07700000
****************************************************************        07710000
*                                                                       07720000
*  ROUTINE: SAFMSGS - Promote Security system messages                  07730000
*                                                                       07740000
*  DESCRIPTION:                                                         07750000
*                                                                       07760000
*    This routine processes the messages returned in the                07770000
*    SAF parameter list.  The $MSG service is used to                   07780000
*    accumulate messages into the message buffer and echo               07790000
*    the messages to the appropriate destination.  If LOG=NO            07800000
*    was specified on the $SAF request,  the DESTination                07810000
*    parameter is overriden to allow messages to be accumulated         07820000
*    into the message buffer.  Each message is separately               07830000
*    freemained as per SAF convention.                                  07840000
*                                                                       07850000
*  ENTRY:  R1 Contains the address of the SAF parameter list            07860000
*          mapped by ICHSAFP.                                           07870000
*                                                                       07880000
*  EXIT:   N/A                                                          07890000
*                                                                       07900000
****************************************************************        07910000
SAFMSGS  DS    0H                                                       07920000
         STM   R0,R15,REGSAVE     SAVE CALLER'S REGISTERS               07930000
                                                                        07940000
         LR    R6,R1              ADDRESS OF SAF PLIST                  07950000
         USING SAFP,R6            ADDRESSABILITY                        07960000
                                                                        07970000
         ICM   R4,15,SAFPMSAD     ADDRESS OF RETURN MSG                 07980000
         BZ    MSG_RET            NO RETURN MESSAGES                    07990000
                                                                        08000000
MSG_NEXT DS    0H                                                       08010000
         L     R0,0(,R4)          LENGTH OF MESSAGE                     08020000
         SH    R0,=AL2(8)         LESS LENGTH OF PREFIX                 08030000
         LA    R1,8(,R4)          SCAN ORIGIN                           08040000
                                                                        08050000
*---------------------------------------------------------------        08060000
*  SCAN FOR MESSAGE TEXT IN WTO BUFFER.  THE MESSAGE TEXT MAY           08070000
*  BE IN WTO MULTILINE FORMAT IN VARIOUS FLAVORS OF THE WTO             08080000
*  PARAMETER LIST, THEREFORE WE WILL JUST SCAN FOR THE TEXT.            08090000
*--------------------------------------------------------------         08100000
MSG_SCAN DS    0H                                                       08110000
         BAS   R14,MSGLOC         LOCATE MESSAGE TEXT                   08120000
         BNZ   MSG_FREE           FREE MESSAGE BUFFER                   08130000
         ST    R1,MSGTEXT@        ADDRESS OF MESSAGE TEXT               08140000
         ST    R0,MSGTEXTL        LENGTH OF MESSAGE TEXT                08150000
                                                                        08160000
*---------------------------------------------------------------        08170000
*  SELECT MESSAGE ID AND ISSUE MESSAGE, ACCUMULATING TO THE             08180000
*  MESSAGE BUFFER IN $MSGBUF FORMAT.                                    08190000
*---------------------------------------------------------------        08200000
         LA    R3,998             ASSUME SECURITY VIOLATION MSGID       08210000
         CLC   RETCODE,=A(RC08)   DID SAF REQUEST FAIL?                 08220000
         BNL   *+8                YES, ISSUE MESSAGE                    08230000
         LA    R3,999             SECURITY MESSAGE JOURNAL              08240000
                                                                        08250000
         $MSG  (R3),FIELDS=((*MSGTEXT@,*MSGTEXTL)),MSGID=NO,           +08260000
               BUFR=*ISAFMSGA,BUFL=*ISAFMSGL,DEST=$BUFFER               08270000
                                                                        08280000
         ICM   R0,15,ISAFLOGG     SAF LOGGING ACTIVE?                   08290000
         BZ    MSG_SCNX           NO, LOGGING OF MESSAGE                08300000
                                                                        08310000
         $MSG  (R3),FIELDS=((*MSGTEXT@,*MSGTEXTL)),MSGID=NO             08320000
                                                                        08330000
MSG_SCNX DS    0H                                                       08340000
         L     R1,MSGTEXT@        ADDRESS OF MESSAGE TEXT               08350000
         A     R1,MSGTEXTL        PLUS LENGTH FOR NEW SCAN LOC          08360000
         LR    R2,R1              SCAN ORIGIN                           08370000
         SR    R2,R4              LENGTH ALREADY SCANNED                08380000
         L     R0,0(,R4)          TOTAL MESSAGE LENGTH                  08390000
         SR    R0,R2              REMAINING MESSAGE LENGTH              08400000
         BP    MSG_SCAN           SCAN FOR MULTILINE WTO MSG TEXT       08410000
                                                                        08420000
*---------------------------------------------------------------        08430000
*  FREE THE MESSAGE BUFFER                                              08440000
*---------------------------------------------------------------        08450000
MSG_FREE DS    0H                                                       08460000
         L     R3,4(,R4)          ADDRESS OF NEXT MESSAGE               08470000
         L     R5,0(,R4)          LENGTH  OF CURRENT MESSAGE            08480000
                                                                        08490000
         TM    ICTSTAT2,ICT2$SUP  ARE WE SUP STATE?                     08500000
         BZ    MSG_FRE1           NO,  JUST TRY THE FREE                08510000
         IVSK  R1,R4              GET KEY OF MESSAGE STORAGE            08520000
         MODESET KEYREG=R1,SAVEKEY=(2)  SWITCH TO STORAGE KEY           08530000
                                                                        08540000
MSG_FRE1 DS    0H                                                       08550000
         FREEMAIN RC,LV=(R5),A=(R4)  RELEASE MESSAGE BUFFER             08560000
                                                                        08570000
         TM    ICTSTAT2,ICT2$SUP  RUNNING SUP STATE?                    08580000
         BZ    MSG_FRE2           NO, GET NEXT MESSAGE                  08590000
         MODESET KEYADDR=(2)      RESTORE TO OUR KEY                    08600000
                                                                        08610000
MSG_FRE2 DS    0H                                                       08620000
         LTR   R4,R3              ADDRESS OF NEXT MESSAGE               08630000
         BNZ   MSG_NEXT           PROCESS NEXT MESSAGE                  08640000
                                                                        08650000
MSG_RET  DS    0H                                                       08660000
         LM    R0,R15,REGSAVE     RESTORE CALLER'S REGISTERS            08670000
         BR    R14                RETURN                                08680000
         DROP  R6                 SAFP                                  08690000
                                                                        08700000
         EJECT ,                                                        08710000
****************************************************************        08720000
*                                                                       08730000
* ROUTINE: MSGLOC - Scan for message in WTO Message Buffer              08740000
*                                                                       08750000
* DESCRIPTION:                                                          08760000
*                                                                       08770000
*    This routine will scan the specified WTO message buffer            08780000
*    searching for 4 or more consecutive printable EBCDIC               08790000
*    characters.                                                        08800000
*                                                                       08810000
* ENTRY:   R1 - Starting address for message scan                       08820000
*          R0 - Length of message area to scan                          08830000
*                                                                       08840000
* EXIT:    R15 contains one of the following return codes               08850000
*                                                                       08860000
*              RC00 - Message text located                              08870000
*                     R1 = Message origin                               08880000
*                     R0 = Message length                               08890000
*                                                                       08900000
*              RC04 - Message not found in buffer                       08910000
*                                                                       08920000
****************************************************************        08930000
MSGLOC   DS    0H                                                       08940000
         STM   R0,R15,REGSAVE2    SAVE CALLER'S REGISTERS               08950000
                                                                        08960000
         LR    R4,R1              SCAN ORIGIN                           08970000
         LR    R3,R0              SCAN LENGTH                           08980000
                                                                        08990000
         L     R1,=A(SCANTAB)     MSG TRANSLATE SCAN TABLE              09000000
         MVC   WRK256,0(R1)       COPY CHARACTER HIT  TABLE             09010000
         XC    WRK256,=256X'FF'   MAKE CHARACTER MISS TABLE             09020000
                                                                        09030000
*---------------------------------------------------------------        09040000
*  SCAN FOR START OF MESSAGE                                            09050000
*---------------------------------------------------------------        09060000
MLOC_SCN DS    0H                                                       09070000
         LA    R5,256             MAXIMUM LENGTH OF SCAN                09080000
         CR    R5,R3              REMAINING LENGTH LESS THAN MAX        09090000
         BL    *+6                NO,  USE MAXIMUM LENGTH               09100000
         LR    R5,R3              USE REMAINING LENGTH                  09110000
                                                                        09120000
         BCTR  R5,0               PREPARE FOR EX INSTR                  09130000
         L     R1,=A(SCANTAB)     MSG TRANSLATE SCAN TABLE              09140000
         TRT   0(*-*,R4),0(R1)    *** EX OBJECT ***                     09150000
         EX    R5,*-6             SCAN FOR CHARACTER HIT                09160000
         BC    HITS,MLOC_HIT      MESSAGE START???                      09170000
                                                                        09180000
         LA    R4,1(R5,R4)        ADVANCE SCAN ORIGIN                   09190000
         SR    R3,R5              SUBTRACT LENGTH OF SCAN               09200000
         BCTR  R3,0               PLUS 1 MORE FOR EX PREPARE            09210000
         LTR   R3,R3              ANYTHING LEFT                         09220000
         BNZ   MLOC_SCN           YES, CONTINUE SCAN FOR CHAR           09230000
         B     MLOC_NF            MESSAGE NOT FOUND                     09240000
                                                                        09250000
MLOC_HIT DS    0H                                                       09260000
         LR    R6,R1              ORIGIN OR MESSAGE START               09270000
         LR    R2,R1              SCAN TERMINATED AT CHARACTER          09280000
         SR    R2,R4              CALC LENGTH OF SCAN                   09290000
         SR    R3,R2              REMAINING LENGTH OF STRING            09300000
         LR    R4,R1              SET REMAINING STRING ORIGIN           09310000
         LA    R7,0(R3,R4)        ASSUME MESSAGE END OF STRING          09320000
                                                                        09330000
*---------------------------------------------------------------        09340000
*  SCAN FOR FIRST NON PRINTABLE CHAR                                    09350000
*---------------------------------------------------------------        09360000
MLOC_END DS    0H                                                       09370000
         LA    R5,256             MAXIMUM LENGTH OF SCAN                09380000
         CR    R5,R3              REMAINING LENGTH LESS THAN MAX        09390000
         BL    *+6                NO, USE MAXIMUM LENGTH                09400000
         LR    R5,R3              USE REMAINING LENGTH                  09410000
                                                                        09420000
         BCTR  R5,0               PREPARE FOR EX INSTR                  09430000
         TRT   0(*-*,R4),WRK256   *** EX OBJECT ***                     09440000
         EX    R5,*-6             SCAN FOR NON PRINT CHARACTER          09450000
         BC    HITS,MLOC_EOM      END OF MESSAGE FOUND                  09460000
                                                                        09470000
         LA    R4,1(R5,R4)        ADVANCE SCAN ORIGIN                   09480000
         SR    R3,R5              SUBTRACT LENGTH OF SCAN               09490000
         BCTR  R3,0               PLUS 1 MORE FOR EX PREPARE            09500000
         LTR   R3,R3              ANYTHING LEFT                         09510000
         BNZ   MLOC_END           YES, KEEP SCANNING FOR END            09520000
         B     MLOC_DON           CALC MSG LENGTH                       09530000
                                                                        09540000
MLOC_EOM DS    0H                 END OF MESSAGE                        09550000
         LR    R7,R1              FIRST NON PRINTABLE CHARACTER         09560000
         LR    R2,R1              SCAN TERMINATED AT CHARACTER          09570000
         SR    R2,R4              CALC LENGTH OF SCAN                   09580000
         SR    R3,R2              REMAINING LENGTH OF STRING            09590000
         LR    R4,R1              SET REMAINING STRING ORIGIN           09600000
                                                                        09610000
*---------------------------------------------------------------        09620000
*  PRINTABLE TEXT FOUND,  ASSUME MESSAGE IF GREATER THAN 4 BYTES        09630000
*---------------------------------------------------------------        09640000
MLOC_DON DS    0H                                                       09650000
         LR    R0,R7              END OF MESSAGE (PAST MSG)             09660000
         SR    R0,R6              CALC MESSAGE LENGTH                   09670000
         CH    R0,=AL2(4)         AT LEAST FOUR BYTES FOR MSG           09680000
         BNL   MLOC_FND           RETURN MESSAGE                        09690000
                                                                        09700000
         LTR   R3,R3              ANYTHING LEFT TO SCAN                 09710000
         BNZ   MLOC_SCN           YES,  RETRY ENTIRE SCAN               09720000
                                                                        09730000
MLOC_NF  DS    0H                                                       09740000
         LA    R15,RC04           MESSAGE NOT FOUND                     09750000
         B     MLOC_RET           RETURN                                09760000
                                                                        09770000
MLOC_FND DS    0H                                                       09780000
         LR    R1,R6              MESSAGE ORIGIN                        09790000
         LA    R15,RC00           MESSAGE RETURNED                      09800000
                                                                        09810000
MLOC_RET DS    0H                                                       09820000
         LM    R2,R14,REGSAVE2+8  RESTORE CALLER'S REGISTERS            09830000
         LTR   R15,R15            SET COMPLETION STATUS                 09840000
         BR    R14                RETURN                                09850000
                                                                        09860000
         EJECT ,                                                        09870000
****************************************************************        09880000
*                                                                       09890000
* ROUTINE: MSGDFT - Generate default msg if no SAF msg returned         09900000
*                                                                       09910000
* DESCRIPTION:                                                          09920000
*                                                                       09930000
*   This routine will lookup the SAF request, SAF RC, RACF-RC           09940000
*   and RACF-RSN in the message tables located later in this            09950000
*   CSECT.  If SAF messages are not returned and a message ID           09960000
*   and routine are available,  then a default message is               09970000
*   constructed in the message buffer.                                  09980000
*                                                                       09990000
*                                                                       10000000
* ENTRY:   R1  - ADDRESS OF SAF PARAMETER LIST                          10010000
*                                                                       10020000
* EXIT:    R15 - N/A                                                    10030000
*                                                                       10040000
****************************************************************        10050000
MSGDFT   DS    0H                                                       10060000
         STM   R0,R15,REGSAVE     SAVE CALLER'S REGISTERS               10070000
                                                                        10080000
         LR    R6,R1              ADDRESS OF SAF REQUEST BLOCK          10090000
         USING SAFP,R6            ADDRESSABILITY                        10100000
                                                                        10110000
         ICM   R0,15,SAFPMSAD     MESSAGES RETURNED BY SAF?             10120000
         BNZ   MDFT_RET           YES,  NO NEED FOR DFT MSG             10130000
                                                                        10140000
         MVC   MSGBF@,ISAFMSGA    MESSAGE BUFFER ADDRESS                10150000
         MVC   MSGBFL,ISAFMSGL    MESSAGE BUFFER LENGTH                 10160000
                                                                        10170000
*---------------------------------------------------------------        10180000
* LOCATE REQUEST TABLE ENTRY                                            10190000
*---------------------------------------------------------------        10200000
         LH    R2,SAFPREQT        REQUEST TYPE                          10210000
         C     R2,=A($REQTAB#)    WITHIN REQUEST TABLE RANGE            10220000
         BNL   MDFT_RET           NO, RETURN                            10230000
                                                                        10240000
         L     R7,=A($REQTAB)     ADDRESS OF SAF REQUEST TABLE          10250000
         MH    R2,=AL2(REQTBLN)   CALC OFFSET IN REQUEST TABLE          10260000
         LA    R7,0(R2,R7)        ADDRESS OF REQUEST ENTRY              10270000
         USING REQTBL,R7          ADDRESSABILITY                        10280000
                                                                        10290000
         MVC   MSGID,REQMSG#      DEFAULT REQUEST MESSAGE NUMBER        10300000
         MVC   MSGRTN,REQMRTN     DEFAULT REQUEST MESSAGE ROUTINE       10310000
         MVC   REQUEST,REQTYPE    SAVE REQUEST TYPE                     10320000
                                                                        10330000
*---------------------------------------------------------------        10340000
* LOCATE SAF REQUEST RETURN CODE TABLE                                  10350000
*---------------------------------------------------------------        10360000
         ICM   R5,15,REQRCTB      RETURN CODE TABLE AVAILABLE           10370000
         BZ    MDFT_BLD           BUILD DFT MESSAGE                     10380000
         L     R2,RETCODE         RETRIEVE RETURN CODE                  10390000
         SRL   R2,2               DIVIDE BY 4                           10400000
         C     R2,REQRCTB#        RETURN CODE WITHIN RANGE              10410000
         BNL   MDFT_BLD           NO, BUILD DFT MESSAGE                 10420000
         MH    R2,=AL2(RCTBLN)    CALC OFFSET IN RETURN CODE TABLE      10430000
         LA    R5,0(R2,R5)        ADDRESS OF RETURN CODE ENTRY          10440000
         USING RCTBL,R5           ADDRESS OF SAF RETURN CODE ENTRY      10450000
                                                                        10460000
         MVC   MSGID,RCMSG#       DEFAULT REQUEST MESSAGE NUMBER        10470000
         MVC   MSGRTN,RCMRTN      DEFAULT REQUEST MESSATE ROUTINE       10480000
                                                                        10490000
*---------------------------------------------------------------        10500000
* LOCATE RACF RETURN CODE TABLE ENTRY                                   10510000
*---------------------------------------------------------------        10520000
         ICM   R0,15,RCRTBL@      RETURN CODE TABLE AVAILABLE           10530000
         BZ    MDFT_BLD           BUILD DFT MESSAGE                     10540000
         L     R2,SAFPRRET        RETRIEVE RACF RETURN CODE             10550000
         SRL   R2,2               DIVIDE BY 4                           10560000
         C     R2,RCRTBL#         RETURN CODE WITHIN RANGE              10570000
         BNL   MDFT_BLD           NO, BUILD DFT MESSAGE                 10580000
         MH    R2,=AL2(RCTBLN)    CALC OFFSET IN RETURN CODE TABLE      10590000
         LR    R5,R0              ADDRESS OF RETURN CODE TABLE          10600000
         LA    R5,0(R2,R5)        ADDRESS OF RETURN CODE ENTRY          10610000
         USING RCTBL,R5           ADDRESS OF RACF RETURN CODE ENTRY     10620000
                                                                        10630000
         MVC   MSGID,RCMSG#       MESSAGE NUMBER                        10640000
         MVC   MSGRTN,RCMRTN      MESSATE ROUTINE                       10650000
                                                                        10660000
*---------------------------------------------------------------        10670000
* LOCATE RACF REASON CODE TABLE ENTRY                                   10680000
*---------------------------------------------------------------        10690000
         ICM   R0,15,RCRTBL@      RETURN CODE TABLE AVAILABLE           10700000
         BZ    MDFT_BLD           BUILD DFT MESSAGE                     10710000
         L     R2,SAFPRREA        RETRIEVE RACF REASON CODE             10720000
         SRL   R2,2               DIVIDE BY 4                           10730000
         C     R2,RCRTBL#         RETURN CODE WITHIN RANGE              10740000
         BNL   MDFT_BLD           NO, BUILD DFT MESSAGE                 10750000
         MH    R2,=AL2(RSNTBLN)   CALC OFFSET IN RETURN CODE TABLE      10760000
         LR    R5,R0              ADDRESS OF REASON CODE TABLE          10770000
         LA    R5,0(R2,R5)        ADDRESS OF REASON CODE ENTRY          10780000
         USING RSNTBL,R5          ADDRESS OF RACF REASON CODE ENTRY     10790000
                                                                        10800000
         MVC   MSGID,RSNMSG#      MESSAGE NUMBER                        10810000
         MVC   MSGRTN,RSNMRTN     MESSATE ROUTINE                       10820000
                                                                        10830000
*---------------------------------------------------------------        10840000
* BUILD DEFAULT MESSAGE                                                 10850000
*---------------------------------------------------------------        10860000
MDFT_BLD DS    0H                                                       10870000
         ICM   R1,15,MSGID        MESSAGE NUMBER AVAILABLE              10880000
         BZ    MDFT_RET           NO, RETURN                            10890000
         ICM   R15,15,MSGRTN      MESSAGE ROUTINE AVAILABLE             10900000
         BZ    MDFT_RET           NO, RETURN                            10910000
                                                                        10920000
         BASR  R14,R15            CALL MESSSAGE ROUTINE                 10930000
                                                                        10940000
*---------------------------------------------------------------        10950000
* RETURN                                                                10960000
*---------------------------------------------------------------        10970000
MDFT_RET DS    0H                                                       10980000
         LM    R0,R15,REGSAVE     RESTORE CALLER'S REGISTER             10990000
         BR    R14                RETURN                                11000000
         DROP  R5,R6,R7           RSNTBL, SAFP, REQTBL                  11010000
                                                                        11020000
         EJECT ,                                                        11030000
****************************************************************        11040000
*                                                                       11050000
* Routine: MSGRTN0 - Default Req/ RC / RACF RC / RACF RSN MSGRTN        11060000
*                                                                       11070000
* Entry: R1 = Message ID                                                11080000
*                                                                       11090000
* Exit:  N/A                                                            11100000
*                                                                       11110000
****************************************************************        11120000
MSGRTN0  DS    0H                                                       11130000
         STM   R0,R15,REGSAVE2    SAVE CALLER'S REGISTERS               11140000
         LR    R2,R1              GET MESSAGE ID                        11150000
                                                                        11160000
         $MSG  (R2),FIELDS=(REQUEST,RETCODE,RSNCODE,INFCODE),          +11170000
               BUFR=*MSGBF@,BUFL=*MSGBFL                                11180000
                                                                        11190000
         LM    R0,R15,REGSAVE2    RESTORE CALLER'S REGISTERS            11200000
         BR    R14                RETURN                                11210000
                                                                        11220000
         EJECT ,                                                        11230000
****************************************************************        11240000
*                                                                       11250000
* Routine: MSGRTN1 - Generate verify msg (USERID, GROUP, NAME)          11260000
*                                                                       11270000
* Entry: R1 = Message ID                                                11280000
*                                                                       11290000
* Exit:  N/A                                                            11300000
*                                                                       11310000
****************************************************************        11320000
MSGRTN1  DS    0H                                                       11330000
         STM   R0,R15,REGSAVE2    SAVE CALLER'S REGISTERS               11340000
         LR    R2,R1              GET MESSAGE ID                        11350000
                                                                        11360000
         $MSG  (R2),FIELDS=(USERID,GROUP,NAME),                        +11370000
               BUFR=*MSGBF@,BUFL=*MSGBFL                                11380000
                                                                        11390000
         LM    R0,R15,REGSAVE2    RESTORE CALLER'S REGISTERS            11400000
         BR    R14                RETURN                                11410000
                                                                        11420000
         EJECT ,                                                        11430000
****************************************************************        11440000
*                                                                       11450000
* Routine: MSGRTN2 - Generate Resource msg (Rsrc class)                 11460000
*                                                                       11470000
* Entry: R1 = Message ID                                                11480000
*                                                                       11490000
* Exit:  N/A                                                            11500000
*                                                                       11510000
****************************************************************        11520000
MSGRTN2  DS    0H                                                       11530000
         STM   R0,R15,REGSAVE2    SAVE CALLER'S REGISTERS               11540000
         LR    R2,R1              GET MESSAGE ID                        11550000
                                                                        11560000
         $MSG  (R2),FIELDS=(RSRCLAS),                                  +11570000
               BUFR=*MSGBF@,BUFL=*MSGBFL                                11580000
                                                                        11590000
         LM    R0,R15,REGSAVE2    RESTORE CALLER'S REGISTERS            11600000
         BR    R14                RETURN                                11610000
                                                                        11620000
         EJECT ,                                                        11630000
****************************************************************        11640000
*                                                                       11650000
*  CONSTANTS, LITERALS, AND MAPPINGS                                    11660000
*                                                                       11670000
****************************************************************        11680000
$INT     DC    CL8'INTEGRAT'      INTEGRATOR REQSTOR AND SUBSYS         11690000
BLANKS   DC    CL20' '            BLANKS                                11700000
                                                                        11710000
         PRINT NOGEN                                                    11720000
                                                                        11730000
$$RRVERF DC    A($RACVERF,$RACV_LN)   ADDR/LEN OF RACROUTE VERIFY       11740000
$$RRDEL  DC    A($RACDEL,$RACD_LN)    ADDR/LEN OF RACROUTE DELETE       11750000
$$RRCHCK DC    A($RACHECK,$RACC_LN)   ADDR/LEN OF RACROUTE AUTH         11760000
$$RRSTAT DC    A($RACSTAT,$RACS_LN)   ADDR/LEN OF RACROUTE STAT         11770000
                                                                        11780000
         LTORG ,                                                        11790000
                                                                        11800000
*---------------------------------------------------------------        11810000
*                                                                       11820000
*  RACROUTE PLIST PROTOTYPES                                            11830000
*                                                                       11840000
*---------------------------------------------------------------        11850000
$RACVERF RACROUTE REQUEST=VERIFY,ENVIR=CREATE,RELEASE=1.9,MF=L          11860000
$RACV_LN EQU   *-$RACVERF                                               11870000
                                                                        11880000
$RACDEL  RACROUTE REQUEST=VERIFY,ENVIR=DELETE,RELEASE=1.9,MF=L          11890000
$RACD_LN EQU   *-$RACDEL                                                11900000
                                                                        11910000
$RACHECK RACROUTE REQUEST=AUTH,RELEASE=1.9,MF=L                         11920000
$RACC_LN EQU   *-$RACHECK                                               11930000
                                                                        11940000
$RACSTAT RACROUTE REQUEST=STAT,RELEASE=1.9,MF=L                         11950000
$RACS_LN EQU   *-$RACSTAT                                               11960000
                                                                        11970000
         EJECT ,                                                        11980000
*****************************************************************       11990000
*                                                                       12000000
* Message scan translate table                                          12010000
*                                                                       12020000
*****************************************************************       12030000
SCANTAB  DC    XL256'00'          INITIALIZE SCAN TABLE                 12040000
         ORG   SCANTAB+C' '                                             12050000
         DC    X'FF'              ' '                                   12060000
         ORG   SCANTAB+C''                                             12070000
         DC    7X'FF'              . < ( +  &                         12080000
         ORG   SCANTAB+C'!'                                             12090000
         DC    8X'FF'             ! $ * ) ;   - /                       12100000
         ORG   SCANTAB+C''                                             12110000
         DC    6X'FF'              , % _ > ?                           12120000
         ORG   SCANTAB+C'`'                                             12130000
         DC    7X'FF'             ` ; # @ ' = "                         12140000
         ORG   SCANTAB+C'a'                                             12150000
         DC    9X'FF'             a - i                                 12160000
         ORG   SCANTAB+C'j'                                             12170000
         DC    9X'FF'             j - r                                 12180000
         ORG   SCANTAB+C'~'                                             12190000
         DC    9X'FF'             ~ s - z                               12200000
         ORG   SCANTAB+C'{'                                             12210000
         DC    10X'FF'            { A - I                               12220000
         ORG   SCANTAB+C'}'                                             12230000
         DC    10X'FF'            } J - R                               12240000
         ORG   SCANTAB+C'\'                                             12250000
         DC    X'FF'              \                                     12260000
         ORG   SCANTAB+C'S'                                             12270000
         DC    8X'FF'             S - Z                                 12280000
         ORG   SCANTAB+C'0'                                             12290000
         DC    10X'FF'            0 - 9                                 12300000
         ORG   ,                                                        12310000
                                                                        12320000
         EJECT ,                                                        12330000
****************************************************************        12340000
*                                                                       12350000
*  The following tables provide a means to locate a specific            12360000
*  message number and message routine for a given SAF request/          12370000
*  SAF RC / RACF RC / RACF RSN.  At each level in these tables          12380000
*  a subordinant level may optionally be specified to produce           12390000
*  a unique message number and message routine.  The msg driver         12400000
*  routine only attempts to locate a unique message# if the SAF         12410000
*  interface fails to return a message.                                 12420000
*                                                                       12430000
*  If a return/reason code is out of range of the specified             12440000
*  table, then the lookup processing stops at that level and            12450000
*  the current default message ID and routine is used to produce        12460000
*  a message to be returned.                                            12470000
*                                                                       12480000
****************************************************************        12490000
                                                                        12500000
$REQTAB  DS    0F                                                       12510000
         DC    CL8'INTEGRAT',A($INTTABL,$INTTRC#,020,MSGRTN0)           12520000
         DC    CL8'AUTH    ',A($AUTHSAF,$AUTHSR#,099,MSGRTN0)           12530000
         DC    CL8'FASTAUTH',A(0,0,0,0)                                 12540000
         DC    CL8'LIST    ',A(0,0,0,0)                                 12550000
         DC    CL8'DEFINE  ',A(0,0,0,0)                                 12560000
         DC    CL8'VERIFY  ',A($VERFSAF,$VERFSR#,099,MSGRTN0)           12570000
         DC    CL8'EXTRACT ',A(0,0,0,0)                                 12580000
         DC    CL8'DIRAUTH ',A(0,0,0,0)                                 12590000
         DC    CL8'TOKENMAP',A(0,0,0,0)                                 12600000
         DC    CL8'VERIFYX ',A(0,0,0,0)                                 12610000
         DC    CL8'TOKENXTR',A(0,0,0,0)                                 12620000
         DC    CL8'TOKENBLD',A(0,0,0,0)                                 12630000
         DC    CL8'EXTRACT ',A(0,0,0,0)                                 12640000
         DC    CL8'AUDIT   ',A(0,0,0,0)                                 12650000
         DC    CL8'STAT    ',A($STATSAF,$STATSR#,099,MSGRTN0)           12660000
         DC    CL8'SIGNON  ',A(0,0,0,0)                                 12670000
$REQTAB# EQU   (*-$REQTAB)/REQTBLN                                      12680000
                                                                        12690000
*---------------------------------------------------------------        12700000
*  SAF REQUEST RETURN CODE TABLE                                        12710000
*---------------------------------------------------------------        12720000
$INTTABL DC    A(0,0,0,0)                          RC00                 12730000
         DC    A(0,0,0,0)                          RC04                 12740000
         DC    A(0,0,008,MSGRTN2)                  RC08                 12750000
         DC    A(0,0,0,0)                          RC12                 12760000
         DC    A(0,0,0,0)                          RC16                 12770000
         DC    A(0,0,020,MSGRTN0)                  RC20                 12780000
$INTTRC# EQU   (*-$INTTABL)/RCTBLN                                      12790000
                                                                        12800000
$AUTHSAF DC    A(0,0,0,0)                          RC00                 12810000
         DC    A(0,0,0,0)                          RC04                 12820000
         DC    A($AUTHRC,$AUTHRC#,099,MSGRTN0)     RC08                 12830000
$AUTHSR# EQU   (*-$AUTHSAF)/RCTBLN                                      12840000
                                                                        12850000
$VERFSAF DC    A(0,0,0,0)                          RC00                 12860000
         DC    A(0,0,0,0)                          RC04                 12870000
         DC    A($VERFRC,$VERFRC#,099,MSGRTN0)     RC08                 12880000
$VERFSR# EQU   (*-$VERFSAF)/RCTBLN                                      12890000
                                                                        12900000
$STATSAF DC    A(0,0,0,0)                          RC00                 12910000
         DC    A($STATRC,$STATRC#,099,MSGRTN0)     RC04                 12920000
         DC    A(0,0,0,0)                          RC08                 12930000
$STATSR# EQU   (*-$STATSAF)/RCTBLN                                      12940000
                                                                        12950000
         EJECT ,                                                        12960000
*---------------------------------------------------------------        12970000
*  REQUEST=AUTH (RC08,*,*) RETURN CODE TABLE                            12980000
*---------------------------------------------------------------        12990000
$AUTHRC  DC    A(0,0,0,0)                          RC00                 13000000
         DC    A(0,0,0,0)                          RC04                 13010000
         DC    A($AUTH08,$AUTH08#,099,MSGRTN0)     RC08                 13020000
         DC    A(0,0,100,MSGRTN1)                  RC12                 13030000
         DC    A(0,0,100,MSGRTN1)                  RC16                 13040000
$AUTHRC# EQU   (*-$AUTHRC)/RCTBLN                                       13050000
                                                                        13060000
*---------------------------------------------------------------        13070000
*  REQUEST=AUTH (RC08,RC08,*) REASON CODE TABLE                         13080000
*---------------------------------------------------------------        13090000
$AUTH08  DC    A(099,MSGRTN0)                      RSN00                13100000
         DC    A(099,MSGRTN0)                      RSN04                13110000
         DC    A(099,MSGRTN0)                      RSN08                13120000
         DC    A(099,MSGRTN0)                      RSN12                13130000
         DC    A(099,MSGRTN0)                      RSN16                13140000
         DC    A(099,MSGRTN0)                      RSN20                13150000
         DC    A(099,MSGRTN0)                      RSN24                13160000
         DC    A(099,MSGRTN0)                      RSN28                13170000
         DC    A(099,MSGRTN0)                      RSN32                13180000
         DC    A(099,MSGRTN0)                      RSN36                13190000
         DC    A(099,MSGRTN0)                      RSN40                13200000
$AUTH08# EQU   (*-$AUTH08)/RSNTBLN                                      13210000
                                                                        13220000
         EJECT ,                                                        13230000
*---------------------------------------------------------------        13240000
*  REQUEST=VERIFY (RC08,*,*) RETURN CODE TABLE                          13250000
*---------------------------------------------------------------        13260000
$VERFRC  DC    A(0,0,0,0)                          RC00                 13270000
         DC    A(0,0,0,0)                          RC04                 13280000
         DC    A(0,0,208,MSGRTN1)                  RC08                 13290000
         DC    A(0,0,212,MSGRTN1)                  RC12                 13300000
         DC    A(0,0,216,MSGRTN1)                  RC16                 13310000
         DC    A(0,0,099,MSGRTN0)                  RC20                 13320000
         DC    A(0,0,099,MSGRTN0)                  RC24                 13330000
         DC    A(0,0,228,MSGRTN1)                  RC28                 13340000
         DC    A(0,0,099,MSGRTN0)                  RC32                 13350000
         DC    A(0,0,099,MSGRTN0)                  RC36                 13360000
         DC    A(0,0,099,MSGRTN1)                  RC40                 13370000
         DC    A(0,0,099,MSGRTN1)                  RC44                 13380000
         DC    A($VERF48,$VERF48#,248,MSGRTN1)     RC48                 13390000
         DC    A(0,0,252,MSGRTN1)                  RC52                 13400000
         DC    A(0,0,099,MSGRTN0)                  RC56                 13410000
         DC    A(0,0,099,MSGRTN0)                  RC60                 13420000
         DC    A(0,0,099,MSGRTN0)                  RC64                 13430000
         DC    A(0,0,099,MSGRTN0)                  RC68                 13440000
         DC    A(0,0,099,MSGRTN0)                  RC72                 13450000
         DC    A(0,0,099,MSGRTN0)                  RC76                 13460000
         DC    A(0,0,099,MSGRTN0)                  RC80                 13470000
         DC    A(0,0,099,MSGRTN0)                  RC84                 13480000
$VERFRC# EQU   (*-$VERFRC)/RCTBLN                                       13490000
                                                                        13500000
*---------------------------------------------------------------        13510000
*  REQUEST=VERIFY (RC08,RC48,*) REASON CODE TABLE                       13520000
*---------------------------------------------------------------        13530000
$VERF48  DC    A(248,MSGRTN1)                      RSN00                13540000
         DC    A(249,MSGRTN1)                      RSN04                13550000
         DC    A(250,MSGRTN1)                      RSN08                13560000
$VERF48# EQU   (*-$VERF48)/RSNTBLN                                      13570000
                                                                        13580000
         EJECT ,                                                        13590000
*---------------------------------------------------------------        13600000
*  REQUEST=STAT (RC04,*,*) RETURN CODE TABLE                            13610000
*---------------------------------------------------------------        13620000
$STATRC  DC    A(0,0,0,0)                          RC00                 13630000
         DC    A(0,0,0,0)                          RC04                 13640000
         DC    A(0,0,0,0)                          RC08                 13650000
         DC    A(0,0,0,0)                          RC12                 13660000
         DC    A(0,0,0,0)                          RC16                 13670000
         DC    A(0,0,0,0)                          RC20                 13680000
         DC    A(0,0,0,0)                          RC24                 13690000
         DC    A(0,0,0,0)                          RC28                 13700000
$STATRC# EQU   (*-$STATRC)/RCTBLN                                       13710000
                                                                        13720000
         EJECT ,                                                        13730000
****************************************************************        13740000
*                                                                       13750000
*  MAPPING: REQTBL - SAF Request message table                          13760000
*                                                                       13770000
****************************************************************        13780000
REQTBL   DSECT ,                                                        13790000
REQTYPE  DS    CL8                SAF REQUEST TYPE                      13800000
REQRCTB  DS    A                  ADDRESS OF SAF RC TABLE               13810000
REQRCTB# DS    F                  DEPTH   OF SAF RC TABLE               13820000
REQMSG#  DS    F                  DEFAULT MESSAGE NUMBER                13830000
REQMRTN  DS    A                  DEFAULT MESSAGE ROUTINE               13840000
REQTBLN  EQU   *-REQTBL           LENGTH OF REQUEST TABLE ENTRY         13850000
                                                                        13860000
****************************************************************        13870000
*                                                                       13880000
*  MAPPING: RCTBL - SAF/RACF Return code message table                  13890000
*                                                                       13900000
****************************************************************        13910000
RCTBL    DSECT ,                                                        13920000
RCRTBL@  DS    A                  ADDRESS OF RET/RSN TABLE              13930000
RCRTBL#  DS    F                  DEPTH OF NEXT LEVEL TABLE             13940000
RCMSG#   DS    F                  MESSAGE NUMBER                        13950000
RCMRTN   DS    A                  MESSAGE ROUTINE                       13960000
RCTBLN   EQU   *-RCTBL            LENGTH OF RC TABLE ENTRY              13970000
                                                                        13980000
****************************************************************        13990000
*                                                                       14000000
*  MAPPING: RSNTBL - RACF Reason code message table                     14010000
*                                                                       14020000
****************************************************************        14030000
RSNTBL   DSECT ,                                                        14040000
RSNMSG#  DS    F                  MESSAGE NUMBER                        14050000
RSNMRTN  DS    A                  MESSAGE ROUTINE                       14060000
RSNTBLN  EQU   *-RSNTBL           LENGTH OF RSN TABLE ENTRY             14070000
                                                                        14080000
         EJECT ,                                                        14090000
         ICHSAFP ,                                                      14100000
                                                                        14110000
         PRINT NOGEN                                                    14120000
         ICVT  ,                                                        14130000
         ITASK ,                                                        14140000
         IPCB  ,                                                        14150000
         IUSER ,                                                        14160000
         IHAACEE ,                                                      14170000
         PRINT GEN                                                      14180000
                                                                        14190000
         END   ,                                                        14200000
