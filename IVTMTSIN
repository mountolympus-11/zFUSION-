IVTMTSIN TITLE 'INTEGRATOR - SLU INTEGRATOR SESSION DRIVER (TEST)'      00010000
**<DOC-ON>************************************************************* 00020000
*                                                                       00030000
* ROUTINE: IVTMTSIN - SLU INTEGRATOR SESSION DRIVER (TEST)              00040000
*                                                                       00050000
* DESCRIPTION: THE SESSION DRIVER IS STARTED AS A NEW PROC UNDER        00060000
*              THE SESSION ITASK WHEN A NEW SESSION IS ESTABLISHED.     00070000
*                                                                       00080000
* ON ENTRY:                                                             00090000
*                                                                       00100000
*    R15 = ENTRY POINT ADDRESS                                          00110000
*    R14 = RETURN ADDRESS                                               00120000
*    R13 = AVAILABLE SAVE AREA                                          00130000
*    R11 = ICVT ADDRESS                                                 00140000
*    R10 = ITASK ADDRESS                                                00150000
*    R01 = ADDRESS OF THE SESSION TOKEN                                 00160000
*                                                                       00170000
* ON EXIT:                                                              00180000
*                                                                       00190000
*    R15 = 0                                                            00200000
*    R00 = 0                                                            00210000
*    R01 = 0                                                            00220000
*                                                                       00230000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00240000
*                                                                       00250000
**<DOC-OFF>************************************************************ 00260000
                                                                        00270000
         EJECT ,                                                        00280000
*********************************************************************** 00290000
*                                                                       00300000
* MAINTENANCE:                                                          00310000
*                                                                       00320000
*   08/01/93 RANDY WITEK                                                00330000
*                                                                       00340000
*********************************************************************** 00350000
                                                                        00360000
         EQUS  ,                  GENERAL EQUATES                       00370000
                                                                        00380000
RICVT    EQU   R11                                                      00390000
RITASK   EQU   R10                                                      00400000
RIVTAM   EQU   R9                                                       00410000
RTOKEN   EQU   R8                                                       00420000
RSPLISTR EQU   R7                                                       00430000
RSPLISTS EQU   R6                                                       00440000
                                                                        00450000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00460000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00470000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00480000
         USING SPLIST,RSPLISTR    ESTABLISH ADDRESSABILITY              00490000
S        USING SPLIST,RSPLISTS    ESTABLISH ADDRESSABILITY              00500000
                                                                        00510000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00520000
WRK256   DS    XL256              GENERAL WORKAREA                      00530000
                                                                        00540000
LV1SAVE  DS    18F                SUBROUTINE SAVE AREA                  00550000
LV0SAVE  DS    18F                SUBROUTINE SAVE AREA                  00560000
                                                                        00570000
SNASTATE DS    F                  EXTRACT AREA                          00580000
                                                                        00590000
$TASKMFL $TASK MF=L               $TASK PLIST CONSTRUCTION              00600000
$SESSRCV DS    A                  $SESS PLIST ADDRESS                   00610000
$SESSSND DS    A                  $SESS PLIST ADDRESS                   00620000
$SESSEX  $SESS MF=L,FIELDS=((SNASTATE,SNASTATE,,4))                     00630000
                                                                        00640000
RCVEPB   DS    F                  RECEIVE EPB ADDRESS                   00650000
                                                                        00660000
ECODE    DS    F                  LAST EVENT CODE                       00670000
                                                                        00680000
RETR15   DS    F                                                        00690000
RETR0    DS    F                                                        00700000
RETR1    DS    F                                                        00710000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      00720000
                                                                        00730000
FLAGS    DS    X                  FLAG BYTE                             00740000
FLAGSQUI EQU   X'80'              QUIET MODE                            00750000
                                                                        00760000
DATASAVE DS    XL4096                                                   00770000
WORKLEN  #ENDWORK                 END OF WORKAREA                       00780000
                                                                        00790000
         $MSGDFT PREFIX=ICTPID,                                        +00800000
               COMPID='VTM',                                           +00810000
               TABLE=*#MSGS,                                           +00820000
               WORKA=0,                                                +00830000
               MF=(E,WRK256),                                          +00840000
               PRINT=NOGEN                                              00850000
                                                                        00860000
IVTMTSIN #ENTER BASE=R12,         ENTRY LINKAGE                        +00870000
               AMODE=31,                                               +00880000
               PREG=RTOKEN,                                            +00890000
               RMODE=ANY                                                00900000
                                                                        00910000
*---------------------------------------------------------------------- 00920000
* ESTABLISH ENVIRONMENT                                                 00930000
*---------------------------------------------------------------------- 00940000
                                                                        00950000
         L     RIVTAM,ICTVTCVT    IVTAMCVT ADDRESS                      00960000
         LA    RTOKEN,1(,RTOKEN)  POINT PAST LENGTH BYTE                00970000
                                                                        00980000
*---------------------------------------------------------------------- 00990000
* SET "QUIET MODE" IF REQUESTED                                         01000000
*---------------------------------------------------------------------- 01010000
                                                                        01020000
         BAS   R14,QUIETEST       CHECK FOR QUIET MODE                  01030000
                                                                        01040000
*---------------------------------------------------------------------- 01050000
* ISSUE AN INFORMATIVE MESSAGE                                          01060000
*---------------------------------------------------------------------- 01070000
                                                                        01080000
         TM    FLAGS,FLAGSQUI     QUIET MODE?                           01090000
         BO    SKIP12             BRANCH IF YES                         01100000
                                                                        01110000
         $MSG  012,               "VTAM DRIVER TOKEN...STARTING"       +01120000
               FIELDS=(((RTOKEN),4), SESSION TOKEN                     +01130000
               (4(,RTOKEN),4),       SESSION TOKEN PART2               +01140000
               (RITASK),             ITASK ADDRESS                     +01150000
               (TSKPCBC,4),          IPROC ADDRESS                     +01160000
               (TSKNAME,8))          ITASK NAME                         01170000
                                                                        01180000
SKIP12   DS    0H                                                       01190000
                                                                        01200000
*---------------------------------------------------------------------- 01210000
* INITIALIZE THE EPB FOR $SESS_RECEIVE OPERATIONS                       01220000
*---------------------------------------------------------------------- 01230000
                                                                        01240000
         $TASK SETEPB,                                                 +01250000
               ECODE=1025,                                             +01260000
               ERRET=ERR$TASK,                                         +01270000
               MF=(E,$TASKMFL)    ALLOCATE AN XEPB                      01280000
                                                                        01290000
         ST    R1,RCVEPB          SAVE XEPB ADDRESS                     01300000
                                                                        01310000
*---------------------------------------------------------------------- 01320000
* ALLOCATE SEND AND RECEIVE SPLISTS FROM ITASK STORAGE                  01330000
*---------------------------------------------------------------------- 01340000
                                                                        01350000
         $GETSTOR L'SPL,                                               +01360000
               LOC=ANY,                                                +01370000
               OWNER=(RITASK)                                           01380000
                                                                        01390000
         ST    R1,$SESSRCV                                              01400000
                                                                        01410000
         $GETSTOR L'SPL,                                               +01420000
               LOC=ANY,                                                +01430000
               OWNER=(RITASK)                                           01440000
                                                                        01450000
         ST    R1,$SESSSND                                              01460000
                                                                        01470000
*---------------------------------------------------------------------- 01480000
* START THE FIRST RECEIVE                                               01490000
*---------------------------------------------------------------------- 01500000
                                                                        01510000
         $SESS $SESS_RECEIVE,                                          +01520000
               SESSION=(RTOKEN),                                       +01530000
               EPB=*RCVEPB,                                            +01540000
               ERRET=ERR$RCV,                                          +01550000
               MF=(E,*$SESSRCV)                                         01560000
                                                                        01570000
*---------------------------------------------------------------------- 01580000
* WAIT FOR AN EVENT TO OCCUR AND JUMP TO THE PROCESSING ROUTINE         01590000
*---------------------------------------------------------------------- 01600000
                                                                        01610000
WAITWORK DS    0H                                                       01620000
                                                                        01630000
         $TASK WAIT,              WAIT FOR EVENT                       +01640000
               MF=(E,$TASKMFL)                                          01650000
                                                                        01660000
         ST    R15,ECODE          SAVE THE EVENT CODE                   01670000
                                                                        01680000
         C     R15,=A(1025)       IS A RCV COMPLETE?                    01690000
         BE    RCV                BRANCH IF YES                         01700000
                                                                        01710000
         C     R15,=A(EC$STOP)    IS PROC STOP REQUESTED?               01720000
         BE    PSTP               BRANCH IF YES                         01730000
                                                                        01740000
         C     R15,=A(EC$CNCL)    IS PROC CANCEL REQUESTED?             01750000
         BE    PCAN               BRANCH IF YES                         01760000
                                                                        01770000
         B     WAITWORK           IGNORE ANYTHING ELSE                  01780000
                                                                        01790000
*---------------------------------------------------------------------- 01800000
* PROCESS A $SESS_RECEIVE COMPLETION                                    01810000
*---------------------------------------------------------------------- 01820000
                                                                        01830000
RCV      DS    0H                                                       01840000
                                                                        01850000
         L     RSPLISTR,$SESSRCV  THE RECEIVE PARM LIST                 01860000
         L     RSPLISTS,$SESSSND  THE SEND    PARM LIST                 01870000
         BAS   R14,DISPRCV        DIAGNOSTIC DISPLAY                    01880000
                                                                        01890000
*                                                                       01900000
* TEST THE RETURN CODE                                                  01910000
*---------------------------------------------------------------------- 01920000
                                                                        01930000
         CLC   SPLRETCD,=A($SESS_RC_SUCCESS)                            01940000
         BE    RCVCONT                          CHECK WHAT WAS RECEIVED 01950000
                                                                        01960000
         CLC   SPLRETCD,=A($SESS_RC_FUNCTION)                           01970000
         BE    ERR$RCV                          HOW DID THIS HAPPEN     01980000
                                                                        01990000
         CLC   SPLRETCD,=A($SESS_RC_ENVIRONMENT)                        02000000
         BE    ERR$RCV                          HOW DID THIS HAPPEN     02010000
                                                                        02020000
         CLC   SPLRETCD,=A($SESS_RC_LENGTH)                             02030000
         BE    ERR$RCV                          HOW DID THIS HAPPEN     02040000
                                                                        02050000
         CLC   SPLRETCD,=A($SESS_RC_BUSY)                               02060000
         BE    ERR$RCV                          HOW DID THIS HAPPEN     02070000
                                                                        02080000
         CLC   SPLRETCD,=A($SESS_RC_CANCELED)                           02090000
         BE    WAITWORK                         WAIT FOR PROC STOP      02100000
                                                                        02110000
         CLC   SPLRETCD,=A($SESS_RC_VTAMRC)                             02120000
         BE    RCVISSUE                                                 02130000
                                                                        02140000
         CLC   SPLRETCD,=A($SESS_RC_PROTOCOL)                           02150000
         BE    RCVISSUE                                                 02160000
                                                                        02170000
*                                                                       02180000
* CHECK IF A RESPONSE WAS RECEIVED                                      02190000
*---------------------------------------------------------------------- 02200000
                                                                        02210000
RCVCONT  DS    0H                                                       02220000
                                                                        02230000
                                                                        02240000
         TM    SPLRH,RHQS         WAS IT A RESPONSE?                    02250000
         BO    RCVISSUE           BRANCH IF YES                         02260000
                                                                        02270000
*                                                                       02280000
* COPY THE DATA AREA AND RELEASE IT IF THIS IS A DATA REQUEST           02290000
*---------------------------------------------------------------------- 02300000
                                                                        02310000
         TM    SPLCNTRL,RPLDATA   WAS IT A DATA REQUEST?                02320000
         BNO   RCVNAREA           BRANCH IF NOT                         02330000
         ICM   R3,15,SPLAREAL     WAS AN AREA RETURNED?                 02340000
         BZ    RCVNAREA           BRANCH IF NOT                         02350000
         L     R2,SPLAREA         ADDRESS OF DATA                       02360000
         LA    R0,DATASAVE        TEMP WORK AREA                        02370000
         L     R1,=F'4096'        SIZE OF TEMP AREA                     02380000
         MVCL  R0,R2              COPY DATA TO TEMP WORK AREA           02390000
                                                                        02400000
         $RETSTOR *SPLAREA,       RELEASE THE DATA AREA                +02410000
               OWNER=(RITASK)                                           02420000
                                                                        02430000
*                                                                       02440000
* A REQUEST WAS RECEIVED SO SEND A RESPONSE IF NEEDED                   02450000
*---------------------------------------------------------------------- 02460000
                                                                        02470000
RCVNAREA DS    0H                                                       02480000
                                                                        02490000
         BAS   R14,SENDPRSP       CALL THE RESPONSE ROUTINE             02500000
                                                                        02510000
*                                                                       02520000
* CHECK THE RECEIVED DATA                                               02530000
*---------------------------------------------------------------------- 02540000
                                                                        02550000
         LA    R2,DATASAVE+6      ADDRESS OF FIELD DATA                 02560000
         CLI   DATASAVE+3,X'11'   WAS SBA RECEIVED?                     02570000
         LA    R2,DATASAVE+3      UNFORMATTED DATA BEGINS HERE          02580000
         B     RCVISSUE                                                 02590000
                                                                        02600000
                                                                        02610000
*                                                                       02620000
* SEND SOME DATA                                                        02630000
*---------------------------------------------------------------------- 02640000
                                                                        02650000
SENDDATA DS    0H                                                       02660000
                                                                        02670000
                                                                        02680000
         $SESS $SESS_SEND_DATA,   SEND THE DATA                        +02690000
               SESSION=(RTOKEN),                                       +02700000
               AREA=SENDMSG,                                           +02710000
               AREALEN=L'SENDMSG,                                      +02720000
               BC=YES,EC=YES,DR1=YES,CD=YES,                           +02730000
               MF=(E,*$SESSSND)                                         02740000
         BAS   R14,DISPSND        DIAGNOSTIC DISPLAY                    02750000
                                                                        02760000
         B     RCVISSUE                                                 02770000
                                                                        02780000
SENDMSG1 DC    X'F5C31D60',C'PLATINUM INTEGRATOR'                       02790000
         DC    X'1D4013'                                                02800000
SENDMSG  EQU   SENDMSG1,*-SENDMSG1                                      02810000
                                                                        02820000
*                                                                       02830000
* RE-ISSUE THE RECEIVE                                                  02840000
*---------------------------------------------------------------------- 02850000
                                                                        02860000
RCVISSUE DS    0H                                                       02870000
                                                                        02880000
         $TASK SETEPB,                                                 +02890000
               ECODE=1025,                                             +02900000
               ERRET=ERR$TASK,                                         +02910000
               MF=(E,$TASKMFL)    ALLOCATE AN XEPB                      02920000
                                                                        02930000
         ST    R1,RCVEPB          SAVE XEPB ADDRESS                     02940000
                                                                        02950000
         $SESS $SESS_RECEIVE,                                          +02960000
               SESSION=(RTOKEN),                                       +02970000
               EPB=*RCVEPB,                                            +02980000
               ERRET=ERR$RCV,                                          +02990000
               MF=(E,*$SESSRCV)                                         03000000
                                                                        03010000
         B     WAITWORK                                                 03020000
                                                                        03030000
*---------------------------------------------------------------------- 03040000
* PROCESS A PROC STOP REQUEST                                           03050000
*---------------------------------------------------------------------- 03060000
                                                                        03070000
PSTP     DS    0H                                                       03080000
                                                                        03090000
         TM    FLAGS,FLAGSQUI     QUIET MODE?                           03100000
         BO    EXIT               BRANCH IF YES                         03110000
                                                                        03120000
         $MSG  982,                 "DRIVER PROC STOP"                 +03130000
               FIELDS=(((RTOKEN),4), SESSION TOKEN                     +03140000
               (4(,RTOKEN),4),       SESSION TOKEN PART2               +03150000
               (RITASK),             ITASK ADDRESS                     +03160000
               (TSKPCBC,4),          IPROC ADDRESS                     +03170000
               (TSKNAME,8))          ITASK NAME                         03180000
                                                                        03190000
         B     EXIT               EXIT WHEN STOP REQUESTED              03200000
                                                                        03210000
*---------------------------------------------------------------------- 03220000
* PROCESS A PROC CANCEL REQUEST                                         03230000
*---------------------------------------------------------------------- 03240000
                                                                        03250000
PCAN     DS    0H                                                       03260000
                                                                        03270000
         TM    FLAGS,FLAGSQUI     QUIET MODE?                           03280000
         BO    EXIT               BRANCH IF YES                         03290000
                                                                        03300000
         $MSG  979,                 "DRIVER PROC CANCEL"               +03310000
               FIELDS=(((RTOKEN),4), SESSION TOKEN                     +03320000
               (4(,RTOKEN),4),       SESSION TOKEN PART2               +03330000
               (RITASK),             ITASK ADDRESS                     +03340000
               (TSKPCBC,4),          IPROC ADDRESS                     +03350000
               (TSKNAME,8))          ITASK NAME                         03360000
                                                                        03370000
         B     EXIT               END TASK IMMEDIATELY                  03380000
                                                                        03390000
*---------------------------------------------------------------------- 03400000
* SUBROUTINE: SENDPRSP                                                  03410000
*---------------------------------------------------------------------- 03420000
                                                                        03430000
SENDPRSP DS     0H                                                      03440000
                                                                        03450000
         STM   R14,R12,LV1SAVE                                          03460000
                                                                        03470000
         $SESS $SESS_SEND_POSRESP,  SEND A RESPONSE AS NEEDED          +03480000
               SESSION=(RTOKEN),                                       +03490000
               RH=*,                                                   +03500000
               SEQNO=*,                                                +03510000
               CNTRL=*,                                                +03520000
               SENSE=*,                                                +03530000
               ERRET=ERR$RCV,                                          +03540000
               MF=(E,*$SESSRCV)                                         03550000
                                                                        03560000
         BAS   R14,DISPRCV          DIAGNOSTIC DISPLAY                  03570000
                                                                        03580000
         LM    R14,R12,LV1SAVE                                          03590000
         BR    R14                                                      03600000
                                                                        03610000
*---------------------------------------------------------------------- 03620000
* SUBROUTINE: SENDNRSP                                                  03630000
*---------------------------------------------------------------------- 03640000
                                                                        03650000
SENDNRSP DS     0H                                                      03660000
                                                                        03670000
         STM   R14,R12,LV1SAVE                                          03680000
                                                                        03690000
         $SESS $SESS_SEND_NEGRESP,  SEND A NEGATIVE RESPONSE           +03700000
               SESSION=(RTOKEN),                                       +03710000
               RH=*,                                                   +03720000
               SEQNO=*,                                                +03730000
               CNTRL=*,                                                +03740000
               SENSE=SNS1005,                                          +03750000
               ERRET=ERR$RCV,                                          +03760000
               MF=(E,*$SESSRCV)                                         03770000
                                                                        03780000
         BAS   R14,DISPRCV          DIAGNOSTIC DISPLAY                  03790000
                                                                        03800000
         LM    R14,R12,LV1SAVE                                          03810000
         BR    R14                                                      03820000
                                                                        03830000
SNS1005  DC    XL4'10050000'                                            03840000
                                                                        03850000
*---------------------------------------------------------------------- 03860000
* SUBROUTINE: DISPSND                                                   03870000
*---------------------------------------------------------------------- 03880000
                                                                        03890000
DISPSND  DS     0H                                                      03900000
                                                                        03910000
         STM   R14,R12,LV0SAVE                                          03920000
         L     RSPLISTS,$SESSSND                                        03930000
                                                                        03940000
         TM    FLAGS,FLAGSQUI        QUIET MODE?                        03950000
         BO    DISPSEND              BRANCH IF YES                      03960000
                                                                        03970000
DISPSOK  DS     0H                                                      03980000
                                                                        03990000
         $SESS $SESS_EXTRACT,                                          +04000000
               SESSION=(RTOKEN),                                       +04010000
               FIELDS=((SNASTATE,SNASTATE,,4)),                        +04020000
               MF=(E,$SESSEX)                                           04030000
                                                                        04040000
         $MSG  978,                  "DRIVER RECEIVE COMPLETE"         +04050000
               FIELDS=(((RTOKEN),4), SESSION TOKEN                     +04060000
               (4(,RTOKEN),4),       SESSION TOKEN PART2               +04070000
               (RSPLISTS),           SPLIST ADDRESS                    +04080000
               (S.SPLSENSE,4),       SENSE                             +04090000
               (S.SPLF1,4),          FLAGS                             +04100000
               (SNASTATE,4),         SESSION STATE                     +04110000
               (S.SPLAREA,4),        AREA  ADDRESS                     +04120000
               (S.SPLAREAL,4),       AREA  LENGTH                      +04130000
               (S.SPLCNTRL,3),       RPL CNTRL FLAGS                   +04140000
               (S.SPLRH,3),          RPL USERRH                        +04150000
               (S.SPLSEQNO,2),       RPL SEQNO                         +04160000
               (S.SPLRETCD,4),       THE RETURN CODE                   +04170000
               (S.SPLRSNCD,4),       THE REASON CODE                   +04180000
               (S.SPLFUNC,4))        THE FUNCTION                       04190000
                                                                        04200000
DISPSEND DS     0H                                                      04210000
                                                                        04220000
         LM    R14,R12,LV0SAVE                                          04230000
         BR    R14                                                      04240000
                                                                        04250000
*---------------------------------------------------------------------- 04260000
* SUBROUTINE: DISPRCV                                                   04270000
*---------------------------------------------------------------------- 04280000
                                                                        04290000
DISPRCV  DS     0H                                                      04300000
                                                                        04310000
         STM   R14,R12,LV0SAVE                                          04320000
         L     RSPLISTR,$SESSRCV                                        04330000
                                                                        04340000
         TM    FLAGS,FLAGSQUI        QUIET MODE?                        04350000
         BO    DISPREND              BRANCH IF YES                      04360000
                                                                        04370000
DISPROK  DS     0H                                                      04380000
                                                                        04390000
                                                                        04400000
         $SESS $SESS_EXTRACT,                                          +04410000
               SESSION=(RTOKEN),                                       +04420000
               FIELDS=((SNASTATE,SNASTATE,,4)),                        +04430000
               MF=(E,$SESSEX)                                           04440000
                                                                        04450000
         $MSG  978,                  "DRIVER RECEIVE COMPLETE"         +04460000
               FIELDS=(((RTOKEN),4), SESSION TOKEN                     +04470000
               (4(,RTOKEN),4),       SESSION TOKEN PART2               +04480000
               (RSPLISTR),           SPLIST ADDRESS                    +04490000
               (SPLSENSE,4),         SENSE                             +04500000
               (SPLF1,4),            FLAGS                             +04510000
               (SNASTATE,4),         SESSION STATE                     +04520000
               (SPLAREA,4),          AREA  ADDRESS                     +04530000
               (SPLAREAL,4),         AREA  LENGTH                      +04540000
               (SPLCNTRL,3),         RPL CNTRL FLAGS                   +04550000
               (SPLRH,3),            RPL USERRH                        +04560000
               (SPLSEQNO,2),         RPL SEQNO                         +04570000
               (SPLRETCD,4),         THE RETURN CODE                   +04580000
               (SPLRSNCD,4),         THE REASON CODE                   +04590000
               (SPLFUNC,4))          THE FUNCTION                       04600000
                                                                        04610000
DISPREND DS     0H                                                      04620000
                                                                        04630000
         LM    R14,R12,LV0SAVE                                          04640000
         BR    R14                                                      04650000
                                                                        04660000
*---------------------------------------------------------------------- 04670000
* SUBROUTINE: QUIETEST                                                  04680000
*---------------------------------------------------------------------- 04690000
                                                                        04700000
QUIETEST DS     0H                                                      04710000
                                                                        04720000
         STM   R14,R12,LV0SAVE                                          04730000
         L     RSPLISTS,$SESSSND                                        04740000
                                                                        04750000
         $SESS $SESS_EXTRACT,                                          +04760000
               SESSION=(RTOKEN),                                       +04770000
               FIELDS=((USERDATA,WRK256,,256)),                        +04780000
               MF=(E,$SESSEX)                                           04790000
                                                                        04800000
         LA    R2,WRK256          START OF USERDATA                     04810000
         CLC   0(1,R2),C'('       PL/1 FORMAT?                          04820000
         BNE   QUICHECK           BRANCH IF NOT                         04830000
         LA    R2,1(,R2)          PAST '('                              04840000
                                                                        04850000
QUICHECK DS     0H                                                      04860000
                                                                        04870000
         CLC   8(5,R2),=C'QUIET'  QUIET MODE REQUESTED?                 04880000
         BNE   QUIDONE            BRANCH IF NOT                         04890000
         OI    FLAGS,FLAGSQUI     SET QUIET MODE                        04900000
                                                                        04910000
QUIDONE  DS     0H                                                      04920000
                                                                        04930000
         LM    R14,R12,LV0SAVE                                          04940000
         BR    R14                                                      04950000
                                                                        04960000
*---------------------------------------------------------------------- 04970000
* EXIT TO END DRIVER PROCESS                                            04980000
*---------------------------------------------------------------------- 04990000
                                                                        05000000
EXIT     DS    0H                                                       05010000
                                                                        05020000
         LM    R15,R1,RETREGS     LOAD RETURN REGISTERS                 05030000
                                                                        05040000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    05050000
                                                                        05060000
*---------------------------------------------------------------------- 05070000
* ERROR ROUTINES                                                        05080000
*---------------------------------------------------------------------- 05090000
                                                                        05100000
ERR$TASK DS    0H                                                       05110000
                                                                        05120000
         $ABEND ABE_VTDIAG,                                            +05130000
               SCOPE=PCB,                                              +05140000
               TITLE='$TASK FAILURE'                                    05150000
                                                                        05160000
ERR$RCV  DS    0H                                                       05170000
                                                                        05180000
         CLC   SPLRETCD,=A($SESS_RC_CANCELED)                           05190000
         BE    WAITWORK                                                 05200000
                                                                        05210000
         $ABEND ABE_VTDIAG,                                            +05220000
               SCOPE=PCB,                                              +05230000
               TITLE='$SESS RECEIVE FAILURE'                            05240000
                                                                        05250000
ERR$SEND DS    0H                                                       05260000
                                                                        05270000
         CLC   S.SPLRETCD,=A($SESS_RC_CANCELED)                         05280000
         BE    WAITWORK                                                 05290000
                                                                        05300000
         $ABEND ABE_VTDIAG,                                            +05310000
               SCOPE=PCB,                                              +05320000
               TITLE='$SESS SEND FAILURE'                               05330000
                                                                        05340000
                                                                        05350000
*---------------------------------------------------------------------- 05360000
*  CONSTANTS AND LITERALS                                               05370000
*---------------------------------------------------------------------- 05380000
                                                                        05390000
         LTORG ,                                                        05400000
         PRINT NOGEN                                                    05410000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                05420000
         ISTDBIND ,               VTAM BIND IMAGE                       05430000
         ISTRH ,                  VTAM SNA REQUEST HEADER               05440000
         ICVT  ,                  INTEGRATOR CVT                        05450000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   05460000
         IRPL ,                   INTEGRATOR VTAM RPL+                  05470000
         IACB ,                   INTEGRATOR VTAM ACB+                  05480000
         INIB ,                   INTEGRATOR VTAM NIB+                  05490000
         ISESS ,                  INTEGRATOR SESSION BLOCK              05500000
         IRQE ,                   INTEGRATOR RECEIVE QUEUE ELEMENT      05510000
         IVUSER ,                 INTEGRATOR VTAM USER BLOCK            05520000
         ITASK ,                  INTEGRATOR TASK BLOCK                 05530000
         IWEVTAM ,                INTEGRATOR VTAM WORK ELEMENT          05540000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       05550000
         EVCODES ,                INTEGRATOR EVENT CODES                05560000
         ABCODES ,                INTEGRATOR $ABEND CODES               05570000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     05580000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        05590000
         $TASK DSECT=YES          INTEGRATOR $TASK SERVICES             05600000
         $PROC DSECT=YES          INTEGRATOR $PROC SERVICES             05610000
         $VTAM DSECT=YES          INTEGRATOR $VTAM SERVICES             05620000
         $SESS DSECT=YES          INTEGRATOR $SESS SERVICES             05630000
         IFGEXLST ,               VTAM EXIT LIST                        05640000
         END   ,                                                        05650000
