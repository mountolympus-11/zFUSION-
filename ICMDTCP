*   01/27/05   BXK    HPNSTST      HPNS TESTING                       *
ICMDTCP  TITLE 'INTEGRATOR - TCP COMMAND PROCESSOR'                     00010000
                                                                        00020000
         PRINT NOGEN                                                    00030000
         SOCKINCL ,                                                     00040000
         TCPINCL ,                                                      00050000
         PRINT GEN                                                      00060000
                                                                        00070000
**<DOC-ON>************************************************************* 00080000
*                                                                       00090000
*     ROUTINE: ICMDTCP - INTEGRATOR TCP COMMAND PROCESSOR               00100000
*                                                                       00110000
* DESCRIPTION: THIS ROUTINE PROCESSES THE VARIOUS FORMS OF THE TCP      00120000
*              COMMAND WHICH IS USED TO CONTROL/DISPLAY THE TCP/IP      00130000
*              IMPLEMENTATION.                                          00140000
*                                                                       00150000
*      SYNTAX: TCP DISPLAY SOCKET()                                     00160000
*              TCP DISPLAY PATH()                                       00170000
*              TCP STOP    PATH()                                       00180000
*              TCP START   CONNECTION                                   00190000
*              TCP START   APPLICATION() PORT() HOST() PARM()           00200000
*                                                                       00210000
* ON ENTRY:                                                             00220000
*                                                                       00230000
*    R15 = ENTRY POINT ADDRESS                                          00240000
*    R14 = RETURN      ADDRESS                                          00250000
*    R13 = SAVE AREA   ADDRESS                                          00260000
*    R11 = ICVT        ADDRESS                                          00270000
*    R10 = ITASK       ADDRESS                                          00280000
*    R01 = CMDREQ      ADDRESS                                          00290000
*                                                                       00300000
* ON EXIT:                                                              00310000
*                                                                       00320000
*    R15 = 0                                                            00330000
*    R00 = 0                                                            00340000
*    R01 = 0                                                            00350000
*                                                                       00360000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00370000
*                                                                       00380000
**<DOC-OFF>************************************************************ 00390000
                                                                        00400000
*********************************************************************** 00410000
*                                                                       00420000
* MAINTENANCE:                                                          00430000
*                                                                       00440000
*   10/10/94 RANDY WITEK                                                00450000
*                                                                       00460000
*********************************************************************** 00470000
                                                                        00480000
         EQUS  ,                  GENERAL EQUATES                       00490000
                                                                        00500000
RICVT    EQU   R11                                                      00510000
RITASK   EQU   R10                                                      00520000
RITC     EQU   R9                                                       00530000
RCMDREQ  EQU   R8                                                       00540000
RCCSUMRY EQU   R7                                                       00550000
RPAB     EQU   R6                                                       00560000
RSOB     EQU   R5                                                       00570000
                                                                        00580000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00590000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00600000
         USING ITC,RITC           ESTABLISH ADDRESSABILITY              00610000
         USING CMDREQ,RCMDREQ     ESTABLISH ADDRESSABILITY              00620000
         USING CCSUMRY,RCCSUMRY   ESTABLISH ADDRESSIBILITY              00630000
         USING PAB,RPAB           ESTABLISH ADDRESSIBILITY              00640000
         USING SOB,RSOB           ESTABLISH ADDRESSIBILITY              00650000
                                                                        00660000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00670000
WRK256   DS    XL256              GENERAL WORKAREA                      00680000
SUB0SAVE DS    18F                SUBROUTINE SAVE AREA                  00690000
SUB1SAVE DS    18F                SUBROUTINE SAVE AREA                  00700000
$WUMFL   $WULOC MF=L              PARM LIST CONSTRUCTION                00710000
WUDATA   DS    XL16               $WULOC USERDATA RETURN AREA           00720000
TCPRETCD DS    F                  API RETURN CODE AREA                  00730000
TCPRETPB DS    F                  API PAB RETURN AREA                   00740000
TCPRETSB DS    F                  API SOB ADDRESS RETURN AREA           00750000
TCPRETTK DS    XL8                API WU TOKEN RETURN AREA              00760000
TCPRETST DS    A                  API STRING ADDRESS RETURN AREA        00770000
TCPRETLN DS    A                  API STRING LENGTH  RETURN AREA        00780000
TCPLOCKM DS    F                  API LOCK MANAGEMENT WORD              00790000
                                                                        00800000
KMDNAME  DS    CL8                REQUEST NAME                          00810000
KMDSTAT  DS    CL8                COMMAND COMPLETION STATUS             00820000
KMDRSN   DS    CL32               COMMAND FAILURE REASON                00830000
                                                                        00840000
KMDREQ   DS    XL(L'CCSID)        REQUEST CODE                          00850000
KMDPARM  DS    CL256              STRING PARMFIELD                      00860000
KMDAPPL  DS    CL8                STRING APPLICATION NAME               00870000
KMDWTYP  DS    CL4                STRING WORK UNIT TYPE                 00880000
KMDPATH  DS    CL8                STRING PATH#                          00890000
KMDSOCK  DS    CL8                STRING SOCKET#                        00900000
KMDPORT  DS    CL8                STRING PORT#                          00910000
KMDHOST  DS    CL8                STRING HOST ADDRESS                   00920000
                                                                        00930000
KMDLPARM DS    F                  LENGTH PARMFIELD                      00940000
KMDLAPPL DS    F                  LENGTH APPLICATION NAME               00950000
KMDLWTYP DS    F                  LENGTH WORK UNIT TYPE                 00960000
KMDLPATH DS    F                  LENGTH PATH#                          00970000
KMDLSOCK DS    F                  LENGTH SOCKET#                        00980000
KMDLPORT DS    F                  LENGTH PORT#                          00990000
KMDLHOST DS    F                  LENGTH HOST ADDRESS                   01000000
                                                                        01010000
KMD#PATH DS    F                  BINARY PATH#                          01020000
KMD#SOCK DS    F                  BINARY SOCKET#                        01030000
KMD#PORT DS    F                  BINARY PORT#                          01040000
KMD#HOST DS    F                  BINARY HOST ADDRESS                   01050000
                                                                        01060000
RETR15   DS    F                                                        01070000
RETR0    DS    F                                                        01080000
RETR1    DS    F                                                        01090000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      01100000
                                                                        01110000
STRAPPL  DS    CL8                STRING APPLICATION NAME BLANK PADDED  01120000
TASKNAME DS    CL8                TEMPORARY TSKNAME AREA                01130000
PROCNAME DS    CL8                TEMPORARY PCBNAME AREA                01140000
FLAGSTRL DS    F                  LENGTH OF FLAG INTERPRETATIONS        01150000
FLAGSTR  DS    CL80               AREA TO BUILD FLAG INTERPRETATIONS    01160000
MSGMAXSD DS    F                                                        01170000
MSGEIBSZ DS    F                                                        01180000
MSGPHASH DS    F                                                        01190000
MSGTHASH DS    F                                                        01200000
DOTFORML DS    F                                                        01210000
IUCVSEND DS    0C                                                       01220000
MSGSOUT  DS    CL20                                                     01230000
IUCVQ    DS    0C                                                       01240000
BYTESOUT DS    CL20                                                     01250000
IUCVQCUR DS    0C                                                       01260000
MSGSIN   DS    CL20                                                     01270000
IUCVQMAX DS    0C                                                       01280000
BYTESIN  DS    CL20                                                     01290000
PATHSAVE DS    XL2                                                      01300000
DOTFORM  DS    CL16                                                     01310000
STATLINE DS    CL33                                                     01320000
                                                                        01330000
FLAG     DS    X                                                        01340000
FLAGPARM EQU   X'80'              PARM           SPECIFIED              01350000
FLAGWTYP EQU   X'40'              WUTYPE         SPECIFIED              01360000
FLAGPATH EQU   X'20'              PATH           SPECIFIED              01370000
FLAGSOCK EQU   X'10'              SOCKET         SPECIFIED              01380000
FLAGPORT EQU   X'08'              PORT           SPECIFIED              01390000
FLAGHOST EQU   X'04'              HOST           SPECIFIED              01400000
FLAGAPPL EQU   X'02'              APPLICATION    SPECIFIED              01410000
FLAGCONN EQU   X'01'              CONNECTION     SPECIFIED              01420000
                                                                        01430000
FLG2     DS    X                                                        01440000
FLG2STAT EQU   X'80'              STATISTICS     SPECIFIED              01450000
                                                                        01460000
DP       DS    X                                                        01470000
DPLOCK   EQU   X'80'                                                    01480000
DPLCKD   EQU   X'40'                                                    01490000
WORKLEN  #ENDWORK                 END OF WORKAREA                       01500000
                                                                        01510000
         $MSGDFT PREFIX=ICTPID,                                        +01520000
               COMPID='CMD',                                           +01530000
               TABLE=*#MSGS,                                           +01540000
               WORKA=0,                                                +01550000
               CONID=*CMRQCNID,CONNAME=CMRQCNAM,CART=CMRQCART,         +01560000
               DESTADD=*CMRQDMSK,                                      X01570000
               MSGQA=*CMRQMQA,STGQH=*CMRQSTGQ,                         +01580000
               MF=(E,WRK256),                                          +01590000
               PRINT=NOGEN                                              01600000
                                                                        01610000
ICMDTCP  #ENTER BASE=R12,                                              +01620000
               PREG=(RCMDREQ),     R1 --> RCMDREQ                      +01630000
               AMODE=31,                                               +01640000
               RMODE=ANY                                                01650000
                                                                        01660000
*--------------------------------------------------------------         01670000
* INITIALIZATION                                                        01680000
*--------------------------------------------------------------         01690000
                                                                        01700000
         L     RITC,ICTTCPVT        ICT ACCESS                          01710000
                                                                        01720000
         MVC   KMDSTAT,=CL8'complete'                                   01730000
         MVC   KMDNAME,=CL8'command'                                    01740000
         ICM   RCCSUMRY,15,CMRQSMRY ASSOC COMMAND SUMMARY               01750000
         BZ    PARSDONE             AMBIGUOUS REQUEST                   01760000
         ICM   R0,15,CMRQSMR#       TOTAL NUMBER OF OPERAND ENTRIES     01770000
         BZ    PARSDONE             AMBIGUOUS REQUEST IF ZERO           01780000
         LTR   RITC,RITC            IS TCP/IP ACTIVE?                   01790000
         BP    PARSENXT             BRANCH IF YES                       01800000
                                                                        01810000
         LA    R3,=C'TCP/IP not active'                                 01820000
         LA    R2,17                                                    01830000
         B     RETURNMG                                                 01840000
                                                                        01850000
*---------------------------------------------------------------------- 01860000
* IDENTIFY AND VALIDATE THE KEYWORDS AND VALUES THAT WERE SPECIFIED     01870000
*---------------------------------------------------------------------- 01880000
                                                                        01890000
PARSENXT DS    0H                                                       01900000
                                                                        01910000
         CLC   CCSID,=AL2(TCP_START)                                    01920000
         BE    PARSREQ                  BRANCH IF START   REQUEST       01930000
         CLC   CCSID,=AL2(TCP_STOP)                                     01940000
         BE    PARSREQ                  BRANCH IF STOP    REQUEST       01950000
         CLC   CCSID,=AL2(TCP_DISPLAY)                                  01960000
         BE    PARSREQ                  BRANCH IF DISPLAY REQUEST       01970000
                                                                        01980000
         CLC   CCSID,=AL2(TCP_PATH)                                     01990000
         BE    PARSPATH                 BRANCH IF PATH    PARM          02000000
         CLC   CCSID,=AL2(TCP_SOCKET)                                   02010000
         BE    PARSSOCK                 BRANCH IF SOCKET  PARM          02020000
         CLC   CCSID,=AL2(TCP_WUTYPE)                                   02030000
         BE    PARSWTYP                 BRANCH IF WUTYPE  PARM          02040000
         CLC   CCSID,=AL2(TCP_PARM)                                     02050000
         BE    PARSPARM                 BRANCH IF PARM    PARM          02060000
         CLC   CCSID,=AL2(TCP_HOST)                                     02070000
         BE    PARSHOST                 BRANCH IF HOST    PARM          02080000
         CLC   CCSID,=AL2(TCP_PORT)                                     02090000
         BE    PARSPORT                 BRANCH IF PORT    PARM          02100000
         CLC   CCSID,=AL2(TCP_APPLICATION)                              02110000
         BE    PARSAPPL                 BRANCH IF APPLICATION PARM      02120000
         CLC   CCSID,=AL2(TCP_CONNECTION)                               02130000
         BE    PARSCONN                 BRANCH IF CONNECTION PARM       02140000
         CLC   CCSID,=AL2(TCP_STATISTICS)                               02150000
         BE    PARSSTAT                 BRANCH IF STATISTICS PARM       02160000
                                                                        02170000
         B     ERREJECT                 REJECT OTHERWISE                02180000
                                                                        02190000
*                                                                       02200000
* A REQUEST KEYWORD WAS FOUND                                           02210000
*---------------------------------------------------------------------- 02220000
                                                                        02230000
PARSREQ  DS    0H                                                       02240000
                                                                        02250000
         OC    KMDREQ,KMDREQ         WAS A REQUEST KEYWORD ALREADY HIT? 02260000
         BNZ   ERRCNFLC              BRANCH IF YES                      02270000
         MVC   KMDREQ(L'CCSID),CCSID SAVE THE REQUEST CODE              02280000
         B     PARSBUMP              ADVANCE TO NEXT OPERAND            02290000
                                                                        02300000
*                                                                       02310000
* STATISTICS KEYWORD WAS SPECIFIED                                      02320000
*---------------------------------------------------------------------- 02330000
                                                                        02340000
PARSSTAT DS    0H                                                       02350000
                                                                        02360000
         TM    FLG2,FLG2STAT         ALREADY SPECIFIED?                 02370000
         BNZ   ERRCNFLC              BRANCH IF YES                      02380000
         OI    FLG2,FLG2STAT         PROVIDED                           02390000
         B     PARSBUMP              ADVANCE TO NEXT OPERAND            02400000
                                                                        02410000
*                                                                       02420000
* CONNECTION KEYWORD WAS SPECIFIED                                      02430000
*---------------------------------------------------------------------- 02440000
                                                                        02450000
PARSCONN DS    0H                                                       02460000
                                                                        02470000
         TM    FLAG,FLAGCONN         ALREADY SPECIFIED?                 02480000
         BNZ   ERRCNFLC              BRANCH IF YES                      02490000
         OI    FLAG,FLAGCONN         PROVIDED                           02500000
         B     PARSBUMP              ADVANCE TO NEXT OPERAND            02510000
                                                                        02520000
*                                                                       02530000
* PATH(NNN.../ALL) KEYWORD WAS SPECIFIED                                02540000
*---------------------------------------------------------------------- 02550000
                                                                        02560000
PARSPATH DS    0H                                                       02570000
                                                                        02580000
         LA    R1,KMD#PATH           BINARY RECEIVING AREA              02590000
         LA    R2,KMDPATH            MVCL COPY-TO ADDRESS               02600000
         LA    R3,L'KMDPATH          MVCL COPY-TO LENGTH                02610000
         LA    R4,KMDLPATH           STRING LENGTH RECEIVING AREA       02620000
         TM    FLAG,FLAGPATH         ALREADY SPECIFIED?                 02630000
         BNZ   ERRCNFLC              BRANCH IF YES                      02640000
         OI    FLAG,FLAGPATH         PROVIDED                           02650000
         B     PARSNUM               GO CHECK IF ALL/NUMBER             02660000
                                                                        02670000
*                                                                       02680000
* SOCKET(NNN.../ALL) KEYWORD WAS SPECIFIED                              02690000
*---------------------------------------------------------------------- 02700000
                                                                        02710000
PARSSOCK DS    0H                                                       02720000
                                                                        02730000
         LA    R1,KMD#SOCK           BINARY RECEIVING AREA              02740000
         LA    R2,KMDSOCK            MVCL COPY-TO ADDRESS               02750000
         LA    R3,L'KMDSOCK          MVCL COPY-TO LENGTH                02760000
         LA    R4,KMDLSOCK           STRING LENGTH RECEIVING AREA       02770000
         TM    FLAG,FLAGSOCK         ALREADY SPECIFIED?                 02780000
         BNZ   ERRCNFLC              BRANCH IF YES                      02790000
         OI    FLAG,FLAGSOCK         PROVIDED                           02800000
         B     PARSNUM               GO CHECK IF ALL/NUMBER             02810000
                                                                        02820000
*                                                                       02830000
* PORT(NNN...) KEYWORD WAS SPECIFIED                                    02840000
*---------------------------------------------------------------------- 02850000
                                                                        02860000
PARSPORT DS    0H                                                       02870000
                                                                        02880000
         LA    R1,KMD#PORT           BINARY RECEIVING AREA              02890000
         LA    R2,KMDPORT            MVCL COPY-TO ADDRESS               02900000
         LA    R3,L'KMDPORT          MVCL COPY-TO LENGTH                02910000
         LA    R4,KMDLPORT           STRING LENGTH RECEIVING AREA       02920000
         TM    FLAG,FLAGPORT         ALREADY SPECIFIED?                 02930000
         BNZ   ERRCNFLC              BRANCH IF YES                      02940000
         OI    FLAG,FLAGPORT         PROVIDED                           02950000
         B     PARSNUM               GO CHECK IF ALL/NUMBER             02960000
                                                                        02970000
*                                                                       02980000
* HOST(XXX...) KEYWORD WAS SPECIFIED                                    02990000
*---------------------------------------------------------------------- 03000000
                                                                        03010000
PARSHOST DS    0H                                                       03020000
                                                                        03030000
         LA    R1,KMD#HOST           BINARY RECEIVING AREA              03040000
         LA    R2,KMDHOST            MVCL COPY-TO ADDRESS               03050000
         LA    R3,L'KMDHOST          MVCL COPY-TO LENGTH                03060000
         LA    R4,KMDLHOST           STRING LENGTH RECEIVING AREA       03070000
         TM    FLAG,FLAGHOST         ALREADY SPECIFIED?                 03080000
         BNZ   ERRCNFLC              BRANCH IF YES                      03090000
         OI    FLAG,FLAGHOST         PROVIDED                           03100000
         B     PARSCOMM              GO COPY VALUE                      03110000
                                                                        03120000
*                                                                       03130000
* PARM(CCC...) KEYWORD WAS SPECIFIED                                    03140000
*---------------------------------------------------------------------- 03150000
                                                                        03160000
PARSPARM DS    0H                                                       03170000
                                                                        03180000
         LA    R2,KMDPARM            MVCL COPY-TO ADDRESS               03190000
         LA    R3,L'KMDPARM          MVCL COPY-TO LENGTH                03200000
         LA    R4,KMDLPARM           STRING LENGTH RECEIVING AREA       03210000
         TM    FLAG,FLAGPARM         WAS THIS ALREADY GIVEN?            03220000
         BNZ   ERRCNFLC              BRANCH IF YES                      03230000
         OI    FLAG,FLAGPARM         PROVIDED                           03240000
         B     PARSCOMM              GO COPY PARM                       03250000
                                                                        03260000
*                                                                       03270000
* WUTYPE(CCC...) KEYWORD WAS SPECIFIED                                  03280000
*---------------------------------------------------------------------- 03290000
                                                                        03300000
PARSWTYP DS    0H                                                       03310000
                                                                        03320000
         LA    R2,KMDWTYP            MVCL COPY-TO ADDRESS               03330000
         LA    R3,L'KMDWTYP          MVCL COPY-TO LENGTH                03340000
         LA    R4,KMDLWTYP           STRING LENGTH RECEIVING AREA       03350000
         TM    FLAG,FLAGWTYP         WAS THIS ALREADY GIVEN?            03360000
         BNZ   ERRCNFLC              BRANCH IF YES                      03370000
         OI    FLAG,FLAGWTYP         PROVIDED                           03380000
         B     PARSCOMM              GO COPY PARM                       03390000
                                                                        03400000
*                                                                       03410000
* APPLICATION(CCC...) KEYWORD WAS SPECIFIED                             03420000
*---------------------------------------------------------------------- 03430000
                                                                        03440000
PARSAPPL DS    0H                                                       03450000
                                                                        03460000
         LA    R2,KMDAPPL            MVCL COPY-TO ADDRESS               03470000
         LA    R3,L'KMDAPPL          MVCL COPY-TO LENGTH                03480000
         LA    R4,KMDLAPPL           STRING LENGTH RECEIVING AREA       03490000
         TM    FLAG,FLAGAPPL         WAS THIS ALREADY GIVEN?            03500000
         BNZ   ERRCNFLC              BRANCH IF YES                      03510000
         OI    FLAG,FLAGAPPL         PROVIDED                           03520000
         B     PARSCOMM              GO COPY PARM                       03530000
                                                                        03540000
*                                                                       03550000
* COMMON HANDLING FOR NUMERIC PARAMETERS                                03560000
*---------------------------------------------------------------------- 03570000
                                                                        03580000
PARSNUM  DS    0H                                                       03590000
                                                                        03600000
         CLC   CCSVALCT,=H'1'        SINGLE VALUE SPECIFIED?            03610000
         BNE   ERRSYNTX              BRANCH IF NOT                      03620000
         LH    R15,CCSVLEN           LENGTH OF SPECIFIED VALUE          03630000
         ST    R15,0(,R4)            SAVE LENGTH                        03640000
         LTR   R15,R15               IS THE LENGTH OK?                  03650000
         BNP   ERRSYNTX              BRANCH IF NOT                      03660000
         CR    R15,R3                IS THE LENGTH OK?                  03670000
         BH    ERRSYNTX              BRANCH IF NOT                      03680000
         L     R14,CCSVDISP          OFFSET TO PARM IN CMD LINE         03690000
         A     R14,CMRQOPST          CONVERT OFFSET TO ADDRESS          03700000
         ST    R2,WRK256             SAVE ADDRESS OF VALUE              03710000
         MVCL  R2,R14                COPY PARM                          03720000
                                                                        03730000
         L     R2,WRK256             RESTORE ADDRESS OF VALUE           03740000
         LH    R3,CCSVLEN            LENGTH OF VALUE                    03750000
         BCTR  R3,0                  LENGTH CODE                        03760000
         EX    R3,PACKIT             PACKED FORMAT IN DWORD             03770000
         ZAP   DWORD,DWORD                                              03780000
         CVB   R2,DWORD              CONVERT TO BINARY                  03790000
         ST    R2,0(R1)              SAVE BINARY VALUE                  03800000
         B     PARSBUMP              CONTINUE ON WITH THE PARSE         03810000
                                                                        03820000
PACKIT   PACK  DWORD,0(0,R2)         CONVERT EBCDIC TO DECIMAL          03830000
                                                                        03840000
*                                                                       03850000
* COMMON HANDLING FOR STRING PARAMETERS                                 03860000
*---------------------------------------------------------------------- 03870000
                                                                        03880000
PARSCOMM DS    0H                                                       03890000
                                                                        03900000
         CLC   CCSVALCT,=H'1'        SINGLE VALUE SPECIFIED?            03910000
         BNE   ERRSYNTX              BRANCH IF NOT                      03920000
         LH    R15,CCSVLEN           LENGTH OF SPECIFIED VALUE          03930000
         ST    R15,0(,R4)            SAVE LENGTH                        03940000
         LTR   R15,R15               IS THE LENGTH OK?                  03950000
         BNP   ERRSYNTX              BRANCH IF NOT                      03960000
         CR    R15,R3                IS THE LENGTH OK?                  03970000
         BH    ERRSYNTX              BRANCH IF NOT                      03980000
         L     R14,CCSVDISP          OFFSET TO PARM IN CMD LINE         03990000
         A     R14,CMRQOPST          CONVERT OFFSET TO ADDRESS          04000000
         ICM   R15,8,=C' '           MVCL PAD BYTE                      04010000
         MVCL  R2,R14                COPY PARM                          04020000
         B     PARSBUMP              CONTINUE ON WITH THE PARSE         04030000
                                                                        04040000
*                                                                       04050000
* ADVANCE THE SCAN TO THE NEXT KEYWORD ENTRY IN THE SUMMARY             04060000
*---------------------------------------------------------------------- 04070000
                                                                        04080000
PARSBUMP DS    0H                                                       04090000
                                                                        04100000
         LA    R15,CCSVSLN                    LENGTH OF VALUE ENTRY     04110000
         MH    R15,CCSVALCT                   TIMES NUMBER OF ENTRIES   04120000
         LA    RCCSUMRY,CCSPFXL(R15,RCCSUMRY) ADDRESS OF NEXT KEYWORD   04130000
         BCT   R0,PARSENXT                    BRANCH IF MORE KEYWORDS   04140000
                                                                        04150000
PARSDONE DS    0H                                                       04160000
                                                                        04170000
*---------------------------------------------------------------------- 04180000
* COMMAND WAS PARSED.  JUMP TO THE SPECIFIC REQUEST ROUTINE.            04190000
*---------------------------------------------------------------------- 04200000
                                                                        04210000
         LA    R1,TCPLOCKM        LOCK MANAGEMENT WORD                  04220000
         BAS   R14,LOCK           SERIALIZE                             04230000
                                                                        04240000
         SR    R1,R1              CLEAR                                 04250000
         ICM   R1,3,KMDREQ        GET THE REQUEST ID                    04260000
         BNP   ERRSYNTX           BRANCH IF NO REQUEST KEYWORD          04270000
         BCTR  R1,0               NORMALIZE                             04280000
         C     R1,=A(RQMAX)       IS REQUEST ID VALID?                  04290000
         BH    ERRSYNTX           BRANCH IF NOT                         04300000
         SLL   R1,2               MULTIPLY BY 4                         04310000
         B     RQJUMP(R1)         JUMP TO ROUTINE                       04320000
                                                                        04330000
RQJUMP   B     RQSTART            1=START                               04340000
         B     RQSTOP             2=STOP                                04350000
         B     RQDISP             3=DISPLAY                             04360000
RQMAX    EQU   ((*-RQJUMP)/4)-1                                         04370000
                                                                        04380000
*---------------------------------------------------------------------- 04390000
* REQUEST = START                                                       04400000
*---------------------------------------------------------------------- 04410000
                                                                        04420000
RQSTART  DS    0H                                                       04430000
                                                                        04440000
         MVC   KMDNAME,=CL8'start'                                      04450000
         TM    FLAG,FLAGAPPL      APPLICATION SPECIFIED?                04460000
         BO    RQSTAPPL           BRANCH IF YES                         04470000
         TM    FLAG,FLAGCONN      PATH        SPECIFIED?                04480000
         BO    RQSTCONN           BRANCH IF YES                         04490000
         B     ERRSYNTX           BRANCH IF NOT                         04500000
                                                                        04510000
RQSTAPPL DS    0H                                                       04520000
                                                                        04530000
         TM    FLAG,FLAGSOCK+FLAGPATH+FLAGCONN                          04540000
         BNZ   ERRCNFLC           BRANCH IF INCOMPATIBLE PARAMETERS     04550000
                                                                        04560000
         LA    R1,TCPLOCKM        LOCK MANAGEMENT WORD                  04570000
         BAS   R14,UNLOCK         RELEASE SERIALIZATION                 04580000
                                                                        04590000
         LA    R0,STRAPPL         AREA FOR PADDING NAME                 04600000
         LA    R1,8               LENGTH OF AREA                        04610000
         LA    R14,KMDAPPL        APPL NAME FROM COMMAND                04620000
         L     R15,KMDLAPPL       LENGTH OF APPL NAME FROM COMMAND      04630000
         ICM   R15,B'1000',=C' '  SET BLANK PADDING                     04640000
         MVCL  R0,R14             COPY AND PAD THE NAME                 04650000
                                                                        04660000
         CLI   KMDWTYP,C' '       WORKUNIT TYPE OMITTED?                04670000
         BH    DOSTAPP            BRANCH IF NOT                         04680000
         MVC   KMDWTYP,=CL4'TASK' DEFAULT TO A NEW TASK                 04690000
                                                                        04700000
DOSTAPP  DS    0H                                                       04710000
                                                                        04720000
         TCPSTAPP STRAPPL,        ADDRESS OF APPLICATION NAME          +04730000
               KMDPARM,           ADDRESS OF PARM STRING               +04740000
               KMDLPARM,          ADDRESS OF PARM STRING LENGTH        +04750000
               KMDWTYP,           ADDRESS OF WU TYPE (TASK/PROC/VTAM)  +04760000
               KMD#PORT,          ADDRESS OF PORT#                     +04770000
               KMD#HOST,          ADDRESS OF HOST#                     +04780000
               =F'0',             NO SOCKET#                           +04790000
               =XL8'0',           NO SOCKET OWNER TOKEN                +04800000
               TCPRETTK,          WU TOKEN RETURN AREA                 +04810000
               TCPRETCD,          RETURN CODE AREA                     +04820000
               MF=(E,MFE_LIST)                                          04830000
                                                                        04840000
         ICM   R1,15,TCPRETCD     GOOD RETURN CODE?                     04850000
         BZ    RETURNOK           BRANCH IF YES                         04860000
         B     ERRTCPRC           BRANCH IF NOT                         04870000
                                                                        04880000
RQSTCONN DS    0H                                                       04890000
                                                                        04900000
         TM    FLAG,FLAGSOCK+FLAGAPPL+FLAGPORT+FLAGHOST+FLAGPARM        04910000
         BNZ   ERRCNFLC           BRANCH IF INCOMPATIBLE PARAMETERS     04920000
         TM    FLAG,FLAGPATH+FLAGWTYP                                   04930000
         BNZ   ERRCNFLC           BRANCH IF INCOMPATIBLE PARAMETERS     04940000
                                                                        04950000
         LA    R1,TCPLOCKM        LOCK MANAGEMENT WORD                  04960000
         BAS   R14,UNLOCK         RELEASE SERIALIZATION                 04970000

*---------------------------------------------------------------------- 01050000
* INVOKE XDC                                               HPNSTST      01060000
*---------------------------------------------------------------------- 01070000
*MAINXDC  #XDCHOOK MAPS=YES
                                                                        04980000
         TCPSTRTP 0,              NO PRE-ALLOCATED PAB                 +04990000
               TCPRETCD,          RETURN CODE AREA                     +05000000
               MF=(E,MFE_LIST)    TRACE A REQUEST                       05010000
                                                                        05020000
         ICM   R1,15,TCPRETCD     TEST RETURN CODE                      05030000
         BZ    RETURNOK           BRANCH IF STARTED                     05040000
         B     ERRTCPRC           BRANCH IF NOT                         05050000
                                                                        05060000
*---------------------------------------------------------------------- 05070000
* REQUEST = STOP                                                        05080000
*---------------------------------------------------------------------- 05090000
                                                                        05100000
RQSTOP   DS    0H                                                       05110000
                                                                        05120000
         MVC   KMDNAME,=CL8'stop'                                       05130000
         TM    FLAG,FLAGSOCK      SOCKET      SPECIFIED?                05140000
         BO    RQSTSOCK           BRANCH IF YES                         05150000
         TM    FLAG,FLAGPATH      PATH        SPECIFIED?                05160000
         BO    RQSTPATH           BRANCH IF YES                         05170000
         B     ERRSYNTX           BRANCH IF NOT                         05180000
                                                                        05190000
RQSTSOCK DS    0H                                                       05200000
                                                                        05210000
         TM    FLAG,FLAGPATH+FLAGAPPL+FLAGPORT+FLAGHOST+FLAGPARM        05220000
         BNZ   ERRCNFLC           BRANCH IF INCOMPATIBLE PARAMETERS     05230000
         TM    FLAG,FLAGWTYP+FLAGCONN                                   05240000
         BNZ   ERRCNFLC           BRANCH IF INCOMPATIBLE PARAMETERS     05250000
         LA    R1,3                                                     05260000
         C     R1,KMDLSOCK        WAS IT A 3 BYTE VALUE?                05270000
         BNE   RQST1SK            BRANCH IF NOT                         05280000
         CLC   KMDSOCK(3),=CL3'ALL'  WAS ALL SPECIFIED?                 05290000
         BNE   RQST1SK            BRANCH IF NOT                         05300000
                                                                        05310000
         L     R2,ITCTCPMU        MAXIMUM USER SOCKETS                  05320000
         L     R3,ITC@STBL        ADDRESS OF USER SOCKET TABLE          05330000
                                                                        05340000
SOCKSTOP DS    0H                                                       05350000
                                                                        05360000
         ICM   R1,15,0(R3)        IS THIS ALLOCATED?                    05370000
         BZ    SOCKSNXT           BRANCH IF NOT                         05380000
         LR    R1,R3              TABLE ENTRY ADDRESS                   05390000
         S     R1,ITC@STBL        SOCKET# TIMES 4                       05400000
         SRL   R1,2               SOCKET#                               05410000
         BAS   R14,TCPLSOB        LOCATE THE SOB/PAB                    05420000
         LTR   RPAB,RPAB          WAS PAB LOCATED?                      05430000
         BNP   SOCKSNXT           BRANCH IF NOT                         05440000
         LTR   RSOB,RSOB          WAS SOB LOCATED?                      05450000
         BNP   SOCKSNXT           BRANCH IF NOT                         05460000
         BAS   R14,STOPSOCK       STOP THE SOCKET                       05470000
                                                                        05480000
SOCKSNXT DS    0H                                                       05490000
                                                                        05500000
         LA    R3,4(,R3)          NEXT TABLE ENTRY                      05510000
         BCT   R2,SOCKSTOP        DO ALL ENTRIES                        05520000
         B     RETURNOK           AND WE ARE DONE                       05530000
                                                                        05540000
RQST1SK  DS    0H                                                       05550000
                                                                        05560000
         L     R1,KMD#SOCK        THE SPECIFIED SOCKET NUMBER           05570000
         BAS   R14,TCPLSOB        LOCATE THE SOB/PAB                    05580000
         LTR   RPAB,RPAB          WAS PAB LOCATED?                      05590000
         BNP   RETURNOK           BRANCH IF NOT                         05600000
         LTR   RSOB,RSOB          WAS SOB LOCATED?                      05610000
         BNP   RETURNOK           BRANCH IF NOT                         05620000
         BAS   R14,STOPSOCK       STOP THE SOCKET                       05630000
         B     RETURNOK           AND WE ARE DONE                       05640000
                                                                        05650000
RQSTPATH DS    0H                                                       05660000
                                                                        05670000
         TM    FLAG,FLAGSOCK+FLAGAPPL+FLAGPORT+FLAGHOST+FLAGPARM        05680000
         BNZ   ERRCNFLC           BRANCH IF INCOMPATIBLE PARAMETERS     05690000
         TM    FLAG,FLAGWTYP+FLAGCONN                                   05700000
         BNZ   ERRCNFLC           BRANCH IF INCOMPATIBLE PARAMETERS     05710000
         LA    R1,3                                                     05720000
         C     R1,KMDLPATH        WAS IT A 3 BYTE VALUE?                05730000
         BNE   RQST1PT            BRANCH IF NOT                         05740000
         CLC   KMDPATH(3),=CL3'ALL'  WAS ALL SPECIFIED?                 05750000
         BNE   RQST1PT            BRANCH IF NOT                         05760000
                                                                        05770000
STOPLOOP DS    0H                                                       05780000
                                                                        05790000
         LA    R1,TCPLOCKM        LOCK MANAGEMENT WORD                  05800000
         BAS   R14,LOCK           SERIALIZE                             05810000
                                                                        05820000
         LA    RPAB,ITCPB1ST      SET TO RUN PAB CHAIN                  05830000
         S     RPAB,=A(PABNEXT-PAB) NORMALIZE FOR CHAIN RUN             05840000
                                                                        05850000
STOPNEXT DS    0H                                                       05860000
                                                                        05870000
         ICM   RPAB,15,PABNEXT    LINK TO NEXT PAB                      05880000
         BM    RETURNOK           BRANCH IF PABS EXHAUSTED              05890000
         TM    PABF1,PABF1SVR     ALREADY SEVERED?                      05900000
         BO    STOPNEXT           SKIP IF SEVERED                       05910000
         MVC   PATHSAVE,PABPATH   COPY PATHID                           05920000
                                                                        05930000
         LA    R1,TCPLOCKM        LOCK MANAGEMENT WORD                  05940000
         BAS   R14,UNLOCK         RELEASE SERIALIZATION                 05950000
                                                                        05960000
         BAS   R14,STOPPATH       STOP THE PATH                         05970000
         B     STOPLOOP           GO GET THE NEXT PATH                  05980000
                                                                        05990000
RQST1PT  DS    0H                                                       06000000
                                                                        06010000
         LA    R1,KMD#PATH+2      THE SPECIFIED PATH NUMBER             06020000
         BAS   R14,TCPLPAB        LOCATE THE PAB                        06030000
         LTR   RPAB,RPAB          WAS PAB LOCATED?                      06040000
         BNP   RETURNOK           BRANCH IF NOT                         06050000
         MVC   PATHSAVE,PABPATH   COPY PATHID                           06060000
                                                                        06070000
         LA    R1,TCPLOCKM        LOCK MANAGEMENT WORD                  06080000
         BAS   R14,UNLOCK         RELEASE SERIALIZATION                 06090000
                                                                        06100000
         BAS   R14,STOPPATH       STOP THE PATH                         06110000
         B     RETURNOK           AND WE ARE DONE                       06120000
                                                                        06130000
*---------------------------------------------------------------------- 06140000
* REQUEST = DISPLAY                                                     06150000
*---------------------------------------------------------------------- 06160000
                                                                        06170000
RQDISP   DS    0H                                                       06180000
                                                                        06190000
         MVC   KMDNAME,=CL8'display'                                    06200000
         TM    FLAG,FLAGSOCK      SOCKET      SPECIFIED?                06210000
         BO    RQDSSOCK           BRANCH IF YES                         06220000
         TM    FLAG,FLAGPATH      PATH        SPECIFIED?                06230000
         BO    RQDSPATH           BRANCH IF YES                         06240000
         B     RQDSMAIN           DISPLAY GLOBAL INFORMATION            06250000
                                                                        06260000
RQDSSOCK DS    0H                                                       06270000
                                                                        06280000
         TM    FLAG,FLAGPATH+FLAGAPPL+FLAGPORT+FLAGHOST+FLAGPARM        06290000
         BNZ   ERRCNFLC           BRANCH IF INCOMPATIBLE PARAMETERS     06300000
         TM    FLAG,FLAGWTYP+FLAGCONN                                   06310000
         BNZ   ERRCNFLC           BRANCH IF INCOMPATIBLE PARAMETERS     06320000
         LA    R1,3                                                     06330000
         C     R1,KMDLSOCK        WAS IT A 3 BYTE VALUE?                06340000
         BNE   RQDS1SK            BRANCH IF NOT                         06350000
         CLC   KMDSOCK(3),=CL3'ALL'  WAS ALL SPECIFIED?                 06360000
         BNE   RQDS1SK            BRANCH IF NOT                         06370000
                                                                        06380000
         L     R2,ITCTCPMU        MAXIMUM USER SOCKETS                  06390000
         L     R3,ITC@STBL        ADDRESS OF USER SOCKET TABLE          06400000
                                                                        06410000
SOCKLOOP DS    0H                                                       06420000
                                                                        06430000
         ICM   R1,15,0(R3)        IS THIS ALLOCATED?                    06440000
         BZ    SOCKNEXT           BRANCH IF NOT                         06450000
         LR    R1,R3              TABLE ENTRY ADDRESS                   06460000
         S     R1,ITC@STBL        SOCKET# TIMES 4                       06470000
         SRL   R1,2               SOCKET#                               06480000
         BAS   R14,TCPLSOB        LOCATE THE SOB/PAB                    06490000
         LTR   RPAB,RPAB          WAS PAB LOCATED?                      06500000
         BNP   SOCKNEXT           BRANCH IF NOT                         06510000
         LTR   RSOB,RSOB          WAS SOB LOCATED?                      06520000
         BNP   SOCKNEXT           BRANCH IF NOT                         06530000
         L     R15,=A(DISPSOCK)                                         06540000
         BASR  R14,R15            DISPLAY THE SOCKET                    06550000
                                                                        06560000
SOCKNEXT DS    0H                                                       06570000
                                                                        06580000
         LA    R3,4(,R3)          NEXT TABLE ENTRY                      06590000
         BCT   R2,SOCKLOOP        DO ALL ENTRIES                        06600000
         B     RETURNOK           AND WE ARE DONE                       06610000
                                                                        06620000
RQDS1SK  DS    0H                                                       06630000
                                                                        06640000
         L     R1,KMD#SOCK        THE SPECIFIED SOCKET NUMBER           06650000
         BAS   R14,TCPLSOB        LOCATE THE SOB/PAB                    06660000
         LTR   RPAB,RPAB          WAS PAB LOCATED?                      06670000
         BNP   RETURNOK           BRANCH IF NOT                         06680000
         LTR   RSOB,RSOB          WAS SOB LOCATED?                      06690000
         BNP   RETURNOK           BRANCH IF NOT                         06700000
         L     R15,=A(DISPSOCK)                                         06710000
         BASR  R14,R15            DISPLAY THE SOCKET                    06720000
         B     RETURNOK           AND WE ARE DONE                       06730000
                                                                        06740000
RQDSPATH DS    0H                                                       06750000
                                                                        06760000
         TM    FLAG,FLAGSOCK+FLAGAPPL+FLAGPORT+FLAGHOST+FLAGPARM        06770000
         BNZ   ERRCNFLC           BRANCH IF INCOMPATIBLE PARAMETERS     06780000
         TM    FLAG,FLAGWTYP+FLAGCONN                                   06790000
         BNZ   ERRCNFLC           BRANCH IF INCOMPATIBLE PARAMETERS     06800000
         LA    R1,3                                                     06810000
         C     R1,KMDLPATH        WAS IT A 3 BYTE VALUE?                06820000
         BNE   RQDS1PT            BRANCH IF NOT                         06830000
         CLC   KMDPATH(3),=CL3'ALL'  WAS ALL SPECIFIED?                 06840000
         BNE   RQDS1PT            BRANCH IF NOT                         06850000
                                                                        06860000
         LA    RPAB,ITCPB1ST      SET TO RUN PAB CHAIN                  06870000
         S     RPAB,=A(PABNEXT-PAB) NORMALIZE FOR CHAIN RUN             06880000
                                                                        06890000
PATHLOOP DS    0H                                                       06900000
                                                                        06910000
         ICM   RPAB,15,PABNEXT    LINK TO NEXT PAB                      06920000
         BM    RETURNOK           BRANCH IF PABS EXHAUSTED              06930000
         L     R15,=A(DISPPATH)                                         06940000
         BASR  R14,R15            DISPLAY THE PATH                      06950000
         B     PATHLOOP           GO GET THE NEXT PATH                  06960000
                                                                        06970000
RQDS1PT  DS    0H                                                       06980000
                                                                        06990000
         LA    R1,KMD#PATH+2      THE SPECIFIED PATH NUMBER             07000000
         BAS   R14,TCPLPAB        LOCATE THE PAB                        07010000
         LTR   RPAB,RPAB          WAS PAB LOCATED?                      07020000
         BNP   RETURNOK           BRANCH IF NOT                         07030000
         L     R15,=A(DISPPATH)                                         07040000
         BASR  R14,R15            DISPLAY THE PATH                      07050000
         B     RETURNOK           AND WE ARE DONE                       07060000
                                                                        07070000
RQDSMAIN DS    0H                                                       07080000
                                                                        07090000
         L     R15,=A(DISPMAIN)                                         07100000
         BASR  R14,R15            DISPLAY THE GLOBAL INFORMATION        07110000
         B     RETURNOK           AND WE ARE DONE                       07120000
                                                                        07130000
*---------------------------------------------------------------------- 07140000
* EXCEPTION ROUTINES                                                    07150000
*---------------------------------------------------------------------- 07160000
                                                                        07170000
ERRSYNTX DS    0H                                                       07180000
                                                                        07190000
         MVC   RETR15,=A(CCODE_SYNTAX)   SYNTAX ERROR                   07200000
         B     RETURN                                                   07210000
                                                                        07220000
ERRCNFLC DS    0H                                                       07230000
                                                                        07240000
         MVC   RETR15,=A(CCODE_CONFLICT) CONFLICTING OPERANDS           07250000
         B     RETURN                                                   07260000
                                                                        07270000
ERREJECT DS    0H                                                       07280000
                                                                        07290000
         MVC   RETR15,=A(CCODE_REJECT)   COMMAND REJECTED               07300000
         B     RETURN                                                   07310000
                                                                        07320000
ERRTCPRC DS    0H                                                       07330000
                                                                        07340000
         BAS   R14,TCPTEXT               GET RETURN CODE TEXT           07350000
         L     R2,TCPRETLN               TEXT LENGTH                    07360000
         L     R3,TCPRETST               TEXT ADDRESS                   07370000
         MVC   KMDSTAT,=CL8'failed-'                                    07380000
         B     RETURNMG                                                 07390000
                                                                        07400000
*---------------------------------------------------------------------- 07410000
* RETURN TO CALLER                                                      07420000
*---------------------------------------------------------------------- 07430000
                                                                        07440000
RETURNOK DS    0H                                                       07450000
                                                                        07460000
         SR    R2,R2              NO ERROR TEXT LENGTH                  07470000
         SR    R3,R3              NO ERROR TEXT ADDRESS                 07480000
                                                                        07490000
RETURNMG DS    0H                                                       07500000
                                                                        07510000
         $MSG  410,FIELDS=(KMDNAME,                                    +07520000
               KMDSTAT,                                                +07530000
               ((R3),(R2)))                                             07540000
                                                                        07550000
RETURN   DS    0H                                                       07560000
                                                                        07570000
         ICM   R1,15,TCPLOCKM     ANYTHING TO MANAGE?                   07580000
         BZ    EXIT               BRANCH IF NOT (MAYBE TCP/IP INACTIVE) 07590000
         LA    R1,TCPLOCKM        LOCK MANAGEMENT WORD                  07600000
         BAS   R14,UNLOCK         RELEASE SERIALIZATION IF APPROPRIATE  07610000
                                                                        07620000
EXIT     DS    0H                                                       07630000
                                                                        07640000
         MVC   CMRQCOMP(4),RETR15 SET COMMAND PROCESSOR COMPLETION CODE 07650000
         LM    R15,R1,RETREGS     LOAD RETURN VALUES                    07660000
                                                                        07670000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    07680000
                                                                        07690000
*---------------------------------------------------------------------- 07700000
*   SUBROUTINE: STOPSOCK                                                07710000
*        ENTRY: RSOB = ADDRESS OF SOCKET BLOCK                          07720000
*         EXIT: ALL REGISTERS ARE RESTORED                              07730000
*---------------------------------------------------------------------- 07740000
                                                                        07750000
STOPSOCK DS    0H                                                       07760000
                                                                        07770000
         STM   R0,R15,SUB0SAVE    SAVE CALLER'S REGISTERS               07780000
                                                                        07790000
         $TCPWE L'ITW03MAX,       SIZE                                 +07800000
               ITW03SCU           CODE                                  07810000
                                                                        07820000
Z        USING ITW,R3             ESTABLISH ADDRESSABILITY              07830000
         LR    R3,R1              ITW ADDRESS                           07840000
         MVC   Z.ITW03ENT,SOBENT  ENTITY TOKEN                          07850000
         MVC   Z.ITW03US#,SOBUSER# USER-SOCKET#                         07860000
         DROP  Z                                                        07870000
                                                                        07880000
         $TCPQ (R3),              WORK ELEMENT                         +07890000
               ITCWEQ             QUEUE WORK TO RELEASE SOCKET          07900000
                                                                        07910000
         $MSG  417,FIELDS=((SOBUSER#,4),                               +07920000
               (SOBPATH#,2),                                           +07930000
               (SOBSOCK#,2))                                            07940000
                                                                        07950000
         LM    R0,R15,SUB0SAVE    RESTORE CALLER'S REGISTERS            07960000
         BR    R14                RETURN                                07970000
                                                                        07980000
*---------------------------------------------------------------------- 07990000
*   SUBROUTINE: STOPPATH                                                08000000
*        ENTRY: RPAB = ADDRESS OF PATH BLOCK                            08010000
*         EXIT: ALL REGISTERS ARE RESTORED                              08020000
*---------------------------------------------------------------------- 08030000
                                                                        08040000
STOPPATH DS    0H                                                       08050000
                                                                        08060000
         STM   R0,R15,SUB0SAVE    SAVE CALLER'S REGISTERS               08070000
                                                                        08080000
         TCPSTOPP PATHSAVE,       ADDRESS OF PATHID                    +08090000
               TCPRETCD,          RETURN CODE AREA                     +08100000
               MF=(E,MFE_LIST)    GO KILL THE PATH                      08110000
                                                                        08120000
         $MSG  418,FIELDS=((PATHSAVE,2))                                08130000
                                                                        08140000
         LM    R0,R15,SUB0SAVE    RESTORE CALLER'S REGISTERS            08150000
         BR    R14                RETURN                                08160000
                                                                        08170000
*---------------------------------------------------------------------- 08180000
*   SUBROUTINE: LOCATE THE SOCKET BLOCK AND PATH BLOCK                  08190000
*                                                                       08200000
*   ENTRY:      R1 = USER SOCKET NUMBER                                 08210000
*                                                                       08220000
*   EXIT:       RSOB = SOB ADDRESS -OR- ZERO                            08230000
*               RPAB = PAB ADDRESS -OR- ZERO                            08240000
*---------------------------------------------------------------------- 08250000
                                                                        08260000
TCPLSOB  DS    0H                                                       08270000
                                                                        08280000
         STM   R0,R15,SUB0SAVE    SAVE CALLER'S REGISTERS               08290000
                                                                        08300000
         SR    RSOB,RSOB          NO SOB                                08310000
         SR    RPAB,RPAB          NO PAB                                08320000
         LTR   R3,R1              TEST USER SOCKET#                     08330000
         BM    TCPLSOBX           EXIT IF NEGATIVE                      08340000
         C     R3,ITCTCPMU        SOCKET# TOO LARGE?                    08350000
         BNL   TCPLSOBX           BRANCH IF TOO LARGE                   08360000
         SLL   R3,2               SOCKET# TIMES 4                       08370000
         A     R3,ITC@STBL        ADDRESS OF APPROPRIATE ENTRY          08380000
                                                                        08390000
         TCPLSOB 0(R3),                                                +08400000
               2(R3),                                                  +08410000
               TCPRETPB,                                               +08420000
               TCPRETSB,                                               +08430000
               TCPRETCD,                                               +08440000
               MF=(E,MFE_LIST)    LOCATE THE BLOCKS                     08450000
                                                                        08460000
         L     RSOB,TCPRETSB      THE SOB -OR- ZERO                     08470000
         L     RPAB,TCPRETPB      THE PAB -OR- ZERO                     08480000
                                                                        08490000
TCPLSOBX DS    0H                                                       08500000
                                                                        08510000
         LA    R15,SUB0SAVE+(RSOB*4)                                    08520000
         ST    RSOB,0(,R15)         RETURN SOB                          08530000
         LA    R15,SUB0SAVE+(RPAB*4)                                    08540000
         ST    RPAB,0(,R15)         RETURN PAB                          08550000
         LM    R0,R15,SUB0SAVE      RESTORE CALLER'S REGISTERS          08560000
         BR    R14                  RETURN                              08570000
                                                                        08580000
*---------------------------------------------------------------------- 08590000
*   SUBROUTINE: LOCATE THE PATH BLOCK                                   08600000
*                                                                       08610000
*   ENTRY:      R1 = ADDRESS OF PATHID                                  08620000
*                                                                       08630000
*   EXIT:       RPAB = PAB ADDRESS -OR- ZERO                            08640000
*---------------------------------------------------------------------- 08650000
                                                                        08660000
TCPLPAB  DS    0H                                                       08670000
                                                                        08680000
         STM   R0,R15,SUB0SAVE    SAVE CALLER'S REGISTERS               08690000
         LR    R3,R1              ADDRESS OF PATHID                     08700000
                                                                        08710000
         TCPLPAB 0(R3),                                                +08720000
               TCPRETPB,                                               +08730000
               TCPRETCD,                                               +08740000
               MF=(E,MFE_LIST)    LOCATE THE PAB                        08750000
                                                                        08760000
         L     RPAB,TCPRETPB      THE PAB -OR- ZERO                     08770000
         LA    R15,SUB0SAVE+(RPAB*4)                                    08780000
         ST    RPAB,0(,R15)         RETURN PAB                          08790000
         LM    R0,R15,SUB0SAVE      RESTORE CALLER'S REGISTERS          08800000
         BR    R14                  RETURN                              08810000
                                                                        08820000
*---------------------------------------------------------------------- 08830000
*   SUBROUTINE: LOCK                                                    08840000
*        ENTRY: R1 = ADDRESS OF LOCK MANAGEMENT WORD                    08850000
*         EXIT: LOCK MANAGEMENT WORD UPDATED                            08860000
*               ALL REGISTERS ARE RESTORED                              08870000
*---------------------------------------------------------------------- 08880000
                                                                        08890000
LOCK     DS    0H                                                       08900000
                                                                        08910000
         STM   R0,R15,SUB0SAVE    SAVE CALLER'S REGISTERS               08920000
         LR    R2,R1              LOCK MANAGEMENT WORD                  08930000
                                                                        08940000
         TCPLOCK (R2),            LOCK MANAGEMENT WORD                 +08950000
               TCPRETCD,          RETURN CODE ADDRESS                  +08960000
               MF=(E,MFE_LIST)    OBTAIN TCPG LOCK                      08970000
                                                                        08980000
         LM    R0,R15,SUB0SAVE    RESTORE CALLER'S REGISTERS            08990000
         BR    R14                RETURN                                09000000
                                                                        09010000
*---------------------------------------------------------------------- 09020000
*   SUBROUTINE: UNLOCK                                                  09030000
*        ENTRY: R1 = ADDRESS OF LOCK MANAGEMENT WORD                    09040000
*         EXIT: LOCK MANAGEMENT WORD UPDATED                            09050000
*               ALL REGISTERS ARE RESTORED                              09060000
*---------------------------------------------------------------------- 09070000
                                                                        09080000
UNLOCK   DS    0H                                                       09090000
                                                                        09100000
         STM   R0,R15,SUB0SAVE    SAVE CALLER'S REGISTERS               09110000
         LR    R2,R1              LOCK MANAGEMENT WORD                  09120000
                                                                        09130000
         TCPUNLK (R2),            LOCK MANAGEMENT WORD                 +09140000
               TCPRETCD,          RETURN CODE ADDRESS                  +09150000
               MF=(E,MFE_LIST)    RELEASE TCPG LOCK                     09160000
                                                                        09170000
         LM    R0,R15,SUB0SAVE    RESTORE CALLER'S REGISTERS            09180000
         BR    R14                RETURN                                09190000
                                                                        09200000
*---------------------------------------------------------------------- 09210000
*   SUBROUTINE: PROVIDE TEXT FOR TCP SERVICE RETURN CODE                09220000
*                                                                       09230000
*   ENTRY:      TCPRETCD CONTAINS THE RETURN CODE                       09240000
*                                                                       09250000
*   EXIT:       TCPRETST CONTAINS THE TEXT STRING ADDRESS               09260000
*               TCPRETLN CONTAINS THE TEXT STRING LENGTH                09270000
*               ALL REGISTERS ARE RESTORED                              09280000
*---------------------------------------------------------------------- 09290000
                                                                        09300000
TCPTEXT  DS    0H                                                       09310000
                                                                        09320000
         STM   R0,R15,SUB1SAVE    SAVE CALLER'S REGISTERS               09330000
         MVC   WRK256(4),TCPRETCD COPY                                  09340000
                                                                        09350000
         TCPRTS WRK256,                                                +09360000
               TCPRETST,                                               +09370000
               TCPRETLN,                                               +09380000
               TCPRETCD,                                               +09390000
               MF=(E,MFE_LIST)    OBTAIN STRING DESCRIPTION             09400000
                                                                        09410000
         LM    R0,R15,SUB1SAVE    RESTORE CALLER'S REGISTERS            09420000
         BR    R14                RETURN                                09430000
                                                                        09440000
*---------------------------------------------------------------------- 09450000
*  CONSTANTS AND LITERALS                                               09460000
*---------------------------------------------------------------------- 09470000
                                                                        09480000
         LTORG ,                                                        09490000
                                                                        09500000
*---------------------------------------------------------------------- 09510000
*   SUBROUTINE: DISPLAY A SOCKET                                        09520000
*                                                                       09530000
*   ENTRY:      RSOB = ADDRESS OF THE SOCKET BLOCK                      09540000
*                                                                       09550000
*   EXIT:       ALL REGISTERS ARE RESTORED                              09560000
*---------------------------------------------------------------------- 09570000
                                                                        09580000
DISPSOCK DS    0H                                                       09590000
                                                                        09600000
         STM   R0,R15,SUB0SAVE    SAVE CALLER'S REGISTERS               09610000
         LR    R12,R15            REBASE                                09620000
         DROP  R12                                                      09630000
         USING DISPSOCK,R12                                             09640000
                                                                        09650000
         L     R15,=A(DISPLOCK)                                         09660000
         BASR  R14,R15            SERIALIZE                             09670000
                                                                        09680000
         $WULOC LOCATE,           FIND THE WORK UNIT                   +09690000
               TOKEN=SOBENT,      WORK UNIT TOKEN ADDRESS              +09700000
               USERDATA=WUDATA,   XL16 AREA TO RECEIVE USER DATA       +09710000
               MF=(E,$WUMFL)      VALIDATE WORK UNIT                    09720000
                                                                        09730000
         LTR   R15,R15            LOCATE SUCCESS?                       09740000
         BNZ   DSSKNONM           BRANCH IF NOT                         09750000
         LTR   R1,R1              IS WORK UNIT ACTIVE?                  09760000
         BNZ   DSSKNONM           BRANCH IF NOT                         09770000
                                                                        09780000
X        USING IWUENTUD,WUDATA                                          09790000
         L     R1,X.WUDITASK      ITASK ADDRESS                         09800000
         L     R2,X.WUDIPCB       IPCB  ADDRESS                         09810000
         DROP  X                                                        09820000
                                                                        09830000
X        USING ITASK,R1                                                 09840000
         MVC   TASKNAME,X.TSKNAME SAVE TASK NAME                        09850000
         DROP  X                                                        09860000
                                                                        09870000
X        USING IPCB,R2                                                  09880000
         MVC   PROCNAME,X.PCBNAME SAVE PROC NAME                        09890000
         DROP  X                                                        09900000
                                                                        09910000
DSSKNONM DS    0H                                                       09920000
                                                                        09930000
         XC    DOTFORM,DOTFORM                                          09940000
         MVC   DOTFORML,=A(L'DOTFORM)                                   09950000
                                                                        09960000
         INET_NTOAX SOBADDR,                                           +09970000
               DOTFORM,                                                +09980000
               DOTFORML,                                               +09990000
               MF=(E,MFE_LIST)                                          10000000
                                                                        10010000
         XC    FLAGSTRL,FLAGSTRL  NO FLAGS                              10020000
                                                                        10030000
         TM    SOBF1,SOBF1ALC     ALLOCATED BY TCP/IP?                  10040000
         BNO   NOTF1ALC           BRANCH IF NOT                         10050000
         LA    R1,=CL9'allocated'                                       10060000
         LA    R0,9                                                     10070000
         L     R15,=A(FLAGUPDT)                                         10080000
         BASR  R14,R15            UPDATE THE FLAG INTERPRETATION        10090000
NOTF1ALC DS    0H                                                       10100000
                                                                        10110000
         TM    SOBF1,SOBF1WFT     GIVEN?                                10120000
         BNO   NOTF1WFT           BRANCH IF NOT                         10130000
         LA    R1,=CL5'given'                                           10140000
         LA    R0,5                                                     10150000
         L     R15,=A(FLAGUPDT)                                         10160000
         BASR  R14,R15            UPDATE THE FLAG INTERPRETATION        10170000
NOTF1WFT DS    0H                                                       10180000
                                                                        10190000
         TM    SOBF1,SOBF1LIS     PASSIVE?                              10200000
         BNO   NOTF1LIS           BRANCH IF NOT                         10210000
         LA    R1,=CL9'listening'                                       10220000
         LA    R0,9                                                     10230000
         L     R15,=A(FLAGUPDT)                                         10240000
         BASR  R14,R15            UPDATE THE FLAG INTERPRETATION        10250000
NOTF1LIS DS    0H                                                       10260000
                                                                        10270000
         LA    R2,SOBATES                                               10280000
         LA    R3,4                                                     10290000
         LA    R4,MSGSOUT                                               10300000
                                                                        10310000
CONVSOCK DS    0H                                                       10320000
                                                                        10330000
         MVC   0(20,R4),=20C'.'                                         10340000
                                                                        10350000
         TCPEDMK 0(R2),                                                +10360000
               =F'8',                                                  +10370000
               0(R4),                                                  +10380000
               =F'20',                                                 +10390000
               RIGHT,                                                  +10400000
               TCPRETCD,                                               +10410000
               MF=(E,MFE_LIST)                                          10420000
                                                                        10430000
         LA    R4,20(,R4)                                               10440000
         LA    R2,8(,R2)                                                10450000
         BCT   R3,CONVSOCK                                              10460000
                                                                        10470000
         $MSG  411,FIELDS=((SOBUSER#,4),                               +10480000
               (SOBPATH#,2),                                           +10490000
               (SOBSOCK#,2),                                           +10500000
               (SOBENT,4),                                             +10510000
               (SOBENT+4,4),                                           +10520000
               (TASKNAME,8),                                           +10530000
               (PROCNAME,8),                                           +10540000
               (SOBFAMLY,2),                                           +10550000
               (SOBPORT,2),                                            +10560000
               (DOTFORM,*DOTFORML),                                    +10570000
               (SOBF1,1),                                              +10580000
               (FLAGSTR,*FLAGSTRL)),PRINT=ON                            10590000
                                                                        10600000
         $MSG  412,FIELDS=((MSGSIN,20),                                +10610000
               (BYTESIN,20),                                           +10620000
               (MSGSOUT,20),                                           +10630000
               (BYTESOUT,20)),PRINT=ON                                  10640000
                                                                        10650000
         L     R15,=A(DISPUNLK)                                         10660000
         BASR  R14,R15            SERIALIZE                             10670000
                                                                        10680000
         LM    R0,R15,SUB0SAVE    RESTORE CALLER'S REGISTERS            10690000
         BR    R14                RETURN                                10700000
         LTORG                                                          10710000
                                                                        10720000
*---------------------------------------------------------------------- 10730000
*   SUBROUTINE: DISPLAY A PATH                                          10740000
*                                                                       10750000
*   ENTRY:      RPAB = ADDRESS OF THE PATH BLOCK                        10760000
*                                                                       10770000
*   EXIT:       ALL REGISTERS ARE RESTORED                              10780000
*---------------------------------------------------------------------- 10790000
                                                                        10800000
DISPPATH DS    0H                                                       10810000
                                                                        10820000
         STM   R0,R15,SUB0SAVE    SAVE CALLER'S REGISTERS               10830000
         LR    R12,R15            REBASE                                10840000
         DROP  R12                                                      10850000
         USING DISPPATH,R12                                             10860000
                                                                        10870000
         XC    FLAGSTRL,FLAGSTRL  NO FLAGS                              10880000
                                                                        10890000
         TM    PABF1,PABF1PRI     IS THIS THE PRIMARY PATH?             10900000
         BNO   NOTF1PRI           BRANCH IF NOT                         10910000
         LA    R1,=CL7'primary'                                         10920000
         LA    R0,7                                                     10930000
         L     R15,=A(FLAGUPDT)                                         10940000
         BASR  R14,R15            UPDATE THE FLAG INTERPRETATION        10950000
NOTF1PRI DS    0H                                                       10960000
                                                                        10970000
         TM    PABF1,PABF1PND     GIVEN?                                10980000
         BNO   NOTF1PND           BRANCH IF NOT                         10990000
         LA    R1,=CL7'pending'                                         11000000
         LA    R0,7                                                     11010000
         L     R15,=A(FLAGUPDT)                                         11020000
         BASR  R14,R15            UPDATE THE FLAG INTERPRETATION        11030000
NOTF1PND DS    0H                                                       11040000
                                                                        11050000
         TM    PABF1,PABF1SVR     PASSIVE?                              11060000
         BNO   NOTF1SVR           BRANCH IF NOT                         11070000
         LA    R1,=CL7'severed'                                         11080000
         LA    R0,7                                                     11090000
         L     R15,=A(FLAGUPDT)                                         11100000
         BASR  R14,R15            UPDATE THE FLAG INTERPRETATION        11110000
NOTF1SVR DS    0H                                                       11120000
                                                                        11130000
         LA    R2,PABATES                                               11140000
         LA    R3,4                                                     11150000
         LA    R4,IUCVSEND                                              11160000
                                                                        11170000
CONVPATH DS    0H                                                       11180000
                                                                        11190000
         MVC   0(20,R4),=20C'.'                                         11200000
                                                                        11210000
         TCPEDMK 0(R2),                                                +11220000
               =F'8',                                                  +11230000
               0(R4),                                                  +11240000
               =F'20',                                                 +11250000
               RIGHT,                                                  +11260000
               TCPRETCD,                                               +11270000
               MF=(E,MFE_LIST)                                          11280000
                                                                        11290000
         LA    R4,20(,R4)                                               11300000
         LA    R2,8(,R2)                                                11310000
         BCT   R3,CONVPATH                                              11320000
                                                                        11330000
         $MSG  413,FIELDS=((PABPATH,2),                                +11340000
               (ICTJOBNM,8),                                           +11350000
               (PABIMSTI,8),                                           +11360000
               (PABMSGLM,4),                                           +11370000
               (PAB#AIR,4),                                            +11380000
               (PAB#MAXS,4),                                           +11390000
               (PAB#SOCK,4),                                           +11400000
               (PABAA1ST,4),                                           +11410000
               (PABAALST,4),                                           +11420000
               (PABQA1ST,4),                                           +11430000
               (PABQALST,4),                                           +11440000
               (PABF1,2),                                              +11450000
               (FLAGSTR,*FLAGSTRL))                                     11460000
                                                                        11470000
         $MSG  414,FIELDS=((IUCVSEND,20),                              +11480000
               (IUCVQ,20),                                             +11490000
               (IUCVQCUR,20),                                          +11500000
               (IUCVQMAX,20))                                           11510000
                                                                        11520000
         LM    R0,R15,SUB0SAVE    RESTORE CALLER'S REGISTERS            11530000
         BR    R14                RETURN                                11540000
         LTORG                                                          11550000
                                                                        11560000
*---------------------------------------------------------------------- 11570000
*   SUBROUTINE: DISPLAY GLOBAL INFORMATION                              11580000
*                                                                       11590000
*   ENTRY:      RITC = ADDRESS OF THE ITC                               11600000
*                                                                       11610000
*   EXIT:       ALL REGISTERS ARE RESTORED                              11620000
*---------------------------------------------------------------------- 11630000
                                                                        11640000
DISPMAIN DS    0H                                                       11650000
                                                                        11660000
         STM   R0,R15,SUB0SAVE    SAVE CALLER'S REGISTERS               11670000
         LR    R12,R15            REBASE                                11680000
         DROP  R12                                                      11690000
         USING DISPMAIN,R12                                             11700000
                                                                        11710000
         XC    FLAGSTRL,FLAGSTRL  NO FLAGS                              11720000
                                                                        11730000
         TM    ITCF1,ITCF1STP     STOPPED?                              11740000
         BNO   NOTF1STP           BRANCH IF NOT                         11750000
         LA    R1,=CL7'stopped'                                         11760000
         LA    R0,7                                                     11770000
         L     R15,=A(FLAGUPDT)                                         11780000
         BASR  R14,R15            UPDATE THE FLAG INTERPRETATION        11790000
NOTF1STP DS    0H                                                       11800000
                                                                        11810000
         TM    ITCF1,ITCF1CAN     CANCELED?                             11820000
         BNO   NOTF1CAN           BRANCH IF NOT                         11830000
         LA    R1,=CL8'canceled'                                        11840000
         LA    R0,8                                                     11850000
         L     R15,=A(FLAGUPDT)                                         11860000
         BASR  R14,R15            UPDATE THE FLAG INTERPRETATION        11870000
NOTF1CAN DS    0H                                                       11880000
                                                                        11890000
         TM    ITCF1,ITCF1TRM     TERMINATING?                          11900000
         BNO   NOTF1TRM           BRANCH IF NOT                         11910000
         LA    R1,=CL11'terminating'                                    11920000
         LA    R0,11                                                    11930000
         L     R15,=A(FLAGUPDT)                                         11940000
         BASR  R14,R15            UPDATE THE FLAG INTERPRETATION        11950000
NOTF1TRM DS    0H                                                       11960000
                                                                        11970000
         TM    ITCF2,ITCF2CON     IUCV ACTIVE?                          11980000
         BNO   NOTF1CON           BRANCH IF NOT                         11990000
         LA    R1,=CL15'connected(iucv)'                                12000000
         LA    R0,15                                                    12010000
         L     R15,=A(FLAGUPDT)                                         12020000
         BASR  R14,R15            UPDATE THE FLAG INTERPRETATION        12030000
NOTF1CON DS    0H                                                       12040000
                                                                        12050000
         MVC   MSGMAXSD,=A(ITCMAXSD)                                    12060000
         LA    R1,ITCEIBSZ                                              12070000
         ST    R1,MSGEIBSZ                                              12080000
         LA    R1,ITCPHASH                                              12090000
         ST    R1,MSGPHASH                                              12100000
         LA    R1,ITCTHASH                                              12110000
         ST    R1,MSGTHASH                                              12120000
                                                                        12130000
         $MSG  415,FIELDS=((ITCTCPNM,8),                               +12140000
               (RITC),                                                 +12150000
               (MSGMAXSD,4),                                           +12160000
               (MSGEIBSZ,4),                                           +12170000
               (ITCTCPML,4),                                           +12180000
               (MSGPHASH,4),                                           +12190000
               (MSGTHASH,4),                                           +12200000
               (ITCTCPMP,4),                                           +12210000
               (ITC#PATH,4),                                           +12220000
               (ITCTCPMU,4),                                           +12230000
               (ITC#SOCK,4),                                           +12240000
               (ITCTCPMS,4),                                           +12250000
               (ITCF1,4),                                              +12260000
               (FLAGSTR,*FLAGSTRL))                                     12270000
                                                                        12280000
         TM    FLG2,FLG2STAT      STATISTICS REQUESTED?                 12290000
         BZ    DISPMXIT           BRANCH IF NOT                         12300000
                                                                        12310000
         LA    R2,STATTABL        TABLE ADDRESS                         12320000
         L     R3,=A(L'STATMAX/8) NUMBER OF TABLE ENTRIES               12330000
                                                                        12340000
DMSTATLP DS    0H                                                       12350000
                                                                        12360000
         MVI   STATLINE,C' '                                            12370000
         MVC   STATLINE+1(L'STATLINE-1),STATLINE                        12380000
                                                                        12390000
         LH    R4,0(,R2)          OFFSET OF STATS FIELD IN ITC          12400000
         AR    R4,RITC            ADDRESS OF STATS FIELD IN ITC         12410000
         L     R0,=A(STATA)       BASE ADDRESS OF DESCRIPTIONS          12420000
         A     R0,4(,R2)          PLUS OFFSET TO DESIRED DESCRIPTION    12430000
         LH    R1,2(,R2)          LENGTH OF DESIRED DESCRIPTION         12440000
         ICM   R1,B'1000',=C'.'   PAD WITH PERIODS                      12450000
         LA    R14,STATLINE       RECEIVING FIELD                       12460000
         LA    R15,13             MAX LENGTH OF DESCRIPTION             12470000
         MVCL  R14,R0             COPY & PAD DESIRED DESCRIPTION        12480000
         MVC   STATLINE+13(20),=20C'.'                                  12490000
                                                                        12500000
         TCPEDMK 0(R4),           STATS FIELD                          +12510000
               =F'8',             STATS LENGTH                         +12520000
               STATLINE+13,       RECEIVING FIELD                      +12530000
               =F'20',            RECEIVING FIELD LENGTH               +12540000
               RIGHT,                                                  +12550000
               TCPRETCD,                                               +12560000
               MF=(E,MFE_LIST)                                          12570000
                                                                        12580000
         $MSG  416,FIELDS=((STATLINE,33))                               12590000
                                                                        12600000
         LA    R2,L'STATENT(,R2)  BUMP TO NEXT TABLE ENTRY              12610000
         BCT   R3,DMSTATLP        ONE LINE FOR EACH TABLE ENTRY         12620000
                                                                        12630000
DISPMXIT DS    0H                                                       12640000
                                                                        12650000
         LM    R0,R15,SUB0SAVE    RESTORE CALLER'S REGISTERS            12660000
         BR    R14                RETURN                                12670000
         LTORG                                                          12680000
                                                                        12690000
STATTABL DS    0D                                                       12700000
         DC    AL2(ITC#MSGO-ITC,L'STATA),A(STATA-STATA)                 12710000
STATENT  EQU   STATTABL,*-STATTABL                                      12720000
         DC    AL2(ITC#BYTO-ITC,L'STATB),A(STATB-STATA)                 12730000
         DC    AL2(ITC#MSGI-ITC,L'STATC),A(STATC-STATA)                 12740000
         DC    AL2(ITC#BYTI-ITC,L'STATD),A(STATD-STATA)                 12750000
         DC    AL2(ITC#IUCV-ITC,L'STATE),A(STATE-STATA)                 12760000
         DC    AL2(ITC#REQQ-ITC,L'STATF),A(STATF-STATA)                 12770000
         DC    AL2(ITC#QCUR-ITC,L'STATF1),A(STATF1-STATA)               12780000
         DC    AL2(ITC#QMAX-ITC,L'STATF2),A(STATF2-STATA)               12790000
         DC    AL2(ITC#AACC-ITC,L'STAT1),A(STAT1-STATA)                 12800000
         DC    AL2(ITC#ABIN-ITC,L'STAT2),A(STAT2-STATA)                 12810000
         DC    AL2(ITC#ACLO-ITC,L'STAT3),A(STAT3-STATA)                 12820000
         DC    AL2(ITC#ACON-ITC,L'STAT4),A(STAT4-STATA)                 12830000
         DC    AL2(ITC#AFCN-ITC,L'STAT5),A(STAT5-STATA)                 12840000
         DC    AL2(ITC#AGHI-ITC,L'STAT6),A(STAT6-STATA)                 12850000
         DC    AL2(ITC#AGHN-ITC,L'STAT7),A(STAT7-STATA)                 12860000
         DC    AL2(ITC#AGPN-ITC,L'STAT8),A(STAT8-STATA)                 12870000
         DC    AL2(ITC#AGSN-ITC,L'STAT9),A(STAT9-STATA)                 12880000
         DC    AL2(ITC#AGSO-ITC,L'STAT10),A(STAT10-STATA)               12890000
         DC    AL2(ITC#AIOC-ITC,L'STAT11),A(STAT11-STATA)               12900000
         DC    AL2(ITC#ALIS-ITC,L'STAT12),A(STAT12-STATA)               12910000
         DC    AL2(ITC#ARD-ITC,L'STAT13),A(STAT13-STATA)                12920000
         DC    AL2(ITC#ARDV-ITC,L'STAT14),A(STAT14-STATA)               12930000
         DC    AL2(ITC#ARC-ITC,L'STAT15),A(STAT15-STATA)                12940000
         DC    AL2(ITC#ARCF-ITC,L'STAT16),A(STAT16-STATA)               12950000
         DC    AL2(ITC#ARCM-ITC,L'STAT17),A(STAT17-STATA)               12960000
         DC    AL2(ITC#ASL-ITC,L'STAT18),A(STAT18-STATA)                12970000
         DC    AL2(ITC#ASLX-ITC,L'STAT19),A(STAT19-STATA)               12980000
         DC    AL2(ITC#ASD-ITC,L'STAT20),A(STAT20-STATA)                12990000
         DC    AL2(ITC#ASDM-ITC,L'STAT21),A(STAT21-STATA)               13000000
         DC    AL2(ITC#ASDT-ITC,L'STAT22),A(STAT22-STATA)               13010000
         DC    AL2(ITC#ASSO-ITC,L'STAT23),A(STAT23-STATA)               13020000
         DC    AL2(ITC#ASHD-ITC,L'STAT24),A(STAT24-STATA)               13030000
         DC    AL2(ITC#ASOC-ITC,L'STAT25),A(STAT25-STATA)               13040000
         DC    AL2(ITC#ASOS-ITC,L'STAT26),A(STAT26-STATA)               13050000
         DC    AL2(ITC#AWR-ITC,L'STAT27),A(STAT27-STATA)                13060000
         DC    AL2(ITC#AWRV-ITC,L'STAT28),A(STAT28-STATA)               13070000
         DC    AL2(ITC#AGIV-ITC,L'STAT29),A(STAT29-STATA)               13080000
         DC    AL2(ITC#ATAK-ITC,L'STAT30),A(STAT30-STATA)               13090000
         DC    AL2(ITC#ACAN-ITC,L'STAT31),A(STAT31-STATA)               13100000
STATMAX  EQU   STATTABL,*-STATTABL                                      13110000
                                                                        13120000
STATA    DC    C'msgs out'                                              13130000
STATB    DC    C'bytes out'                                             13140000
STATC    DC    C'msgs in'                                               13150000
STATD    DC    C'bytes in'                                              13160000
STATE    DC    C'IUCV calls'                                            13170000
STATF    DC    C'tot# queued'                                           13180000
STATF1   DC    C'cur# queued'                                           13190000
STATF2   DC    C'max# queued'                                           13200000
STAT1    DC    C'accept'                                                13210000
STAT2    DC    C'bind'                                                  13220000
STAT3    DC    C'close'                                                 13230000
STAT4    DC    C'connect'                                               13240000
STAT5    DC    C'fcntl'                                                 13250000
STAT6    DC    C'gethostid'                                             13260000
STAT7    DC    C'gethostname'                                           13270000
STAT8    DC    C'getpeername'                                           13280000
STAT9    DC    C'getsockname'                                           13290000
STAT10   DC    C'getsockopt'                                            13300000
STAT11   DC    C'ioctl'                                                 13310000
STAT12   DC    C'listen'                                                13320000
STAT13   DC    C'read'                                                  13330000
STAT14   DC    C'readv'                                                 13340000
STAT15   DC    C'recv'                                                  13350000
STAT16   DC    C'recvfrom'                                              13360000
STAT17   DC    C'recvmsg'                                               13370000
STAT18   DC    C'select'                                                13380000
STAT19   DC    C'selectx'                                               13390000
STAT20   DC    C'send'                                                  13400000
STAT21   DC    C'sendmsg'                                               13410000
STAT22   DC    C'sendto'                                                13420000
STAT23   DC    C'setsockopt'                                            13430000
STAT24   DC    C'shutdown'                                              13440000
STAT25   DC    C'socket'                                                13450000
STAT26   DC    C'socket_server'                                         13460000
STAT27   DC    C'write'                                                 13470000
STAT28   DC    C'writev'                                                13480000
STAT29   DC    C'givesocket'                                            13490000
STAT30   DC    C'takesocket'                                            13500000
STAT31   DC    C'cancel'                                                13510000
                                                                        13520000
*---------------------------------------------------------------------- 13530000
*   SUBROUTINE: ADD INTERPRETATION TO FLAG INTERPRETATION STRING        13540000
*                                                                       13550000
*   ENTRY:      R1 = ADDRESS OF CHARACTER STRING                        13560000
*               R0 = LENGTH OF  CHARACTER STRING                        13570000
*                                                                       13580000
*   EXIT:       ALL REGISTERS ARE RESTORED                              13590000
*---------------------------------------------------------------------- 13600000
                                                                        13610000
FLAGUPDT DS    0H                                                       13620000
                                                                        13630000
         STM   R0,R15,SUB1SAVE    SAVE CALLER'S REGISTERS               13640000
         LR    R12,R15            REBASE                                13650000
         DROP  R12                                                      13660000
         USING FLAGUPDT,R12                                             13670000
                                                                        13680000
         LR    R2,R1              STRING ADDRESS                        13690000
         LR    R3,R0              STRING LENGTH                         13700000
         LA    R1,FLAGSTR         COMPOSITE STRING                      13710000
         A     R1,FLAGSTRL        CURRENT POSITION                      13720000
         ICM   R0,15,FLAGSTRL     CURRENT LENGTH                        13730000
         BZ    COPYSTR            BRANCH IF EMPTY                       13740000
         MVI   0(R1),C','         ADD SEPARATING COMMA                  13750000
         A     R0,=F'1'           UPDATE CURRENT LENGTH                 13760000
         LA    R1,1(,R1)          UPDATE CURRENT POSITION               13770000
                                                                        13780000
COPYSTR  DS    0H                                                       13790000
                                                                        13800000
         AR    R0,R3              NEW COMPOSITE LENGTH                  13810000
         ST    R0,FLAGSTRL        SAVE IT                               13820000
         BCTR  R3,0               LENGTH CODE FOR EXECUTE               13830000
         EX    R3,FLAGCOPY        COPY IT                               13840000
                                                                        13850000
         LM    R0,R15,SUB1SAVE    RESTORE CALLER'S REGISTERS            13860000
         BR    R14                RETURN                                13870000
                                                                        13880000
FLAGCOPY MVC   0(*-*,R1),0(R2)    ADD INTERPRETATION TO STRING          13890000
         LTORG                                                          13900000
                                                                        13910000
*---------------------------------------------------------------------- 13920000
*   SUBROUTINE: OBTAIN DISP GLOBAL LOCK                                 13930000
*---------------------------------------------------------------------- 13940000
                                                                        13950000
DISPLOCK DS    0H                                                       13960000
                                                                        13970000
         TM    DP,DPLOCK          WAS THE LOCK ALREADY OBTAINED?        13980000
         BOR   R14                RETURN IF YES                         13990000
         STM   R0,R15,SUB1SAVE    SAVE CALLER'S REGISTERS               14000000
         LR    R12,R15            REBASE                                14010000
         DROP  R12                                                      14020000
         USING DISPLOCK,R12                                             14030000
                                                                        14040000
         $SER  OBTAIN,                                                 +14050000
               DISP                                                     14060000
                                                                        14070000
         C     R15,=F'4'          WAS LOCK ALREADY HELD?                14080000
         BNE   DISPLOEX           BRANCH IF NOT                         14090000
         OI    DP,DPLCKD          REMEMBER LOCK HELD ON ENTRY           14100000
                                                                        14110000
DISPLOEX DS    0H                                                       14120000
                                                                        14130000
         OI    DP,DPLOCK          REMEMBER LOCK IS HELD                 14140000
         LM    R0,R15,SUB1SAVE    RESTORE CALLER'S REGISTERS            14150000
         BR    R14                RETURN                                14160000
         LTORG                                                          14170000
                                                                        14180000
*---------------------------------------------------------------------- 14190000
*   SUBROUTINE: RELEASE DISP GLOBAL LOCK                                14200000
*---------------------------------------------------------------------- 14210000
                                                                        14220000
DISPUNLK DS    0H                                                       14230000
                                                                        14240000
         TM    DP,DPLOCK          IS LOCK HELD?                         14250000
         BNOR  R14                BRANCH IF NOT                         14260000
         TM    DP,DPLCKD          WAS LOCK HELD ON ENTRY?               14270000
         BOR   R14                DON'T RELEASE IF IT WAS               14280000
         STM   R0,R15,SUB1SAVE    SAVE CALLER'S REGISTERS               14290000
         LR    R12,R15            REBASE                                14300000
         DROP  R12                                                      14310000
         USING DISPUNLK,R12                                             14320000
                                                                        14330000
         $SER  RELEASE,                                                +14340000
               DISP                                                     14350000
                                                                        14360000
         NI    DP,255-DPLOCK      SHOW LOCK NOT HELD                    14370000
         LM    R0,R15,SUB1SAVE    RESTORE CALLER'S REGISTERS            14380000
         BR    R14                RETURN                                14390000
                                                                        14400000
         LTORG ,                                                        14410000
                                                                        14420000
         PRINT NOGEN                                                    14430000
         CMDREQ  ,                COMMAND REQUEST BLOCK                 14440000
         CCSUMRY ,                COMMAND OPERAND PREPARSE SUMMARY      14450000
         KEYCODES COMMANDSET=TCP                                        14460000
         CMDCODES ,                                                     14470000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                14480000
         CVT DSECT=YES            MVS COMMUNICATIONS VECTOR TABLE       08820000
         IEFJESCT ,               MVS JES CVT                           08830000
         IEFJSCVT ,               MVS SUBSYSTEM COMMUNICATIONS TABLE    08840000
         IKJTCB ,                 MVS TASK CONTROL BLOCK                08850000
         TRACODES ,               INTEGRATOR TRACE CODE EQUATES         14490000
         ICVT  ,                  INTEGRATOR CVT                        14500000
         ITASK ,                  INTEGRATOR TASK BLOCK                 14510000
         IPCB  ,                  INTEGRATOR PROC BLOCK                 14520000
         IWUENTUD ,               INTEGRATOR WU ENTITY USERDATA         14530000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       14540000
         EVCODES ,                INTEGRATOR EVENT CODES                14550000
         ABCODES ,                INTEGRATOR $ABEND CODES               14560000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     14570000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        14580000
         $PROC DSECT=YES          INTEGRATOR $PROC SERVICES             14590000
         $WULOC DSECT=YES         INTEGRATOR $WULOC SERVICES            14600000
         END   ,                                                        14610000
