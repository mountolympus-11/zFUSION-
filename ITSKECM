ITSKECM  TITLE '- UPDATE TASK TRACE EVENT CLASS MASK'                   00010000
         EQUS  ,                                                        00020000
                                                                        00030000
         EJECT                                                          00040000
**<DOC-ON>*****************************************************         00050000
*                                                                       00060000
* ROUTINE: ITSKECM - UPDATE TASK TRACE EVENT CLASS MASK                 00070000
*                                                                       00080000
* DESCRIPTION:                                                          00090000
*                                                                       00100000
*    THIS ROUTINE IS USED TO ACQUIRE AND UPDATE A TRACE EVENT           00110000
*    CLASS MASK (ECM) FOR A GIVEN TASK.  THE ECM IS ALLOCATED           00120000
*    ON BEHALF OF THE DESIGNATED TASK AND WILL NOT BE RELEASED          00130000
*    UNTIL TASK TERMINATION.                                            00140000
*                                                                       00150000
*                                                                       00160000
* NOTES:                                                                00170000
*                                                                       00180000
*    APPROPRIATE SERIALIZATION ASSUMED                                  00190000
*                                                                       00200000
*                                                                       00210000
* ON ENTRY:                                                             00220000
*                                                                       00230000
*    R0  - ADDR OF TRACE EVENT CLASS MASK (XL32) OR ZERO                00240000
*    R1  - ADDR OF TARGET TASK                                          00250000
*                                                                       00260000
* ON EXIT:                                                              00270000
*                                                                       00280000
*    R15 - RC00                                                         00290000
*    R1  - ADDR OF THE TASK ECM OR ZERO IF NO ECM IS ALLOCATED          00300000
*                                                                       00310000
**<DOC-OFF>****************************************************         00320000
                                                                        00330000
                                                                        00340000
***************************************************************         00350000
*                                                                       00360000
* MAINTENANCE:                                                          00370000
*                                                                       00380000
*    08/18/93 R. TURGEON                                                00390000
*             INITIAL VERSION                                           00400000
*                                                                       00410000
***************************************************************         00420000
                                                                        00430000
         EJECT                                                          00440000
ITSKECM  #ENTER PREG=(R8,R7),SAVE=NO                                    00450000
                                                                        00460000
         USING ICVT,R11                                                 00470000
         USING ITASK,R10                                                00480000
                                                                        00490000
         EJECT                                                          00500000
*--------------------------------------------------------------         00510000
*   ALLOCATE TASK ECM IF NOT PREVIOUSLY BUILT AND UPDATE IT             00520000
*--------------------------------------------------------------         00530000
T        USING ITASK,R8           ITASK AS PARAMETER                    00540000
         ICM   R5,15,T.TSKECM     ECM PREVIOUSLY ALLOCATED?             00550000
         BNZ   ECM_RDY            SKIP IF SO                            00560000
         LTR   R7,R7              ECM PTR PROVIDED?                     00570000
         BZ    ECM_FIN            NOP IF NOT                            00580000
                                                                        00590000
         $GETSTOR 32,OWNER=T.ITASK                                      00600000
         LR    R5,R1              ACCEPT ACQUIRED STORAGE               00610000
                                                                        00620000
ECM_RDY  DS    0H                 UPDATE ECM FROM INPUT MODEL           00630000
         LTR   R7,R7              MODEL ECM AVAILABLE?                  00640000
         BNZ   ECM_COPY           COPY IT IF SO                         00650000
         XC    0(32,R5),0(R5)     ELSE CLEAR IT                         00660000
         B     ECM_FIN            DONE                                  00670000
                                                                        00680000
ECM_COPY DS    0H                                                       00690000
         MVC   0(32,R5),0(R7)     REPLACE ECM                           00700000
         ST    R5,T.TSKECM        POST ECM ADDR                         00710000
                                                                        00720000
*--------------------------------------------------------------         00730000
*   RETURN COMPLETION STATUS / ECM TO CALLER                            00740000
*--------------------------------------------------------------         00750000
ECM_FIN  DS    0H                 REQUEST FAILED                        00760000
         LA    R15,RC00           COMPLETE                              00770000
         L     R1,TSKECM          RETURN ECM ADDR OR ZERO               00780000
                                                                        00790000
         #EXIT ,                                                        00800000
                                                                        00810000
         EJECT                                                          00820000
***************************************************************         00830000
*                                                                       00840000
*   LOCAL READ/ONLY DATA AREAS, ETC.                                    00850000
*                                                                       00860000
***************************************************************         00870000
         LTORG ,                                                        00880000
                                                                        00890000
         PRINT NOGEN                                                    00900000
         ICVT  ,                                                        00910000
         ITASK ,                                                        00920000
         END   ,                                                        00930000
