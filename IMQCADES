IMQCADES TITLE 'IMQCADES - MQCA delete'                                 00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: IMQCADES - MQCA delete                                       00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine is used to delete an $MSG Queue Control Area.         00080000
*    It is appropriate for use a $SRM DESTRUCTOR routine.               00090000
*                                                                       00100000
* ON ENTRY:                                                             00110000
*                                                                       00120000
*    R1  address of MQCA                                                00130000
*                                                                       00140000
* ON EXIT:                                                              00150000
*                                                                       00160000
*    R15 contains one of the following return codes                     00170000
*                                                                       00180000
*        RC00 - Request complete                                        00190000
*        RC04 - Storage area provided does not contain an MQCA          00200000
*        RC08 - STORAGE MANAGER FAILURE                                 00210000
*                                                                       00220000
**<DOC-OFF>****************************************************         00230000
                                                                        00240000
         EJECT                                                          00250000
***************************************************************         00260000
*                                                                       00270000
* MAINTENANCE:                                                          00280000
*                                                                       00290000
*    08/16/94 R. Turgeon                                                00300000
*             Initial version                                           00310000
*                                                                       00320000
***************************************************************         00330000
                                                                        00340000
         EJECT                                                          00350000
         #WORK ,                  BEGIN WORKAREA                        00360000
         #ENDWORK ,               END WORKAREA                          00370000
                                                                        00380000
         EJECT                                                          00390000
         MQCA  DSECT=YES          $MSG QUEUE CONTROL AREA               00400000
                                                                        00410000
         EJECT                                                          00420000
         ABCODES ,                $ABEND CODES                          00430000
*                                                                       00440000
         EQUS  ,                  USEFUL SYMBOLS                        00450000
                                                                        00460000
         EJECT                                                          00470000
IMQCADES #ENTER PREG=R8                                                 00480000
                                                                        00490000
         USING ITASK,R10          STDENV                                00500000
                                                                        00510000
         EJECT                                                          00520000
*--------------------------------------------------------------         00530000
*   VALIDATE THE MQCA                                                   00540000
*--------------------------------------------------------------         00550000
         USING MQCA,R8            REQUEST BLOCK                         00560000
         CLC   MQCA,=CL8'MQCA'    VALID?                                00570000
         BNE   ERR_REQ            APPEARS NOT                           00580000
                                                                        00590000
*--------------------------------------------------------------         00600000
*   RELEASE $MSG STORAGE AND THE MQCA PROPER                            00610000
*--------------------------------------------------------------         00620000
         STGTERM QH=MQCSTGQH      INIT A STORAGE POOL FOR MESSAGES      00630000
                                                                        00640000
         BZ    *+10                                                     00650000
         MVC   FWORD,=A(RC08)                                           00660000
                                                                        00670000
         STGRETN ADDR=MQCA,LEN=MQCALN,QH=ICTSTG                         00680000
                                                                        00690000
         BZ    *+10                                                     00700000
         MVC   FWORD,=A(RC08)                                           00710000
                                                                        00720000
*--------------------------------------------------------------         00730000
*   RETURN COMPLETION STATUS TO CALLER                                  00740000
*--------------------------------------------------------------         00750000
         L     R15,FWORD          RETURN CODE                           00760000
         B     RETURN             EXIT                                  00770000
                                                                        00780000
ERR_REQ  DS    0H                 INVALID MQCA                          00790000
         LA    R15,RC04                                                 00800000
                                                                        00810000
RETURN   DS    0H                                                       00820000
         SR    R15,R15            RETURN CODES NOT DEFINED              00830000
         SR    R0,R0              REASON CODES NOT DEFINED              00840000
                                                                        00850000
         #EXIT ,                                                        00860000
                                                                        00870000
         EJECT                                                          00880000
***************************************************************         00890000
*                                                                       00900000
*   LOCAL READ/ONLY DATA AREAS, ETC.                                    00910000
*                                                                       00920000
***************************************************************         00930000
         LTORG ,                                                        00940000
                                                                        00950000
         PRINT NOGEN                                                    00960000
         ICVT  ,                                                        00970000
         ITASK ,                                                        00980000
         IPCB  ,                                                        00990000
         END   ,                                                        01000000
