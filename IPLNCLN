IPLNCLN  TITLE '- PURGE NAVIGATION PLAN CACHE'                          00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: IPLNCLN - Purge navigation plan cache                        00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine is used to detach all navigation plans queued         00080000
*    to a given IPROJ and delete the associated RPN (plan               00090000
*    reference) entries.  It is intended for use in project             00100000
*    resource management (RMX) routines.  The normal                    00110000
*    serialization safeguards including the nav plan use count          00120000
*    are bypassed.                                                      00130000
*                                                                       00140000
*    The unordered list of RPNs is traversed.  IPLNRET is               00150000
*    invoked for any RPN containing an active navigation plan.          00160000
*    Then, the RPN itself is deleted.                                   00170000
*                                                                       00180000
*                                                                       00190000
* NOTES:                                                                00200000
*                                                                       00210000
*    It would have been nice to call this routine IPLNPURG              00220000
*    to maintain symmetry with IVDBPURG, but an external                00230000
*    function of that name already exists in INAVPLAN.                  00240000
*                                                                       00250000
*                                                                       00260000
* ON ENTRY:                                                             00270000
*                                                                       00280000
*    R1  contains the address of an IPROJ                               00290000
*                                                                       00300000
*                                                                       00310000
* ON EXIT:                                                              00320000
*                                                                       00330000
*    N/A                                                                00340000
*                                                                       00350000
**<DOC-OFF>****************************************************         00360000
                                                                        00370000
         EJECT                                                          00380000
***************************************************************         00390000
*                                                                       00400000
* MAINTENANCE:                                                          00410000
*                                                                       00420000
*    08/28/95 R. Turgeon                                                00430000
*             Initial version                                           00440000
*                                                                       00450000
***************************************************************         00460000
                                                                        00470000
         EJECT                                                          00480000
         #WORK ,                                                        00490000
         #ENDWORK ,                                                     00500000
                                                                        00510000
         EJECT                                                          00520000
         PLNREFNT ,               NAVIGATION PLAN REFERENCE ENTRY       00530000
                                                                        00540000
         EJECT                                                          00550000
         IPROJ ,                  PROJECT                               00560000
                                                                        00570000
         EJECT                                                          00580000
         EQUS  ,                                                        00590000
                                                                        00600000
         EJECT                                                          00610000
IPLNCLN  #ENTER BASE=R12,PREG=R7                                        00620000
                                                                        00630000
         USING ITASK,R10          ITASK ADDRESSABILITY                  00640000
                                                                        00650000
         EJECT                                                          00660000
***************************************************************         00670000
*                                                                       00680000
*   Run the unordered RPN list and delete all navigation plans          00690000
*                                                                       00700000
***************************************************************         00710000
                                                                        00720000
         USING IPROJ,R7           LIFE OF FUNCTION ADDRESSABILITY       00730000
                                                                        00740000
         ICM   R9,15,PRJEXPFQ     REFERENCED PLANS LIST                 00750000
         BZ    COMPLETE           DONE IF NONE                          00760000
         USING PLNREFNT,R9        RPN ENTRY FORMAT                      00770000
                                                                        00780000
         XC    PRJEXPFQ,PRJEXPFQ  PREVENT RECURSIVE CALLS IF ABEND      00790000
         XC    PRJEXPTR,PRJEXPTR                                        00800000
         XC    PRJIRPLN,PRJIRPLN  PLANCACHE() USAGE                     00810000
                                                                        00820000
*--------------------------------------------------------------         00830000
*   Delete the plan                                                     00840000
*--------------------------------------------------------------         00850000
                                                                        00860000
RPNSCAN  DS    0H                                                       00870000
         L     R8,RPNNEXT         SAVE PTR TO NEXT ENTRY                00880000
         ICM   R2,15,RPNEPLAN     RESIDUAL PLAN?                        00890000
         BZ    RPNADV             ONWARD IF NOT                         00900000
         L     R3,RPNEPSIZ        COALESCED PLAN SIZE, RETAIN RESIDUAL  00910000
                                                                        00920000
         STGRETN ADDR=(R2),LEN=(R3),QH=PRJEXSTG                         00930000
                                                                        00940000
*--------------------------------------------------------------         00950000
*   Delete the RPN                                                      00960000
*--------------------------------------------------------------         00970000
                                                                        00980000
RPNADV   DS    0H                                                       00990000
         $RETSTOR (R9),QHDR=0     RELEASE THE RPN                       01000000
                                                                        01010000
         LTR   R9,R8              RPNS REMAIN?                          01020000
         BNZ   RPNSCAN            GET THEM ALL                          01030000
         DROP  R9,R7              PLNREFNT, IPROJ                       01040000
                                                                        01050000
***************************************************************         01060000
*                                                                       01070000
*   Return to caller                                                    01080000
*                                                                       01090000
***************************************************************         01100000
                                                                        01110000
COMPLETE DS    0H                                                       01120000
         SR    R15,R15            RETURN CODE NOT DEFINED               01130000
                                                                        01140000
         #EXIT ,                                                        01150000
                                                                        01160000
         EJECT                                                          01170000
***************************************************************         01180000
*                                                                       01190000
*   Local read only storage                                             01200000
*                                                                       01210000
***************************************************************         01220000
                                                                        01230000
         LTORG ,                                                        01240000
                                                                        01250000
         EJECT                                                          01260000
         PRINT NOGEN                                                    01270000
         ICVT  ,                                                        01280000
         ITASK ,                                                        01290000
         END   ,                                                        01300000
