ISQXRSTN TITLE '- COMPLETE $NAVPARM COLUMN/VARIABLE ENTRIES'            00010000
**<DOC-ON>******************************************************        00020000
*                                                                       00030000
* ROUTINE: ISQXRSTN - Complete $NAVPARM column/variable entries         00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine is used to complete the input $NAVPARM with           00080000
*    recording (NVREC), screen (STN), and region (RGNTRY)               00090000
*    information that can be acquired only from the navigation          00100000
*    network associated with the current project, including:            00110000
*                                                                       00120000
*        IXRSRECP - principle recording anchor   (NVREC)                00130000
*        IXRSCRNA - screen (state) STN address   (NVSTN)                00140000
*        IXREXSSD - screen set descriptor        (EXRGNET)              00150000
*        IXRRGNTY - container region tree entry, (RGNTRY)               00160000
*                   or unnamed presentation space entry                 00170000
*                                                                       00180000
*    and various attributes and flags including:                        00190000
*                                                                       00200000
*        IXRSTAT1.IXRS1RGN - variable resides in a region               00210000
*        IXRSTAT1.IXRS1RPT - variable resides in repeating group        00220000
*                                                                       00230000
* METHOD:                                                               00240000
*                                                                       00250000
*    For each $NAVPARM column/variable (IXRCOLDF) entry,                00260000
*    the screen (set) name countained in IXRSRCNM is used to            00270000
*    derive the variable's associated STN and principle                 00280000
*    recording (NVREC) addresses.                                       00290000
*                                                                       00300000
*    Then, ILOCSSET and ILOCRGN are used, in sequence, to               00310000
*    acquire the assocaited region tree entry (RGNTRY) if the           00320000
*    variable is region resident.                                       00330000
*                                                                       00340000
*                                                                       00350000
* ON ENTRY:                                                             00360000
*                                                                       00370000
*    R1  address of $NAVPARM                                            00380000
*                                                                       00390000
*                                                                       00400000
* ON EXIT:                                                              00410000
*                                                                       00420000
*    R15 contains one of the return codes listed below.                 00430000
*        For all non-zero return codes, R1 contains the                 00440000
*        address of the IXRCOLDF entry causing the failure.             00450000
*                                                                       00460000
*        RC00 - all IXRCOLDF entries completed without error            00470000
*                                                                       00480000
*        RC04 - screen (set) STN could not be located                   00490000
*                                                                       00500000
*               R0 - RSN04 (standard "not found") indicator             00510000
*                                                                       00520000
*        RC08 - screen (set) region descriptor retrieval error          00530000
*                                                                       00540000
*               R0 - ILOCSSET return code                               00550000
*                                                                       00560000
*        RC12 - region not defined                                      00570000
*                                                                       00580000
*               R0 - ILOCRGN return code                                00590000
*                                                                       00600000
**<DOC-OFF>****************************************************         00610000
                                                                        00620000
         EJECT                                                          00630000
***************************************************************         00640000
*                                                                       00650000
* MAINTENANCE:                                                          00660000
*                                                                       00670000
*    05/10/95 R. Turgeon                                                00680000
*             Generalized to complete $NAVPARM column/variable          00690000
*             entry data not easily provided by a $NAVPARM              00700000
*             builder.                                                  00710000
*                                                                       00720000
*    07/06/95 R. Turgeon                                                00730000
*             Force a region name change whenever the screen       201A 00740000
*             (set) name changes.                                  201A 00750000
*                                                                       00760000
***************************************************************         00770000
                                                                        00780000
         EJECT                                                          00790000
         #WORK ,                                                        00800000
                                                                        00810000
USERAREA DS    4F                 $ENTITY USERDATA AREA                 00820000
                                                                        00830000
PREVSCRN DS    CL16               PREVIOUS SCREEN NAME                  00840000
PREVRGNM DS    CL16               PREVIOUS REGION NAME                  00850000
CURRRGNM DS    CL16               CURRENT REGION NAME                   00860000
                                                                        00870000
@NVSTN   DS    A                  STN OF LAST VARIABLE                  00880000
@NVREC   DS    A                  PRINCIPLE RECORDING OF LAST STN       00890000
@EXSSD   DS    A                  SCREEN (SET) DESCRIPTOR               00900000
@RGNTRY  DS    A                  REGION TREE ENTRY OF LAST VARIABLE    00910000
@STAT1   DS    X                  IXRSTAT1 VALUE CORR TO LAST RGNTRY    00920000
                                                                        00930000
         #ENDWORK ,                                                     00940000
                                                                        00950000
         EJECT                                                          00960000
         NAV ,                    NAVIGATION STRUCTURES                 00970000
                                                                        00980000
         EJECT                                                          00990000
         $NAVPARM ,               PRIMARY NAVIGATION LINKAGES           01000000
                                                                        01010000
         EJECT                                                          01020000
         $ENTITY DSECT=YES        $ENTITY LOOKUP CAPABILITY             01030000
                                                                        01040000
         EJECT                                                          01050000
         EXRGNET ,                SCREEN (SET) DESCRIPTOR               01060000
                                                                        01070000
         EJECT                                                          01080000
         REGION ,                 REGION DEFINITION STRUCTURES          01090000
                                                                        01100000
         ICATALOG VARIABLE        SYSVARIABLES FORMAT                   01110000
                                                                        01120000
         EJECT                                                          01130000
         EQUS  ,                                                        01140000
                                                                        01150000
         EJECT                                                          01160000
ISQXRSTN #ENTER PREG=R8                                                 01170000
                                                                        01180000
         USING ITASK,R10          STDENV                                01190000
         L     R9,TSKPCBC         PROCESS MODE                          01200000
         USING IPCB,R9                                                  01210000
                                                                        01220000
         EJECT                                                          01230000
***************************************************************         01240000
*                                                                       01250000
*   General initialization - locate current project                     01260000
*                                                                       01270000
***************************************************************         01280000
                                                                        01290000
         USING $NAVPARM,R8        LIFE OF FUNCTION                      01300000
                                                                        01310000
         ICM   R7,15,PCBUSER      LOCATE IUSER                          01320000
         BNZ   *+8                                                      01330000
         EX    R0,*                                                     01340000
                                                                        01350000
         ICM   R7,15,USRPROJ-IUSER(R7)  ASSOCIATED PROJECT              01360000
         BNZ   *+8                                                      01370000
         EX    R0,*                                                     01380000
                                                                        01390000
         USING IPROJ,R7           LIFE OF FUNCTION                      01400000
                                                                        01410000
*--------------------------------------------------------------         01420000
*   PREPARE FOR NAVPARM SCAN                                            01430000
*--------------------------------------------------------------         01440000
                                                                        01450000
         LA    R6,$NAVPARM        LOCATE COL/VAR ENTRY ORIGIN           01460000
         A     R6,IXREPOFF                                              01470000
         USING IXRCOLDF,R6        LIFE OF FUNCTION                      01480000
                                                                        01490000
         LH    R4,IXRNVARS        NUMBER OF VARIABLES DEFINED           01500000
                                                                        01510000
         EJECT                                                          01520000
***************************************************************         01530000
*                                                                       01540000
*   STN and principle recording (NVREC) location is needed only         01550000
*   if the current variable's screen (set) residence differs            01560000
*   from that of the previously processed variable.                     01570000
*                                                                       01580000
***************************************************************         01590000
                                                                        01600000
NXTENTRY DS    0H                                                       01610000
         CLC   PREVSCRN,IXRSCRNM  VARIABLE RESIDES IN SAME SCREEN?      01620000
         BE    FINSCRN            NO NEED TO RELOCATE INFO              01630000
         MVC   PREVSCRN,IXRSCRNM  RETAIN NEW CURRENT/PREV SCREEN        01640000
                                                                        01650000
         MVC   PREVRGNM,HIVALUE   FORCE A REGION TRANSITION        201A 01660000
         XC    @EXSSD,@EXSSD      WITHDRAW SCREEN SET DESCRIPTOR        01670000
         XC    @RGNTRY,@RGNTRY    REGION TREE ENTRY PTR                 01680000
         XC    @STAT1,@STAT1      IXRSTAT1 VALUE, LAST RGN TREE ENTRY   01690000
                                                                        01700000
*--------------------------------------------------------------         01710000
*   LOCATE STN ADDRESS USING VARIABLE'S SCREEN NAME                     01720000
*--------------------------------------------------------------         01730000
                                                                        01740000
         $ENTITY EXTR,            LOCATE STN                           X01750000
               QNAME=CSTRIMAG,    ENTITY IS AN IMAGE                   X01760000
               ENTITY=IXRSCRNM,   FOREIGN KEY RESIDES IN SYSVAR        X01770000
               USERDATA=USERAREA,                                      X01780000
               ANCHOR=PRJEXENT,                                        X01790000
               MF=(E,MFE_LIST)                                          01800000
                                                                        01810000
         CH    R15,=AL2(RC04)     TEST COMPLETION STATUS                01820000
         BL    EXTRSTN            STN RETURNED IN R1                    01830000
         BE    *+8                VARIABLE NOT ATTACHED TO SCREEN       01840000
         EX    R0,*               DENY 'PROPERLY FORMULATED REQ'        01850000
                                                                        01860000
*--------------------------------------------------------------         01870000
*   SCREEN NAME DID NOT MATCH SYSVAR, RETRY AS SCREEN SET NAME          01880000
*--------------------------------------------------------------         01890000
                                                                        01900000
         $ENTITY EXTR,            LOCATE STN                           X01910000
               QNAME=CSTRSSET,    ENTITY IS A SCREEN SET               X01920000
               ENTITY=IXRSCRNM,   FOREIGN KEY RESIDES IN SYSVAR        X01930000
               USERDATA=USERAREA,                                      X01940000
               ANCHOR=PRJEXENT,                                        X01950000
               MF=(E,MFE_LIST)                                          01960000
                                                                        01970000
         CH    R15,=AL2(RC04)     TEST COMPLETION STATUS                01980000
         BL    EXTRSTN            STN RETURNED IN R1                    01990000
         BE    ERR_STN            VARIABLE NOT ATTACHED TO SCREEN       02000000
         EX    R0,*               ASSERT 'PROPERLY FORMULATED REQ'      02010000
                                                                        02020000
*--------------------------------------------------------------         02030000
*   EXTRACT STN AND PRINCIPLE RECORDING NVREC ADDRESSES                 02040000
*--------------------------------------------------------------         02050000
                                                                        02060000
EXTRSTN  DS    0H                                                       02070000
         USING NVSTN,R5           STATE TRANSITION NETWORK NODE         02080000
         L     R5,USERAREA        EXTRACT STN ADDRESS FROM USERDATA     02090000
         ST    R5,@NVSTN          EXTRACT STN ADDRESS FROM USERDATA     02100000
         MVC   @NVREC,NVSRECP     EXTRACT PRINCIPLE NVREC ADDRESS       02110000
         DROP  R5                 NVSTN                                 02120000
                                                                        02130000
FINSCRN  DS    0H                                                       02140000
                                                                        02150000
         EJECT                                                          02160000
***************************************************************         02170000
*                                                                       02180000
*   Region tree entry location and attribute extraction is              02190000
*   required only if the variable's region residence differs            02200000
*   from that of the previously processed variable.                     02210000
*                                                                       02220000
*   If the variable does not reside in a named, user defined            02230000
*   region yet some variables on the screen are region                  02240000
*   resident, it is associated instead with the unnamed region          02250000
*   representing the entire presentation space.  Having all             02260000
*   variables associated with regions simplifies variable               02270000
*   extraction later.                                                   02280000
*                                                                       02290000
***************************************************************         02300000
                                                                        02310000
         L     R3,IXR@RVAR        SYSVARIABLES DEFINITION               02320000
         USING SVARSECT,R3        SHORT TERM ADDRESSABILITY             02330000
         MVC   CURRRGNM,SVAREGN   EXTRACT VARIABLE RGN ASSOCIATION      02340000
         OC    CURRRGNM,BLANKS    CONSITENT BLANK/NULL VALUE            02350000
         CLC   PREVRGNM,CURRRGNM  VARIABLE RESIDES IN SAME REGION?      02360000
         BE    FINREGN            NO NEED TO RELOCATE                   02370000
         MVC   PREVRGNM,CURRRGNM  RETAIN REGION NAME OR NULLS           02380000
                                                                        02390000
         XC    @EXSSD,@EXSSD      WITHDRAW SCREEN SET DESCRIPTOR        02400000
         XC    @RGNTRY,@RGNTRY    ASSUME VARIABLE NOT REGION RESIDENT   02410000
         MVI   @STAT1,0           REGION STATUS FLAGS                   02420000
                                                                        02430000
*--------------------------------------------------------------         02440000
*   LOCATE SCREEN (SET) DESCRIPTOR, IDENTIFY REGION RESIDENCE           02450000
*--------------------------------------------------------------         02460000
                                                                        02470000
         LA    R1,IXRSCRNM        R1 <== SCREEN (SET) NAME              02480000
         @CALL ILOCSSET,CTYPE=CVT LOCATE SCREEN SET DESCRIPTOR?         02490000
         CH    R15,=AL2(RC04)     REGIONS DEFINED?                      02500000
         BE    FINREGN            DONE HERE IF NOT                      02510000
         BH    ERR_SSET           INCONSISTENT DEFINITIONS              02520000
                                                                        02530000
E        USING EXRGNET,R1         SCREEN (SET) DESCRIPTOR RETURNED      02540000
T        USING RGNTREE,E.EXRNROOT REGION TREE BASE                      02550000
R        USING RGNTRY,T.RGTROOT   ROOT REGION TREE ENTRY                02560000
                                                                        02570000
         ST    R1,@EXSSD          RETAIN SCREEN (SET) DESCRIPTOR        02580000
         LA    R1,R.RGNTRY        ASSUME VAR IN PRES SPACE REGION ONLY  02590000
         TM    SVAREGN,BF         VARIABLE IS REGION RESIDENT?          02600000
         BZ    SETREGN            DONE HERE IF NOT                      02610000
         DROP  R,T,E              EXRGNET, RGNTREE, RGNTRY              02620000
                                                                        02630000
*--------------------------------------------------------------         02640000
*   ASSOCIATE A REGION WITH THE VARIABLE                                02650000
*--------------------------------------------------------------         02660000
                                                                        02670000
         L     R0,@EXSSD          R0 <== SCREEN SET DESCRIPTOR          02680000
         LA    R1,SVAREGN         R1 <== REGION NAME                    02690000
         @CALL ILOCRGN,CTYPE=CVT  LOCATE REGION TREE ENTRY              02700000
         LTR   R15,R15            RETURNED IN R1                        02710000
         BNZ   ERR_RGN            INCONSISTENT DEFINITIONS              02720000
                                                                        02730000
*--------------------------------------------------------------         02740000
*   EXTRACT/RETAIN USEFUL INFORMATION FROM REGION TREE ENTRY            02750000
*--------------------------------------------------------------         02760000
                                                                        02770000
SETREGN  DS    0H                                                       02780000
         USING RGNTRY,R1          REGION TREE ENTRY                     02790000
         ST    R1,@RGNTRY         RETAIN REGION TREE ADDR               02800000
                                                                        02810000
         MVI   @STAT1,IXRS1RGN    VARIABLE IS REGION RESIDENT           02820000
         TM    RGNFLAG1,RGRPTRGN+RGRPTPAR  VARIABLE IN REPEAT GRP?      02830000
         BZ    *+8                SKIP IF NOT                           02840000
         OI    @STAT1,IXRS1RPT    VARIABLE IN REPEAT GRP, NAVPARM FMT   02850000
         DROP  R1,R3              RGNTRY, SYSVARIABLE                   02860000
                                                                        02870000
FINREGN  DS    0H                                                       02880000
                                                                        02890000
         EJECT                                                          02900000
***************************************************************         02910000
*                                                                       02920000
*   Complete $NAVPARM entry (IXRCOLDF) with extracted info              02930000
*                                                                       02940000
***************************************************************         02950000
                                                                        02960000
         MVC   IXRSCRNA,@NVSTN    SCREEN (SET) STN ADDRESS              02970000
         MVC   IXRSRECP,@NVREC    PRINCIPLE RECORDING (NVREC)           02980000
         MVC   IXREXSSD,@EXSSD    SCREEN (SET) DESC   (EXRGNET)         02990000
         MVC   IXRRGNTY,@RGNTRY   REGION TREE ENTRY   (RGNTRY)          03000000
         OC    IXRSTAT1,@STAT1    REGION / REPEAT GROUP STATUS          03010000
                                                                        03020000
*--------------------------------------------------------------         03030000
*   ADVANCE TO NEXT $NAVPARM COLUMN/VARIABLE ENTRY                      03040000
*--------------------------------------------------------------         03050000
                                                                        03060000
         LA    R6,IXRCDLEN(,R6)   ADVANCE TO NEXT COLUMN                03070000
         BCT   R4,NXTENTRY        PROCESS NEXT                          03080000
                                                                        03090000
         EJECT                                                          03100000
***************************************************************         03110000
*                                                                       03120000
*   Normal and abnormal completions                                     03130000
*                                                                       03140000
***************************************************************         03150000
                                                                        03160000
NORMRET  DS    0H                                                       03170000
         LA    R15,RSN04          STANDARD 'NOT FOUND' VALUE            03180000
         LA    R15,RC00           $NAVPARM COMPLETED WITHOUT ERROR      03190000
         B     RETURN                                                   03200000
                                                                        03210000
ERR_STN  DS    0H                 STN COULD NOT BE ($ENTITY) LOCATED    03220000
         SR    R0,R0              REASON CODES NOT DEFINED              03230000
         LA    R15,RC04           SET ERROR RETURN CODE                 03240000
         B     RETURN                                                   03250000
                                                                        03260000
ERR_SSET DS    0H                 SCREEN SET REGION DESCRIPTOR MISSING  03270000
         LR    R0,R15             ILOCSSET FAILING RETURN CODE          03280000
         LA    R15,RC08                                                 03290000
         B     RETURN                                                   03300000
                                                                        03310000
ERR_RGN  DS    0H                 REGION TREE ENTRY NOT FOUND           03320000
         LR    R0,R15             ILOCRGN FAILING RETURN CODE           03330000
         LA    R15,RC12                                                 03340000
                                                                        03350000
*--------------------------------------------------------------         03360000
*   RETURN COMPLETION STATUS TO CALLER                                  03370000
*--------------------------------------------------------------         03380000
                                                                        03390000
RETURN   DS    0H                                                       03400000
         LA    R1,IXRCOLDF        RETURN NAVPARM COL/VAR ENTRY IF ERROR 03410000
                                                                        03420000
         #EXIT                                                          03430000
                                                                        03440000
         EJECT                                                          03450000
***************************************************************         03460000
*                                                                       03470000
*   LOCAL READ ONLY DATA AREAS, MAPPINGS, ETC.                          03480000
*                                                                       03490000
***************************************************************         03500000
                                                                        03510000
CSTRIMAG DC    C'IMAGE'                                                 03520000
CSTRSSET DC    C'SSET'                                                  03530000
BLANKS   DC    CL32' '                                                  03540000
HIVALUE  DC    32X'FF'                                             201A 03550000
                                                                        03560000
         LTORG ,                                                        03570000
                                                                        03580000
         EJECT ,                                                        03590000
         PRINT NOGEN                                                    03600000
         ICVT  ,                                                        03610000
         ITASK ,                                                        03620000
         IPCB  ,                                                        03630000
         IPROJ ,                  PROJECT DEFINITION                    03640000
         IUSER ,                  USER DEFINITION                       03650000
         END   ,                                                        03660000
