ISESDIAG TITLE '- GENERATE DIAGNOSTIC MSGS FOR $SESS ERRORS'            00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: ISESDIAG - GENERATE DIAGNOSTIC MSGS FOR $SESS ERRORS         00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THIS ROUTINE MAY BE USED TO DOCUMENT A PROBLEM ENCOUNTERED         00080000
*    BY THE $SESS FACILITY. IT ACCEPTS THE $SESS PARAMETER LIST         00090000
*    AND SELECTS AN DIAGNOSTIC MESSAGE APPROPRIATE FOR THE              00100000
*    POSTED RETURN AND REASON CODES. THE REQUESTOR MAY PROVIDE          00110000
*    A MESSAGE BUFFER AND/OR MESSAGE DESTINATION CODE OVERRIDES.        00120000
*                                                                       00130000
*                                                                       00140000
* ON ENTRY:                                                             00150000
*                                                                       00160000
*    R1 CONTAINS THE ADDRESS OF A PARAMETER CLIST CONSTRUCTED           00170000
*       AS FOLLOWS                                                      00180000
*                                                                       00190000
*          +00 - ADDR OF A COMPLETED $SESS PLIST/COMM AREA              00200000
*          +04 - ADDR OF A $MSGBUF MSG RETURN AREA  (OPTIONAL)          00210000
*          +08 - LENG OF MESSAGE RETURN AREA        (OPTIONAL)          00220000
*          +12 - $MSG DESTINATION CODE OVERRIDES    (OPTIONAL)          00230000
*                                                                       00240000
*                                                                       00250000
* ON EXIT:                                                              00260000
*                                                                       00270000
*    THE MESSAGE BUFFER PROVIDED CONTAINS APPROPRIATE DIAGNOSTIC        00280000
*    MESSAGES FOR THE RETURN AND REASON CODE PAIR PROVIDED.             00290000
*    NO MESSAGES ARE RETURNED FOR RC00.                                 00300000
*                                                                       00310000
*       RC00 - MESSAGE BUFFER CONSTRUCTED, REF $MSGBUF                  00320000
*                                                                       00330000
*       RCNN - RETURN CODE GENERATED BY $MSG.  R0 MAY CONTAIN           00340000
*              AN ASSOCIATED REASON CODE.                               00350000
*                                                                       00360000
**<DOC-OFF>****************************************************         00370000
                                                                        00380000
         EJECT ,                                                        00390000
         #WORK ,                                                        00400000
                                                                        00410000
BUFPTR   DS    A                  USER SUPPLIED MSG BUFFER PTR          00420000
BUFLEN   DS    F                  MSG BUFFER LENGTH                     00430000
                                                                        00440000
DESTCODE DS    X                  $MSG DESTINATION (ROUTING) CODES      00450000
                                                                        00460000
ALIGN    DS    0F                 ALIGNMENT                             00470000
WK256    DS    XL256              GENERAL PURPOSE WORK AREA             00480000
                                                                        00490000
         #ENDWORK ,                                                     00500000
                                                                        00510000
         EJECT                                                          00520000
         $SESS DSECT=YES          SESSION MANAGEMENT REQUEST PLISTS     00530000
                                                                        00540000
         EJECT                                                          00550000
         ABCODES ,                                                      00560000
                                                                        00570000
         EQUS  ,                                                        00580000
                                                                        00590000
         EJECT ,                                                        00600000
                                                                        00610000
         $MSGDFT PREFIX=ICTPID,COMPID='VTM',TABLE=*#MSGS,              X00620000
               CONID=*ICTCONID,CONNAME=ICTCONNM,                       X00630000
               PRINT=NOGEN,MF=(E,WK256)                                 00640000
                                                                        00650000
         EJECT ,                                                        00660000
ISESDIAG #ENTER PREG=R9                                                 00670000
                                                                        00680000
         USING ITASK,R10          PROCESS MODE                          00690000
                                                                        00700000
         EJECT                                                          00710000
*--------------------------------------------------------------         00720000
*   FETCH PASSED PARAMETERS, REQUESTOR MAY PROVIDE $MSGBUF AREA         00730000
*--------------------------------------------------------------         00740000
         LA    R15,RC00           ANTICIPATE EARLY EXIT                 00750000
         LM    R5,R8,0(R9)        FETCH PASSED PARAMETERS               00760000
         USING SPLIST,R5          $SESS COMMUNICATION AREA              00770000
         STC   R8,DESTCODE        SUPPLEMENTAL MSG ROUTING CODES        00780000
                                                                        00790000
         LTR   R6,R6              MSG BUFFER PROVIDED?                  00800000
         BZ    NOBUFR             TERM IF NOT                           00810000
         C     R7,=A($MSBPFXL)    REASONABLE BUFFER LENGTH              00820000
         BNH   NOBUFR             TERM IF NOT                           00830000
                                                                        00840000
         ST    R6,BUFPTR          REQUESTOR SUPPLIED BUFFER             00850000
         ST    R7,BUFLEN          BUFFER LENGTH                         00860000
         OI    DESTCODE,$BUFFER   MESSAGES RETAINED FOR RETURN          00870000
                                                                        00880000
NOBUFR   DS    0H                                                       00890000
                                                                        00900000
*--------------------------------------------------------------         00910000
*   CONVERT FUNCTION CODE TO FUNCTION NAME                              00920000
*--------------------------------------------------------------         00930000
         LA    R4,FUNCTAB         ASSUME FUNCTION NOT KNOWN             00940000
         ICM   R1,15,SPLFUNC      ACQUIRE TRUE FUNCTION CODE            00950000
         BNP   EFUNC              INVALID FUNCTION CODE                 00960000
         C     R1,=A(FUNC#)       FUNCTION KNOWN?                       00970000
         BNL   EFUNC              SKIP IF NOT                           00980000
         MH    R1,=AL2(L'FUNCTAB) INDEX INTO FUNCTION NAME TABLE        00990000
         AR    R4,R1              SELECT CORR FUNCTION NAME             01000000
EFUNC    DS    0H                                                       01010000
                                                                        01020000
*--------------------------------------------------------------         01030000
*   DERIVE MSG # FROM RETCODE ALONE OR RETCODE AND RSNCODE              01040000
*--------------------------------------------------------------         01050000
         ICM   R15,15,SPLRETCD    RETURN CODE                           01060000
         BZ    RETURN             NORMAL COMPLETION YIELDS NO MSGS      01070000
         C     R15,RETCODES       RETCODE WITHIN RANGE?                 01080000
         BNL   DFTMSG             NO FURTHER ANALYSIS OTHERWISE         01090000
         L     R2,RETCTAB(R15)    FETCH APPROP MSG# OR RSN CODE TABLE   01100000
         C     R2,=A(1000)        MESSAGE NUMBER?                       01110000
         BL    BUILDMSG           NO FURTHER ANALYSIS IF SO             01120000
                                                                        01130000
         ICM   R15,15,SPLRSNCD    FETCH ASSOCIATED REASON CODE          01140000
         C     R15,0(,R2)         REASON CODE DOCUMENTED?               01150000
         BNL   DFTMSG             DEFAULT RC/RSN MSG OTHERWISE          01160000
         SLL   R15,2              CONVERT REASON NUMBER TO FWORD MULT   01170000
         L     R2,4(R15,R2)       FETCH MESSAGE NUMBER                  01180000
         LTR   R2,R2              MESSAGE ASSIGNED?                     01190000
         BNZ   BUILDMSG           USE DEFAULT MESSAGE                   01200000
                                                                        01210000
*--------------------------------------------------------------         01220000
*   CONSTRUCT MESSAGE AND ROUTE PER PARAMETERIZED REQUEST               01230000
*--------------------------------------------------------------         01240000
DFTMSG   DS    0H                 SELECT DEFAULT RC/RSN MESSAGE         01250000
         L     R2,RETINV          DEFAULT MSG #                         01260000
                                                                        01270000
BUILDMSG DS    0H                                                       01280000
         SR    R3,R3              PREPARE FOR INSERT                    01290000
         IC    R3,DESTCODE        MSG DESTINATION OVERRIDES OR ZERO     01300000
                                                                        01310000
         $MSG  (R2),FIELDS=(((R4),L'FUNCTAB),SPLRETCD,SPLRSNCD),       X01320000
               BUFR=*BUFPTR,BUFL=*BUFLEN,                              X01330000
               DEST=(R3)                                                01340000
                                                                        01350000
         EJECT                                                          01360000
***************************************************************         01370000
*                                                                       01380000
*   RETURN TO CALLER                                                    01390000
*                                                                       01400000
***************************************************************         01410000
RETURN   DS    0H                                                       01420000
         #EXIT ,                                                        01430000
                                                                        01440000
         EJECT ,                                                        01450000
***************************************************************         01460000
*                                                                       01470000
*   $SESS FUNCTION AND COMPLETION CODE TABLES                           01480000
*                                                                       01490000
***************************************************************         01500000
         DS    0F                                                       01510000
                                                                        01520000
FUNCTAB  DC    CL16'*UNKNOWN*       ' 0                                 01530000
         DC    CL16'SEND-DATA       ' 1                                 01540000
         DC    CL16'SEND-POS-RESP   ' 2                                 01550000
         DC    CL16'SEND-NEG-RESP   ' 3                                 01560000
         DC    CL16'SEND-SIGNAL     ' 4                                 01570000
         DC    CL16'SEND-BID        ' 5                                 01580000
         DC    CL16'SEND-LUSTAT     ' 6                                 01590000
         DC    CL16'SEND-CANCEL     ' 7                                 01600000
         DC    CL16'SEND-RTR        ' 8                                 01610000
         DC    CL16'SEND-CHASE      ' 9                                 01620000
         DC    CL16'SEND-RELQ       ' 10                                01630000
         DC    CL16'SEND-QEC        ' 11                                01640000
         DC    CL16'SEND-QC         ' 12                                01650000
         DC    CL16'SEND-SBI        ' 13                                01660000
         DC    CL16'SEND-BIS        ' 14                                01670000
         DC    CL16'SEND-SDT        ' 15                                01680000
         DC    CL16'SEND-CLEAR      ' 16                                01690000
         DC    CL16'SEND-STSN       ' 17                                01700000
         DC    CL16'SEND-RQR        ' 18                                01710000
         DC    CL16'SEND-SHUTD      ' 19                                01720000
         DC    CL16'SEND-SHUTC      ' 20                                01730000
         DC    CL16'SEND-RSHUTD     ' 21                                01740000
         DC    CL16'RECEIVE         ' 22                                01750000
         DC    CL16'EXTRACT         ' 23                                01760000
         DC    CL16'START-SESS      ' 24                                01770000
         DC    CL16'END-SESS        ' 25                                01780000
         DC    CL16'ADD-SESS        ' 26                                01790000
         DC    CL16'DEL-SESS        ' 27                                01800000
         DC    CL16'FIND-SESS       ' 28                                01810000
         DC    CL16'*UNKNOWN*       ' 29                                01820000
         DC    CL16'*UNKNOWN*       ' 30                                01830000
         DC    CL16'*UNKNOWN*       ' 31                                01840000
         DC    CL16'*UNKNOWN*       ' 32                                01850000
                                                                        01860000
FUNC#    EQU   (*-FUNCTAB)/L'FUNCTAB                                    01870000
                                                                        01880000
*--------------------------------------------------------------         01890000
*   $SESS RETURN / REASON CODES MAPPED TO MESSAGE NUMBERS               01900000
*--------------------------------------------------------------         01910000
RETINV   DC   A(101)              GENERIC FAILURE MESSAGE               01920000
                                                                        01930000
RETCODES DC   A(RETC#)            RETCODE TABLE SIZE                    01940000
RETCTAB  DC   A(*-*)       RC00   NOT USED                              01950000
         DC   A(RET04)     RC04   INVALID FUNCTION OR FIELD ID          01960000
         DC   A(RET08)     RC08   ENVIRONMENTAL ERROR                   01970000
         DC   A(112)       RC12   DATA TRUNCATION                       01980000
         DC   A(116)       RC16   SEND RECEIVE ALREADY ACTIVE           01990000
         DC   A(120)       RC20   REQUEST WAS CANCELLED                 02000000
         DC   A(124)       RC24   VTAM RPLRTNCD IS NON-ZERO             02010000
         DC   A(RET28)     RC28   PROTOCOL VIOLATION                    02020000
         DC   A(132)       RC32   NOTIFY REC'D (PROCEDURE ERROR)        02030000
RETC#    EQU  (*-RETCTAB)         RETCODE VALUE LIMIT                   02040000
                                                                        02050000
                                                                        02060000
RET04    DC   A(RET04RS#)         INVALID FUNCTION OR FIELD ID          02070000
RET04TAB DC   A(150)       RSN0      INVALID FUNCTION CODE              02080000
         DC   A(151)       RSN1      REQUIRED PARAMETER MISSING         02090000
         DC   A(152)       RSN2      INVALID EXTRACT FIELD ID           02100000
         DC   A(153)       RSN3      INAPPROPRIATE KEYWORD SPECIFIED    02110000
RET04RS# EQU  (*-RET04TAB)/4      RSN CODE VALUE LIMIT                  02120000
                                                                        02130000
                                                                        02140000
RET08    DC   A(RET08RS#)         ENVIRONMENTAL ERROR                   02150000
RET08TAB DC   A(101)       RSN0      *UNDEFINED*                        02160000
         DC   A(161)       RSN1      INVALID IVUSER BLOCK               02170000
         DC   A(162)       RSN2      INVALID TOKEN                      02180000
         DC   A(163)       RSN3      INVALID ISESS BLOCK                02190000
         DC   A(164)       RSN4      TOKEN ALREADY EXISTS               02200000
         DC   A(165)       RSN5      SPECIFIED POOL NOT AVAILABLE       02210000
         DC   A(166)       RSN6      SPECIFIED ACB  NOT AVAILABLE       02220000
RET08RS# EQU  (*-RET08TAB)/4      RSN CODE VALUE LIMIT                  02230000
                                                                        02240000
RET28    DC   A(RET28RS#)         PROTOCOL VIOLATION                    02250000
RET28TAB DC   A(101)       RSN0      *UNDEFINED*                        02260000
         DC   A(171)       RSN1      DATA TRAFFIC STATE ERROR           02270000
         DC   A(172)       RSN2      SESSION QUIESCED                   02280000
         DC   A(173)       RSN3      SESSION SHUTDOWN                   02290000
         DC   A(174)       RSN4      BRACKET VIOLATION                  02300000
         DC   A(175)       RSN5      DIRECTION VIOLATION                02310000
         DC   A(176)       RSN6      RU-TYPE NOT SUPPORTED              02320000
RET28RS# EQU  (*-RET28TAB)/4      RSN CODE VALUE LIMIT                  02330000
                                                                        02340000
         EJECT ,                                                        02350000
***************************************************************         02360000
*                                                                       02370000
*   LOCAL READ ONLY DATA AREAS, ETC.                                    02380000
*                                                                       02390000
***************************************************************         02400000
         LTORG ,                                                        02410000
                                                                        02420000
         EJECT                                                          02430000
         PRINT NOGEN                                                    02440000
         ICVT  ,                                                        02450000
         ITASK ,                                                        02460000
         END   ,                                                        02470000
