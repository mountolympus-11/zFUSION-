ILU2APSP TITLE 'INTEGRATOR - LU2 SESSION IMAGE SIGNAL PLU'              00010000
                                                                        00020000
**<DOC-ON>************************************************************* 00030000
*                                                                       00040000
* ROUTINE: ILU2APSP - INTEGRATOR SESSION IMAGE SIGNAL PLU               00050000
*                                                                       00060000
* DESCRIPTION: THIS ROUTINE IS CALLED TO SEND AN SNA SIGNAL             00070000
*              RU TO THE HOST APPLICATION.                              00080000
*                                                                       00090000
* ON ENTRY:                                                             00100000
*                                                                       00110000
*    R15 = ENTRY POINT ADDRESS                                          00120000
*    R14 = RETURN ADDRESS                                               00130000
*    R13 = AVAILABLE SAVE AREA                                          00140000
*    R11 = ICVT ADDRESS                                                 00150000
*    R10 = ITASK ADDRESS                                                00160000
*    R01 = SLUHANDL ADDRESS                                             00170000
*                                                                       00180000
* ON EXIT:                                                              00190000
*                                                                       00200000
*    R15 = 0 SIGNAL SUCCESSFUL                                          00210000
*            R00 = 0                                                    00220000
*            R01 = 0                                                    00230000
*        = 8 SIGNAL FAILED                                              00240000
*            R00 = $SESS SPLRETCD                                       00250000
*            R01 = $SESS SPLRSNCD                                       00260000
*                                                                       00270000
*    ALL OTHER REGISTERS ARE RESTORED.                                  00280000
*                                                                       00290000
**<DOC-OFF>************************************************************ 00300000
                                                                        00310000
*********************************************************************** 00320000
*                                                                       00330000
* MAINTENANCE:                                                          00340000
*                                                                       00350000
*   10/01/93 RANDY WITEK                                                00360000
*                                                                       00370000
*********************************************************************** 00380000
                                                                        00390000
         EQUS  ,                  GENERAL EQUATES                       00400000
                                                                        00410000
RICVT    EQU   R11                                                      00420000
RITASK   EQU   R10                                                      00430000
RIVTAM   EQU   R9                                                       00440000
RSLUHNDL EQU   R8                                                       00450000
                                                                        00460000
         USING ICVT,RICVT         ESTABLISH ADDRESSABILITY              00470000
         USING ITASK,RITASK       ESTABLISH ADDRESSABILITY              00480000
         USING IVTAMCVT,RIVTAM    ESTABLISH ADDRESSABILITY              00490000
         USING SLUHANDL,RSLUHNDL  ESTABLISH ADDRESSABILITY              00500000
                                                                        00510000
WORKAREA #WORK ,                  READ/WRITE WORKAREA                   00520000
WRK256   DS    XL256              GENERAL WORKAREA                      00530000
SUB0SAVE DS    18F                SUBROUTINE SAVE AREA                  00540000
RETR15   DS    F                                                        00550000
RETR0    DS    F                                                        00560000
RETR1    DS    F                                                        00570000
RETREGS  EQU   RETR15,*-RETR15    INCLUSIVE SYMBOL                      00580000
                                                                        00590000
WORKLEN  #ENDWORK                 END OF WORKAREA                       00600000
                                                                        00610000
         $MSGDFT PREFIX=ICTPID,                                        +00620000
               COMPID='LU2',                                           +00630000
               TABLE=*#MSGS,                                           +00640000
               WORKA=0,                                                +00650000
               MF=(E,WRK256),                                          +00660000
               PRINT=NOGEN                                              00670000
                                                                        00680000
ILU2APSP #ENTER BASE=R12,                                              +00690000
               PREG=(RSLUHNDL),    R1 --> RSLUHNDL                     +00700000
               AMODE=31,                                               +00710000
               RMODE=ANY                                                00720000
                                                                        00730000
*---------------------------------------------------------------------- 00740000
* INITIALIZATION                                                        00750000
*---------------------------------------------------------------------- 00760000
                                                                        00770000
         L     RIVTAM,ICTVTCVT     ESTABLISH ADDRESSIBILITY             00780000
                                                                        00790000
*---------------------------------------------------------------------- 00800000
* SEND A SIGNAL                                                         00810000
*---------------------------------------------------------------------- 00820000
                                                                        00830000
         $GETSTOR L'SPL,                                               +00840000
               LOC=ANY,                                                +00850000
               OWNER=(RITASK)          ALLOCATE SPLIST IN TASK STORAGE  00860000
                                                                        00870000
         LR    R3,R1                   SPLIST ADDRESS                   00880000
                                                                        00890000
         $SESS $SESS_SEND_SIGNAL,                                      +00900000
               SESSION=SLHSTKN,                                        +00910000
               AREA=SIGDATA,                                           +00920000
               AREALEN=4,                                              +00930000
               ERRET=BADSEND,                                          +00940000
               MF=(E,(R3))             SIGNAL THE PLU                   00950000
                                                                        00960000
         B     RETURN                                                   00970000
                                                                        00980000
*---------------------------------------------------------------------- 00990000
* EXCEPTION ROUTINES                                                    01000000
*---------------------------------------------------------------------- 01010000
                                                                        01020000
X        USING SPLIST,R3                                                01030000
                                                                        01040000
BADSEND  DS    0H                                                       01050000
                                                                        01060000
         MVC   RETR15,=F'8'       $SESS SEND FAILED                     01070000
         MVC   RETR0,X.SPLRETCD   $SESS RETURN CODE                     01080000
         MVC   RETR1,X.SPLRSNCD   $SESS REASON CODE                     01090000
         B     RETURN                                                   01100000
                                                                        01110000
         DROP  X                                                        01120000
                                                                        01130000
*---------------------------------------------------------------------- 01140000
* RETURN TO CALLER                                                      01150000
*---------------------------------------------------------------------- 01160000
                                                                        01170000
RETURN   DS    0H                                                       01180000
                                                                        01190000
         $RETSTOR (R3),                                                +01200000
               OWNER=(RITASK)     RELEASE THE SPLIST                    01210000
                                                                        01220000
         LM    R15,R1,RETREGS     LOAD RETURN VALUES                    01230000
                                                                        01240000
         #EXIT R1=YES             RETURN W/R15,R0,R1                    01250000
                                                                        01260000
*---------------------------------------------------------------------- 01270000
* ERROR ROUTINES                                                        01280000
*---------------------------------------------------------------------- 01290000
                                                                        01300000
*---------------------------------------------------------------------- 01310000
*  CONSTANTS AND LITERALS                                               01320000
*---------------------------------------------------------------------- 01330000
                                                                        01340000
SIGDATA  DC    XL4'00010000'                                            01350000
                                                                        01360000
         LTORG ,                                                        01370000
         PRINT NOGEN                                                    01380000
         IHAPSA ,                 MVS PREFIXED SAVE AREA                01390000
         ISTDBIND ,               VTAM BIND IMAGE                       01400000
         TRACODES ,               INTEGRATOR TRACE CODE EQUATES         01410000
         SESSIMAG ,               INTEGRATOR LU2 IMAGE BLOCK            01420000
         ICVT  ,                  INTEGRATOR CVT                        01430000
         IVTAMCVT ,               INTEGRATOR VTAM CVT                   01440000
         ITASK ,                  INTEGRATOR TASK BLOCK                 01450000
         ISESS ,                  INTEGRATOR ISESS BLOCK                01460000
         TMSG  ,                  INTEGRATOR INTERTASK MSG FORMAT       01470000
         EVCODES ,                INTEGRATOR EVENT CODES                01480000
         ABCODES ,                INTEGRATOR $ABEND CODES               01490000
         MSGCODES ,               INTEGRATOR INTERTASK MSGING CODES     01500000
         @EPB ,                   INTEGRATOR EVENT PROCESS BLOCK        01510000
         $VTAM DSECT=YES          INTEGRATOR $VTAM SERVICES             01520000
         $SESS DSECT=YES          INTEGRATOR $SESS SERVICES             01530000
         SBUF  DSECT=YES          INTEGRATOR SBUF SERVICES              01540000
         SLUHANDL ,               INTEGRATOR                            01550000
         END   ,                                                        01560000
