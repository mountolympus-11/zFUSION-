ITBFROW  TITLE 'TABLE SERVICES - ROW LOCATE BY SLOT NUMBER'             00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE:  ITBFROW - Row locate by slot number                         00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    Ref TBFROW macro                                                   00080000
*                                                                       00090000
*                                                                       00100000
* ON ENTRY:                                                             00110000
*                                                                       00120000
*    R1 - AR qualified address of row locator                           00130000
*    R0 - ROWID in slot number format                                   00140000
*                                                                       00150000
*                                                                       00160000
* ON EXIT:                                                              00170000
*                                                                       00180000
*    R15 contains one of the following return codes                     00190000
*                                                                       00200000
*        RC00 - valid row reference                                     00210000
*                                                                       00220000
*               R1 contains the AR qualified row offset                 00230000
*                                                                       00240000
*        RC04 - slot number not valid                                   00250000
*                                                                       00260000
**<DOC-OFF>****************************************************         00270000
                                                                        00280000
         EJECT                                                          00290000
***************************************************************         00300000
*                                                                       00310000
* MAINTENANCE:                                                          00320000
*                                                                       00330000
*    10/23/95 R. Turgeon                                                00340000
*             Implement the NOLOCATOR property                          00350000
*                                                                       00360000
***************************************************************         00370000
                                                                        00380000
         EJECT                                                          00390000
         LOCATOR ,                ROW LOCATOR                           00400000
                                                                        00410000
         EJECT                                                          00420000
         EQUS  LINKAGE=VCON                                             00430000
                                                                        00440000
         EJECT                                                          00450000
ITBFROW  @ENTER ASC=ENTRY                                               00460000
                                                                        00470000
*--------------------------------------------------------------         00480000
*   Validate slot number, convert to row offset                         00490000
*--------------------------------------------------------------         00500000
                                                                        00510000
         LA    R15,RC04           ASSUME ROW # IS INVALID               00520000
         LTR   R2,R0              VALIDATE ROW # PROVIDED               00530000
         BNP   RET                RANGES FROM 1 - N                     00540000
                                                                        00550000
         LAE   R11,0(,R1)         LOCATOR OBJECT ORIGIN                 00560000
         USING LOCATOR,R11        OPEN OBJECT SPACE WINDOW              00570000
         CL    R2,LOCHWM          ROW # EXCEEDS HIGHEST IN USE?         00580000
         BH    RET                ERROR IF SO                           00590000
                                                                        00600000
         BCTR  R2,0               ZERO RELATIVE ROW #                   00610000
         MH    R2,LOCSLOSZ+2      CONVERT TO OFFSET                     00620000
         L     R1,LOCSLOTS(R2)    ACQUIRE ROW OFFLINK                   00630000
         LTR   R1,R1              VALID ROW DESIGNATION?                00640000
         BNP   RET                REQUEST FAILS IF NOT                  00650000
                                                                        00660000
         LA    R15,RC00           ELSE, SUCCESS                         00670000
                                                                        00680000
*--------------------------------------------------------------         00690000
*   Return to requester                                                 00700000
*--------------------------------------------------------------         00710000
                                                                        00720000
RET      DS    0H                                                       00730000
         NOP   0                                                        00740000
                                                                        00750000
         @EXIT ,                                                        00760000
         DROP  R11                LOCATOR                               00770000
                                                                        00780000
         EJECT                                                          00790000
***************************************************************         00800000
*                                                                       00810000
*   Local read-only data areas, etc.                                    00820000
*                                                                       00830000
***************************************************************         00840000
                                                                        00850000
         LTORG ,                                                        00860000
         END   ,                                                        00870000
