INAVCLRV TITLE 'INAVCLRV - CLEAR VALUES FOR REGION-RESIDENT VARS'       00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: INAVCLRV - CLEAR VALUES FOR REGION-RESIDENT VARS             00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    THIS ROUTINE IS USED IN CONJUNCTION WITH REPEATING REGION/         00080000
*    VARIABLE PROCESSING TO CLEAR (DELETE) OUTPUT VARIABLES FROM        00090000
*    THEIR VARIABLE POOL AFTER A RESULT SET ROW HAS BEEN BUILT.         00100000
*    THIS IS DONE TO AVOID CARRY-OVER OF INAPPLICABLE DATA FROM         00110000
*    ROW TO ROW.                                                        00120000
*                                                                       00130000
*    THE TVBR VECTOR IS SCANNED FOR OUTPUT VARIABLES THAT LIE           00140000
*    WITHIN EXPLICITLY OR IMPLICITLY REPEATING REGIONS.                 00150000
*    $VARMGR IS INVOKED TO DELETE EACH OUTPUT VARIABLE FOUND            00160000
*    FROM THE PASSED VARIABLE POOL.                                     00170000
*                                                                       00180000
*                                                                       00190000
* ON ENTRY:                                                             00200000
*                                                                       00210000
*    R1  CONTAINS THE ADDR OF A PARAMETER LIST CONSTRUCTED              00220000
*        AS FOLLOWS:                                                    00230000
*                                                                       00240000
*           +00 - ADDR OF TRAVERSE VARS BY RGN VECTOR (TVBRVEC)         00250000
*           +04 - ADDR OF $VARMGR VARIABLE POOL BLOCK (POOL=)           00260000
*           +08 - ADDR OF $VARMGR STORAGE POOL (QH=)                    00270000
*                                                                       00280000
*                                                                       00290000
* ON EXIT:                                                              00300000
*                                                                       00310000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                     00320000
*                                                                       00330000
*        RC00 - VARIABLE CLEAR COMPLETE                                 00340000
*                                                                       00350000
**<DOC-OFF>****************************************************         00360000
                                                                        00370000
         EJECT                                                          00380000
***************************************************************         00390000
*                                                                       00400000
* MAINTENANCE:                                                          00410000
*                                                                       00420000
*   03/07/94  R. TURGEON                                                00430000
*             INITIAL VERSION                                           00440000
*                                                                       00450000
***************************************************************         00460000
                                                                        00470000
         EJECT                                                          00480000
***************************************************************         00490000
*                                                                       00500000
*   ENTRANCE LIST FORMAT                                                00510000
*                                                                       00520000
***************************************************************         00530000
PLIST    DSECT ,                       INAVCLRV PARM LIST FORMAT        00540000
PLTVBR   DS    A                       TVBR VECTOR ADDR      (TVBRVEC)  00550000
PLVPOOL  DS    A                       $VARMGR VARIABLE POOL (VMPOOL)   00560000
PLVSTGQH DS    A                       $VARMGR STORAGE POOL             00570000
PLISTLN  EQU   *-PLIST                                                  00580000
                                                                        00590000
         EJECT                                                          00600000
         #WORK ,                       READ/WRITE WORKAREA              00610000
                                                                        00620000
VAR_MFE  $VARMGR MF=L                  $VARMGR PLIST CONSTRUCTION AREA  00630000
REGSAVE  DS    16F                     LOCAL REGISTER SAVEAREA          00640000
                                                                        00650000
         #ENDWORK ,                    END OF WORKAREA                  00660000
                                                                        00670000
         EJECT                                                          00680000
         $NAVPARM ,                    SQL QUERY NAVIGATION PARMS       00690000
                                                                        00700000
         EJECT                                                          00710000
         TVBRVEC ,                     TRAVERSE VARS BY RGNS VECTOR     00720000
                                                                        00730000
         EJECT                                                          00740000
         REGION  ,                     REGION DEFINITION STRUCTURES     00750000
                                                                        00760000
         EJECT                                                          00770000
         ICATALOG VARIABLES            PROJECT VARIABLES                00780000
                                                                        00790000
         EJECT                                                          00800000
         $VARMGR DSECT=YES             VARIABLE MANAGEMENT              00810000
                                                                        00820000
         EJECT                                                          00830000
         ABCODES PRINT=NOGEN           ABEND CODES                      00840000
                                                                        00850000
         EQUS  ,                       GENERAL EQUATES                  00860000
                                                                        00870000
         EJECT                                                          00880000
INAVCLRV #ENTER PREG=(R8)                                               00890000
                                                                        00900000
         USING ITASK,R10               STANDARD ENVIRONMENT             00910000
         USING PLIST,R8                ENTRANCE LIST                    00920000
                                                                        00930000
         EJECT                                                          00940000
***************************************************************         00950000
*                                                                       00960000
*   PREPARE FOR TVBRVEC SCAN                                            00970000
*                                                                       00980000
***************************************************************         00990000
         L     R4,PLTVBR               FETCH TVBR VECTOR PTR            01000000
         USING TVBRVEC,R4              TRAVERSE VARS BY RGN VECTOR      01010000
                                                                        01020000
         ICM   R0,15,TVBNVARS          ENTRIES EXPECTED                 01030000
         BZ    NORMRET                 DONE IF NONE                     01040000
         LA    R6,TVVAR                POSITION TO FIRST ENTRY          01050000
         USING TVVAR,R6                ENTRY ADDRESSABILITY             01060000
                                                                        01070000
*--------------------------------------------------------------         01080000
*   IDENTIFY CHANGED VARIABLES BY CHANGED REGIONS                       01090000
*--------------------------------------------------------------         01100000
NEXT_VAR DS    0H                                                       01110000
         CLI   TVVOVAR,FALSE           VARIABLE DESCRIBED BY ENTRY?     01120000
         BE    ADV_VAR                 SKIP IF NOT                      01130000
                                                                        01140000
         ICM   R2,15,TVVRGNTY          LOCATE CORR REGION DEFINITION    01150000
         BZ    ADV_VAR                 VERY STRANGE                     01160000
         USING RGNTRY,R2               RGN DEFINITION                   01170000
         TM    RGNFLAG1,RGRPTRGN+RGRPTPAR                               01180000
         BZ    ADV_VAR                 NO IMPLICIT/EXPLICIT REPETITION  01190000
         DROP  R2                      RGNTRY                           01200000
                                                                        01210000
         ICM   R3,15,TVVCOLDF          LOCATE CORR $NAVPARM DEFINITION  01220000
         BZ    ADV_VAR                 STRANGE, BUT ONWARD              01230000
         USING IXRCOLDF,R3             $NAVPARM COLUMN/VAR XREF         01240000
         TM    IXRSTAT1,IXRS1INP       INPUT VARIABLE?                  01250000
         BO    ADV_VAR                 FILTER FOR OUTPUT VARS ONLY      01260000
         ICM   R0,15,TVVRECNT          REGION INSTANCE POSTED?          01270000
         BZ    CLR_VAR                 ENSURE VARS DELETED IF NOT       01280000
         TM    TVVFLAGS,TVVF$CHG       CHANGED ENTRY?                   01290000
         BNO   ADV_VAR                 RETAIN CURRENT VALUE IF NOT      01300000
                                                                        01310000
CLR_VAR  DS    0H                                                       01320000
         LA    R1,IXRCOLDF             R1 <== COLUMN/VAR DESCRIPTOR     01330000
         BAS   R14,CLEARVAR            REMOVE VALUE ASSOCIATION         01340000
                                                                        01350000
ADV_VAR  DS    0H                                                       01360000
         TM    TVVSTAT,TVVS$END        ALL TVBR ENTRIES PROCESSED?      01370000
         BO    NORMRET                 FUNCTION COMPLETE IF SO          01380000
         LA    R6,TVVLN(,R6)           ADVANCE TO NEXT TVBR ENTRY       01390000
         B     NEXT_VAR                PROCESS ALL ENTRIES              01400000
         DROP  R3,R4,R6                IXRCOLDF, TVBRVEC, TVVAR         01410000
                                                                        01420000
*--------------------------------------------------------------         01430000
*   RETURN TO CALLER                                                    01440000
*--------------------------------------------------------------         01450000
NORMRET  DS    0H                                                       01460000
         LA    R15,RC00                NORMAL RETURN                    01470000
                                                                        01480000
         #EXIT ,                       RETURN                           01490000
                                                                        01500000
         EJECT                                                          01510000
**<DOC-ON>*****************************************************         01520000
*                                                                       01530000
* ROUTINE: CLEARVAR - DELETE VARIABLE FROM VARIABLE POOL                01540000
*                                                                       01550000
* ON ENTRY:                                                             01560000
*                                                                       01570000
*    R1 - $NAVPARM COLUMN / VARIABLE ENTRY                              01580000
*                                                                       01590000
* ON EXIT:                                                              01600000
*                                                                       01610000
*    R15 CONTAINS THE $VARMGR RETURN CODE OR ZERO IF N/A                01620000
*                                                                       01630000
**<DOC-OFF>****************************************************         01640000
                                                                        01650000
CLEARVAR DS    0H                                                       01660000
         STM   R0,R15,REGSAVE          SAVE MAINLINE REGS               01670000
         LR    R3,R1                   $NAVPARM ENTRY                   01680000
         USING IXRCOLDF,R3                                              01690000
                                                                        01700000
         LA    R15,RC00                ASSUME NORMAL COMPLETION         01710000
         ICM   R2,15,IXR@RVAR          LOCATE VARIABLE DEFINITION       01720000
         BZ    CLEARET                 STRANGE, BUT ONWARD              01730000
         USING SVARSECT,R2             IN SYSVARIABLES FORMAT           01740000
                                                                        01750000
         $VARMGR VPUT,                 DELETE REQUEST                  X01760000
               SCOPE=$VARMGR_SCOPE_USER,                               X01770000
               VARNAME=SVARNAME,       VARIABLE NAME                   X01780000
               POOL=*PLVPOOL,          VARIABLE POOL                   X01790000
               QH=*PLVSTGQH,           STORAGE POOL                    X01800000
               MF=(E,VAR_MFE)                                           01810000
                                                                        01820000
         DROP  R2,R3                   SVARSECT, IXRCOLDF               01830000
                                                                        01840000
*--------------------------------------------------------------         01850000
*   RETURN $VARMGR STATUS TO CALLER                                     01860000
*--------------------------------------------------------------         01870000
CLEARET  DS    0H                      NEW RGN INSTANCES POSTED IN TVBR 01880000
         LM    R0,R14,REGSAVE          RESTORE REGS                     01890000
         BR    R14                     RETURN                           01900000
                                                                        01910000
         EJECT                                                          01920000
***************************************************************         01930000
*                                                                       01940000
*   LOCAL READ ONLY STORAGE                                             01950000
*                                                                       01960000
***************************************************************         01970000
         LTORG ,                                                        01980000
                                                                        01990000
         PRINT OFF                                                      02000000
         ICVT  ,                                                        02010000
         ITASK ,                                                        02020000
         END   ,                                                        02030000
