IINFLOGX TITLE '- GENERAL INFO EXCHANGE - LOG MESSAGE TRANSACTION'      00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: IINFLOGX - General Info Exchange - LOG MESSAGE xact          00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    This routine implements the Generalized Information Object         00080000
*    Exchange LOG MESSAGE function.  It allows the coop to              00090000
*    journal a list of messages to the log file and/or public           00100000
*    and private helpdesks as determined by routing flags               00110000
*    provided in the RU.                                                00120000
*                                                                       00130000
*    Options determine whether the messages provided require            00140000
*    a STDENV message id.  If so, the requester can override            00150000
*    the message severity code character appended to the                00160000
*    message number.                                                    00170000
*                                                                       00180000
*    Two types of help desk are identified.  A PRIVATE helpdesk         00190000
*    is a helpdesk appl that resides in the same ITASK as the           00200000
*    transaction originator and that monitors message destination       00210000
*    HPRIVATE.  It is generally best to monitor both the                00220000
*    HPUBLIC and HPRIVATE destinations when debugging with a            00230000
*    private helpdesk application.                                      00240000
*                                                                       00250000
*    A PUBLIC helpdesk is any helpdesk monitoring message class         00260000
*    HPUBLIC.  Generally, a public helpdesk excludes                    00270000
*    destination HPRIVATE to avoid receipt of debugging                 00280000
*    information, etc.                                                  00290000
*                                                                       00300000
*    The message is delivered to each of the destinations               00310000
*    indicated by reformatting each message line provided with          00320000
*    $MSG.  No special indication is given if no recipients             00330000
*    actually receive the journalled messages.  No response is          00340000
*    made to coop.                                                      00350000
*                                                                       00360000
*                                                                       00370000
* ON ENTRY:                                                             00380000
*                                                                       00390000
*    R1 contains the address of a parameter list mapped by              00400000
*       the XIO with one or more messages appended in IOLOGMSG          00410000
*       format.                                                         00420000
*                                                                       00430000
*                                                                       00440000
* ON EXIT:                                                              00450000
*                                                                       00460000
*    R15 contains zero                                                  00470000
*                                                                       00480000
**<DOC-OFF>****************************************************         00490000
                                                                        00500000
         EJECT                                                          00510000
***************************************************************         00520000
*                                                                       00530000
* MAINTENANCE:                                                          00540000
*                                                                       00550000
*    03/27/95 R. Turgeon - HELPDESK                                     00560000
*             Initial version                                           00570000
*                                                                       00580000
***************************************************************         00590000
                                                                        00600000
         EJECT                                                          00610000
         XIO   ,                  GENERALIZED INFO OBJECT EXCHANGE      00620000
                                                                        00630000
         EJECT                                                          00640000
         IOLOGMSG ,               XIO LOG MESSAGE PACKET ENTRIES        00650000
                                                                        00660000
         EJECT                                                          00670000
         ABCODES ,                                                      00680000
                                                                        00690000
         EQUS  ,                                                        00700000
                                                                        00710000
         $MSGDFT PREFIX=ICTPID,COMPID='JRN',TABLE=*#MSGS,              X00720000
               CONID=*ICTCONID,CONNAME=ICTCONNM,                       X00730000
               PRINT=NOGEN,MF=(E,$MSGMFL)                               00740000
                                                                        00750000
         EJECT                                                          00760000
WORKAREA #WORK ,                                                        00770000
                                                                        00780000
DESTMASK DS    X                  MESSAGE DESTINATIONS                  00790000
SOURCL   DS    F                                                        00800000
                                                                        00810000
$MSGMFL  $MSG  MF=(L,*),FIELDS=(,,,,)                                   00820000
                                                                        00830000
         #ENDWORK ,                                                     00840000
                                                                        00850000
         EJECT                                                          00860000
IINFLOGX #ENTER PREG=R8                                                 00870000
                                                                        00880000
         USING ITASK,R10                                                00890000
                                                                        00900000
         EJECT ,                                                        00910000
***************************************************************         00920000
*                                                                       00930000
*   Analyze request, terminate if no work defined                       00940000
*                                                                       00950000
***************************************************************         00960000
                                                                        00970000
         USING XIO,R8             INFO EXCHANGE / LOG MESSAGE           00980000
                                                                        00990000
         TM    XIOROUTE,XIOR_LOG  ROUTE TO LOGGING FACILITY             01000000
         BNO   *+8                                                      01010000
         OI    DESTMASK,$LOGFILE                                        01020000
                                                                        01030000
         TM    XIOROUTE,XIOR_PRV  ROUTE TO PRIVATE HELPDESK APP         01040000
         BNO   *+8                                                      01050000
         OI    DESTMASK,$HPRIVAT                                        01060000
                                                                        01070000
         TM    XIOROUTE,XIOR_PUB  ROUTE TO PUBLIC HELPDESK APP          01080000
         BNO   *+8                                                      01090000
         OI    DESTMASK,$HPUBLIC                                        01100000
                                                                        01110000
         CLI   DESTMASK,0         DESTINATIONS PROVIDED?                01120000
         BE    NORMRET            EXPENSIVE NOP IF NOT                  01130000
                                                                        01140000
         LA    R9,XIOSTD          PACKET APPL AREA ORIGIN               01150000
         AH    R9,XIOSRCO         CONVERT SOURCE OFFSET TO ADDR         01160000
                                                                        01170000
         LH    R6,XIOSRCL         SOURCE LENGTH                         01180000
         ST    R6,SOURCL                                                01190000
***************************************************************         01200000
*                                                                       01210000
*   Issue $MSG to format and deliver the message lines                  01220000
*                                                                       01230000
***************************************************************         01240000
                                                                        01250000
         SR    R6,R6              MESSAGE ENTRY COUNT                   01260000
         ICM   R6,3,XIOINFOC      MESSAGES PROVIDED?                    01270000
         BNP   NORMRET            DONE IF NOT                           01280000
                                                                        01290000
         LA    R7,XIOSTD          PACKET APPL AREA ORIGIN               01300000
         AH    R7,XIOINFO         CONVERT MESSAGE AREA OFFSET TO ADDR   01310000
         USING IOLOGMSG,R7        MESSAGE ENTRY FORMAT                  01320000
                                                                        01330000
*--------------------------------------------------------------         01340000
*   PARAMETERIZE AND ISSUE $MSG                                         01350000
*--------------------------------------------------------------         01360000
                                                                        01370000
PROCESS  DS    0H                                                       01380000
         SR    R4,R4              PREPARE FOR INSERT                    01390000
         ICM   R4,3,IOLMDATA      FETCH TEXT ORIGIN OFFSET              01400000
         BZ    ADVANCE            SKIP IF IMPROPER FORMAT               01410000
         LA    R4,IOLOGMSG(R4)    TEXT ORIGIN ADDRESS                   01420000
                                                                        01430000
         SR    R5,R5              PREPARE FOR INSERT                    01440000
         ICM   R5,3,IOLMDATL      FETCH TEXT LENGTH                     01450000
         BNP   ADVANCE            SKIP IF IMPROPER FORMAT               01460000
                                                                        01470000
*--------------------------------------------------------------         01480000
*   ISSUE MESSAGE WITH OR WITHOUT MESSAGE ID                            01490000
*--------------------------------------------------------------         01500000
                                                                        01510000
         IC    R3,IOLOPTNS        ISOLATE MSGID= OPTION                 01520000
         N     R3,=A(IOLO_MSGID)                                        01530000
         BNZ   MSGID                                                    01540000
                                                                        01550000
         LA    R9,XIOSTD          PACKET APPL AREA ORIGIN               01560000
         AH    R9,XIOINFO         CONVERT MESSAGE AREA OFFSET TO ADDR   01570000
                                                                        01580000
         $MSG  001,FIELDS=(((R9),*SOURCL),((R4),(R5))),                X01590000
               MSGID=NO,                                               X01600000
               SEVERITY=IOLMLEVL,                                      X01610000
               DESTADD=DESTMASK                                         01620000
         B     ADVANCE                                                  01630000
                                                                        01640000
MSGID    DS    0H                                                       01650000
         $MSG  001,FIELDS=(((R9),*SOURCL),((R4),(R5))),                X01660000
               MSGID=YES,                                              X01670000
               SEVERITY=IOLMLEVL,                                      X01680000
               DESTADD=DESTMASK                                         01690000
         B     ADVANCE                                                  01700000
                                                                        01710000
*--------------------------------------------------------------         01720000
*   PROCESS ALL MESSAGE ENTRIES                                         01730000
*--------------------------------------------------------------         01740000
                                                                        01750000
ADVANCE  DS    0H                                                       01760000
         AH    R7,IOLMLEN         ADVANCE TO NEXT IOLOGMSG              01770000
         BCT   R6,PROCESS                                               01780000
                                                                        01790000
         EJECT                                                          01800000
***************************************************************         01810000
*                                                                       01820000
*   CLEANUP AND TRANSACTION TERMINATION                                 01830000
*                                                                       01840000
***************************************************************         01850000
                                                                        01860000
NORMRET  DS    0H                                                       01870000
         SR    R15,R15            RETURN CODES NOT DEFINED              01880000
         SR    R0,R0              REASON CODES NOT DEFINED              01890000
         SR    R1,R1              INFO CODES NOT DEFINED                01900000
                                                                        01910000
         #EXIT ,                                                        01920000
                                                                        01930000
         EJECT                                                          01940000
***************************************************************         01950000
*                                                                       01960000
*   LOCAL READ ONLY DATA AREAS, ETC.                                    01970000
*                                                                       01980000
***************************************************************         01990000
                                                                        02000000
         LTORG ,                                                        02010000
                                                                        02020000
         EJECT                                                          02030000
         PRINT NOGEN                                                    02040000
         ICVT  ,                                                        02050000
         ITASK ,                                                        02060000
         END   ,                                                        02070000
