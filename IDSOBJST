IDSOBJST TITLE 'DATASPACE SERVICES - ACQUIRE OBJECT STORAGE'            00010000
***************************************************************         00020000
*                                                                       00030000
*   READ / WRITE WORKING STORAGE AREA                                   00040000
*                                                                       00050000
***************************************************************         00060000
WORKAREA DSECT                                                          00070000
                                                                        00080000
         @WORK ,                  STANDARD WORKAREA                     00090001
                                                                        00100001
WORKLEN  EQU   *-WORKAREA         WORKAREA LENGTH                       00110000
                                                                        00120001
         EJECT                                                          00130001
         SPCBLOCK ,                                                     00140000
                                                                        00150001
         EJECT                                                          00160001
         OIE   ,                                                        00170000
                                                                        00180001
         EJECT                                                          00190001
         $TOKEN ,                                                       00200000
                                                                        00210001
         EJECT                                                          00220001
         EQUS  LINKAGE=VCON                                             00230000
                                                                        00240001
         EJECT                                                          00250001
**<DOC-ON>*****************************************************         00260001
*                                                                       00270000
* ROUTINE: IDSOBJST - ACQUIRE OBJECT STORAGE                            00280000
*                                                                       00290000
* DESCRIPTION:                                                          00300000
*                                                                       00310000
*    OBJSTG API SHELL                                                   00320000
*    RETURNS AR QUALIFIED ADDRESSES                                     00330000
*    BY DEFAULT (REQSZ=0) THEN ALLOCATE ALU                             00340000
*                                                                       00350000
* ON ENTRY:                                                             00360000
*                                                                       00370000
*    R1 POINTS TO AN OS/VS PARAMETER LIST CONTAINING                    00380000
*                                                                       00390000
*        +00 - OBJECT TOKEN ADDRESS                                     00400000
*        +04 - STORAGE EXTENT SIZE OR ZERO                              00410000
*                                                                       00420000
*    A/R10 - AR QUALIFIED ADDRESS OF THE STORAGE SPCBLOCK               00430000
*                                                                       00440000
*                                                                       00450000
* ON EXIT:                                                              00460000
*                                                                       00470000
*    R15 CONTAINS ONE OF THE FOLLOWING RETURN CODES                     00480000
*                                                                       00490000
*        -4 - STORAGE SUCCESSFULLY ACQUIRED, OBJECT EXTENDED            00500000
*         0 - STORAGE SUCCESSFULLY ACQUIRED                             00510000
*         4 - STORAGE UNAVAILABLE                                       00520000
*        16 - INVALID REQUEST                                           00530000
*        20 - ALU TRANSLATION ERROR                                     00540000
*                                                                       00550000
*        ## - SERVICE ROUTINE FAILURE OR OTHER ENVIRON ERROR            00560000
*                                                                       00570000
**<DOC-OFF>****************************************************         00580001
                                                                        00590001
         EJECT                                                          00600001
IDSOBJST @ENTER WORKA=(WORKAREA,WORKLEN)                                00610000
                                                                        00620000
         LAE   R7,0(R1,0)         PLIST RESIDES IN PRIMARY              00630001
         LM    R3,R4,0(R1)        FETCH PASSED PARAMETERS               00640000
         LAE   R3,0(R3,0)         R3 <== OBJECT TOKEN                   00650001
*                                 R4 <== SIZE REQUESTED                 00660000
                                                                        00670000
         USING $TOKEN,R3          ADDRESSABILITY                        00680000
         CLC   $TOKTAG,=CL8'OBJTOKEN'                                   00690000
         BNE   ERR_REQ            VALIDATED                             00700000
                                                                        00710000
         L     R10,$SPCBASE       ESTAB PRINCIPLE SPACE ACCESS WINDOW   00720000
         USING SPCBLOCK,R10                                             00730000
         LAM   R10,R10,$ALET                                            00740000
                                                                        00750000
         LAE   R11,SPCBLOCK       OPEN WINDOW TO SPACE                  00760001
                                                                        00770000
*--------------------------------------------------------------         00780000
*   LOCATE OBJECT OIE                                                   00790000
*--------------------------------------------------------------         00800000
         LOCOIE ALUERR=ERR_ALU                                          00810000
                                                                        00820000
         LR    R11,R1             EXPOSE OIE IN OBJECT SPACE            00830000
         USING OIE,R11                                                  00840000
                                                                        00850000
*--------------------------------------------------------------         00860000
*   ACQUIRE STORAGE EXTENT FROM OBJECT                                  00870000
*--------------------------------------------------------------         00880000
         LTR   R4,R4              TEST REQUESTED EXTENT SIZE            00890000
         BP    *+8                HONOR REQUEST                         00900000
         L     R4,SPC_ALU_SIZE    USE DEFAULT ASSIGNMENT                00910000
                                                                        00920000
         OBJSTG $TOKEN,OIE,(R4),MF=(E,MFE_LIST)                         00930000
         B     RET                PASS THRU ALL RETURN INFO             00940000
                                                                        00950000
*--------------------------------------------------------------         00960000
*   RETURN COMPLETION STATUS TO CALLER                                  00970000
*--------------------------------------------------------------         00980000
ERR_REQ  DS    0H                 INVALID REQUEST                       00990000
         LA    R15,RC16                                                 01000000
         B     RET                                                      01010000
                                                                        01020000
ERR_ALU  DS    0H                 ALU TRANSLATION ERROR                 01030000
         LA    R15,RC20                                                 01040000
                                                                        01050000
RET      DS    0H                                                       01060000
         @EXIT ,                                                        01070000
                                                                        01080000
         EJECT ,                                                        01090000
***************************************************************         01100000
*                                                                       01110000
*   READ ONLY CONSTANTS, ETC.                                           01120001
*                                                                       01130000
***************************************************************         01140000
         LTORG ,                                                        01150000
         END   ,                                                        01160000
