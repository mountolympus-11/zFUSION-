IVDBXREF TITLE '- VALIDATE SYSCOLUMNS variables'                        00010000
**<DOC-ON>*****************************************************         00020000
*                                                                       00030000
* ROUTINE: IVDBXREF - Validate SYSCOLUMNs variables                     00040000
*                                                                       00050000
* DESCRIPTION:                                                          00060000
*                                                                       00070000
*    For each SYSCOLUMN entry contained in the VDBLOAD return           00080000
*    area, ensure that if a variable reference is present that          00090000
*    it has been bound to the appropriate SYSVARIABLEs entry.           00100000
*    Error messages are returned in the return area provided            00110000
*    by the caller.                                                     00120000
*                                                                       00130000
*                                                                       00140000
* ON ENTRY:                                                             00150000
*                                                                       00160000
*    R1  points to a parameter list constructed as follows              00170000
*                                                                       00180000
*        +00 - address of VDB LOAD result (VDBLRET)                     00190000
*        +04 - address of message collection area                       00200000
*        +08 - length  of message collection area                       00210000
*                                                                       00220000
*                                                                       00230000
* ON EXIT:                                                              00240000
*                                                                       00250000
*    R15 contains one of the following return codes                     00260000
*                                                                       00270000
*        RC00 - column/variable relationships complete                  00280000
*                                                                       00290000
*        RC04 - column/variable relationship unsatisfied for            00300000
*               one or more columns                                     00310000
*                                                                       00320000
**<DOC-OFF>****************************************************         00330000
                                                                        00340000
         EJECT                                                          00350000
***************************************************************         00360000
*                                                                       00370000
* MAINTENANCE:                                                          00380000
*                                                                       00390000
*    08/28/95 R. Turgeon                                                00400000
*             VDBLOAD cache implementation. VDBLOADP parameter          00410000
*             block split into distinct request/return areas.           00420000
*                                                                       00430000
***************************************************************         00440000
                                                                        00450000
         EJECT                                                          00460000
         VDBLOADP ,          REQUEST PARAMETER LIST                     00470000
                                                                        00480000
         EJECT                                                          00490000
         ICATALOG COLUMNS                                               00500000
                                                                        00510000
         EJECT                                                          00520000
         EQUS ,                                                         00530000
                                                                        00540000
         EJECT                                                          00550000
         $MSGDFT PREFIX=ICTPID,COMPID='SQL',TABLE=*#MSGS,              X00560000
               PRINT=NOGEN,MF=(E,$MSG_MFL)                              00570000
                                                                        00580000
         EJECT                                                          00590000
         #WORK ,                                                        00600000
                                                                        00610000
ERRFLAG  DS    X                  TRUE IF ERROR ENCOUNTERED             00620000
                                                                        00630000
$MSG_MFL $MSG  FIELDS=(,,,,),MF=(L,*)                                   00640000
                                                                        00650000
         #ENDWORK ,                                                     00660000
                                                                        00670000
         EJECT                                                          00680000
IVDBXREF #ENTER BASE=R12,PREG=R8                                        00690000
                                                                        00700000
         USING ITASK,R10          ITASK ADDRESSABILITY                  00710000
                                                                        00720000
         EJECT                                                          00730000
***************************************************************         00740000
*                                                                       00750000
*   Fetch passed parameters, general initialization                     00760000
*                                                                       00770000
***************************************************************         00780000
                                                                        00790000
         LM    R5,R7,0(R8)        FETCH PASSED PARAMETERS               00800000
         USING VDBLRET,R5                                               00810000
         USING $MSGBUF,R6         R6 <== $MSGBUF CONSTRUCTION AREA      00820000
*                                 R7 <== $MSBBUF AREA LENGTH            00830000
                                                                        00840000
         XC    $MSGBUF($MSBPFXL),$MSGBUF                                00850000
                                                                        00860000
***************************************************************         00870000
*                                                                       00880000
*   Ensure variable present for all columns defined with var            00890000
*                                                                       00900000
***************************************************************         00910000
                                                                        00920000
         LH    R9,LVDB#COL        NUMBER OF COLUMNS                     00930000
         LTR   R9,R9              ANY DEFINED?                          00940000
         BNP   RET                ABEND ELSEWHERE                       00950000
                                                                        00960000
         L     R3,LVDBACOL        COLUMN SECTION ORIGIN                 00970000
         USING SYSCOLS,R3         COLUMN FORMAT                         00980000
                                                                        00990000
NEXTCOL  DS    0H                                                       01000000
         LA    R4,SYSCOLS         COPY ENTRY ORIGIN                     01010000
         AH    R4,LVDBLCOL        END OF ENTRY                          01020000
         LA    R2,SCOLVEXE        SQL VERB DEPENDENT SECTION            01030000
         USING SKEYVAR,R2         FORMAT OF VERB SECTION                01040000
                                                                        01050000
NEXTVERB DS    0H                                                       01060000
         ICM   R0,3,SKVARSC#      VARIABLE ASSOCIATED WITH COL?         01070000
         BNZ   VERBADV            SKIP IF SO                            01080000
         TM    SKVARNAM,BF        VARIABLE NAMED FOR COL?               01090000
         BZ    VERBADV            SKIP IF NOT                           01100000
         MVI   ERRFLAG,TRUE       INDICATE ERRORS NOTED                 01110000
                                                                        01120000
         $MSG  036,FIELDS=(SKVARNAM,SCOLNAME),                         X01130000
               BUFR=(R6),BUFL=(R7),DEST=$BUFFER                         01140000
                                                                        01150000
VERBADV  DS    0H                                                       01160000
         LA    R2,SKEYVARL(,R2)   ADVANCE TO NEXT VERB                  01170000
         CR    R2,R4              END OF SYSCOLS REACHED?               01180000
         BL    NEXTVERB           AGAIN IF NOT                          01190000
                                                                        01200000
ADVANCE  DS    0H                                                       01210000
         AH    R3,LVDBLCOL        ADVANCE TO NEXT COLUMN                01220000
         BCT   R9,NEXTCOL                                               01230000
         DROP  R2,R3              SKEYVAR, SYSCOLS                      01240000
                                                                        01250000
         EJECT                                                          01260000
***************************************************************         01270000
*                                                                       01280000
*   Return completion status to requestor                               01290000
*                                                                       01300000
***************************************************************         01310000
                                                                        01320000
RET      DS     0H                                                      01330000
         LA     R15,RC00                                                01340000
         CLI    ERRFLAG,0                                               01350000
         BE     *+8                                                     01360000
         LA     R15,RC08                                                01370000
                                                                        01380000
         #EXIT  ,                                                       01390000
                                                                        01400000
         EJECT                                                          01410000
***************************************************************         01420000
*                                                                       01430000
*   Local read only storage                                             01440000
*                                                                       01450000
***************************************************************         01460000
                                                                        01470000
         LTORG ,                                                        01480000
                                                                        01490000
         EJECT                                                          01500000
         PRINT NOGEN                                                    01510000
         ICVT  ,                                                        01520000
         ITASK ,                                                        01530000
         END   ,                                                        01540000
